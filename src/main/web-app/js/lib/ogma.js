/**
 * Ogma
 * @description Graph visualization library
 * @version 4.6.5 (built on Fri Dec 29 2023 19:12:15 GMT+0000 (Coordinated Universal Time))
 * @author Linkurious SAS
 * @license (c) Linkurious 2023. All rights reserved.
 * @preserve
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t().default:"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).Ogma=t(),e.Ogma=e.Ogma&&e.Ogma.default?e.Ogma.default:e.Ogma)}(this,(function(){"use strict";var Ogma=(()=>{var e=Object.create,t=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,l=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,s,value)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value}):e[s]=value,__spreadValues=(e,t)=>{for(var s in t||(t={}))d.call(t,s)&&__defNormalProp(e,s,t[s]);if(a)for(var s of a(t))h.call(t,s)&&__defNormalProp(e,s,t[s]);return e},__spreadProps=(e,t)=>s(e,r(t)),__commonJS=(e,t)=>function __require(){return t||(0,e[o(e)[0]])((t={exports:{}}).exports,t),t.exports},__export=(e,s)=>{for(var i in s)t(e,i,{get:s[i],enumerable:!0})},__copyProps=(e,s,r,a)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let l of o(s))d.call(e,l)||l===r||t(e,l,{get:()=>s[l],enumerable:!(a=i(s,l))||a.enumerable});return e},__toESM=(s,i,r)=>(r=null!=s?e(l(s)):{},__copyProps(!i&&s&&s.__esModule?r:t(r,"default",{value:s,enumerable:!0}),s)),u=__commonJS({"node_modules/@linkurious/ogma-parsers/dist/ogma-parsers.umd.js"(e,t){var s,i;s=e,i=function(e){
/**
        * Ogma Parsers
        * @description Parsers for Ogma
        * @version 0.0.18 (built on Mon Nov 13 2023 16:35:06 GMT+0000 (Coordinated Universal Time))
        * @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
        * @license (c) Linkurious 2023. All rights reserved.
        * @preserve
        */
function A2(e,t,s){s=s||t,t in e&&(e.attributes[s]=e[t])}function C3(e,t,s){if(e&&"object"==typeof e){if(Array.isArray(e))return e.forEach((e=>C3(e,t,s)));if(function Vt(e){return"vertex"===e.type||"vertex"===e._type||e.inE||e.outE||e._inE||e._outE}(e)){const i={};e.properties&&Object.keys(e.properties).forEach((t=>{i[t]=e.properties[t][0].value}));const r=J2(e);t.push({id:r,data:{id:e.id+"",categories:[e.label],properties:i}});for(const i in e)"properties"!==i&&C3(e[i],t,s);return}if(function kt2(e){return"edge"===e.type||"edge"===e._type||e.inV||e.outV||e._outV||e._inV}(e)){const i=J2(e);s.push({id:i,source:dt2(e,["inV","_inV"]),target:dt2(e,["outV","_outV"]),data:{id:i,type:e.label,properties:e.properties||{}}});for(const i in e)"properties"!==i&&C3(e[i],t,s);return}Object.keys(e).forEach((i=>C3(e[i],t,s)))}}function dt2(e,t){for(const s of t)if(e[s])return J2(e[s])}function J2(e){if("string"==typeof e||isFinite(e))return String(e);const t=e;return String(t.id||t._id)}const g=e=>e.charCodeAt(0),t=g(" "),s=g("<"),i=g(">"),r=g('"'),o=g("\n"),a=g("\r"),l=g("/"),d=g("\\"),h=g("a"),u=g("z"),c=g("A"),m=g("Z"),p=g("0"),y=g("9"),x=g(":"),b=-1,v=-2,E=-3,k=-4;function Wt(e,t,s,i){const r=i.length;if(s-t!==r)return!1;for(let s=0;s<r;++s)if(e[t+s]!==i[s])return!1;return!0}function qt(e,t,s,i){return yt2(e.tags,t,s,i)}function yt2(e,t,s,i){const r=e.length;for(let o=0;o<r;++o)if(Wt(t,s,i,e[o]))return o;return e.push(t.slice(s,i)),r}function Xt(e,t,s){let o=z2(t,s),a=t[o];if(a===i||a===l)return o;let h=o;o=Et2(t,o);const u=function Kt(e,t,s,i){return yt2(e.attributes,t,s,i)}(e,t,h,o);for(;t[o]!==r;)++o;for(++o,h=o;(a=t[o])!==r;)a===d&&++o,++o;return e.tokens.push(E,u,h,o),o+1}function _t(e){return e===t||e===o||e===a}function z2(e,t){for(;_t(e[t]);)++t;return t}function te(e){return e>=h&&e<=u||e>=c&&e<=m||e===x||e>=p&&e<=y}function Et2(e,t){for(;te(e[t]);)++t;return t}function bt2(e,t){const s=["return {","  id: undefined,","  attributes: {","    text: undefined,","    color: undefined,",`    ${e?"radius":"width"}: undefined`,e?"  ,x: undefined":"",e?"  ,y: undefined":"","  },"];e||s.push("  source: undefined,","  target: undefined,");const i=Object.keys(t);i.length&&s.push("  data: {");for(let e=0;e<i.length;++e){const r=t[i[e]],o=r.title;s.push(`  "${o}": ${void 0!==r.default?JSON.stringify(r.default):void 0}${e===i.length-1?"":","}`)}return i.length&&s.push("}"),s.push("};"),new Function(s.join("\n"))}function mt(e){return-1===e.indexOf("\\")||(e=e.replace(/\\"/g,'"')),e}function wt2(e,t){let s=0;for(let i=0;i<20;++i){const r=s+e[i]+t[i];s=+(r>=10),e[i]=r%10}}const L=new class se{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:e,high:t}){if(0===e&&0===t)return"0";(function ie(e,t,s){for(let t=0;t<32;++t)s[t]=+!!(e&1<<t);for(let e=0;e<32;++e)s[e+32]=+!!(t&1<<e);return s})(e,t,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;const s=1===this._binaryNumber[63];s&&function ne(e){for(let t=0;t<64;++t)e[t]^=1;for(let t=0;t<64&&!(e[t]^=1);++t);}(this._binaryNumber);for(let e=0;e<64;++e)this._binaryNumber[e]&&wt2(this._decimalNumber,this._decimalPowerOfTwo),wt2(this._decimalPowerOfTwo,this._decimalPowerOfTwo);const i=[];let r=this._decimalNumber.length-1;for(s&&i.push("-");!this._decimalNumber[r];)r-=1;for(let e=r;e>=0;--e)i.push(String(this._decimalNumber[e]));return i.join("")}};function B3(e){return L.int64ToString(e)}function $2(e){return"object"==typeof e&&"high"in e&&"low"in e}const fe=e=>"start"in e&&"end"in e&&"type"in e,le=e=>"segments"in e;function v2(e,t,s,i){if(t)if(Array.isArray(t))t.forEach((t=>v2(e,t,s,i)));else if(le(t))!function ue(e,t,s,i){t.segments.forEach((t=>{v2(e,t.start,s,i),v2(e,t.end,s,i),v2(e,t.relationship,s,i)}))}(e,t,s,i);else if(function ae(e){if("object"!=typeof e||null===e)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");const t=Object.keys(e.properties);for(const s of t){const t=e.properties[s];$2(t)&&(e.properties[s]=B3(t))}if(void 0!==e.identity){if($2(e.identity)&&(e.identity=B3(e.identity)),function re(e){return"start"in e&&"end"in e}(e)){const t=e.start.identity||e.start,s=e.end.identity||e.end;$2(t)&&(e.start=B3(t)),$2(s)&&(e.end=B3(s))}}else e.id&&(e.identity=e.id)}(t),fe(t))i.has(t.identity)||(i.add(t.identity),e.edges.push({id:t.identity,source:t.start,target:t.end,data:{neo4jType:t.type,neo4jProperties:t.properties}}));else{const i=t;s.has(i.identity)||(s.add(i.identity),e.nodes.push({id:i.identity,attributes:{},data:{neo4jLabels:i.labels,neo4jProperties:i.properties}}))}}const D={boolean:e=>"true"===e.toLowerCase(),int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:e=>e};function Nt(e,t,s){const i=e.getElementsByTagName("data"),r={};for(let e=0;e<i.length;e++){const s=i[e],o=s.getAttribute("key");if(null===o)continue;const a=t[o];typeof a>"u"?r[o]=s.textContent:s.textContent&&0!==s.textContent.length&&(r[a.name]=a.parse(s.textContent))}for(const e in s)e in r||(r[e]=s[e]);return r}function W2(e){return e.color?e.color:e.r&&e.g&&e.b?`rgb(${e.r}, ${e.g}, ${e.b})`:void 0}const B=new Set(["x","y","size","color","r","g","b","label"]);function It2(e){const t={};for(const s in e)B.has(s)||void 0===e[s]||(t[s]=e[s]);return t}e.gexf=function ee(e){if(-1===e.indexOf("<gexf"))throw new Error("not a GEXF file");const t=function Qt(e){const t=new Int32Array(e.length);for(let s=0,i=e.length;s<i;++s)t[s]=e.charCodeAt(s);return t}(e),r=function jt(e,t){let r,o;const a={tags:[],attributes:[],tokens:[]},d=a.tokens;let h=z2(e,t);for(;h<e.length;){let t=e[h];if(t===s){if(h=z2(e,++h),e[h]===l)for(d.push(v);e[++h]!==i;);else{r=h,h=Et2(e,r);const s=qt(a,e,r,h);for(d.push(b,s),t=e[h];t!==i&&t!==l;)h=Xt(a,e,h),t=e[h];if(t===l)for(d.push(v);e[++h]!==i;);}h+=1}else{for(r=h;e[++h]!==s;);for(o=h-1;_t(e[o]);)--o;d.push(k,r,o+1)}h=z2(e,h)}return a}(t,e.indexOf("<gexf ")),o={},a={};r.tags.forEach(((e,t)=>{const s=String.fromCharCode.apply(null,e);o[s]=t})),r.attributes.forEach(((e,t)=>{const s=String.fromCharCode.apply(null,e);a[s]=t}));const d=o.attributes,h=o.attribute,u=o.node,c=o.edge,m=o.default,p=o["viz:position"],y=o["viz:size"],x=o["viz:color"],L=o.attvalue,D=a.class,B=a.id,H=a.type,X=a.title,Y=a.label,Z=a.source,oe=a.target,de=a.x,he=a.y,ce=a.r,me=a.g,_e=a.b,pe=a.a,ye=a.value,xe=a.for,be=a.weight,ve={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5};let Se=0;const Ee=r.tokens,we=Ee.length,Ce=new Array(16);let ke=0,Me=0,Le=0,Ie=!0;const Ne={},Pe={};let Fe,ze,De="",Re="",Oe="",Be={attributes:{}},je=0,Ve=0,Ue=0,Ge=1,We="",He=!1,qe=!0,Xe=null,$e=null;const Ye=[],Ze=[];let Qe=0,Ke={};for(;Se<we;){const s=Ee[Se];if(s===b)Me=ke,ke=Ee[Se+1],Ce[Le]=ke,Le+=1,ke===u?(Xe||(Xe=bt2(!0,Ne)),Be=Xe(),qe=!0,Ke=Ne):ke===c&&($e||($e=bt2(!1,Pe)),Be=$e(),qe=!1,Ke=Pe),Se+=2;else if(s===v){if(De&&ke===h){Ke=Ie?Ne:Pe;const e=ve[Re];let t=Fe;t&&(1===e?t=+t:2===e?t=0|+t:3===e?t="true"===t:5===e&&(t=t.split(" ").filter((e=>e)))),Ke[De]={title:Oe||De,default:t,type:e},De="",Oe="",Re="",Fe=void 0}else if(ke===u&&4===Le)He&&Be.attributes&&(Be.attributes.color=`rgba(${je}, ${Ve}, ${Ue}, ${Ge})`,je=0,Ve=0,Ue=0,Ge=1,He=!1),Be.id||(Be.id=++Qe),Ye.push(Be);else if(ke===c&&4===Le)Be.id||(Be.id=++Qe),Ze.push(Be);else if(ke===L&&6===Le&&We){const e=(qe?Ne:Pe)[We];if(e){if(void 0===ze)ze=e.default;else{const s=e.type;s&&(1===s?ze=+ze:2===s?ze=0|+ze:3===s?ze="true"===ze:5===s?ze=ze.split(" ").filter((e=>e)).map((e=>mt(e))):"string"==typeof t&&(ze=mt(ze)))}Be.data[Ke[We].title]=ze}We="",ze=null}Le-=1,ke=Me,Me=Ce[Le-2],Se+=1}else if(s===E){const t=Ee[Se+1],s=e.substring(Ee[Se+2],Ee[Se+3]);if(ke===d)t===D&&(Ie="edge"!==s&&"edges"!==s);else if(ke===h)t===B?De=s:t===H?Re=s:t===X&&(Oe=s);else if(ke!==u&&ke!==c||4!==Le)if(ke===p&&5===Le){if(t===de)Be.attributes.x=parseFloat(s);else if(t===he){const e=parseFloat(s);Be.attributes.y=0===e?e:-e}}else ke===x&&5===Le?(He=!0,t===ce?je=parseInt(s):t===me?Ve=parseInt(s):t===_e?Ue=parseInt(s):t===pe&&(Ge=parseFloat(s))):ke===y&&5===Le?t===ye&&(qe?Be.attributes.radius=+s:Be.attributes.width=+s):ke===L&&6===Le&&(t===xe||t===B?We=s:t===ye&&(ze=s));else t===B?Be.id=s:t===Y?Be.attributes.text=s:t===Z?Be.source=s:t===oe?Be.target=s:t===be&&(Be.attributes.width=+s);Se+=4}else{if(s!==k)throw new Error(`at index ${Se}: token ${s}`);{const t=e.substring(Ee[Se+1],Ee[Se+2]);ke===m&&(Fe=t),Se+=3}}}return{nodes:Ye,edges:Ze}},e.graphml=function Ae(e,t){if(!t){if(typeof DOMParser>"u")throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");t=new DOMParser}const s=t.parseFromString(e,"application/xml"),i=s.getElementsByTagName("key"),r=s.getElementsByTagName("node"),o=s.getElementsByTagName("edge"),{definitions:a,defaults:l}=function Te(e){const t={graph:{},node:{},edge:{}},s={graph:{},node:{},edge:{}};for(let i=0;i<e.length;i++){const r=e[i],o=r.getAttribute("for")||"node",a=r.getAttribute("id"),l=r.getAttribute("attr.name"),d=r.getAttribute("attr.type")||"string",h=r.getElementsByTagName("default"),u=0!==h.length?h[0].textContent:void 0;t[o][a]={name:l,parse:D[d]},typeof u<"u"&&(s[o][l]=u)}return{definitions:t,defaults:s}}(i),d=[],h=new Set;for(let e=0;e<r.length;e++){const t=r[e],s=t.getAttribute("id"),i=t.getAttribute("href")||void 0,o=Nt(t,a.node,l.node);h.add(s);const u={id:s,attributes:{x:o.x,y:o.y,radius:o.size,color:W2(o),text:o.label},data:It2(o)};void 0!==o.x&&(u.attributes.x=o.x),void 0!==o.y&&(u.attributes.y=o.y),void 0!==o.size&&(u.attributes.radius=o.size),void 0!==o.label&&(u.attributes.text=o.label);const c=W2(o);void 0!==c&&(u.attributes.color=c),void 0!==i&&(u.data.href=i),d.push(u)}const u=[];for(let e=0;e<o.length;e++){const t=o[e],s=t.getAttribute("id")||e,i=t.getAttribute("source"),r=t.getAttribute("target"),d=t.getAttribute("xlink:href")||void 0;if(!h.has(i)||!h.has(r))throw new Error(`Invalid edge: ${i} -> ${r}`);const c=Nt(t,a.edge,l.edge),m={id:s,source:i,target:r,attributes:{},data:It2(c)},p=W2(c);void 0!==p&&(m.attributes.color=p),void 0!==d&&(m.data.href=d),u.push(m)}return{nodes:d,edges:u}},e.janus=function Rt(e){const t=[],s=[];return C3("string"==typeof e?JSON.parse(e):e,t,s),{nodes:t,edges:s}},e.json=function Gt(e,t=(e=>e)){const s=t(JSON.parse(e)),i=s.nodes||[],r=s.edges||[];for(let e=0;e<i.length;e++){const t=i[e];t.attributes||(t.attributes={}),"string"==typeof t.size&&(t.size=+t.size),"string"==typeof t.x&&(t.x=+t.x),"string"==typeof t.y&&(t.y=+t.y),A2(t,"x"),A2(t,"y"),A2(t,"size","radius"),A2(t,"color"),A2(t,"text")}for(let e=0;e<r.length;e++){const t=r[e];t.attributes||(t.attributes={}),"string"==typeof t.size&&(t.size=+t.size),A2(t,"size","width"),A2(t,"color"),A2(t,"text")}return{nodes:i,edges:r}},e.neo4j=function ge(e){let t="string"==typeof e?JSON.parse(e):e;const s={nodes:[],edges:[]},i=new Set,r=new Set;return(e=>"queryKeys"in e&&"values"in e)(t)&&(t=function de2(e){const t=[];return e.values.forEach((e=>{const{nodes:s=[],relationships:i=[],segments:r=[]}=e.adapted,o=[{segments:r,properties:{}}];t.push({_fields:[...s,...i,...o]})})),{records:t}}(t)),t.records.forEach((({_fields:e})=>e.forEach((e=>v2(s,e,i,r))))),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})},"object"==typeof e&&typeof t<"u"?i(e):"function"==typeof define&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaParsers={})}}),c=__commonJS({"node_modules/@linkurious/ogma-generators/dist/ogma-generators.umd.js"(e,t){var s,i;s=e,i=function(e){const t=Object.freeze(Object.defineProperty({__proto__:null,configure:({nodes:e=10,edges:t=10,texts:s=!1,scale:i=100}={})=>({nodes:e,edges:t,texts:s,scale:i}),generate:function w({nodes:e,scale:t,texts:s,edges:i}){const r=[],o=[];for(let i=0;i<e;i++)r.push({id:i,attributes:{x:Math.random()*t,y:Math.random()*t,text:s?`Node ${i}`:void 0}});for(let t=0;t<i;t++)o.push({id:t,source:Math.random()*e|0,target:Math.random()*e|0,attributes:{text:s?`Edge ${t}`:void 0}});return{nodes:r,edges:o}}},Symbol.toStringTag,{value:"Module"})),s=Object.freeze(Object.defineProperty({__proto__:null,configure:({rows:e=4,columns:t=4,columnDistance:s=20,rowDistance:i=20,xmin:r=0,ymin:o=0}={})=>({rows:e,columns:t,columnDistance:s,rowDistance:i,xmin:r,ymin:o}),generate:function j2({rows:e,columns:t,columnDistance:s,rowDistance:i,xmin:r,ymin:o}){const a={nodes:[],edges:[]};let l=0;for(let d=0;d<e;++d)for(let h=0;h<t;++h){const u=d*t+h;a.nodes.push({id:u,attributes:{x:r+h*s,y:o+d*i}}),h!==t-1&&(a.edges.push({id:l,source:u,target:d*t+h+1}),l++),d!==e-1&&(a.edges.push({id:l,source:u,target:(d+1)*t+h}),l++)}return a}},Symbol.toStringTag,{value:"Module"})),i=Object.freeze(Object.defineProperty({__proto__:null,configure:({length:e=5,scale:t=100}={})=>({length:e,scale:t}),generate:function I2({length:e,scale:t}){const s={nodes:[],edges:[]};if(e<=0)return s;s.nodes.push({id:0,attributes:{x:Math.random()*t,y:Math.random()*t}});for(let i=1;i<e;++i)s.nodes.push({id:i,attributes:{x:Math.random()*t,y:Math.random()*t}}),s.edges.push({id:i-1,source:i-1,target:i});return s}},Symbol.toStringTag,{value:"Module"}));function m2(e){return"number"==typeof e&&isFinite(e)?e:void 0}const r=Object.freeze(Object.defineProperty({__proto__:null,configure:function R2({children:e=2,height:t=3}={}){if(!function D3(e){return"number"==typeof e&&isFinite(e)&&e>0?e:void 0}(e))throw new TypeError('Invalid argument: "children" is not a positive number, was '+e);if(!function P2(e){return"number"==typeof e&&isFinite(e)&&e>=0?e:void 0}(t))throw new TypeError('Invalid argument: "height" is not a positive number, was '+t);return{children:e,height:t}},generate:function z2({children:e,height:t}){t+=1;const s=Math.pow(e,t),i=[],r=[];let o=1,a=0,l=0;for(let d=0;d<t;++d){const h=s/(o+1)/1.5;for(let s=0;s<o;++s){const o=a++;if(i.push({id:o,attributes:{x:(s+1)*h*10,y:20*d}}),d!==t-1)for(let t=0;t<e;++t)r.push({id:l,source:o,target:o*e+t+1}),l+=1}o*=e}return{nodes:i,edges:r}}},Symbol.toStringTag,{value:"Module"})),o=Object.freeze(Object.defineProperty({__proto__:null,configure:function F2({nodes:e=20,edges:t,p:s,scale:i=100}={}){if(!m2(e)||e<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+e);if(void 0!==t&&void 0!==s)throw new TypeError("Invalid argument: choose between options.edges and options.p");return void 0===t&&void 0===s&&(s=.1),void 0===s&&(s=-1),void 0===t&&(t=-1),{nodes:e,p:s,edges:t,scale:i}},generate:function C3(e){const t={nodes:[],edges:[]},s=e.nodes,i=e.p,r=e.scale;if(i>=0){let e=0;for(let o=0;o<s;o++){t.nodes.push({id:o,attributes:{x:Math.random()*r,y:Math.random()*r}});for(let s=0;s<o;s++)Math.random()<i&&t.edges.push({id:e++,source:o,target:s})}}else{const i=[],r=e.edges;for(let e=0;e<s;e++){t.nodes.push({id:e,attributes:{x:100*Math.random(),y:100*Math.random()}});for(let t=e+1;t<s;t++)i.push({source:e,target:t})}let o=i.length-1;for(let e=0;e<r;e++){const s=i.splice(Math.floor(Math.random()*o),1)[0];s.id=e,t.edges.push(s),o--}}return t}},Symbol.toStringTag,{value:"Module"})),a=Object.freeze(Object.defineProperty({__proto__:null,configure:function U2({nodes:e=40,m0:t=5,m:s=1,scale:i=100}={}){if(!m2(e)||e<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+e);if(!m2(t)||t>=e)throw new TypeError(`Invalid argument: options.m0 is not a number < ${e}, was ${t}`);if(!m2(t)||s>=t)throw new TypeError(`Invalid argument: options.m is not a number <= ${t}, was ${s}`);if(!m2(i)||i<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:e,m0:t,m:s,scale:i}},generate:function B3({scale:e,nodes:t,m0:s,m:i}){const r={nodes:[],edges:[]},o={},a=[],l=e/10;let d=0;for(let e=0;e<s;e++)r.nodes.push({id:e,attributes:{x:Math.random()*l,y:Math.random()*l}}),a[e]=0;for(let e=0;e<s;e++)for(let t=e+1;t<s;t++){const s={id:d++,source:e,target:t};o[s.source+"-"+s.target]=s,r.edges.push(s),a[e]++,a[t]++}for(let l=s;l<t;l++){r.nodes.push({id:l,attributes:{x:Math.random()*e,y:Math.random()*e}}),a[l]=0;let t=0;for(let e=0;e<l;e++)t+=a[e];let s=0;for(let e=0;e<i;e++){const i=Math.random();let h=0;for(let u=0;u<l;u++)if(!o[`${l}-${u}`]&&!o[`${u}-${l}`]&&(h=1===l?1:h+a[u]/t+s/(l-e),i<=h)){s+=a[u]/t;const e={id:d++,source:l,target:u};o[`${e.source}-${e.target}`]=e,r.edges.push(e),a[l]++,a[u]++;break}}}return r}},Symbol.toStringTag,{value:"Module"})),l=Object.freeze(Object.defineProperty({__proto__:null,configure:function q2({nodes:e=50,width:t=100,height:s=100,x:i=0,y:r=0}={}){if(!isFinite(e)||e<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:e,width:t,height:s,x:i,y:r}},generate:function H2({nodes:e,x:t,y:s,width:i,height:r}){const o=t-i/2,a=s-r/2;return{nodes:new Array(e).fill(0).map(((e,t)=>({id:t,attributes:{x:o+Math.random()*i,y:a+Math.random()*r}}))),edges:new Array(e-1).fill(0).map(((e,t)=>({id:t,source:Math.floor(Math.sqrt(t)),target:t+1})))}}},Symbol.toStringTag,{value:"Module"})),d=5,h=10,u=10,c=2.7,m=.2;function M(e){return Math.pow(c,e)*h}function v2(e){return d+M(e)/u}function T2(e,t,s,i,r){if(0===s)return r;const o=M(s),a=v2(s),l=a*m;let d=-Math.PI;const h=2*Math.PI/t,u=i.attributes.x||0,c=i.attributes.y||0;for(let m=0;m<t;++m){const m={id:r,attributes:{x:u+o*Math.cos(d),y:c+o*Math.sin(d),radius:a}},p={id:r,source:i.id,target:r,attributes:{width:l}};e.nodes.push(m),e.edges.push(p),r=T2(e,t,s-1,m,r+1),d+=h}return r}const p=Object.freeze(Object.defineProperty({__proto__:null,configure:function Q2({depth:e=3,breadth:t=3,nodes:s}){return void 0!==s?(t=5,e=Math.ceil(Math.log(s)/Math.log(5))):s=-1,{depth:e,breadth:t,nodes:s}},generate:function V2({depth:e,breadth:t,nodes:s}){const i={id:0,attributes:{x:0,y:0,radius:v2(e+1)}},r={nodes:[i],edges:[]};return T2(r,t,e,i,1),void 0!==s&&s>=0&&(r.nodes=r.nodes.slice(0,s),r.edges=r.edges.slice(0,Math.max(s-1,0))),r}},Symbol.toStringTag,{value:"Module"}));e.balancedTree=r,e.barabasiAlbert=a,e.erdosRenyi=o,e.flower=p,e.grid=s,e.path=i,e.random=t,e.randomTree=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})},"object"==typeof e&&typeof t<"u"?i(e):"function"==typeof define&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaGenerators={})}}),m={};__export(m,{BoundingBox:()=>ss,Edge:()=>ai,EdgeList:()=>li,Neo4JEdgeData:()=>Vc.Neo4JEdgeData,Neo4JNodeData:()=>Vc.Neo4JNodeData,Node:()=>yi,NodeList:()=>xi,NonObjectPropertyWatcher:()=>fl,ObjectPropertyWatcher:()=>yl,StyleClass:()=>va,StyleRule:()=>Tl,Transformation:()=>Xd,default:()=>Uc});var p=class{constructor(e){this._ogma=e}},y={};function weightedStress(e,t,s,i,r,o){let a=0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){const i=o[l],h=o[d];if(i!==h){const o=e[i][h]*r,l=1/(o*o);if(l){const e=t[i]-t[h],r=s[i]-s[h];a+=l*Math.pow(o-Math.sqrt(e*e+r*r),2)}}}return a}function distanceStress(e,t,s,i,r,o,a){let l=0;if(-1===r)return 0;for(let d=0;d<i;d++)for(let h=0;h<i;h++){const i=a[d],u=a[h];if(i!==u&&(i===r||u===r)){const r=e[i][u]*o,a=1/(r*r);if(a){const e=t[i]-t[u],o=s[i]-s[u];l+=a*Math.pow(r-Math.sqrt(e*e+o*o),2)}}}return l}function constrainedStress(e,t,s,i,r,o,a,l){a=a||0;let d=0,h=0;for(let a=0;a<i;a++)for(let u=0;u<i;u++){const i=l[a],c=l[u];if(i!==c){const a=e[i][c]*o,l=1/(a*a);if(l){const e=t[i]-t[c],o=s[i]-s[c],u=l*Math.pow(a-Math.sqrt(e*e+o*o),2);d+=u,i!==r&&c!==r||(h+=u)}}}return(1-a)*d+a*h}function stressMinimizationStep(e,t,s,i,r,o,a,l,d){a=a||0;const h=t,u=s;-1===(r=void 0===r?-1:r)&&(a=0);const c=t[r],m=s[r];for(let p=0;p<i;p++){const y=l[p],x=d(e[r][p]),b=a/(x*x);if(0===x)continue;let v=0,E=0,k=0;const L=t[y],D=s[y];for(let r=0;r<i;r++){const i=l[r];if(i!==y){const r=e[y][i]*o,l=1/(r*r),d=t[i],h=s[i];if(0!==l){const e=L-d,t=D-h,s=e*e+t*t,i=s<1e-12?0:1/Math.sqrt(s);E+=(1-a)*l*(d+r*(L-d)*i),k+=(1-a)*l*(h+r*(D-h)*i)}v+=l}}const B=(1-a)*v+b;if(0!==B){const e=L-c,i=D-m;let r=e*e+i*i;r=r<1e-12?0:1/Math.sqrt(r);const o=0===x?0:b*(x*r);h[y]=(E+o*t[y])/B,u[y]=(k+o*s[y])/B}}return{x:h,y:u}}function stressMinimizationStepGeneral(e,t,s,i,r,o,a,l){a=a||0;const d=t,h=s;let u;-1===(r=void 0===r?-1:r)&&(a=0);for(let c=0;c<i;c++){const m=l[c];let p=0,y=0,x=0;const b=t[m],v=s[m];for(let d=0;d<i;d++){const i=l[d];let h=0;if(i!==m){let l=0;const d=e[m][i]*o,u=1/(d*d);m!==r&&i!==r||(l=u);const c=(1-a)*u+a*l;if(p+=c,0!==u){const e=t[i],r=s[i],o=b-e,a=v-r,l=o*o+a*a;l>1e-6&&(h=1/Math.sqrt(l)),y+=c*(e+d*(b-e)*h),x+=c*(r+d*(v-r)*h)}}}u=p,0!==u&&(d[m]=y/u,h[m]=x/u)}return{x:d,y:h}}function minHeap(e=((e,t)=>e-t),t=[],s={},i=(e=>e)){let r=t.length;function heapify(o){for(;;){const a=2*o+1,l=a+1;let d=o;if(a<r&&e(t[a],t[d])<0&&(d=a),l<r&&e(t[l],t[d])<0&&(d=l),d===o)return o;const h=t[d];t[d]=t[o],t[o]=h,s[i(t[d])]=d,s[i(h)]=o,o=d}}const o={get keys(){return s},get size(){return r},heapify,pop(){if(r<=0)return;if(1===r)return r--,t[0];const e=t[0];return t[0]=t[r-1],r--,heapify(0),e},decreaseKey(r,value){for(void 0!==value&&(t[r]=value,s[i(value)]=r);r>0;){const o=r-1>>1;if(!(e(t[o],t[r])>0))break;{const e=t[r];t[r]=t[o],t[o]=e,s[i(t[r])]=r,s[i(e)]=o,r=o}}return r},min:()=>t[0],remove(e){return this.decreaseKey(e,Number.NEGATIVE_INFINITY),this.pop()},push(o){r++;let a=r-1;for(t[a]=o;a>0;){const r=a-1>>1;if(!(e(t[r],t[a])>0))break;{const e=t[a];t[a]=t[r],t[r]=e,s[i(t[a])]=a,s[i(e)]=r,a=r}}return a},empty:()=>r<=0,toArray:()=>t.slice(0,r)};return o}function bellmanFord({sources:e,targets:t,weights:s,source:i,target:r,undirected:o=!1,indexes:a,N:l}){if(!(l=a?a.length:l)||!isFinite(l)||0===l)throw new Error("Invalid number of nodes "+l);const d=new Float32Array(l),h=new Int32Array(l),u={},c=Number.POSITIVE_INFINITY;if(!s){s=[];for(let e=0;e<l;e++)s[e]=1}if(!a){a=new Uint32Array(l);for(let e=0;e<l;e++)a[e]=e+1}for(let e=0;e<l;e++)d[e]=c,h[e]=-1,u[a[e]]=e;d[u[i]]=0;let m=!1;for(let i=1;i<=l;i++){for(let i=0;i<s.length;i++){const r=e[i],a=t[i],l=u[r],p=u[a];if(void 0!==l&&void 0!==p){const e=s[i];let t=d[l]+e;d[l]!==c&&t<d[p]&&(d[p]=t,h[p]=r,m=!0),o&&(t=d[p]+e,d[p]!==c&&t<d[l]&&(d[l]=t,h[l]=a,m=!0))}}if(!m)break}if(m)for(let i=0;i<s.length;i++){const r=e[i],o=t[i],a=u[r],l=u[o];if(void 0!==a&&void 0!==l){const e=s[i];if(d[a]+e<d[l])return null}}let p=null,y=null;if(void 0!==r){const e=u[r];if(void 0!==e&&d[e]!==c){p=[];for(let e=r;-1!==e;e=h[u[e]])p.push(e);p=p.reverse(),y=d[e]}}return{distances:d,path:p,pathLength:y}}function dijkstra(e,t,s,i,r,o,a){i=i||e.map(((e,t)=>t+1));const l=i.length,d=new Float32Array(l),h=new Int32Array(l),u=new Uint32Array(l),c=Number.POSITIVE_INFINITY,m={};if(0===l)return{distances:d,path:null,pathLength:null};if(!r){r={};for(let e=0;e<l;e++)r[i[e]]=e}for(let e=0;e<l;e++)d[e]=c,h[e]=-1,u[e]=m[e]=e;const p=minHeap(((e,t)=>d[e]-d[t]),u,m);for(d[r[t]]=0,p.decreaseKey(m[r[t]]);0!==p.size;){const t=p.pop(),s=d[t],l=e[t];if(s===c)break;for(let e=0,u=l.nodes.length;e<u;e++){const u=l.nodes[e],c=o?1:a?a(i[t],u):l.weights?l.weights[e]:1,y=r[u];if(void 0===y)continue;const x=s+c;x<d[y]&&(d[y]=x,h[y]=t,p.decreaseKey(m[y]))}}let y=null,x=null;if(void 0!==s){const e=r[s];if(d[e]!==c){y=[];for(let t=e;-1!==t;t=h[t])y.push(i[t]);y.reverse(),x=d[s]}}return{distances:d,path:y,pathLength:x}}function johnson({sources:e,targets:t,weights:s,indexes:i,adjacency:r,undirected:o,ignoreWeights:a}){const l=Number.POSITIVE_INFINITY,d=i?i.length:r.length;if(!i){i=new Uint32Array(d);for(let e=0;e<d;e++)i[e]=e+1}const h=new Array(d),u={};for(let e=0;e<d;e++){h[e]=new Float32Array(d);for(let t=0;t<d;t++)h[e][t]=e===t?0:l;u[i[e]]=e}const c=d,m=s.length;e=e.slice(),t=t.slice(),s=s.slice();for(let r=0;r<d;r++)e[m+r]=c,t[m+r]=i[r],s[m+r]=0,a&&(s[r]=1);const p=bellmanFord({sources:e,targets:t,weights:s,undirected:o,N:d+1,source:c});if(null===p)throw new Error("Graph has negative weight loops");const y=p.distances;for(let i=0;i<s.length;i++){const r=u[e[i]],o=u[t[i]];void 0!==r&&void 0!==o&&(s[i]=s[i]+y[r]-y[o])}e=e.slice(0,m),t=t.slice(0,m),s=s.slice(0,m);for(let e=0;e<d;e++){const t=i[e],{distances:s}=dijkstra(r,t,void 0,i,u,!!a);for(let t=0;t<d;t++)h[e][t]=e===t?0:s[t]}return h}__export(y,{CyclesFinder:()=>ks,Quadtree:()=>Ts,bellmanFord:()=>bellmanFord,betweenness:()=>betweennes,circlePack:()=>circlePack,circleSpread:()=>circleSpread,constrainedStress:()=>constrainedStress,convexhull:()=>convexHull,detectCyclesDirected:()=>detectCyclesDirected,detectCyclesUndirected:()=>detectCyclesUndirected,detectCyclesUndirectedDFS:()=>detectCyclesUndirectedDFS,dijkstra:()=>dijkstra,distanceStress:()=>distanceStress,johnson:()=>johnson,kruskal:()=>kruskal_default,largestEmptyCircle:()=>getLargestEmptyCircle,minDisk:()=>minDisk,minHeap:()=>minHeap,removeRadialOverlap:()=>removeRadialOverlap,stressMinimizationStep:()=>stressMinimizationStep,stressMinimizationStepGeneral:()=>stressMinimizationStepGeneral,weightedStress:()=>weightedStress});var x=11102230246251565e-32,b=134217729,v=(3+8*x)*x;function sum(e,t,s,i,r){let o,a,l,d,h=t[0],u=i[0],c=0,m=0;u>h==u>-h?(o=h,h=t[++c]):(o=u,u=i[++m]);let p=0;if(c<e&&m<s)for(u>h==u>-h?(a=h+o,l=o-(a-h),h=t[++c]):(a=u+o,l=o-(a-u),u=i[++m]),o=a,0!==l&&(r[p++]=l);c<e&&m<s;)u>h==u>-h?(a=o+h,d=a-o,l=o-(a-d)+(h-d),h=t[++c]):(a=o+u,d=a-o,l=o-(a-d)+(u-d),u=i[++m]),o=a,0!==l&&(r[p++]=l);for(;c<e;)a=o+h,d=a-o,l=o-(a-d)+(h-d),h=t[++c],o=a,0!==l&&(r[p++]=l);for(;m<s;)a=o+u,d=a-o,l=o-(a-d)+(u-d),u=i[++m],o=a,0!==l&&(r[p++]=l);return 0===o&&0!==p||(r[p++]=o),p}function vec(e){return new Float64Array(e)}var E=22204460492503146e-32,k=11093356479670487e-47,L=vec(4),D=vec(8),B=vec(12),H=vec(16),X=vec(4);function orient2d(e,t,s,i,r,o){const a=(t-o)*(s-r),l=(e-r)*(i-o),d=a-l,h=Math.abs(a+l);return Math.abs(d)>=33306690738754716e-32*h?d:-function orient2dadapt(e,t,s,i,r,o,a){let l,d,h,u,c,m,p,y,x,Y,Z,oe,de,he,ce,me,_e,pe;const ye=e-r,xe=s-r,be=t-o,ve=i-o;he=ye*ve,m=b*ye,p=m-(m-ye),y=ye-p,m=b*ve,x=m-(m-ve),Y=ve-x,ce=y*Y-(he-p*x-y*x-p*Y),me=be*xe,m=b*be,p=m-(m-be),y=be-p,m=b*xe,x=m-(m-xe),Y=xe-x,_e=y*Y-(me-p*x-y*x-p*Y),Z=ce-_e,c=ce-Z,L[0]=ce-(Z+c)+(c-_e),oe=he+Z,c=oe-he,de=he-(oe-c)+(Z-c),Z=de-me,c=de-Z,L[1]=de-(Z+c)+(c-me),pe=oe+Z,c=pe-oe,L[2]=oe-(pe-c)+(Z-c),L[3]=pe;let Se=function estimate(e,t){let s=t[0];for(let i=1;i<e;i++)s+=t[i];return s}(4,L),Ee=E*a;if(Se>=Ee||-Se>=Ee)return Se;if(c=e-ye,l=e-(ye+c)+(c-r),c=s-xe,h=s-(xe+c)+(c-r),c=t-be,d=t-(be+c)+(c-o),c=i-ve,u=i-(ve+c)+(c-o),0===l&&0===d&&0===h&&0===u)return Se;if(Ee=k*a+v*Math.abs(Se),Se+=ye*u+ve*l-(be*h+xe*d),Se>=Ee||-Se>=Ee)return Se;he=l*ve,m=b*l,p=m-(m-l),y=l-p,m=b*ve,x=m-(m-ve),Y=ve-x,ce=y*Y-(he-p*x-y*x-p*Y),me=d*xe,m=b*d,p=m-(m-d),y=d-p,m=b*xe,x=m-(m-xe),Y=xe-x,_e=y*Y-(me-p*x-y*x-p*Y),Z=ce-_e,c=ce-Z,X[0]=ce-(Z+c)+(c-_e),oe=he+Z,c=oe-he,de=he-(oe-c)+(Z-c),Z=de-me,c=de-Z,X[1]=de-(Z+c)+(c-me),pe=oe+Z,c=pe-oe,X[2]=oe-(pe-c)+(Z-c),X[3]=pe;const we=sum(4,L,4,X,D);he=ye*u,m=b*ye,p=m-(m-ye),y=ye-p,m=b*u,x=m-(m-u),Y=u-x,ce=y*Y-(he-p*x-y*x-p*Y),me=be*h,m=b*be,p=m-(m-be),y=be-p,m=b*h,x=m-(m-h),Y=h-x,_e=y*Y-(me-p*x-y*x-p*Y),Z=ce-_e,c=ce-Z,X[0]=ce-(Z+c)+(c-_e),oe=he+Z,c=oe-he,de=he-(oe-c)+(Z-c),Z=de-me,c=de-Z,X[1]=de-(Z+c)+(c-me),pe=oe+Z,c=pe-oe,X[2]=oe-(pe-c)+(Z-c),X[3]=pe;const Ce=sum(we,D,4,X,B);he=l*u,m=b*l,p=m-(m-l),y=l-p,m=b*u,x=m-(m-u),Y=u-x,ce=y*Y-(he-p*x-y*x-p*Y),me=d*h,m=b*d,p=m-(m-d),y=d-p,m=b*h,x=m-(m-h),Y=h-x,_e=y*Y-(me-p*x-y*x-p*Y),Z=ce-_e,c=ce-Z,X[0]=ce-(Z+c)+(c-_e),oe=he+Z,c=oe-he,de=he-(oe-c)+(Z-c),Z=de-me,c=de-Z,X[1]=de-(Z+c)+(c-me),pe=oe+Z,c=pe-oe,X[2]=oe-(pe-c)+(Z-c),X[3]=pe;const ke=sum(Ce,B,4,X,H);return H[ke-1]}(e,t,s,i,r,o,h)}vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(8),vec(8),vec(8),vec(4),vec(8),vec(8),vec(8),vec(12),vec(192),vec(192),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(8),vec(8),vec(8),vec(8),vec(8),vec(8),vec(8),vec(8),vec(8),vec(4),vec(4),vec(4),vec(8),vec(16),vec(16),vec(16),vec(32),vec(32),vec(48),vec(64),vec(1152),vec(1152),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(4),vec(24),vec(24),vec(24),vec(24),vec(24),vec(24),vec(24),vec(24),vec(24),vec(24),vec(1152),vec(1152),vec(1152),vec(1152),vec(1152),vec(2304),vec(2304),vec(3456),vec(5760),vec(8),vec(8),vec(8),vec(16),vec(24),vec(48),vec(48),vec(96),vec(192),vec(384),vec(384),vec(384),vec(768),vec(96),vec(96),vec(96),vec(1152);var Y=Math.pow(2,-52),Z=new Uint32Array(512),oe=class{static from(e,t=defaultGetX,s=defaultGetY){const i=e.length,r=new Float64Array(2*i);for(let o=0;o<i;o++){const i=e[o];r[2*o]=t(i),r[2*o+1]=s(i)}return new oe(r)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const s=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*s),this._halfedges=new Int32Array(3*s),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:s,_hullTri:i,_hullHash:r}=this,o=e.length>>1;let a=1/0,l=1/0,d=-1/0,h=-1/0;for(let t=0;t<o;t++){const s=e[2*t],i=e[2*t+1];s<a&&(a=s),i<l&&(l=i),s>d&&(d=s),i>h&&(h=i),this._ids[t]=t}const u=(a+d)/2,c=(l+h)/2;let m,p,y,x=1/0;for(let t=0;t<o;t++){const s=dist(u,c,e[2*t],e[2*t+1]);s<x&&(m=t,x=s)}const b=e[2*m],v=e[2*m+1];x=1/0;for(let t=0;t<o;t++){if(t===m)continue;const s=dist(b,v,e[2*t],e[2*t+1]);s<x&&s>0&&(p=t,x=s)}let E=e[2*p],k=e[2*p+1],L=1/0;for(let t=0;t<o;t++){if(t===m||t===p)continue;const s=circumradius(b,v,E,k,e[2*t],e[2*t+1]);s<L&&(y=t,L=s)}let D=e[2*y],B=e[2*y+1];if(L===1/0){for(let t=0;t<o;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];quicksort(this._ids,this._dists,0,o-1);const t=new Uint32Array(o);let s=0;for(let e=0,i=-1/0;e<o;e++){const r=this._ids[e];this._dists[r]>i&&(t[s++]=r,i=this._dists[r])}return this.hull=t.subarray(0,s),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(orient2d(b,v,E,k,D,B)<0){const e=p,t=E,s=k;p=y,E=D,k=B,y=e,D=t,B=s}const H=function circumcenter(e,t,s,i,r,o){const a=s-e,l=i-t,d=r-e,h=o-t,u=a*a+l*l,c=d*d+h*h,m=.5/(a*h-l*d);return{x:e+(h*u-l*c)*m,y:t+(a*c-d*u)*m}}(b,v,E,k,D,B);this._cx=H.x,this._cy=H.y;for(let t=0;t<o;t++)this._dists[t]=dist(e[2*t],e[2*t+1],H.x,H.y);quicksort(this._ids,this._dists,0,o-1),this._hullStart=m;let X=3;s[m]=t[y]=p,s[p]=t[m]=y,s[y]=t[p]=m,i[m]=0,i[p]=1,i[y]=2,r.fill(-1),r[this._hashKey(b,v)]=m,r[this._hashKey(E,k)]=p,r[this._hashKey(D,B)]=y,this.trianglesLen=0,this._addTriangle(m,p,y,-1,-1,-1);for(let o,a,l=0;l<this._ids.length;l++){const d=this._ids[l],h=e[2*d],u=e[2*d+1];if(l>0&&Math.abs(h-o)<=Y&&Math.abs(u-a)<=Y)continue;if(o=h,a=u,d===m||d===p||d===y)continue;let c=0;for(let e=0,t=this._hashKey(h,u);e<this._hashSize&&(c=r[(t+e)%this._hashSize],-1===c||c===s[c]);e++);c=t[c];let x,b=c;for(;x=s[b],orient2d(h,u,e[2*b],e[2*b+1],e[2*x],e[2*x+1])>=0;)if(b=x,b===c){b=-1;break}if(-1===b)continue;let v=this._addTriangle(b,d,s[b],-1,-1,i[b]);i[d]=this._legalize(v+2),i[b]=v,X++;let E=s[b];for(;x=s[E],orient2d(h,u,e[2*E],e[2*E+1],e[2*x],e[2*x+1])<0;)v=this._addTriangle(E,d,x,i[d],-1,i[E]),i[d]=this._legalize(v+2),s[E]=E,X--,E=x;if(b===c)for(;x=t[b],orient2d(h,u,e[2*x],e[2*x+1],e[2*b],e[2*b+1])<0;)v=this._addTriangle(x,d,b,-1,i[b],i[x]),this._legalize(v+2),i[x]=v,s[b]=b,X--,b=x;this._hullStart=t[d]=b,s[b]=t[E]=d,s[d]=E,r[this._hashKey(h,u)]=d,r[this._hashKey(e[2*b],e[2*b+1])]=b}this.hull=new Uint32Array(X);for(let e=0,t=this._hullStart;e<X;e++)this.hull[e]=t,t=s[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function pseudoAngle(e,t){const s=e/(Math.abs(e)+Math.abs(t));return(t>0?3-s:1+s)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:s,coords:i}=this;let r=0,o=0;for(;;){const a=s[e],l=e-e%3;if(o=l+(e+2)%3,-1===a){if(0===r)break;e=Z[--r];continue}const d=a-a%3,h=l+(e+1)%3,u=d+(a+2)%3,c=t[o],m=t[e],p=t[h],y=t[u];if(inCircle(i[2*c],i[2*c+1],i[2*m],i[2*m+1],i[2*p],i[2*p+1],i[2*y],i[2*y+1])){t[e]=y,t[a]=c;const i=s[u];if(-1===i){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,i),this._link(a,s[o]),this._link(o,u);const l=d+(a+1)%3;r<Z.length&&(Z[r++]=l)}else{if(0===r)break;e=Z[--r]}}return o}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,s,i,r,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=s,this._link(a,i),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}};function dist(e,t,s,i){const r=e-s,o=t-i;return r*r+o*o}function inCircle(e,t,s,i,r,o,a,l){const d=e-a,h=t-l,u=s-a,c=i-l,m=r-a,p=o-l,y=u*u+c*c,x=m*m+p*p;return d*(c*x-y*p)-h*(u*x-y*m)+(d*d+h*h)*(u*p-c*m)<0}function circumradius(e,t,s,i,r,o){const a=s-e,l=i-t,d=r-e,h=o-t,u=a*a+l*l,c=d*d+h*h,m=.5/(a*h-l*d),p=(h*u-l*c)*m,y=(a*c-d*u)*m;return p*p+y*y}function quicksort(e,t,s,i){if(i-s<=20)for(let r=s+1;r<=i;r++){const i=e[r],o=t[i];let a=r-1;for(;a>=s&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=i}else{let r=s+1,o=i;swap(e,s+i>>1,r),t[e[s]]>t[e[i]]&&swap(e,s,i),t[e[r]]>t[e[i]]&&swap(e,r,i),t[e[s]]>t[e[r]]&&swap(e,s,r);const a=e[r],l=t[a];for(;;){do{r++}while(t[e[r]]<l);do{o--}while(t[e[o]]>l);if(o<r)break;swap(e,r,o)}e[s+1]=e[o],e[o]=a,i-r+1>=o-s?(quicksort(e,t,r,i),quicksort(e,t,s,o-1)):(quicksort(e,t,s,o-1),quicksort(e,t,r,i))}}function swap(e,t,s){const i=e[t];e[t]=e[s],e[s]=i}function defaultGetX(e){return e[0]}function defaultGetY(e){return e[1]}var de={};__export(de,{BUTTON_MAPPING:()=>Ge,BoundingBox:()=>ss,DummyCanvas:()=>qe,DummyCanvasRenderingContext2D:()=>Xe,DummyDomElement:()=>De,DummyFileReader:()=>ze,DummyTextNode:()=>Zt,DummyXHR:()=>Pe,ElementSet:()=>ts,EventTarget:()=>is,FlexArray:()=>Ct,IndexList:()=>Ze,Map2:()=>Qe,PathMap:()=>Je,PrioritySet:()=>es,SVG_NS:()=>Be,Table:()=>ns,XLINK:()=>Ve,XML_NS:()=>je,applyCursorStyle:()=>applyCursorStyle,baseURI:()=>baseURI,binaryIndexOf:()=>binaryIndexOf,cancelAnimFrame:()=>cancelAnimFrame,clamp:()=>clamp,clearCanvas:()=>clearCanvas,componentsToRGBA:()=>componentsToRGBA,computeMax:()=>computeMax,computeMin:()=>computeMin,computeSum:()=>computeSum,concatenateArrays:()=>concatenateArrays,createBlob:()=>createBlob,createCanvas:()=>createCanvas,createDummyDomElement:()=>createDummyDomElement,createDummyXmlDocument:()=>createDummyXmlDocument,createElement:()=>createElement,createSvgElement:()=>createSvgElement,createTextNode:()=>createTextNode,createWorker:()=>createWorker,createXmlDocument:()=>createXmlDocument,dataUrlToBlob:()=>dataUrlToBlob,debounce:()=>debounce,deepCopy:()=>deepCopy,displayPixelsOnScreen:()=>displayPixelsOnScreen,ensureTransferable:()=>ensureTransferable,escapeDOMAttribute:()=>escapeDOMAttribute,extendList:()=>extendList,fadeElement:()=>fadeElement,fetch:()=>fetch,fetchBinary:()=>fetchBinary,fetchBinaryAsBase64:()=>fetchBinaryAsBase64,flatten:()=>flatten,flattenArray:()=>flattenArray,forEach:()=>forEach,formatAngle:()=>formatAngle,formatHex:()=>formatHex,formatWorkerMessage:()=>formatWorkerMessage,getBaseLog:()=>getBaseLog,getCurrentTime:()=>getCurrentTime,getDate:()=>getDate,getDocument:()=>getDocument,getDocumentFontRules:()=>getDocumentFontRules,getEmbeddedFontRules:()=>getEmbeddedFontRules,getFlattenedKeys:()=>getFlattenedKeys,getGlContext:()=>getGlContext,getImage:()=>getImage,getLeafValues:()=>getLeafValues,getOptions:()=>getOptions,getPixelRatio:()=>Re,getProperty:()=>getProperty,getStyle:()=>getStyle,getTime:()=>getTime,getValues:()=>getValues,getWebglContext:()=>getWebglContext,hash8:()=>hash8,indexArrayToArray:()=>indexArrayToArray,indexByName:()=>indexByName,insertSortAsc:()=>insertSortAsc,insertSortDesc:()=>insertSortDesc,isArray:()=>isArray,isBlob:()=>isBlob,isHTMLElement:()=>isHTMLElement,isInteger:()=>isInteger,isLittleEndian:()=>isLittleEndian,isObject:()=>isObject,isRawObject:()=>isRawObject,isWebGLSupported:()=>isWebGLSupported,lerp:()=>lerp,mapKeys:()=>mapKeys,mapValues:()=>mapValues,merge:()=>merge,mergeValues:()=>mergeValues,mix:()=>mix,nextPowerOfTwo:()=>nextPowerOfTwo,objToValueList:()=>objToValueList,parseColor:()=>parseColor,parseColorHex:()=>parseColorHex,parseColorRgba:()=>parseColorRgba,pick:()=>pick,processQueue:()=>processQueue,promiseQueue:()=>promiseQueue,promptDownload:()=>promptDownload,propertyPathToString:()=>propertyPathToString,removeFromArray:()=>removeFromArray,requestAnimFrame:()=>requestAnimFrame,resizeElement:()=>resizeElement,resolvePath:()=>resolvePath,rgbaToRgb:()=>rgbaToRgb,serializeXMLDocument:()=>serializeXMLDocument,setAttributes:()=>setAttributes,setCtxFont:()=>setCtxFont,setElementSize:()=>setElementSize,setKeys:()=>rt,setProperty:()=>setProperty,setValues:()=>gt,smartRequire:()=>smartRequire,throttle:()=>throttle,toArray:()=>toArray,toHexa:()=>toHexa,toPropertyPath:()=>toPropertyPath,traverse:()=>traverse,unflatten:()=>unflatten,unorderedHash:()=>unorderedHash,workerIsAvailable:()=>Ft});var he=(()=>{let e=0;return"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:function(t){const s=Date.now(),i=Math.min(16,Math.max(0,16-(s-e))),r=e=s+i;return setTimeout((()=>t(r)),i)}})(),ce="undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame:function(e){return clearTimeout(e)};function requestAnimFrame(e,t){return he((s=>{e.call(t,s)}))}function cancelAnimFrame(e){e&&ce(e)}var me="object"==typeof global&&null!==global&&void 0!==global.it,_e="undefined"!=typeof document,pe="undefined"!=typeof window,ye=pe&&!window.__OGMA_HEADLESS,xe=ye&&_e;function insertSortAsc(e,t){for(let s=1,i=e.length;s<i;s++){const i=e[s];let r=s;for(;r>0&&t.get(e[r-1])>t.get(i);)e[r]=e[r-1],--r;e[r]=i}return e}function insertSortDesc(e,t){for(let s=1,i=e.length;s<i;s++){const i=e[s];let r=s;for(;r>0&&t.get(e[r-1])<t.get(i);)e[r]=e[r-1],--r;e[r]=i}return e}function isArray(value){return Array.isArray(value)||ArrayBuffer.isView(value)}function toArray(value){return Array.isArray(value)?value:[value]}function flattenArray(e){const t=[];for(let s=0;s<e.length;++s){const i=e[s];if(Array.isArray(i))for(let e=0;e<i.length;++e)t.push(i[e]);else t.push(i)}return t}function concatenateArrays(...e){if(0===e.length)return[];const t=e[0].constructor;let s=0;for(const t of e)s+=t.length;const i=new t(s);let r=0;for(const t of e){for(let e=0;e<t.length;e++)i[r+e]=t[e];r+=t.length}return i}function removeFromArray(e,t){const s=e.indexOf(t);return-1!==s&&(e.splice(s,1),!0)}function binaryIndexOf(e,t){let s,i,r=0,o=e.length-1;for(;r<=o;)if(s=(r+o)/2|0,i=e[s],i<t)r=s+1;else{if(!(i>t))return s;o=s-1}return-1}var indexArrayToArray=(e,t)=>{const s=new Array(e.length);for(let i=0;i<e.length;i++)s[i]=t[e[i]];return s};function isInteger(e){return"number"==typeof e&&e%1==0}function propertyPathToString(e){return Array.isArray(e)?e.join("."):e}function toPropertyPath(e){if(!e)return[];if("string"==typeof e)return e.split(".");if(Array.isArray(e)){for(let t=0;t<e.length;++t)if("string"!=typeof e[t])throw new TypeError(`${e[t]} is not a string`);return e.slice()}throw new TypeError(`invalid property path "${e}": expected string or array of strings`)}function throttle(e,t,s){let i,r,o;if(0===t)return function(){e.apply(s,arguments)};const later=function(){i=!1,r&&(o.apply(s,r),r=null)};return o=function(){let o;return i?r=arguments:(o=e.apply(s,arguments),setTimeout(later,t),i=!0),o},o}function debounce(e,t,s){let i,r,o,a,l;const d=0===t||void 0===t?100:t;function later(){const t=Date.now()-a;t<d&&t>=0?i=setTimeout(later,d-t):(i=null,s||(l=e.apply(o,r),o=r=null))}const debounced=function(){o=this,r=arguments,a=Date.now();const d=s&&!i;return i||(i=setTimeout(later,t)),d&&(l=e.apply(o,r),o=r=null),l};return debounced.clear=function(){i&&(clearTimeout(i),i=null)},debounced.flush=function(){i&&(l=e.apply(o,r),o=r=null,clearTimeout(i),i=null)},debounced}function processItem(e,t,s,i,r){s(e[t],t,e,i,r).then((o=>{t===e.length-1?i(o):processItem(e,t+1,s,i,r)})).catch(r)}function processQueue(e,t){return new Promise(((s,i)=>processItem(e,0,t,s,i)))}function isLittleEndian(){return 120===new Uint8Array(new Uint32Array([305419896]).buffer)[0]}function promiseQueue(e){return e.reduce(((e,t)=>e.then(t)),Promise.resolve())}function hash8(e,t,s,i,r,o,a,l){return e+r+256*(t+o)+65536*(s+a)+16777216*(i+l)}function unorderedHash(e,t){return e<t?e*t+Math.pow(t-e-1,2)/4:e*t+Math.pow(e-t-1,2)/4}function isRawObject(e){return!(null===e||"object"!=typeof e||isArray(e)||e instanceof RegExp||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement)}function getValues(e){const t=Object.keys(e),s=new Array(t.length);for(let i=0;i<t.length;++i)s[i]=e[t[i]];return s}function forEach(e,t,s){if(Array.isArray(e))return e.forEach(t,s);if(!isRawObject(e))throw new Error("forEach: invalid argument "+JSON.stringify(e));const i=Object.keys(e);if(void 0!==s)for(let r=0;r<i.length;++r){const o=i[r];t.call(s,e[o],o)}else for(let s=0;s<i.length;++s){const r=i[s];t(e[r],r)}}function deepCopy(e){if(Array.isArray(e)){const t=new Array(e.length);for(let s=0;s<e.length;++s)t[s]=deepCopy(e[s]);return t}if(!isObject(e))return e;const t={},s=Object.keys(e);for(const i of s)t[i]=deepCopy(e[i]);return t}function extendList(e,t){t.forEach((t=>{-1===e.indexOf(t)&&e.push(t)}))}function setProperty(e,t,value){const s="string"==typeof t?t.split("."):t;for(let t=0;t<s.length-1;++t){const i=s[t];let r=e[i];r||(r={},e[i]=r),e=r}e[s[s.length-1]]=value}function getProperty(e,t){const s=toPropertyPath(t);if(!s.length)return e;if(e){for(let t=0;t<s.length-1;++t){const i=e[s[t]];if(!i)return;e=i}return e[s[s.length-1]]}}function flatten(e,t,s="."){t||(t=e=>!isRawObject(e));const i={},r=Object.keys(e);for(let o=0;o<r.length;++o){const a=r[o],value=e[a];if(t(value))i[a]=value;else{const e=flatten(value,t),r=Object.keys(e);for(let t=0;t<r.length;t++){const o=r[t];i[`${a}${s}${o}`]=e[o]}}}return i}function unflatten(e){const t={},s=Object.keys(e);for(let i=0;i<s.length;++i){const r=s[i];setProperty(t,r,e[r])}return t}function getFlattenedKeys(e,t,s=[]){const i=Object.keys(e);for(let r=0;r<i.length;++r){const o=i[r],value=e[o],a=t?t+o:o;isObject(value)?getFlattenedKeys(value,a+".",s):s.push(a)}return s}var be=Object.prototype.hasOwnProperty;function traverse(e,t){const s=[e];let i;for(;s.length>0;)if(i=s.pop(),i)if(isObject(i))for(const e in i)be.call(i,e)&&s.push(i[e]);else t(i)}function indexByName(e){const t={};return traverse(e,(e=>t[e.getName()]=e)),t}function getLeafValues(e,t=[]){if(isObject(e)){const s=Object.keys(e);for(const i of s)getLeafValues(e[i],t)}else t.push(e);return t}function ensureTransferable(e){for(const t in e)"function"==typeof e[t]&&delete e[t];return e}function getOptions(value,e){if(void 0===value)return deepCopy(e);if(!isRawObject(value))return value;const t={},s=Object.keys(e);for(const i of s){const s=e[i],r=value[i];isRawObject(s)?t[i]=getOptions(r,s):t[i]=void 0===r?deepCopy(s):r}return t}function isObject(value){return value&&(value.constructor===Object||!value.constructor)}function mergeValues(e,t){if(!isObject(t)||!isObject(e))return t;const s=Object.assign({},e),i=Object.keys(t);for(const e of i)s[e]=mergeValues(s[e],t[e]);return s}function pick(e,t){return null==t?e:t.reduce(((t,s)=>(t[s]=e[s],t)),{})}var merge=(...e)=>{const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const e in i)be.call(i,e)&&(Array.isArray(t[e])&&Array.isArray(i[e])?t[e]=Array.from(new Set(t[e].concat(i[e]))):isObject(t[e])&&isObject(i[e])?t[e]=merge(t[e],i[e]):t[e]=i[e])}return t},ve={},Se={},Ee={},_require=e=>null;if("object"==typeof global&&(Se=global),"object"==typeof window&&(Ee=window),"object"==typeof module&&"function"==typeof module.require){const e=module.require.bind(module);_require=t=>{try{return e(t)}catch(e){return null}}}else"function"==typeof Se.require&&(_require=e=>{const t=module.require;try{return t(e)}catch(e){return null}});function smartRequire(e,{throwOnError:t}={}){let s=null;if(!s&&e&&(s=ve[e]),!s&&e&&(s=_require(e)),!s&&e&&(s=Ee[e]),!s&&e&&(s=Se[e]),!s&&t){const t=[`unable to find module "${e}"; make sure one of these statements is true:`,`- Ogma.libraries['${e}'] is set to the right library`,`- require('${e}') returns the right library`,`- window['${e}'] is set to the right library`].join("\n");throw new Error(t)}return s}var we="undefined"!=typeof performance&&performance.now?()=>0|performance.now():()=>Date.now(),Ce=we();function getCurrentTime(){return we()-Ce}function getDate(){const e=new Date,t=e.getDate(),s=e.getMonth()+1;return`${e.getFullYear()}-${s<10?"0"+s:s}-${t<10?"0"+t:t}`}function getTime(){const e=new Date;return`[${format((e.getUTCHours()-(e.getTimezoneOffset()/60|0))%24)}:${format(e.getUTCMinutes())}:${format(e.getUTCSeconds())}:${format(e.getUTCMilliseconds(),3)}]`}function format(e,t=2){let s=Math.pow(10,t-1),i=String(e);for(;s>1;)e<s&&(i="0"+i),s/=10;return i}function $warn(e){!me&&console.warn(getTime()+" "+e)}var ke,Me,Le,Ie,noop=()=>{},falseFn=()=>!1,trueFn=()=>!0,nullFn=()=>null,idenitity=e=>e,Ne=class{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,Ne.onCreate&&Ne.onCreate(this)}open(e,t){this.method=e,this.url=t,Ne.onSend&&Ne.onSend(this)}respond(e,t,s){this.readyState=4,this.status=e,this.headers=t,this.responseText=s,this.response=s,this.onreadystatechange()}send(){this.readyState=4}},Pe=Ne;Pe.onCreate=noop,Pe.onSend=noop;var Fe=class{constructor(){this.onload=noop,Fe.onCreate&&Fe.onCreate(this)}readAsDataURL(e){this._blob=e,Fe.onRead&&Fe.onRead(this)}load(e){this.result="function"==typeof e?e(this._blob):e,this.onload&&this.onload()}},ze=Fe;function getDocument(){if(Me)return Me;return{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}function getStyle(e,t){if(document&&document.defaultView){let value=e.style[t];if((!value||"auto"===value)&&getDocument().defaultView){const s=document.defaultView.getComputedStyle(e,null);value=s?s[t]:null}return"auto"===value?null:value?value.toString():null}return null}ze.onCreate=noop,ze.onRead=noop,ke=smartRequire("xmldom"),Me=_e?document:ke?(new ke.DOMImplementation).createDocument():null,Le="undefined"!=typeof XMLHttpRequest?XMLHttpRequest:Pe,Ie="undefined"!=typeof FileReader?FileReader:ze;var De=class{constructor(){this.onmousewheel=noop,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:e=>!1,item:null}}get innerHTML(){return""}set innerHTML(e){}appendChild(e){return this.childNodes.push(e),e}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(e){return!1}};function createDummyDomElement(){return new De}var Re=pe?()=>window.devicePixelRatio:()=>1;function dataUrlToBlob(e){const t=";base64,";let s,i,r;if(-1===e.indexOf(t))return s=e.split(","),i=s[0].split(":")[1],r=decodeURIComponent(s[1]),createBlob(r,i);s=e.split(t),i=s[0].split(":")[1],r=window.atob(s[1]);const o=r.length,a=new Uint8Array(o);for(let e=0;e<o;++e)a[e]=r.charCodeAt(e);return createBlob([a],i)}var Oe=class{constructor(e,t){this.data=e,this.type=t}};function createBlob(e,t){return"undefined"!=typeof Blob?new Blob(e,{type:t}):new Oe(e,t)}function isBlob(e){return"undefined"!=typeof Blob&&e instanceof Blob||e instanceof Oe}function promptDownload(e,t,s){if(!ye)return e;let i=null,r=null,o=null;window.Blob?(i=function getBlob(e,t){return"blob"===t?e:"dataURL"===t?dataUrlToBlob(e):createBlob([e],"text/xml")}(e,s),r=window.URL.createObjectURL(i)):o="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(e);const a=document.createElement("a");return a.setAttribute("href",r||o),a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a),r&&setTimeout((()=>window.URL.revokeObjectURL(r)),0),e}function resizeElement(e,t,s,i=Re()){if(setElementSize(e,t+"px",s+"px"),"IMG"===e.tagName||"CANVAS"===e.tagName){const r=e;r.width=t*i,r.height=s*i}}function setAttributes(e,t){forEach(t,((value,t)=>{void 0!==value&&e.setAttribute(t,value)}))}var Be="http://www.w3.org/2000/svg",je="http://www.w3.org/2000/xmlns/",Ve="http://www.w3.org/1999/xlink",Ue=1;function createSvgElement(e,t){const s=Me.createElementNS(Be,e);return s.style||(s.style={}),t&&setAttributes(s,t),s}function createElement(e){const t=Me.createElement("div"),s=e.trim().replace(/\s+/g," ");if(t.innerHTML=s,!t.firstChild||t.firstChild.nodeType!==Ue)throw new Error(`Failed to create element from: "${e}". Expected an HTML string`);return t.firstChild}function createTextNode(e){if(Me)return Me.createTextNode(e)}function getImage(e){return"undefined"==typeof Image?Promise.resolve(null):new Promise((t=>{const s=new Image;s.src=e,s.onload=()=>t(s),s.onerror=()=>t(null)}))}function formatURL(e){if(0===e.indexOf("http://")||0===e.indexOf("https://"))return e;const t=window.location.origin,s=window.location.pathname,i=s.lastIndexOf("/");return-1===i?t+"/"+e:t+s.substr(0,i)+"/"+e}function fetch(e){return new Promise(((t,s)=>{const i=new Le;i.open("GET",formatURL(e),!0),i.onreadystatechange=function(){if(4===i.readyState){const r=i.status;200===r?t(i.responseText):s(0!==r?new Error(`cannot retrieve file at url "${e}"; the server responded with status code ${r}.`):new Error(`cannot send XMLHttpRequest to url "${e}"; if you're using the local file protocol this is most likely the cause.`))}},i.onerror=function(){s(new Error(`cannot retrieve file at url "${e}"; the XMLHttpRequest failed.`))},i.send()}))}function isHTMLElement(e){return"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function applyCursorStyle(e,t){e.style.cursor=t,e.style.cursor!==t&&(e.style.cursor=`-webkit-${t}`)}function fetchBinary(e){return new Promise(((t,s)=>{const i=new Le;i.responseType="blob",i.open("GET",formatURL(e),!0),i.onreadystatechange=()=>{if(4===i.readyState){if(200===i.status)return t(i.response);s(i.status)}},i.onerror=e=>s(e),i.send()}))}function fetchBinaryAsBase64(e){return fetchBinary(e).then((e=>new Promise(((t,s)=>{const i=new Ie;i.onerror=s,i.onload=()=>t(i.result),i.readAsDataURL(e)}))))}function escapeDOMAttribute(e,t=!0){const s=t?"&#13;":"\n";return(""+e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,s).replace(/[\r\n]/g,s)}var Ge={0:"left",1:"middle",2:"right"};function baseURI(e){if(e.baseURI)return e.baseURI;const t=e.getElementsByTagName("base");return t.length>0?t[0].href:e.URL||(e.location?e.location.href:"")}function fadeElement(e,t,s,i){return new Promise((r=>{let o=t;const a=Date.now(),l=(s-t)*Math.min(1,1/(i/16));!function update(){Date.now()-a<i?(o=Math.min(1,Math.max(0,o+l)),e.style.opacity=o.toString(),requestAnimFrame(update)):r()}()}))}function setElementSize(e,t,s){e.style.width=t,e.style.height=s}var We=300,He=150,qe=class{constructor(){this.style={},this.width=We,this.height=He,this.__context=new Xe,this.style={},this.width=We,this.height=He}get __dummy(){return!0}get parentNode(){return null}getContext(e){return"2d"===e?this.__context:null}toDataURL(e="png"){return`data:image/${e};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},Xe=class{constructor(){this._fontSize=10}set font(e){const t=e.match(/\d+/);t&&(this._fontSize=parseFloat(t[0]))}set fillStyle(e){}set textBaseline(e){}set textAlign(e){}set strokeStyle(e){}set lineWidth(e){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(e){return{width:e.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},$e=smartRequire("canvas")||smartRequire("canvas-prebuilt");function createCanvas(e=We,t=He){if(_e){const s=document.createElement("canvas");return s.width=e,s.height=t,s}if($e){let s=null;return s="createCanvas"in $e?$e.createCanvas(e,t):new $e(e,t),s.style={},s}const s=new qe;return s.width=e,s.height=t,s}function clearCanvas(e,t,s=e.width,i=e.height){t.clearRect(0,0,s,i)}function setCtxFont(e,t,s,i=""){e.font=`${i} ${s}px ${t}`}function isWebGLSupported(){return null!==getWebglContext(createCanvas(),{},"webgl")}var getGlContext=(e,t,s)=>{const i=createCanvas();if(!i)return null;const r=i.getContext(e,t);if(!r)return null;i.addEventListener("webglcontextlost",s);return{context:r,cleanUp:()=>i.removeEventListener("webglcontextlost",s)}};function getWebglContext(e,t,s){let i=e.getContext(s,t);return i||(i=e.getContext("experimental-webgl",t)),i||null}function serializeCSSRuleList(e){let t="";for(let s=0;s<e.length;s++)t+=e[s].cssText+"\n";return t}function getDocumentFontRules(){const e=getDocument(),t=e.styleSheets||[],s=baseURI(e),i=[],r=[];for(let e=0;e<t.length;e++){const o=t[e];null==o.href?i.push({href:s,content:serializeCSSRuleList(o.cssRules)}):r.push(o.href)}const o=/@font-face\s*\{[^}]+\}/g;return Promise.all(r.map((e=>fetch(e).then((t=>({href:e,content:t}))).catch(nullFn)))).then((e=>e.concat(i))).then((e=>{const t=[];for(let s=0;s<e.length;s++){const i=e[s];if(null!==i){const{href:e,content:s}=i,r=s.match(o);if(r){const s=parseRules(r,e);t.push.apply(t,s)}}}return t}))}function getEmbeddedFontRules(e,t){return Promise.all(e.map((({formats:e,originalRule:s})=>Promise.all(e.map((({format:e,url:s})=>t?fetchBinaryAsBase64(s).then((t=>({format:e,src:t}))).catch(nullFn):{format:e,src:s}))).then((e=>{const t=[];for(const s of e)null!==s&&t.push(`url('${s.src}') format('${s.format}')`);if(0!==t.length){const e=`src: ${t.join(",")}`;return s.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${e}}`).replace(/\s+/," ").replace(/;+/,";")}return s})))))}var Ye={"embedded-opentype":!0,svg:!0};function parseRules(e,t){const s=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,r=[];for(let o=0;o<e.length;o++){const a=e[o],l=a.match(i);if(l){const e=l[1],i=[];let o;for(;o=s.exec(a);){const e=o[1],s=o[2];Ye[s.toLowerCase()]||i.push({format:s,url:resolvePath(e,t)})}r.push({name:e,formats:i,originalRule:a})}}return r}function resolvePath(e,t){if(/^http(s)?:/.test(e))return e;if("/"===e[0]){const s=t.match(/((\w+:\/\/)([^/]+))/);return s?s[1]+e:e}const s=e.split("/"),i=t.split("/");for("/"!==t[t.length-1]&&i.pop();".."===s[0];)s.shift(),i.pop();return i.concat(s).join("/").replace(/[\w](\/{2,})/g,(e=>e[0]+"/"))}function nextPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function computeSum(e){let t=0;for(let s=0;s<e.length;++s)t+=e[s];return t}function clamp(value,e,t){return Math.max(e,Math.min(t,value))}function mix(e,t,s){return e+(t-e)*s}function lerp(e,t,s){return e*(1-s)+t*s}function computeMax(e){if(!e.length)return-1/0;let t=e[0];for(let s=1,i=e.length;s<i;++s){const i=e[s];i>t&&(t=i)}return t}function computeMin(e){if(!e.length)return 1/0;let t=e[0];for(let s=1,i=e.length;s<i;++s){const i=e[s];i<t&&(t=i)}return t}var getBaseLog=(e,t)=>Math.log(e)/Math.log(t),formatAngle=e=>e<-Math.PI?e+2*Math.PI:e>Math.PI?e-2*Math.PI:e,Ze=class{constructor(){this._buffer=new Uint32Array(4),this._capacity=4,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;const e=this.slice(0,this._size);return this.reset(),e}reset(){return this._size=0,this}reserve(value){return value>this._capacity&&this._setCapacity(nextPowerOfTwo(value)),this}_setCapacity(e){const t=new Uint32Array(e);t.set(this._buffer),this._buffer=t,this._capacity=e}push(value){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=value,this}pushUnchecked(value){return this._buffer[this._size++]=value,this}slice(e=0,t=this._size){return this._buffer.slice(e,t)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(value){return this._size=value,this}isEmpty(){return 0===this._size}},orderedPair=(e,t)=>(e+t)*(e+t+1)/2+t;function getPairId(e,t){const s=e<t?e:t;return 67108864*s+(e+t-s)}function mapKeys(e){if(e.keys)return Array.from(e.keys());const t=[];return e.forEach(((e,s)=>t.push(s))),t}function mapValues(e){if(e.values)return Array.from(e.values());const t=[];return e.forEach((value=>t.push(value))),t}var Qe=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(e,t,value){this._map.set(orderedPair(e,t),value)}get(e,t){return this._map.get(orderedPair(e,t))}};var Ke="undefined"==typeof HTMLElement?e=>!1:e=>e instanceof HTMLElement,isValid=function(e){return"object"!=typeof e||null===e||isArray(e)||function isSpecialClass(e){return e instanceof RegExp||e instanceof Date}(e)};function objToValueList(e,t=[],s=[]){if(!Ke(e)){if(isValid(e))t.push({path:s.slice(),value:e});else{const i=Object.keys(e);for(let r=0;r<i.length;++r){const o=i[r],a=s.slice();a.push(o),objToValueList(e[o],t,a)}}return t}}var Je=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(e,value){const t=this._getIndex(e);-1!==t?this._values[t]=value:(checkPathEquality(this._cachedPath,e)&&(this._cachedIndex=this._keys.length),this._keys.push(e),this._values.push(value),this._size+=1)}get(e){const t=this._getIndex(e);if(-1!==t)return this._values[t]}has(e){return-1!==this._getIndex(e)}keys(){return this._keys.slice()}_getIndex(e){if(checkPathEquality(e,this._cachedPath))return this._cachedIndex;this._cachedPath=e.slice();const t=this._keys;for(let s=0;s<t.length;++s)if(checkPathEquality(t[s],e))return this._cachedIndex=s,s;return this._cachedIndex=-1,-1}};function checkPathEquality(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}var rt=function setKeys2(e){return Array.from(e.keys())},gt=function setValues2(e){return Array.from(e.values())},yt={1:getBitsFunction(1),2:getBitsFunction(2),4:getBitsFunction(4),8:(e,t)=>e[t],16:(e,t)=>e[t],32:(e,t)=>e[t],int8:(e,t)=>e[t],int16:(e,t)=>e[t],int32:(e,t)=>e[t],float:(e,t)=>e[t],any:(e,t)=>e[t]},At={1:setBitsFunction(1),2:setBitsFunction(2),4:setBitsFunction(4),8:(e,t,value)=>{e[t]=value},16:(e,t,value)=>{e[t]=value},32:(e,t,value)=>{e[t]=value},int8:(e,t,value)=>{e[t]=value},int16:(e,t,value)=>{e[t]=value},int32:(e,t,value)=>{e[t]=value},float:(e,t,value)=>{e[t]=value},any:(e,t,value)=>{e[t]=value}};function getBitsFunction(e){const t=8/e,s=(1<<e)-1;return(i,r)=>i[r/t|0]>>r%t*e&s}function setBitsFunction(e){const t=8/e,s=Math.pow(2,e)-1;return(i,r,value)=>{const o=r%t*e,a=r/t|0,l=value<<o,d=255-(s-value<<o);i[a]=i[a]&d|l}}var St={get(e){return this._getArrayElt(this._buffer,e)},set(e,value){this._setArrayElt(this._buffer,e,value)}},Et={get(e){return this._byIndex[this._getArrayElt(this._buffer,e)]},set(e,value){let t=this._byName[value];if(void 0===t){t=this._nextIndex++,this._byIndex.push(value);this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[value]=t}this._setArrayElt(this._buffer,e,t)}},Tt=0,Ct=class{constructor(e){this._id=Tt++,this._initialized=!1;const t=e.name,s=e.storage,i=e.size||0,r=function formatDefaultValue(e,t){return void 0===e&&"any"!==t&&"resource"!==t?0:e}(e.default,s),o=Math.max(8,upperPowerOfTwo(i+1)),a="resource"===s?1:s;this._name=t,this._storage=s,this._getArrayElt=yt[a],this._setArrayElt=At[a],this._elementSize=a,this._nbElements=o,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=r,this._BASE_VALUE="any"===s?void 0:0,this._methods=St,this._initialized=!1,this._buffer=null,"resource"===s&&(this._methods=Et,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[r]=0,this._byIndex.push(r))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(e){this._defaultValue=e,"resource"===this._storage&&(this._byName[e]=0,this._byIndex[0]=e)}get(e){return this._get(e)}set(e,value){this._set(e,value)}_get(e){return this._defaultValue}_set(e,value){value!==this._defaultValue&&(this._initialize(),this._set(e,value))}setFallback(e){this._fallback=e,this.get=this._getWithFallback}_getWithFallback(e){const value=this._get(e);return void 0===value&&this._fallback?this._fallback.get(e):value}_initialize(){this._initialized=!0,this._buffer=createBuffer(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,"resource"!==this._storage&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}grow(e){const t=upperPowerOfTwo(e+1);if(!(t<=this._nbElements)){if(this._initialized)if("any"===this._elementSize)for(let e=this._nbElements;e<t;++e)this._buffer.push(this._defaultValue);else{const e=createBuffer(t,this._elementSize);e.set(this._buffer),this._buffer=e,"resource"!==this._storage&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=t}}increaseElementSize(){const e=this._elementSize;if("number"!=typeof e||32===e)throw new Error("FlexArray: cannot increase element size");const t=2*e,s=yt[t],i=At[t];if(this._initialized){const s=this._nbElements,r=this._getArrayElt,o=this._buffer,a=createBuffer(s,t);if(e>=8)a.set(o);else for(let e=0;e<s;++e)i(a,e,r(o,e));this._buffer=a}this._elementSize=t,this._getArrayElt=s,this._setArrayElt=i}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(e,t){const s=e.length;void 0===t&&(t=new Array(s));for(let i=0,r=s;i<r;++i)t[i]=this.get(e[i]);return t}fill(e,value){for(let t=0,s=e.length;t<s;++t)this.set(e[t],value)}setMultiple(e,t,s){if(s||!Array.isArray(t)&&!ArrayBuffer.isView(t))for(let s=0,i=e.length;s<i;++s)this.set(e[s],t);else for(let s=0,i=e.length;s<i;++s)this.set(e[s],t[s])}reset(){return this._initialized&&this._reset(0),this}_reset(e){const value="resource"===this._storage?0:this._defaultValue;if(this._buffer)if("number"!=typeof this._elementSize||this._elementSize>=8)this._buffer.fill(value,e);else{const t=8/this._elementSize;let s=0;for(let e=0;e<t;++e)s<<=this._elementSize,s+=value;if(void 0===e)this._buffer.fill(s);else{const t=e+(8-e%8);for(let s=e;s<t;++s)this._setArrayElt(this._buffer,s,value);this._buffer.fill(s,t/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function upperPowerOfTwo(e){let t=2;for(;t<e;)t*=2;return t}function createBuffer(e,t){return"any"===t?new Array(e):"float"===t?new Float32Array(e):"int8"===t?new Int8Array(e):"int16"===t?new Int16Array(e):"int32"===t?new Int32Array(e):32===t?new Uint32Array(e):16===t?new Uint16Array(e):new Uint8Array(Math.ceil(e/8*t))}var It=class{constructor(e){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=e?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new Ct({storage:"int32"}),this._idFlexArray.get=e=>this._indexToId[e],this._idFlexArray.getMultiple=e=>{const t=new Array(e.length);for(let s=0;s<e.length;++s)t[s]=this._indexToId[e[s]];return t},this._flexArraysByName.id=this._idFlexArray}addElements(e){const t=[];for(let s=0,i=e.length;s<i;++s){const i=e[s];let r=this._idToIndex[i];void 0===r&&(r=this._getNextIndex(),this._idToIndex[i]=r,this._indexToId[r]=i),t.push(r)}for(const e of this._flexArrays)e.grow(this._nextIndex);for(const e of this._indexLists)e.reserve(this._nextIndex);return new Uint32Array(t)}removeElements(e){for(let t=0,s=e.length;t<s;++t){const s=e[t],i=this._indexToId[s];void 0!==i&&(delete this._idToIndex[i],this._removeIndex(s))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(const e of this._flexArrays)e.reset();for(const e of this._indexLists)e.reset()}has(e){return void 0!==this._indexToId[e]}getIndex(e,t=!1){const s=this._idToIndex[e];if(void 0===s&&t)throw new Error(`${this._name} id "${e}" not found`);return s}createFlexArray(e,t){const{name:s}=e;if(s&&t&&this._flexArraysByName[s])throw new Error(`${this._name} flexArray "${s}" already exists`);let i=e.default;void 0===i&&"any"!==e.storage&&"resource"!==e.storage&&(i=0);const r=this._nextIndex,o={storage:e.storage,size:r,name:s,default:i};let a;return a=(void 0===i&&"any"!==e.storage&&e.storage,new Ct(o)),this._flexArrays.push(a),this._defaultValues.push(e.default),s&&t&&(this._flexArraysByName[s]=a),a}getFlexArray(e){return this._flexArraysByName[e]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){const e=new Ze;return e.reserve(this._nextIndex),this._indexLists.push(e),e}getId(e){return this._indexToId[e]}getMaxIndex(){return this._nextIndex-1}_removeIndex(e){this._indexesToBeFreed.push(e)}_getNextIndex(){let e=this._freeIndexes.pop();return void 0===e&&(e=this._nextIndex++),e}freeIndexes(){for(const e of this._indexesToBeFreed)this._indexToId[e]=void 0,this._freeIndexes.push(e);for(let e=0;e<this._flexArrays.length;++e){const t=this._flexArrays[e],s=this._defaultValues[e];for(const e of this._indexesToBeFreed)t.set(e,s)}this._indexesToBeFreed=[]}},Pt=smartRequire("web-worker"),Ft=!!Pt||"undefined"!=typeof Worker&&"undefined"!=typeof Blob;function formatWorkerMessage(e){return Pt?removeTypedArrays(e):e}function removeTypedArrays(e){if(ArrayBuffer.isView(e))return Array.from(e);if(Array.isArray(e)){for(let t=0;t<e.length;t++)e[t]=removeTypedArrays(e[t]);return e}if(isObject(e)){const t=Object.keys(e);for(const s of t)e[s]=removeTypedArrays(e[s]);return e}return e}function createWorker(e){return Pt?function newNodeWebWorker(e){if(Pt)return new Pt("data:application/javascript,"+e.replace(/\n/g,""))}(e):function newStandardWebWorker(e){const t=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(t);return new Worker(s)}(e)}var zt=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function parseColorRgba(e,t=[0,0,0,0]){const s=zt.exec(e);return s?(t[0]=parseInt(s[1])/255,t[1]=parseInt(s[2])/255,t[2]=parseInt(s[3])/255,t[3]=void 0===s[4]?1:parseFloat(s[4]),t):null}function formatHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function componentsToRGBA([e,t,s,i=1]){return`rgba(${256*e|0},${256*t|0},${256*s|0},${i})`}function parseColorHex(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,s,i)=>t+t+s+s+i+i));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255,1]:null}var Ot=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],Bt=[0,0,0,0],Ut=new Map;Ut.set(null,[0,0,0,0]),Ut.set("transparent",[0,0,0,0]);for(let e=0;e<Ot.length;e+=2){const t=Ot[e].toLowerCase(),value=Ot[e+1];Ut.set(t,parseColorHex(value))}var Ht,parseColor=e=>{let t=Ut.get(e);if(void 0===t){const s=e+"",i="#"===s.charAt(0)?parseColorHex(s):parseColorRgba(s);Ut.set(e,i),t=i}return t},toHexa=e=>{const t=parseColor(e);if(!t)return null;const[s,i,r]=t;return`#${formatHex(255*s)}${formatHex(255*i)}${formatHex(255*r)}`},rgbaToRgb=e=>{let t=1,s=e;return s&&parseColorRgba(e,Bt)&&(s=`rgb(${255*+Bt[0]},${255*+Bt[1]},${255*+Bt[2]})`,t=parseFloat(Bt[3].toString())),{color:s,opacity:t}},$t=smartRequire("xmldom");Ht="undefined"!=typeof XMLSerializer?XMLSerializer:$t?$t.XMLSerializer:null;var Yt=class{constructor(e){this._attributes={},this._children=[],this._name=e}setAttribute(e,value){this._attributes[e]=value}appendChild(e){this._children.push(e)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){const e=this._name,t=this._attributes,s=this._children,i=Object.keys(t).filter((e=>void 0!==t[e])).map((e=>` ${e}="${""+t[e]}"`)).join(""),r=s.map((e=>e.serialize())).join("");return r.length?`<${e}${i}>${r}</${e}>`:`<${e}${i}/>`}cloneNode(e){const t=new Yt(this._name),s=Object.keys(this._attributes);for(const e of s)t.setAttribute(e,this._attributes[e]);if(e)for(let s=0;s<this._children.length;s++)t.appendChild(this._children[s].cloneNode(e));return t}},Zt=class{constructor(e){this._text=e}serialize(){return this._text}cloneNode(){return new Zt(this._text)}},Jt=class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(e){this._children.push(e)}serialize(){return this._meta.concat(this._children.map((e=>e.serialize()))).join("")}createElement(e){return new Yt(e)}createTextNode(e){return new Zt(e)}},createDummyXmlDocument=()=>new Jt;function serializeXMLDocument(e){if(Ht)return(new Ht).serializeToString(e)}var createXmlDocument=()=>getDocument().implementation.createDocument("","",null),es=class{constructor(e){this._heap=[],this._size=0,this._keyToValue=e,this._keyToIndex=new Int32Array(e.length),this._keyToIndex.fill(-1)}add(e){let t=this._keyToIndex[e];-1===t&&(t=this._size++,this._heap[t]=e),this._keyToIndex[e]=this._bubble(t)}removeMin(){if(0===this._size)return NaN;const e=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),e}isEmpty(){return 0===this._size}has(e){return-1!==this._keyToIndex[e]}_bubble(e){const value=this._indexToValue(e),t=this._getParentIndex(e),s=this._indexToValue(t);let i=e;if(0!==e&&s>value)i=this._swap(e,t);else{const t=this._getLeftChildIndex(e),s=this._getRightChildIndex(e),r=this._indexToValue(t),o=this._indexToValue(s),a=Math.min(value,r,o);a===value||(i=a===r?this._swap(e,t):this._swap(e,s))}return i===e?e:this._bubble(i)}_indexToValue(e){return e>=this._size?1/0:this._keyToValue[this._heap[e]]}_getParentIndex(e){return(e-1)/2|0}_getLeftChildIndex(e){return 2*e+1}_getRightChildIndex(e){return 2*e+2}_swap(e,t){const s=this._heap[e],i=this._heap[t];return this._heap[e]=i,this._heap[t]=s,this._keyToIndex[s]=t,this._keyToIndex[i]=e,t}},ts=class{constructor(e,t){this._graph=e,this._nodes={elementList:e.nodeList,flexArray:e.createNodeAttribute({storage:1,name:t},!!t),indexList:e.createIndexList(!0)},this._edges={elementList:e.edgeList,flexArray:e.createEdgeAttribute({storage:1,name:t},!!t),indexList:e.createIndexList(!1)}}_get(e){return e.isNode?this._nodes:this._edges}addOrRemoveElements(e,t){return t?this.addElements(e):this.removeElements(e)}addElements(e){const{elementList:t,flexArray:s,indexList:i}=this._get(e),r=i.getLength();for(let t=0;t<e._indexes.length;t++){const r=e._indexes[t];1!==s.get(r)&&(s.set(r,1),i.pushUnchecked(r))}return t(i.slice(r))}removeElements(e){const{elementList:t,flexArray:s,indexList:i}=this._get(e),r=i.getLength(),o=i.getBuffer();if(r>o.length)return this.clear(),this.addElements(e),e;let a=0;for(let t=0;t<e._indexes.length;t++){const i=e._indexes[t];0!==s.get(i)&&(s.set(i,0),a+=1)}if(a===r)return t(i.sliceAndReset());if(0===a)return t();{const l=this._graph.acquireIndexList(e.isNode);let d=0;for(let e=0;e<r;++e){const t=o[e];0===s.get(t)?(d+=1,l.pushUnchecked(t)):o[e-d]=t}return i.setLength(r-a),t(l.sliceAndReset())}}hasElement(e){return!!this._get(e).flexArray.get(e._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function displayPixelsOnScreen(e,t,s,i=0){void 0===t&&(t=s=Math.sqrt(e.length/4)),void 0===s&&(s=t);const r=document.createElement("canvas"),o=r.getContext("2d");if(o){const a=o.createImageData(t,s);r.style.imageRendering="pixelated",r.style.border="1px solid black",r.style.margin="2px",r.style.position="absolute",r.style.top=r.style.left="0px",r.width=t,r.height=s,a.data.set(e),o.putImageData(a,0,0);const l=document.getElementById("graph-container");l&&(l.style.position="static"),setTimeout((()=>document.body.appendChild(r)),i)}}var simpleBoundingBox=()=>({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),ss=class{constructor(e={}){const{xValues:t=[],yValues:s=[],scaledSizeValues:i=[],fixedSizeValues:r=[]}=e;this.minX=computeMin(t),this.minY=computeMin(s),this.maxX=computeMax(t),this.maxY=computeMax(s),this.minScaledSize=computeMin(i),this.maxScaledSize=computeMax(i),this.minFixedSize=computeMin(r),this.maxFixedSize=computeMax(r),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(e,t,s,i){return this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,t),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,t),void 0!==s&&void 0!==i&&("scaled"===i?(this.minScaledSize=Math.min(this.minScaledSize,s),this.maxScaledSize=Math.max(this.maxScaledSize,s)):(this.minFixedSize=Math.min(this.minFixedSize,s),this.maxFixedSize=Math.max(this.maxFixedSize,s))),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this}computeForZoom(e){const t=Math.max(this.maxScaledSize,this.maxFixedSize/e);return ss.from({minX:this.minX-t/2,minY:this.minY-t/2,maxX:this.maxX+t/2,maxY:this.maxY+t/2,width:this.width+t,height:this.height+t})}static from({minX:e,minY:t,maxX:s,maxY:i,width:r,height:o}={}){const a=new ss;return null!=e&&(a.minX=e),null!=t&&(a.minY=t),null!=s&&(a.maxX=s),null!=i&&(a.maxY=i),null!=s&&null!=e&&(a.width=r||(s-e)/2,a.cx=(e+s)/2),null!=i&&null!=t&&(a.height=o||(i-t)/2,a.cy=(t+i)/2),a}static fromValues(e,t,s){let i=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let d=0;d<e.length;d++){const h=e[d],u=t[d],c=s[d];h-c<i&&(i=h-c),u-c<r&&(r=u-c),h+c>o&&(o=h+c),u+c>a&&(a=u+c),c>l&&(l=c)}const d=ss.from({minX:i,minY:r,maxX:o,maxY:a});return d.maxScaledSize=l,d}pad(value){return this.minX-=value,this.minY-=value,this.maxX+=value,this.maxY+=value,this.width+=2*value,this.height+=2*value,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(e){return this.addPoint(e.minX,e.minY),this.addPoint(e.maxX,e.maxY),this}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}},is=class{on(e,t){if("string"!=typeof e)throw new TypeError("Event name must be string");if("function"!=typeof t)throw new TypeError("Event handler must be function");const s=this._events=this._events||{};return(s[e]=s[e]||[]).push(t),this}off(e,t){if("string"!=typeof e)throw new TypeError("Event name must be string");const s=this._events=this._events||{},i=s[e];if(isArray(i))if("function"!=typeof t)s[e]=null;else{const r=i.indexOf(t);-1!==r&&i.splice(r,1),0===i.length&&(s[e]=null)}return this}fire(e,...t){if("string"!=typeof e)throw new TypeError("Event name must be string");const s=(this._events=this._events||{})[e];if(isArray(s)){const e=t;for(let t=0;t<s.length;t++){const i=s[t];i&&i.apply(this,e)}}return this}once(e,t){const s=this,wrapped=function(...i){t.apply(s,i),s.off(e,wrapped)};return wrapped.handler=t,this.on(e,wrapped)}hasListener(e,t){if(!e||!t)return!1;const s=(this._events=this._events||{})[e];if(isArray(s))for(let e=0,i=s.length;e<i;e++){const i=s[e];if(i===t||i.handler===t)return!0}return!1}clearEvents(){this._events={}}getListeners(e){return(this._events=this._events||{})[e]}},ns=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=8,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(e){return void 0===e&&(e=this._nextIndex++),e>=this._capacity&&this._reserve(e+1),this._sizes[e]=0,e}get(e){const t=this._sizes[e],s=this._MAX_LIST_SIZE*e;if(t<=this._MAX_LIST_SIZE){this._constList.length=t;for(let e=0,i=t;e<i;++e)this._constList[e]=this._buffer[s+e];return this._constList}if(t===this._BIG_LIST){const e=this._buffer[s];return this._bigLists[e]}throw new Error(`Table: ${e} out of bounds (${t})`)}size(e){const t=this._sizes[e];return t<=this._MAX_LIST_SIZE?t:this._bigLists[this._buffer[e*this._MAX_LIST_SIZE]].length}sizes(e){const t=this._sizes,s=this._bigLists,i=this._buffer,r=this._MAX_LIST_SIZE,o=e.length,a=new Array(o);for(let l=0;l<o;l++){const o=e[l],d=t[o];a[l]=d<=r?d:s[i[o*r]].length}return a}addTo(e,value){const t=this._sizes[e],s=e*this._MAX_LIST_SIZE;if(t<this._MAX_LIST_SIZE)this._buffer[s+t]=value,this._sizes[e]=t+1;else if(t===this._BIG_LIST){const e=this._buffer[s];this._bigLists[e].push(value)}else{const t=new Array(this._MAX_LIST_SIZE);for(let e=0;e<this._MAX_LIST_SIZE;++e)t[e]=this._buffer[s+e];t.push(value),this._bigLists.push(t),this._sizes[e]=this._BIG_LIST,this._buffer[s]=this._bigLists.length-1}return this}removeFrom(e,value){return this.removeFromAndGetSize(e,value),this}removeFromAndGetSize(e,value){const t=this._MAX_LIST_SIZE*e;let s=this._sizes[e];if(s<=this._MAX_LIST_SIZE){for(let i=t,r=t+s;i<r;++i)if(this._buffer[i]===value)return s-=1,this._buffer[i]=this._buffer[r-1],this._sizes[e]=s,s}else if(s===this._BIG_LIST){const e=this._buffer[t],s=this._bigLists[e],i=s.indexOf(value);if(-1!==i)return s.splice(i,1),s.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(e){return this._capacity<e&&this._reserve(e),this}_reserve(e){this._capacity=Math.pow(2,Math.ceil(Math.log2(e))),this._buffer=expandArray(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=expandArray(this._sizes,this._capacity)}};function expandArray(e,t){const s=new(0,e.constructor)(t);return s.set(e),s}function getLargestEmptyCircle(e,t=1,s=0,i,convexhull){if(!i||!convexhull){const t=e.map((e=>[e.x,e.y])),s=oe.from(t,(e=>e.x),(e=>e.y));i=indexArrayToArray(s.triangles,t),convexhull=indexArrayToArray(s.hull,t)}if(!convexhull)return[];const r=s*s,o=[],a={};for(let e=0;e<i.length;e+=3){if(inside(convexhull,getCircumcenter(i[e],i[e+1],i[e+2]))){const t=circumcircleRadiusSquared(i[e],i[e+1],i[e+2]);t>r&&(o.push(e),a[e]=t)}}if(0===o.length)return[];o.sort(((e,t)=>a[e]-a[t]));let l=o[0],d=a[l];const h=[];for(let e=0;e<o.length;e++){const s=o[e],i=a[s];i>d&&i>r&&(l=s,d=i,h.push(l),h.length>t&&h.shift())}return h.map((e=>function makeCircle(e,t,s){const i=getCircumcenter(e,t,s);let r=0;for(let e=0;e<3;e++){const t=arguments[e],s=t[0]-i[0],o=t[1]-i[1],a=Math.sqrt(s*s+o*o);a>r&&(r=a)}return[i[0],i[1],r]}(i[e],i[e+1],i[e+2])))}function inside(e,t){const s=e.length,i=e[s-1],[r,o]=t;let[a,l]=i,d=!1;for(let t=0;t<s;t++){const s=e[t],[i,h]=s;h>o!=l>o&&r<(a-i)*(o-h)/(l-h)+i&&(d=!d),a=i,l=h}return d}function circumcircleRadiusSquared(e,t,s){const[i,r]=getCircumcenter(e,t,s),[o,a]=e,l=i-o,d=r-a;return l*l+d*d}function getCircumcenter(e,t,s){const i=[(e[0]+t[0])/2,(e[1]+t[1])/2],r=[(t[0]+s[0])/2,(t[1]+s[1])/2],o=-1/((t[1]-e[1])/(t[0]-e[0])),a=-1/((s[1]-t[1])/(s[0]-t[0])),l=i[1]-o*i[0],d=(l-(r[1]-a*r[0]))/(a-o);return[d,o*d+l]}function minDisk(e,t,s,i){let r;if(i)r=i;else{r=new Uint32Array(e.length);for(let t=0,s=e.length;t<s;t++)r[t]=t}function enclosesWeak(e,t,s,i,r,o){const a=s-o+1e-9*Math.max(s,o,1),l=i-e,d=r-t;return a>0&&a*a>l*l+d*d}function enclosesWeakAll(e,t,s,i,r,o,a){for(let l=0;l<i.length;++l){const d=i[l];if(!enclosesWeak(e,t,s,r[d],o[d],a[d]))return!1}return!0}function encloseBasis2(e,t,s,i,r,o){const a=i-e,l=r-t,d=o-s,h=Math.sqrt(a*a+l*l);return[(e+i+a/h*d)/2,(t+r+l/h*d)/2,(h+s+o)/2]}function encloseBasis3(e,t,s,i,r,o,a,l,d){const h=e-i,u=e-a,c=t-r,m=t-l,p=o-s,y=d-s,x=e*e+t*t-s*s,b=x-i*i-r*r+o*o,v=x-a*a-l*l+d*d,E=u*c-h*m,k=(c*v-m*b)/(2*E)-e,L=(m*p-c*y)/E,D=(u*b-h*v)/(2*E)-t,B=(h*y-u*p)/E,H=L*L+B*B-1,X=2*(s+k*L+D*B),Y=k*k+D*D-s*s,Z=-(Math.abs(H)>1e-6?(X+Math.sqrt(X*X-4*H*Y))/(2*H):Y/X);return[e+k+L*Z,t+D+B*Z,Z]}function encloseBasis(e,t,s,i){switch(e.length){case 1:const r=e[0];return function encloseBasis1(e,t,s){return[e,t,s]}(t[r],s[r],i[r]);case 2:const[o,a]=e;return encloseBasis2(t[o],s[o],i[o],t[a],s[a],i[a]);case 3:const[l,d,h]=e;return encloseBasis3(t[l],s[l],i[l],t[d],s[d],i[d],t[h],s[h],i[h]);default:return null}}function enclosesNot(e,t,s,i,r,o){const a=s-o,l=i-e,d=r-t;return a<0||a*a<l*l+d*d}function extendBasis(e,t,s,i,r){const o=s[t],a=i[t],l=r[t];if(enclosesWeakAll(o,a,l,e,s,i,r))return[t];for(let d=0;d<e.length;++d){const h=e[d],u=s[h],c=i[h],m=r[h];if(enclosesNot(o,a,l,u,c,m)){const[h,p,y]=encloseBasis2(u,c,m,o,a,l);if(enclosesWeakAll(h,p,y,e,s,i,r))return[e[d],t]}}for(let d=0;d<e.length-1;++d)for(let h=d+1;h<e.length;++h){const u=e[d],c=e[h],m=s[u],p=i[u],y=r[u],x=s[c],b=i[c],v=r[c],E=encloseBasis2(m,p,y,x,b,v);if(enclosesNot(E[0],E[1],E[2],o,a,l)){const d=encloseBasis2(m,p,y,o,a,l);if(enclosesNot(d[0],d[1],d[2],x,b,v)){const d=encloseBasis2(x,b,v,o,a,l);if(enclosesNot(d[0],d[1],d[2],m,p,y)){const d=encloseBasis3(m,p,y,x,b,v,o,a,l);if(enclosesWeakAll(d[0],d[1],d[2],e,s,i,r))return[u,c,t]}}}}throw new Error}return r=function shuffle2(e){for(let t=e.length-1;t>=0;t--){let s=Math.floor(Math.random()*(t+1));s=Math.max(Math.min(s,t),0);const i=e[t];e[t]=e[s],e[s]=i}return e}(r),s=s||new Array(e.length).fill(0),function minDiskIterative(e,t,s,i,r){let o=null,a=[],l=0;for(;l<t;){const t=e[l];o&&enclosesWeak(o[0],o[1],o[2],s[t],i[t],r[t])?l++:(a=extendBasis(a,t,s,i,r),o=encloseBasis(a,s,i,r),l=0)}return o}(r,r.length,e,t,s)}var rs=[1/0,1/0,-1/0,-1/0];function rotate(e,t,s,i,r,o={x:0,y:0}){const a=Math.cos(r),l=Math.sin(r),d=e-s,h=t-i;return o.x=a*d-l*h+s,o.y=l*d+a*h+i,o}function move(e,t,s=0,i={x:0,y:0}){return i.x=e.x+s*Math.sin(t),i.y=e.y+s*Math.cos(t),i}function distance(e,t,s,i){return Math.sqrt((e-s)*(e-s)+(t-i)*(t-i))}function squaredDistance(e,t,s,i){const r=e-s,o=t-i;return r*r+o*o}function normalize(e){const t=Math.sqrt(e.x*e.x+e.y*e.y);return e.x/=t,e.y/=t,e}function radiansToDegrees(e){return 180*e/Math.PI}function degreesToRadians(e){return e*Math.PI/180}function extendBounds(e,t){return e.minX-=t,e.minY-=t,e.maxX+=t,e.maxY+=t,void 0===e.width&&(e.width=e.maxX-e.minX),void 0===e.height&&(e.height=e.maxY-e.minY),e.width+=2*t,e.height+=2*t,e}function circleCircleIntersection(e,t,s,i,r,o){const a=i-e,l=r-t,d=Math.sqrt(a*a+l*l);if(d>s+o)return null;if(d<Math.abs(s-o))return null;const h=(s*s-o*o+d*d)/(2*d),u=e+a*h/d,c=t+l*h/d,m=Math.sqrt(s*s-h*h),p=m/d*-l,y=a*(m/d);return[[u+p,c+y],[u-p,c-y]]}function circleSortCompare(e,t,s,i,r,o){if(e-r>=0&&s-r<0)return 1;if(e-r<0&&s-r>=0)return-1;if(e-r==0&&s-r==0)return t-i>=0||i-o>=0?t-i:i-t;const a=(e-r)*(i-o)-(s-r)*(t-o);if(a<0)return 1;if(a>0)return-1;return(e-r)*(e-r)+(t-o)*(t-o)-((s-r)*(s-r)+(i-o)*(i-o))}function circleContainsPoint([e,t,s],i,r){const o=Math.abs(e-i),a=Math.abs(t-r);return o+a<=s||!(o>s||a>s)&&Math.sqrt(o*o+a*a)<s+1e-12}function circleContainsCircle(e,t,s,i){const r=e[0]-t,o=e[1]-s,a=e[2]-i;return r*r+o*o<a*a+1e-6}function circleIntersectsBox(e,t,s,i,r,o,a){const l=e-Math.max(i,Math.min(o,e)),d=t-Math.max(r,Math.min(a,t));return l*l+d*d<s*s}function circleLineIntersection(e,t,s,i,r,o,a,l={x:0,y:0}){const d=l||{x:0,y:0};let h,u,c,m;if(s===e){const t=e-r,s=a*a-t*t;if(s<0)return null;const i=Math.sqrt(s);h=e,c=e,u=o+i,m=o-i}else{const l=(i-t)/(s-e),d=t-l*e,p=d-o,y=l*l+1,x=2*(l*p-r),b=x*x-4*y*(r*r+p*p-a*a);if(b<0)return null;const v=-x,E=Math.sqrt(b),k=2*y;h=(v+E)/k,c=(v-E)/k,u=l*h+d,m=l*c+d}const p=e-h,y=t-u,x=e-c,b=t-m;return p*p+y*y<x*x+b*b?(d.x=h,d.y=u):(d.x=c,d.y=m),d}function removeRadialOverlap({X:e,Y:t,sizes:s,indexes:i,R:r,center:o,gap:a=0,epsilon:l=.001,maxLoops:d=5,inPlace:h=!0}){const u=i.length,c=o[0],m=o[1];let p=u;h||(e=e.slice(),t=t.slice());const y=circleCircleIntersection,x=circleSortCompare,b=i.slice().sort(((s,i)=>x(e[s],t[s],e[i],t[i],c,m))),v=b[u-1],E=e[v],k=t[v];let L=!1;for(let i=0;i<p-1;i++){let o=i%u,h=(i+1)%u;-1===i&&(o=u-1,h=0),o=b[o],h=b[h];const v=e[o],E=t[o];let k=e[h],D=t[h];const B=s[o]+s[h]+a;let H=x(v,E,k,D,c,m);if(-1===H&&L&&(H=1),!(B>r)){if(1===H||B-distance(v,E,k,D)>l){const s=y(c,m,r,v,E,B);if(s){const i=s[0];L=k>c&&i[0]<c,k=e[h]=i[0],D=t[h]=i[1]}}else L=!1;if(i%u==u-2){const i=b[u-1],r=b[0];if(t[i]>m&&t[r]>m&&e[i]-s[i]<e[r]+s[i]){let s=0;for(p=Math.min(u*d,p+u);t[b[i]]>m&&t[b[0]]>m&&e[b[i]]<e[b[0]]&&++s<u;){const e=b.pop();e&&b.unshift(e)}}}}}const D=E-c,B=k-m,H=e[v]-c,X=t[v]-m,Y=D===H?0:Math.abs(Math.acos((D*H+B*X)/(Math.sqrt(D*D+B*B)*Math.sqrt(H*H+X*X))));if(0!==Y){const s=Math.sin(-Y),i=Math.cos(-Y);let r;for(let o=0;o<u;o++){r=b[o];const a=e[r]-c,l=t[r]-m;e[r]=a*i-l*s+c,t[r]=a*s+l*i+m}}return{X:e,Y:t}}function calculateRadii(e,t,s,i,r,o){const a={},l=s[e];let d=l,h=0;const u=l*r;for(const e in t){const l=t[e];let c=0,m=0;for(let e=0,t=l.length;e<t;e++){const t=s[l[e]];m=Math.max(m,t),c+=2*t+i}const p=c/(2*Math.PI),y=m+d,x=o?h+Math.max(o,y):h*r;h=Math.max(y,h,p,u,x),a[e]=h,d=m}return a[0]=0,a[Number.POSITIVE_INFINITY]=h,a}function computeUpperHullIndexes(e){const t=e.length,s=[0,1];let i=2;for(let l=2;l<t;l++){for(;i>1&&(r=e[s[i-2]],o=e[s[i-1]],a=e[l],(o[0]-r[0])*(a[1]-r[1])-(o[1]-r[1])*(a[0]-r[0])<=0);)--i;s[i++]=l}var r,o,a;return s.slice(0,i)}function convexHull(e){const t=e.length;if(t<3)return null;const s=new Array(t),i=new Array(t);for(let i=0;i<t;i++)s[i]=[+e[i][0],+e[i][1],i];s.sort(((e,t)=>e[0]-t[0]||e[1]-t[1]));for(let e=0;e<t;e++)i[e]=[s[e][0],-s[e][1]];const r=computeUpperHullIndexes(s),o=computeUpperHullIndexes(i),a=o[o.length-1],l=r[r.length-1],d=o[0]===r[0],h=a===l?1:0,u=[];for(let t=r.length-1;t>=0;--t)u.push(e[s[r[t]][2]]);for(let t=+d;t<o.length-h;t++)u.push(e[s[o[t]][2]]);return u}var cubicIn=e=>--e*e*e+1,magnitude=(e,t,s)=>{const i=e-s[0],r=t-s[1];return i*i+r*r},minmax=(e,t)=>{let s=1/0,i=-1/0;for(let r=0;r<e.length;r++){const o=e[r],a=t?t[o]:o;s=Math.min(a,s),i=Math.max(a,i)}return{min:s,max:i}};function circleSpread({X:e,Y:t,R:s,center:i,maxSteps:r=1e3,padding:o=5,epsilon:a=1e-9,damping:l=2,pinned:d,indexes:h,onUpdate:u,pushSmallerOut:c=!0}){const m=h?h.length:e.length;let p=h;if(isFinite(d)||(d=-1),void 0===p){p=new Uint32Array(m);for(let e=0;e<m;e++)p[e]=e}else p=h;if(-1!==d)i=[e[d],t[d]];else if(!i){let s=0,r=0;for(let i=0;i<m;i++)s+=e[p[i]],r+=t[p[i]];i=[s/m,r/m]}const{min:y,max:x}=minmax(p,s);function run(r,a){let h=0;for(let i=0;i<m-1;i++)for(let l=i+1;l<m;l++){if(i===l)continue;const u=p[i],c=p[l],m=e[u],x=t[u],b=s[u],v=e[c],E=t[c],k=s[c],L=v-m,D=E-x,B=b+k+o,H=L*L+D*D;if(H<B*B-r){const s=(B-Math.sqrt(H))*a,i=1/H,r=L*i*s,o=D*i*s,l=r*r+o*o;if(c!==d){const s=b/y;h+=l*s,e[c]+=r*s,t[c]+=o*s}if(u!==d){const s=k/y;h+=l*s,e[u]-=r*s,t[u]-=o*s}}}const u=r*l*(1-a),b=i[0],v=i[1];for(let i=0;i<m;i++){const r=p[i];if(r!==d){const i=e[r],o=t[r],a=s[r],l=c?u*(a/x):u,d=(i-b)*l,m=(o-v)*l;h+=d*d+m*m,e[r]-=d,t[r]-=m}}return h}p.sort(((r,o)=>s[o]*magnitude(e[o],t[o],i)-s[r]*magnitude(e[r],t[r],i)));let b=0,v=0;const E=cubicIn(1/m);for(let s=0;s<r&&(b=run(E,cubicIn((s+1)/r)),u&&setTimeout((()=>u(e,t))),!(Math.abs(b-v)<a));s++)v=b;return{X:e,Y:t}}var node=e=>({data:e,next:null,prev:null});function circlePack(e,t=0,s=0){const i=e.length;if(0===i)return e;const r=e[0];if(r.x=t,r.y=s,1===i)return e;const o=e[1];if(r.x=t-o.radius,o.x=t+r.radius,o.y=s,2===i)return e;const a=e[2];place(o,r,a);let l=node(r),d=node(o),h=node(a);l.next=h.prev=d,d.next=l.prev=h,h.next=d.prev=l;e:for(let t=3;t<i;t++){h=node(e[t]),place(l.data,d.data,e[t]);let s=d.next,i=l.prev,r=d.data.radius,o=l.data.radius;do{if(r<=o){if(intersects(s.data,h.data)){d=s,l.next=d,d.prev=l,--t;continue e}r+=s.data.radius,s=s.next}else{if(intersects(i.data,h.data)){l=i,l.next=d,d.prev=l,--t;continue e}o+=i.data.radius,i=i.prev}}while(s!==i.next);h.prev=l,h.next=d,l.next=d.prev=d=h;let a=score(l);for(;(h=h.next)!==d;){const e=score(h);e<a&&(l=h,a=e)}d=l.next}return e}function place(e,t,s){const i=e.x-t.x;let r,o;const a=e.y-t.y,l=i*i+a*a;let d,h;l?(o=t.radius+s.radius,o*=o,h=e.radius+s.radius,h*=h,o>h?(r=(l+h-o)/(2*l),d=Math.sqrt(Math.max(0,h/l-r*r)),s.x=e.x-r*i-d*a,s.y=e.y-r*a+d*i):(r=(l+o-h)/(2*l),d=Math.sqrt(Math.max(0,o/l-r*r)),s.x=t.x+r*i-d*a,s.y=t.y+r*a+d*i)):(s.x=t.x+s.radius,s.y=t.y)}var os=1e-6;function intersects(e,t){const s=e.radius+t.radius-os,i=t.x-e.x,r=t.y-e.y;return s>0&&s*s>i*i+r*r}function score(e){const t=e.data,s=e.next.data,i=t.radius+s.radius,r=(t.x*s.radius+s.x*t.radius)/i,o=(t.y*s.radius+s.y*t.radius)/i;return r*r+o*o}var as=class{constructor(e,t){this.key=e,this.data=t,this.left=null,this.right=null}};function DEFAULT_COMPARE(e,t){return e>t?1:e<t?-1:0}function splay(e,t,s){if(null===t)return t;let i,r,o;const a=new as;for(i=r=a;;){const a=s(e,t.key);if(a<0){if(null===t.left)break;if(s(e,t.left.key)<0&&(o=t.left,t.left=o.right,o.right=t,null===(t=o).left))break;r.left=t,r=t,t=t.left}else{if(!(a>0))break;if(null===t.right)break;if(s(e,t.right.key)>0&&(o=t.right,t.right=o.left,o.left=t,null===(t=o).right))break;i.right=t,i=t,t=t.right}}return i.right=t.left,r.left=t.right,t.left=a.right,t.right=a.left,t}function insert(e,t,s,i,r){const o=new as(e,t);if(r._size++,null===s)return o.left=o.right=null,o;const a=i(e,(s=splay(e,s,i)).key);return a<0?(o.left=s.left,o.right=s,s.left=null):a>=0&&(o.right=s.right,o.left=s,s.right=null),o}function remove(e,t,s,i){let r;return null===t?null:0===s(e,(t=splay(e,t,s)).key)?(null===t.left?r=t.right:(r=splay(e,t.left,s),r.right=t.right),i._size--,r):t}function split(e,t,s){let i,r;if(null===t)i=r=null;else{const o=s((t=splay(e,t,s)).key,e);0===o?(i=t.left,r=t.right):o<0?(r=t.right,t.right=null,i=t):(i=t.left,t.left=null,r=t)}return{left:i,right:r}}function printRow(e,t,s,i,r){if(e){i(`${t}${s?" ":" "}${r(e)}\n`);const o=t+(s?"    ":"   ");e.left&&printRow(e.left,o,!1,i,r),e.right&&printRow(e.right,o,!0,i,r)}}var ls=class{constructor(e=DEFAULT_COMPARE){this._comparator=e,this._root=null,this._size=0}insert(e,t){return this._root=insert(e,t,this._root,this._comparator,this)}add(e,t){return this._root=function add(e,t,s,i,r){const o=new as(e,t);if(null===s)return o.left=o.right=null,r._size++,o;const a=i(e,(s=splay(e,s,i)).key);return 0===a?s:(a<0?(o.left=s.left,o.right=s,s.left=null):a>0&&(o.right=s.right,o.left=s,s.right=null),r._size++,o)}(e,t,this._root,this._comparator,this)}remove(e){this._root=remove(e,this._root,this._comparator,this)}pop(){let e=this._root;if(e){for(;e.left;)e=e.left;return this._root=splay(e.key,this._root,this._comparator),this._root=remove(e.key,this._root,this._comparator,this),{key:e.key,data:e.data}}return null}findStatic(e){let t=this._root;const s=this._comparator;for(;t;){const i=s(e,t.key);if(0===i)return t;t=i<0?t.left:t.right}return null}find(e){return this._root&&(this._root=splay(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root}contains(e){let t=this._root;const s=this._comparator;for(;t;){const i=s(e,t.key);if(0===i)return!0;t=i<0?t.left:t.right}return!1}forEach(e,t){let s=this._root;const i=[];let r=!1;for(;!r;)null!==s?(i.push(s),s=s.left):0!==i.length?(s=i.pop(),e.call(t,s),s=s.right):r=!0;return this}range(e,t,s,i){const r=[],o=this._comparator;let a,l=this._root;for(;0!==r.length||l;)if(l)r.push(l),l=l.left;else{if(l=r.pop(),a=o(l.key,t),a>0)break;if(o(l.key,e)>=0&&s.call(i,l))return this;l=l.right}return this}keys(){const e=[];return this.forEach((({key:t})=>e.push(t))),e}values(){const e=[];return this.forEach((({data:t})=>e.push(t))),e}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}at(e){let t=this._root,s=!1,i=0;const r=[];for(;!s;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),i===e)return t;i++,t=t.right}else s=!0;return null}next(e){let t=this._root,s=null;if(e.right){for(s=e.right;s.left;)s=s.left;return s}const i=this._comparator;for(;t;){const r=i(e.key,t.key);if(0===r)break;r<0?(s=t,t=t.left):t=t.right}return s}prev(e){let t=this._root,s=null;if(null!==e.left){for(s=e.left;s.right;)s=s.right;return s}const i=this._comparator;for(;t;){const r=i(e.key,t.key);if(0===r)break;r<0?t=t.left:(s=t,t=t.right)}return s}clear(){return this._root=null,this._size=0,this}toList(){return function toList(e){var t=e,s=[],i=!1;const r={next:null};let o=r;for(;!i;)t?(s.push(t),t=t.left):s.length>0?t=(t=o=o.next=s.pop()).right:i=!0;return o.next=null,r.next}(this._root)}load(e=[],t=[],s=!1){let i=e.length;const r=this._comparator;if(s&&sort(e,t,0,i-1,r),null===this._root)this._root=loadRecursive(this._root,e,t,0,i),this._size=i;else{const s=function mergeLists(e,t,s=((e,t)=>e-t)){const i={};let r=i,o=e,a=t;for(;null!==o&&null!==a;)s(o.key,a.key)<0?(r.next=o,o=o.next):(r.next=a,a=a.next),r=r.next;null!==o?r.next=o:null!==a&&(r.next=a);return i.next}(this.toList(),function createList(e,t){const s={next:null};let i=s;for(let s=0;s<e.length;s++)i=i.next={key:e[s],data:t[s]};return i.next=null,s.next}(e,t),r);i=this._size+i,this._root=sortedListToBST({head:s},0,i)}return this}isEmpty(){return null===this._root}get size(){return this._size}toString(e=(e=>e.key)){const t=[];return printRow(this._root,"",!0,(e=>t.push(e)),e),t.join("")}update(e,t,s){const i=this._comparator;let{left:r,right:o}=split(e,this._root,i);this._size--,i(e,t)<0?o=insert(t,s,o,i,this):r=insert(t,s,r,i,this),this._root=function merge2(e,t,s){return null===t?e:(null===e||((t=splay(e.key,t,s)).left=e),t)}(r,o,i)}split(e){return split(e,this._root,this._comparator)}};function loadRecursive(e,t,s,i,r){const o=r-i;if(o>0){const a=i+Math.floor(o/2),l={key:t[a],data:s[a],parent:e};return l.left=loadRecursive(l,t,s,i,a),l.right=loadRecursive(l,t,s,a+1,r),l}return null}function sortedListToBST(e,t,s){const i=s-t;if(i>0){const r=t+Math.floor(i/2),o=sortedListToBST(e,t,r),a=e.head;return a.left=o,e.head=e.head.next,a.right=sortedListToBST(e,r+1,s),a}return null}function sort(e,t,s,i,r){if(s>=i)return;const o=e[s+i>>1];let a=s-1,l=i+1;for(;;){do{a++}while(r(e[a],o)<0);do{l--}while(r(e[l],o)>0);if(a>=l)break;let s=e[a];e[a]=e[l],e[l]=s,s=t[a],t[a]=t[l],t[l]=s}sort(e,t,s,l,r),sort(e,t,l+1,i,r)}var ds=class extends ls{constructor(e){super(e,!0)}};ds.prototype.lte=function(e){const t=this._comparator;let s,i=this._root;for(;i;){if(s=t(i.key,e),null===i.left&&null===i.right&&s>0)return null;if(s<=0&&null===i.right||s<=0&&t(i.right.key,e)>0)return i;i=s>=0?i.left:i.right}return i},ds.prototype.gte=ds.prototype.gte||function(e){const t=[],s=this._comparator;let i=this._root;for(;0!==t.length||i;)if(i)t.push(i),i=i.left;else{if(i=t.pop(),s(i.key,e)>=0)break;i=i.right}return i},ds.prototype.clear=ds.prototype.clear||function(){return this._root=null,this._size=0,this};var hs=class{constructor(e=Int32Array,t=16,s=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=e,this._capacity=t,this._MAX_LIST_SIZE=s,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex={},this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(e){let t;return-1===this._freeIndex?t=this._nextIndex++:(t=this._freeIndex,this._freeIndex=-1),this._idToIndex[e]=t,t>=this._capacity&&this._expand(t+1),this._sizes[t]=0,t}getItems(e){const t=this._idToIndex[e];if(void 0===t)return;const s=this._sizes[t],i=this._MAX_LIST_SIZE*t;if(s<=this._MAX_LIST_SIZE){this._constList.length=s;for(let e=0,t=s;e<t;++e)this._constList[e]=this._buffer[i+e];return this._constList}if(s===this._BIG_LIST){let e=this._buffer[i];return this._bigLists[e]}}removeEntry(e){const t=this._idToIndex[e];if(this._sizes[t]===this._BIG_LIST){const e=this._MAX_LIST_SIZE*t,s=this._buffer[e];this._bigLists[s].length=0}this._sizes[t]=0,this._freeIndex=t}size(e){const t=this._idToIndex[e];let s=this._sizes[t];return s<=this._MAX_LIST_SIZE?s:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length}sizes(e){const t=this._sizes,s=this._bigLists,i=this._buffer,r=this._MAX_LIST_SIZE,o=e.length,a=new Array(o);for(let l=0;l<o;l++){const o=this._idToIndex[e[l]],d=t[o];a[l]=d<=r?d:s[i[o*r]].length}return a}addTo(e,value){const t=this._idToIndex[e],s=this._sizes[t],i=t*this._MAX_LIST_SIZE;if(s<this._MAX_LIST_SIZE)this._buffer[i+s]=value,this._sizes[t]=s+1;else if(s===this._BIG_LIST){let e=this._buffer[i];this._bigLists[e].push(value)}else{let e=new Array(this._MAX_LIST_SIZE);for(let t=0;t<this._MAX_LIST_SIZE;++t)e[t]=this._buffer[i+t];e.push(value),this._bigLists.push(e),this._sizes[t]=this._BIG_LIST,this._buffer[i]=this._bigLists.length-1}}removeFrom(e,value){this.removeFromAndGetSize(e,value)}removeFromAndGetSize(e,value){const t=this._idToIndex[e];let s=this._sizes[t],i=this._MAX_LIST_SIZE*t;if(s<=this._MAX_LIST_SIZE){for(let e=i,r=i+s;e<r;++e)if(this._buffer[e]===value)return s-=1,this._buffer[e]=this._buffer[r-1],this._sizes[t]=s,s}else if(s===this._BIG_LIST){let e=this._buffer[i],t=this._bigLists[e],s=t.indexOf(value);if(-1!==s)return t.splice(s,1),t.length}}reserve(e){this._capacity<e&&this._expand(e)}_expand(e){this._capacity=Math.pow(2,Math.ceil(Math.log2(e))),this._buffer=expandArray2(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=expandArray2(this._sizes,this._capacity)}has(e){const t=this._idToIndex[e];return!(void 0===t||t>=this._capacity)&&0!==this._sizes[t]}get averageSize(){let e=0;for(let t=0;t<this._capacity;t++)e+=this._sizes[t];return e/this._capacity}};function expandArray2(e,t){let s=new e.constructor(t);return s.set(e),s}var us,cs,gs,ms,_s,ps=[0,1],fs=[0,2];for(gs=4;gs<65535;gs<<=2)for(us=0,cs=ps.length;us<cs;us++)ps.push(ps[us]|gs),fs.push((ps[us]|gs)<<1);function morton(e,t){return(fs[255&t]|ps[255&e])+65536*(fs[t>>8&255]|ps[e>>8&255])+4294967296*(fs[t>>16&255]|ps[e>>16&255])}function reverse(e,t=[0,0]){if(e>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!ms){ms={},_s={};for(var s=0;s<256;s++)ms[morton(s,0)]=s,_s[morton(0,s)]=s}var i=ms[21845&e],r=_s[43690&e];return e>65535&&(i|=ms[21845&(e/=65536)]<<8,r|=_s[43690&e]<<8,e>65535&&(i|=ms[21845&(e/=65536)]<<16,r|=_s[43690&e]<<16)),t[0]=i,t[1]=r,t}morton.code=function code(e,t,s){if(e>24)throw"Morton codes are only supported up to Z=24";var i=1<<24-e;return morton(t*i,s*i)},morton.range=function range(e,t,s){if(e>24)throw"Morton ranges are only supported up to Z=24";var i=1<<24-e,r=morton(t*i,s*i);return[r,r+i*i-1]},morton.reverse=reverse,morton.decode=function decode(e,t){var s=reverse(t),i=1<<24-e;return[s[0]/i,s[1]/i]},morton.min=function min(e,t){var s=1431655765&e,i=1431655765&t,r=2863311530&e,o=2863311530&t;return Math.min(s,i)+Math.min(r,o)};var ys=1e-6,xs=1e-12;function getPolynomialRoots(){for(var e=arguments,t=e.length-1,s=t,i=[],r=0;r<=t&&Math.abs(e[r])<=xs;r++)t--;switch(t){case 1:!function getLinearRoots(e,t,s=[]){0!==t&&s.push(-e/t);return s}(e[s],e[s-1],i);break;case 2:!function getQuadraticRoots(e,t,s,i=[]){var r=t/s,o=r*r-e/s*4;if(o>0){var a=Math.sqrt(o);i.push(.5*(-r+a)),i.push(.5*(-r-a))}else 0===o&&i.push(.5*-r);return i}(e[s],e[s-1],e[s-2],i);break;case 3:!function getCubicRoots(e,t,s,i,r=[]){var o,a,l=i,d=s/l,h=t/l,u=(3*h-d*d)/3,c=(2*d*d*d-9*h*d+e/l*27)/27,m=d/3,p=c*c/4+u*u*u/27,y=c/2;Math.abs(p)<=ys&&(p=0);if(p>0){var x=Math.sqrt(p);a=(o=-y+x)>=0?Math.pow(o,1/3):-Math.pow(-o,1/3),(o=-y-x)>=0?a+=Math.pow(o,1/3):a-=Math.pow(-o,1/3),r.push(a-m)}else if(p<0){var b=Math.sqrt(-u/3),v=Math.atan2(Math.sqrt(-p),-y)/3,E=Math.cos(v),k=Math.sin(v),L=Math.sqrt(3);r.push(2*b*E-m),r.push(-b*(E+L*k)-m),r.push(-b*(E-L*k)-m)}else o=y>=0?-Math.pow(y,1/3):Math.pow(-y,1/3),r.push(2*o-m),r.push(-o-m);return r}(e[s],e[s-1],e[s-2],e[s-3],i)}return i}function quadBezierLine(e,t,s,i,r,o,a,l,d,h,u){for(var c,m,p=Math.min(a,d),y=Math.min(l,h),x=Math.max(a,d),b=Math.max(l,h),v=getPolynomialRoots((c=l-h)*(e+-2*s+r)+(m=d-a)*(t+-2*i+o),c*(-2*e+2*s)+m*(-2*t+2*i),c*e+m*t+(a*h-d*l)),E=0;E<v.length;E++){var k=v[E];if(0<=k&&k<=1){var L=e+(s-e)*k,D=t+(i-t)*k,B=L+(s+(r-s)*k-L)*k,H=D+(i+(o-i)*k-D)*k;if(a===d){if(y<=H&&H<=b){if(!u)return 1;u.push(B,H)}}else if(l===h){if(p<=B&&B<=x){if(!u)return 1;u.push(B,H)}}else if(B>=p&&H>=y&&B<=x&&H<=b){if(!u)return 1;u.push(B,H)}}}return u?u.length/2:0}function quadBezierAABB(e,t,s,i,r,o,a,l,d,h,u){return u?(quadBezierLine(e,t,s,i,r,o,a,l,d,l,u),quadBezierLine(e,t,s,i,r,o,d,l,d,h,u),quadBezierLine(e,t,s,i,r,o,a,h,d,h,u),quadBezierLine(e,t,s,i,r,o,a,l,a,h,u),u.length/2):a<=e&&d>=e&&l<=t&&h>=t||a<=r&&d>=r&&l<=o&&h>=o||quadBezierLine(e,t,s,i,r,o,a,l,d,l)||quadBezierLine(e,t,s,i,r,o,d,l,d,h)||quadBezierLine(e,t,s,i,r,o,a,h,d,h)||quadBezierLine(e,t,s,i,r,o,a,l,a,h)?1:0}function cubicBezierLine(e,t,s,i,r,o,a,l,d,h,u,c,m){for(var p,y,x=Math.min(d,u),b=Math.min(h,c),v=Math.max(d,u),E=Math.max(h,c),k=getPolynomialRoots((p=h-c)*(-1*e+3*s+-3*r+a)+(y=u-d)*(-1*t+3*i+-3*o+l),p*(3*e+-6*s+3*r)+y*(3*t+-6*i+3*o),p*(-3*e+3*s)+y*(-3*t+3*i),p*e+y*t+(d*c-u*h)),L=0;L<k.length;L++){var D=k[L];if(0<=D&&D<=1){var B=e+(s-e)*D,H=t+(i-t)*D,X=s+(r-s)*D,Y=i+(o-i)*D,Z=B+(X-B)*D,oe=H+(Y-H)*D,de=Z+(X+(r+(a-r)*D-X)*D-Z)*D,he=oe+(Y+(o+(l-o)*D-Y)*D-oe)*D;if(d===u){if(b<=he&&he<=E){if(!m)return 1;m.push(de,he)}}else if(h===c){if(x<=de&&de<=v){if(!m)return 1;m.push(de,he)}}else if(de>=x&&he>=b&&de<=v&&he<=E){if(!m)return 1;m.push(de,he)}}}return m?m.length/2:0}function cubicBezierAABB(e,t,s,i,r,o,a,l,d,h,u,c,m){return m?(cubicBezierLine(e,t,s,i,r,o,a,l,d,h,u,h,m),cubicBezierLine(e,t,s,i,r,o,a,l,u,h,u,c,m),cubicBezierLine(e,t,s,i,r,o,a,l,d,c,u,c,m),cubicBezierLine(e,t,s,i,r,o,a,l,d,h,d,c,m),m.length/2):d<=e&&u>=e&&h<=t&&c>=t||d<=a&&u>=a&&h<=l&&c>=l||cubicBezierLine(e,t,s,i,r,o,a,l,d,h,u,h)||cubicBezierLine(e,t,s,i,r,o,a,l,u,h,u,c)||cubicBezierLine(e,t,s,i,r,o,a,l,d,c,u,c)||cubicBezierLine(e,t,s,i,r,o,a,l,d,h,d,c)?1:0}
/**
   * Bresenham rasterisation functions by Alois Zingl
   * @author Alois Zingl
   * @preserve
   */
var bs;!function setResolution(e){1<<(bs=e),1<<bs-1}(14);var vs="undefined"==typeof Map?class PolyfilledMap{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}set(e,value){e in this._values||this._size++,this._values[e]=value}get(e){return this._values[e]}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,As="undefined"==typeof Set?class PolyfilledSet{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}add(e){e in this._values||this._size++,this._values[e]=!0}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set,Ss=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(e){return this._getBounds=e,this}setIntersector(e){return this._intersects=e,this}},Es=class extends Ss{constructor(e,t,s=16,i=65536,r=Int32Array,o=16){super(),this._occupied=0,this._idToCode=new vs,this._codeCache=[0,0,0],this.code=(e,t,s)=>s|morton(e,t)<<this._bitsForZoom,this.decode=(e,t)=>(morton.reverse(e>>this._bitsForZoom,t),t[2]=e&this._zoomMask,t),this._intersects=e,this._getBounds=t,this._cells=new hs(r),this._offset=i,this._maxLevels=o,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-i,this._max=i,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=s*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let e=0;e<this._maxLevels;e++)this._bounds[4*e]=1/0,this._bounds[4*e+1]=1/0,this._bounds[4*e+2]=-1/0,this._bounds[4*e+3]=-1/0}setMinCellSize(e){return this._minCellSize=e,this}setOffset(e){return this._offset=e,this._min=-e,this._max=e,this._resolution=this._mortonMax/(this._max-this._min),this}insert(e,t,s,i,r){void 0===t&&([t,s,i,r]=this._getBounds(e));const o=Math.max(i-t,r-s);let a,l=this._minCellSize;for(a=0;l<o&&a<this._maxLevels-1;a++)l*=2;const d=this._resolution,h=this._min,u=d*(.5*(i+t)-h)/l|0,c=d*(.5*(r+s)-h)/l|0,m=this.code(u,c,a);this._cells.has(m)||this._cells.addEntry(m),this._cells.addTo(m,e),this._objectsAtLevel[a]++,this._occupied|=1<<a;const p=4*a,y=this._bounds;return u<y[p]&&(y[p]=u),c<y[p+1]&&(y[p+1]=c),u>y[p+2]&&(y[p+2]=u),c>y[p+3]&&(y[p+3]=c),this._idToCode.set(e,m),m}has(e){return this._idToCode.has(e)}update(e,t,s,i,r){return this.remove(e),this.insert(e,t,s,i,r)}remove(e){const t=this._idToCode.get(e);this.decode(t,this._codeCache);const s=this._codeCache[2];return 0==--this._objectsAtLevel[s]&&(this._occupied&=~(1<<s),this._bounds[4*s]=1/0,this._bounds[4*s+1]=1/0,this._bounds[4*s+2]=-1/0,this._bounds[4*s+3]=-1/0),this._cells.removeFrom(t,e),this._idToCode.delete(e),this}query(e,t,s,i){const r=this._cells,o=this._bounds,a=this._intersects,l=this._min,d=this._resolution;let h=this._minCellSize,u=this._occupied;const c=[];for(let m=0;m<this._maxLevels&&0!==u;h*=2,u>>=1,m++){if(0==(1&u))continue;const p=1/h,y=4*m,x=Math.max(o[y],d*(e-l)*p-1>>0),b=Math.max(o[y+1],d*(t-l)*p-1>>0),v=Math.min(o[y+2],d*(s-l)*p+1>>0),E=Math.min(o[y+3],d*(i-l)*p+1>>0);for(let o=x;o<=v;o++)for(let l=b;l<=E;l++){const d=this.code(o,l,m),h=r.getItems(d);if(void 0!==h)for(let r=0;r<h.length;r++){const o=h[r];a(o,e,t,s,i)&&c.push(o)}}}return c}traverse(e,t,s,i,r){const o=this._cells,a=this._bounds,l=this._intersects,d=this._min,h=this._resolution;let u=this._minCellSize,c=this._occupied;const m=[];for(let p=0;p<this._maxLevels&&0!==c;u*=2,c>>=1,p++){if(0==(1&c))continue;const y=1/u,x=4*p,b=Math.max(a[x],h*(e-d)*y-1>>0),v=Math.max(a[x+1],h*(t-d)*y-1>>0),E=Math.min(a[x+2],h*(s-d)*y+1>>0),k=Math.min(a[x+3],h*(i-d)*y+1>>0);for(let a=b;a<=E;a++)for(let d=v;d<=k;d++){const h=this.code(a,d,p),u=o.getItems(h);if(void 0!==u)for(let o=0;o<u.length;o++){const a=u[o];if(l(a,e,t,s,i)&&(m.push(a),r(a)))return m}}}return m}collisions(e,t=this._getBounds){if("function"!=typeof t)throw new Error("getBounds function is required to get the object bounds");const s=Array.from(this._idToCode.keys()),i=this._min,r=this._resolution,o=this._cells,a=new vs,l=[];for(let d=0;d<s.length;d++){let h=0,u=this._minCellSize,c=this._occupied;const m=s[d];let[p,y,x,b]=t(m);const v=Math.max(x-p,b-y);for(h=0;u<v;h++)u*=2,c>>=1;p=r*(p-i),y=r*(y-i),x=r*(x-i),b=r*(b-i);for(let t=h;t<this._maxLevels&&0!==c;u*=2,c>>=1,t++){if(0==(1&c))continue;const s=1/u,i=y*s-1>>0,r=x*s+1>>0,h=b*s+1>>0;for(let u=p*s-1>>0;u<=r;u++)for(let s=i;s<=h;s++){const i=this.code(u,s,t);if(a.get(i)===d)continue;a.set(i,d);const r=o.getItems(i);if(void 0!==r)for(let t=0;t<r.length;t++){const s=r[t],[i,o,a,d]=this._getBounds(s);s!==m&&e(m,i,o,a,d)&&l.push(m,s)}}}}return function deduplicate(e){const t=new As,s=[];for(let i=0;i<e.length;i+=2){const r=e[i],o=e[i+1],a=r<o?r*o+(o-r-1)*(o-r-1)/4:r*o+(r-o-1)*(r-o-1)/4;t.has(a)||(t.add(a),s.push(r,o))}return s}(l)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let e=0;e<this._maxLevels;e++)this._bounds[4*e]=1/0,this._bounds[4*e+1]=1/0,this._bounds[4*e+2]=-1/0,this._bounds[4*e+3]=-1/0;return this}keyToBBox(e){const[t,s,i]=this.decode(e,[0,0,0]),r=this._minCellSize*(1<<i),o=this._min,a=this._resolution;return[t*r/a+o,s*r/a+o,(t+1)*r/a+o,(s+1)*r/a+o]}keys(){return Object.keys(this._cells._idToIndex)}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map((e=>this._getBounds(e)))}};function overlaps2(e,t,s,i,r,o,a,l){return i>=o&&t<=l&&s>=r&&e<=a}var createNode=(e,t,s,i,r,o)=>({minX:e,minY:t,maxX:s,maxY:i,leaf:!0,level:o,parent:r,objects:[],final:!1,children:null});function getNodeBBox(e){const{minX:t,minY:s,maxX:i,maxY:r}=e;return[t,s,i,r]}function inside2(e,t,s,i,r,o,a,l){return e>=r&&s<=a&&t>=o&&i<=l}function findQuad(e,t,s,i,r,o,a,l){const d=(o+l)/2,h=(t+i)/2;return(e+s)/2<=(r+a)/2?h<=d?0:1:h<=d?3:2}var DEF_GET_BBOX=e=>e,ws=class extends Ss{constructor(e=DEF_GET_BBOX,t=10,s,i=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=t,this._root=null,this._getBounds=e,this._rootLevel=i,this._maxLevel=i+30,this._idToCell={},s&&(this._root=createNode(s[0],s[1],s[2],s[3],null,i))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(e,t,s,i,r,o=this._root){if(t||([t,s,i,r]=this._getBounds(e)),this._objects[e])return;if(this._objects[e]=!0,this._size++,!this._root){const o=Math.max(Math.abs(i-t),Math.abs(r-s));return this._root=createNode(t,s,t+o,s+o,null,this._rootLevel),this._idToCell[e]=[this._root],this._root.objects=[e],e}let a,l=[o],d=!1;const h=this._nodeCapacity,u=this._idToCell,c=this._maxLevel;let m;for(;m=l.pop();){a=m;const{minX:o,minY:p,maxX:y,maxY:x}=a;overlaps2(t,s,i,r,o,p,y,x)&&(a.leaf?a.objects&&(a.objects.length<h||a.final)?(a.objects.push(e),u[e]?u[e].push(a):u[e]=[a],d=!0,(a.level>=c||Math.abs(y-o)<=Math.abs(i-t)||Math.abs(x-p)<=Math.abs(r-s))&&(a.final=!0)):(this.splitNode(a),l.push(a)):l.push.apply(l,a.children))}if(!inside2(t,s,i,r,(o=this._root).minX,o.minY,o.maxX,o.maxY)){let d=this._rootLevel;for(;!inside2(t,s,i,r,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){o=this._root;const{minX:e,minY:i,maxX:r,maxY:a}=o;let l=e,h=i,u=r,c=a;const m=Math.abs(r-e),p=Math.abs(a-i);if(0===p&&0===m)break;const y=Math.max(m,p);t<e?(l-=y,s<i?h-=y:c+=y):(u+=y,s<i?h-=y:c+=y);const x=createNode(l,h,u,c,null,--d);this.splitNode(x),x.children[findQuad(e,i,r,a,l,h,u,c)]=o,this._root=o.parent=x}for(l=[this._root],this._root.level=this._rootLevel;m=l.shift();)if(a=m,!a.leaf)for(let e=0;e<4;e++){const t=a.children[e];t.level=a.level+1,l.push(t)}o=this._root;for(let t=0;t<4;t++){const s=o.children[t];s&&s.leaf&&s.objects&&(s.objects.push(e),u[e]?u[e].push(s):u[e]=[s])}}return d?e:void 0}removeById(e){if(!this._objects[e])return e;this._size--;const t=this._idToCell[e];for(let s=0;s<t.length;s++){const i=t[s].objects||[];for(let t=0,s=i.length;t<s;t++)if(i[t]===e){i.splice(t,1);break}}return delete this._objects[e],delete this._idToCell[e],e}remove(e){const[t,s,i,r]=this._getBounds(e),o=[this._root];let a,l;const d=[];for(;a=o.pop();)if(overlaps2(t,s,i,r,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const t=a.objects||[];for(let s=0,i=t.length;s<i;s++)if(t[s]===e){t.splice(s,1),1===i&&d.push(a);break}}else o.push.apply(o,a.children);if(delete this._idToCell[e],delete this._objects[e],this._size--,d.length)for(;l=d.pop();){let e=l.parent,t=!0;for(;e&&t;){if(!e.leaf){for(let s=0;s<4;s++)if(a=e.children[s],!a.leaf||a.objects&&0!==a.objects.length){t=!1;break}t&&(e.leaf=!0,e.children=[],e.objects=[])}e=e.parent}}return e}splitNode(e){const{minX:t,minY:s,maxX:i,maxY:r}=e,o=(t+i)/2,a=(s+r)/2,l=e.level+1,d=this._idToCell,h=this._maxLevel,u=[createNode(t,s,o,a,e,l),createNode(t,a,o,r,e,l),createNode(o,a,i,r,e,l),createNode(o,s,i,a,e,l)];if(null!==e.objects){const t=e.objects,s=this._getBounds;for(let i=0,r=t.length;i<r;i++){const r=t[i],o=s(r);let a=d[r];for(let e=0;e<4;e++){const t=u[e],{minX:s,minY:i,maxX:l,maxY:d}=t;overlaps2(o[0],o[1],o[2],o[3],s,i,l,d)&&(t.objects&&t.objects.push(r),(t.level>=h||Math.abs(l-s)<=Math.abs(o[2]-o[0])||Math.abs(d-i)<=Math.abs(o[3]-o[1]))&&(t.final=!0),a?a.push(t):a=[t])}a&&a.splice(a.indexOf(e),1)}}e.children=u,e.objects=null,e.leaf=!1}point(e,t,s){let i=[];const r=[this._root];let o,a,l;const d=this._getBounds;for(;o=r.pop();)if(e>=o.minX&&e<=o.maxX&&t>=o.minY&&t<=o.maxY){if(o.leaf){s&&o.objects&&(i=o.objects);const r=o.objects||[];for(let s=0,o=r.length;s<o;s++)l=r[s],a=d(l),e>=a[0]&&e<=a[2]&&t>=a[1]&&t<=a[3]&&i.push(l);break}r.push.apply(r,o.children)}return i.length?i:null}neigbours(e,t){let s,i=[];const r=[this._root];for(;s=r.pop();)if(e>=s.minX&&e<=s.maxX&&t>=s.minY&&t<=s.maxY){if(s.leaf){i=s.objects;break}r.push.apply(r,s.children)}return i}query(e,t,s,i){const r=[],o=[this._root];let a,l,d;const h=this._getBounds,u={},c=this._intersects;let m;for(;a=o.pop();)if(overlaps2(e,t,s,i,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const o=a.objects||[];for(let a=0,m=o.length;a<m;a++)d=o[a],u[d]||(l=h(d),overlaps2(e,t,s,i,l[0],l[1],l[2],l[3])&&(c&&!c(d,e,t,s,i)||r.push(d)),u[d]=!0)}else m=findQuad(e,t,s,i,a.minX,a.minY,a.maxX,a.maxY),o.push(a.children[(m+3)%4],a.children[(m+2)%4],a.children[(m+1)%4],a.children[m]);return r}traverse(e,t,s,i,r){const o=[],a=[this._root];let l,d,h;const u=this._getBounds,c={},m=this._intersects;let p;for(;l=a.pop();)if(overlaps2(e,t,s,i,l.minX,l.minY,l.maxX,l.maxY))if(l.leaf){const a=l.objects||[];for(let l=0,p=a.length;l<p;l++)if(h=a[l],!c[h]){if(d=u(h),overlaps2(e,t,s,i,d[0],d[1],d[2],d[3])&&(!m||m(h,e,t,s,i))&&(o.push(h),r(h)))return o;c[h]=!0}}else p=findQuad(e,t,s,i,l.minX,l.minY,l.maxX,l.maxY),a.push(l.children[(p+3)%4],l.children[(p+2)%4],l.children[(p+1)%4],l.children[p]);return o}getOverlaps(){const e=[this._root];let t,s,i;const r=[],o=this._getBounds,a={};for(;t=e.pop();)if(t.leaf){const e=t.objects||[],l=e.length;for(let t=0;t<l;t++)for(let d=0;d<l;d++)if(s=e[t],i=e[d],t!==d&&!a[s+":"+i]&&!a[i+":"+s]){a[s+":"+i]=!0;const e=o(s),t=o(i);overlaps2(e[0],e[1],e[2],e[3],t[0],t[1],t[2],t[3])&&r.push(s,i)}}else e.push.apply(e,t.children);return r}cover(e,t,s,i){if(null===this._root)return this._root=createNode(e,t,s,i,null,0),this;let r=this._root;if(!inside2(e,t,s,i,r.minX,r.minY,r.maxX,r.maxY)){let o=this._rootLevel;for(;!inside2(e,t,s,i,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){r=this._root;const{minX:s,minY:i,maxX:a,maxY:l}=r;let d=s,h=i,u=a,c=l;const m=Math.abs(a-s),p=Math.abs(l-i);if(0===p&&0===m)break;const y=Math.max(m,p);e<s?(d-=y,t<i?h-=y:c+=y):(u+=y,t<i?h-=y:c+=y);const x=createNode(d,h,u,c,null,--o);this.splitNode(x),x.children[findQuad(s,i,a,l,d,h,u,c)]=r,this._root=r.parent=x}const a=[this._root];let l,d;for(this._root.level=this._rootLevel;l=a.shift();)if(d=l,!d.leaf)for(let e=0;e<4;e++){const t=d.children[e];t.level=d.level+1,a.push(t)}}return this}getAll(){return Object.keys(this._objects).map((e=>Number(e)))}forEach(e,t){const s=[this._root];let i;for(;i=s.pop();)if(i.leaf&&i.objects)for(let s=0,r=i.objects.length;s<r;s++)e.call(t,i.objects[s]);else s.push.apply(s,i.children);return this}getLeafs(){const e=[this._root],t=[];let s;for(;s=e.pop();)s.leaf?t.push(s):e.push.apply(e,s.children);return t}traverseFromRoot(e,t){const s=[this._root];let i;for(;i=s.pop();)e.call(t,i,i.objects)||i.leaf||s.push.apply(s,i.children);return this}update(e,t,s,i,r){return this.remove(e),this.insert(e,t,s,i,r),this}getNodeBounds(e){return getNodeBBox(e)}};ws.flatAccessor=(e,t)=>s=>{const i=t*s;return e.slice(i,i+t)},ws.inside=inside2,ws.intersects=function intersects2(e,t,s,i,r,o,a,l){return e>r&&e<a&&t>o&&t<l||s>r&&s<a&&i>o&&i<l},ws.overlaps=overlaps2,ws.getNodeBBox=getNodeBBox;var Ts=ws;function add2(e,t,s,i){if(isNaN(t)||isNaN(s))return e;var r,o,a,l,d,h,u,c,m,p=e._root,y={data:i},x=e._x0,b=e._y0,v=e._x1,E=e._y1;if(!p)return e._root=y,e;for(;p.length;)if((h=t>=(o=(x+v)/2))?x=o:v=o,(u=s>=(a=(b+E)/2))?b=a:E=a,r=p,!(p=p[c=u<<1|h]))return r[c]=y,e;if(l=+e._x.call(null,p.data),d=+e._y.call(null,p.data),t===l&&s===d)return y.next=p,r?r[c]=y:e._root=y,e;do{r=r?r[c]=new Array(4):e._root=new Array(4),(h=t>=(o=(x+v)/2))?x=o:v=o,(u=s>=(a=(b+E)/2))?b=a:E=a}while((c=u<<1|h)==(m=(d>=a)<<1|l>=o));return r[m]=p,r[c]=y,e}function quad_default(e,t,s,i,r){this.node=e,this.x0=t,this.y0=s,this.x1=i,this.y1=r}function defaultX(e){return e[0]}function defaultY(e){return e[1]}function quadtree(e,t,s){var i=new Quadtree2(null==t?defaultX:t,null==s?defaultY:s,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function Quadtree2(e,t,s,i,r,o){this._x=e,this._y=t,this._x0=s,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function leaf_copy(e){for(var t={data:e.data},s=t;e=e.next;)s=s.next={data:e.data};return t}var Cs=quadtree.prototype=Quadtree2.prototype;Cs.copy=function(){var e,t,s=new Quadtree2(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return s;if(!i.length)return s._root=leaf_copy(i),s;for(e=[{source:i,target:s._root=new Array(4)}];i=e.pop();)for(var r=0;r<4;++r)(t=i.source[r])&&(t.length?e.push({source:t,target:i.target[r]=new Array(4)}):i.target[r]=leaf_copy(t));return s},Cs.add=function add_default(e){const t=+this._x.call(null,e),s=+this._y.call(null,e);return add2(this.cover(t,s),t,s,e)},Cs.addAll=function addAll(e){var t,s,i,r,o=e.length,a=new Array(o),l=new Array(o),d=1/0,h=1/0,u=-1/0,c=-1/0;for(s=0;s<o;++s)isNaN(i=+this._x.call(null,t=e[s]))||isNaN(r=+this._y.call(null,t))||(a[s]=i,l[s]=r,i<d&&(d=i),i>u&&(u=i),r<h&&(h=r),r>c&&(c=r));if(d>u||h>c)return this;for(this.cover(d,h).cover(u,c),s=0;s<o;++s)add2(this,a[s],l[s],e[s]);return this},Cs.cover=function cover_default(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var s=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(s))r=(s=Math.floor(e))+1,o=(i=Math.floor(t))+1;else{for(var a,l,d=r-s||1,h=this._root;s>e||e>=r||i>t||t>=o;)switch(l=(t<i)<<1|e<s,(a=new Array(4))[l]=h,h=a,d*=2,l){case 0:r=s+d,o=i+d;break;case 1:s=r-d,o=i+d;break;case 2:r=s+d,i=o-d;break;case 3:s=r-d,i=o-d}this._root&&this._root.length&&(this._root=h)}return this._x0=s,this._y0=i,this._x1=r,this._y1=o,this},Cs.data=function data_default(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},Cs.extent=function extent_default(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Cs.find=function find_default(e,t,s){var i,r,o,a,l,d,h,u=this._x0,c=this._y0,m=this._x1,p=this._y1,y=[],x=this._root;for(x&&y.push(new quad_default(x,u,c,m,p)),null==s?s=1/0:(u=e-s,c=t-s,m=e+s,p=t+s,s*=s);d=y.pop();)if(!(!(x=d.node)||(r=d.x0)>m||(o=d.y0)>p||(a=d.x1)<u||(l=d.y1)<c))if(x.length){var b=(r+a)/2,v=(o+l)/2;y.push(new quad_default(x[3],b,v,a,l),new quad_default(x[2],r,v,b,l),new quad_default(x[1],b,o,a,v),new quad_default(x[0],r,o,b,v)),(h=(t>=v)<<1|e>=b)&&(d=y[y.length-1],y[y.length-1]=y[y.length-1-h],y[y.length-1-h]=d)}else{var E=e-+this._x.call(null,x.data),k=t-+this._y.call(null,x.data),L=E*E+k*k;if(L<s){var D=Math.sqrt(s=L);u=e-D,c=t-D,m=e+D,p=t+D,i=x.data}}return i},Cs.remove=function remove_default(e){if(isNaN(o=+this._x.call(null,e))||isNaN(a=+this._y.call(null,e)))return this;var t,s,i,r,o,a,l,d,h,u,c,m,p=this._root,y=this._x0,x=this._y0,b=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((h=o>=(l=(y+b)/2))?y=l:b=l,(u=a>=(d=(x+v)/2))?x=d:v=d,t=p,!(p=p[c=u<<1|h]))return this;if(!p.length)break;(t[c+1&3]||t[c+2&3]||t[c+3&3])&&(s=t,m=c)}for(;p.data!==e;)if(i=p,!(p=p.next))return this;return(r=p.next)&&delete p.next,i?(r?i.next=r:delete i.next,this):t?(r?t[c]=r:delete t[c],(p=t[0]||t[1]||t[2]||t[3])&&p===(t[3]||t[2]||t[1]||t[0])&&!p.length&&(s?s[m]=p:this._root=p),this):(this._root=r,this)},Cs.removeAll=function removeAll(e){for(var t=0,s=e.length;t<s;++t)this.remove(e[t]);return this},Cs.root=function root_default(){return this._root},Cs.size=function size_default(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},Cs.visit=function visit_default(e){var t,s,i,r,o,a,l=[],d=this._root;for(d&&l.push(new quad_default(d,this._x0,this._y0,this._x1,this._y1));t=l.pop();)if(!e(d=t.node,i=t.x0,r=t.y0,o=t.x1,a=t.y1)&&d.length){var h=(i+o)/2,u=(r+a)/2;(s=d[3])&&l.push(new quad_default(s,h,u,o,a)),(s=d[2])&&l.push(new quad_default(s,i,u,h,a)),(s=d[1])&&l.push(new quad_default(s,h,r,o,u)),(s=d[0])&&l.push(new quad_default(s,i,r,h,u))}return this},Cs.visitAfter=function visitAfter_default(e){var t,s=[],i=[];for(this._root&&s.push(new quad_default(this._root,this._x0,this._y0,this._x1,this._y1));t=s.pop();){var r=t.node;if(r.length){var o,a=t.x0,l=t.y0,d=t.x1,h=t.y1,u=(a+d)/2,c=(l+h)/2;(o=r[0])&&s.push(new quad_default(o,a,l,u,c)),(o=r[1])&&s.push(new quad_default(o,u,l,d,c)),(o=r[2])&&s.push(new quad_default(o,a,c,u,h)),(o=r[3])&&s.push(new quad_default(o,u,c,d,h))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Cs.x=function x_default(e){return arguments.length?(this._x=e,this):this._x},Cs.y=function y_default(e){return arguments.length?(this._y=e,this):this._y};var Quad=function(e,t,s,i,r){this.node=e,this.x0=t,this.y0=s,this.x1=i,this.y1=r};function getAdjacencyList(e,t,s,i,r){const o=new Array(e.length);for(let e=0;e<t.length;e++){const a=i[t[e]],l=i[s[e]];o[a]=o[a]||[],o[a].push(l),r&&(o[l]=o[l]||[],o[l].push(a))}return o}function find(e,t){return-1===e[t]?t:find(e,e[t])}function union(e,t,s){const i=find(e,t),r=find(e,s);e[i]=r}function detectCyclesUndirected(e,t,s,i=!1){const r=new Int32Array(e.length),o={};for(let t=0;t<e.length;t++)r[t]=-1,o[e[t]]=t;for(let e=0;e<t.length;e++){const a=o[t[e]],l=o[s[e]];if(i&&a===l)return!0;const d=find(r,a),h=find(r,l);if(d===h)return!0;union(r,d,h)}return!1}function dfs(e,t,s,i,r,o,a,l){if(i[e]=r,s[e])return!0;if(t[e])return!1;t[e]=1,s[e]=1;const d=o[e];if(d)for(const r of d)if(dfs(r,t,s,i,e,o,a,l))return a.push(l[r]),!0;return s[e]=0,!1}function detectCyclesDirected(e,t,s){const i=e.length,r=new Uint8Array(i),o=new Uint8Array(i),a=new Int32Array(i),l={};for(let t=0;t<i;t++)l[e[t]]=t;const d=getAdjacencyList(e,t,s,l,!1);for(let t=0;t<i;t++){const s=[];if(dfs(t,r,o,a,-1,d,s,e)&&s.length>1){const e=s[0];for(let t=1;t<s.length;t++)if(s[t]===e){s.length=t;break}return s.push(e),s.reverse()}}return!1}function isCyclic(e,t,s,i,r,o,a){t[e]=1,i[e]=s;const l=r[e];if(l)for(const d of l)if(t[d]){if(d!==s)return i[d]=e,o.push(a[d]),!0}else if(isCyclic(d,t,e,i,r,o,a))return o.push(a[d]),!0;return!1}function detectCyclesUndirectedDFS(e,t,s){const i=e.length,r=new Uint8Array(i),o=new Int32Array(i),a={};for(let t=0;t<i;t++)a[e[t]]=t,o[t]=-1;const l=getAdjacencyList(e,t,s,a,!0);for(let e=0;e<t.length;e++){const i=a[t[e]],r=a[s[e]];l[i]=l[i]||[],l[i].push(r)}for(let t=0;t<i;t++){const s=t,i=[];if(!r[s]&&isCyclic(s,r,-1,o,l,i,e))return!0}return!1}quadtree.prototype.visit2=function(e){const t=[];let s,i,r,o,a,l,d,h=this._root;for(h&&t.push(new Quad(h,this._x0,this._y0,this._x1,this._y1));(s=t.pop())&&(d=e(h=s.node,r=s.x0,o=s.y0,a=s.x1,l=s.y1),"break"!==d);)if(!d&&h.length){const e=(r+a)/2,s=(o+l)/2;(i=h[3])&&t.push(new Quad(i,e,s,a,l)),(i=h[2])&&t.push(new Quad(i,r,s,e,l)),(i=h[1])&&t.push(new Quad(i,e,o,a,s)),(i=h[0])&&t.push(new Quad(i,r,o,e,s))}return this};var ks=class{constructor(e,t,s){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=e,this.visited=new Uint8Array(this.nodes.length);for(let t=0;t<e.length;t++)this.idToIndex[e[t]]=t;this.adjacency=getAdjacencyList(e,t,s,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let e=0;e<this.nodes.length;e++)for(this.backtrack(e,e);0!==this.visitedLength;){const e=this.visitedStack.pop();void 0!==e&&this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}return this.cycles}backtrack(e,t){let s=!1;this.stack.push(t),this.visited[t]||(this.visited[t]=1,this.visitedLength++),this.visitedStack.push(t);const i=this.adjacency[t]||[];for(const r of i)if(this.removed[t]=this.removed[t]||{},!this.removed[t][r])if(r<e)this.removed[t][r]=!0;else if(r===e){s=!0;const t=[];for(let s=0,i=!1;s<this.stack.length;s++){const r=this.stack[s];e===r&&(i=!0),i&&t.push(this.nodes[r])}this.cycles.push(t)}else if(!this.visited[r]){const t=this.backtrack(e,r);s=s||t}if(s){let e;do{e=this.visitedStack.pop(),this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}while(e!==t)}return this.stack.pop(),s}};function find2(e,t){let s=e.index[t];if(void 0===s)return-1;for(;s>=0;)t=s,s=e.parent[s];return t}function union2(e,t,s){e.parent[s]=t,e.count-=1}function kruskal_default(e,t,s,i,r){r&&t.sort(((e,t)=>r(e)-r(t)));const o=[],a={index:{},parent:[],count:0};e.forEach((e=>function add3(e,t){void 0===e.index[t]&&(e.count+=1,e.index[t]=e.parent.push(-e.count))}(a,e)));for(let e=0;e<t.length&&!(a.count<=1);e++){const r=find2(a,s(t[e])),l=find2(a,i(t[e]));r!==l&&r>0&&l>0&&(union2(a,r,l),o.push(t[e]))}return o}function betweennes({adjacency:e,directed:t=!1,normalized:s=!0}){const i=[],r=[],o={},a={},l={},d={};let h;const u=new Array(e.length),c={},m={},p={};for(let s=0;s<e.length;s++){const i=e[s];p[i.id]=i.adj,c[i.id]=!0,m[i.id]=s,t||i.adj.forEach((e=>{c[e]=!0}))}const y=Object.keys(c).map((e=>+e));for(let e=0;e<y.length;e++)u[e]=0;for(let e=0;e<y.length;e++)h=y[e],singleSourceShortestPath(h),accumulate();const x=s?y.length>2?1/((y.length-1)*(y.length-2)):0:t?0:.5;if(x)for(let e=0;e<u.length;e++)u[e]*=x;return u;function accumulate(){for(let e=0;e<y.length;e++)d[y[e]]=0;for(;r.length;){const e=r.pop(),t=(1+d[e])/l[e],s=o[e];for(let e=0;e<s.length;++e){const i=s[e];d[i]+=l[i]*t}e!==h&&(u[m[e]]+=d[e])}}function singleSourceShortestPath(e){for(let e=0;e<y.length;e++){const t=y[e];o[t]=[],a[t]=-1,l[t]=0}for(a[e]=0,l[e]=1,i.push(e);i.length;){const e=i.shift();r.push(e);p[e].forEach((t=>{-1===a[t]&&(a[t]=a[e]+1,i.push(t)),a[t]===a[e]+1&&(l[t]+=l[e],o[t].push(e))}))}}}var Ms=pe&&!!window.PointerEvent,Ls="pointerdown",Is="pointermove",Ns="pointerup",Ps="pointercancel",Fs={},zs=0,isMousePointer=e=>"mouse"===e.pointerType,isTouchPointer=e=>"mouse"!==e.pointerType;function down(e){Fs[e.pointerId]=e}function move2(e){Fs[e.pointerId]&&(Fs[e.pointerId]=e)}function up(e){delete Fs[e.pointerId]}function wrapAndHandle(e,t){e.touches=[];for(const t in Fs)e.touches.push(Fs[t]);e.changedTouches=[e],t(e)}function removePointerListener(e,t,s,i){return"touchstart"===s?e(t,Ls,i,!1):"touchmove"===s?e(t,Is,i,!1):"touchend"===s?(e(t,Ns,i,!1),e(t,Ps,i,!1)):void 0}var Ds=class{constructor(e){this._ogma=e}_setModules(e){this._modules=e}onMounted(){}onReady(e){}destroy(e){}},Rs=["graphics","legend","brand"],Os=class extends Ds{constructor(){super(...arguments),this._width=300,this._height=300,this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._refreshUntil=0,this._currentTime=getCurrentTime(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=ye,this._isDocumentReady=xe,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowResize=()=>this._resize(),this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=isFullScreen()}}onMounted(){this._modules.settings.register("minimumWidth",300,(()=>this._resize()),!1),this._modules.settings.register("minimumHeight",300,(()=>this._resize()),!1),this._modules.events.register(["beforeNewFrame","newFrame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],function initPointerEvents(){if(_e&&0===zs&&Ms){const e=document.documentElement;e.addEventListener(Ls,down,!0),e.addEventListener(Is,move2,!0),e.addEventListener(Ns,up,!0),e.addEventListener(Ps,up,!0)}zs++}(),this.addWindowEventListener("resize",this._onWindowResize).addWindowEventListener("focus",this._onWindowFocus)}onReady(e){var t,s;e.container&&this.setContainer(e.container),(null==(t=e.options)?void 0:t.width)||(null==(s=e.options)?void 0:s.height)?this._resize({width:e.options.width||300,height:e.options.height||300}):this._resize()}addWindowEventListener(e,t,s){return this._isRealBrowser&&this.addElementEventListener(window,e,t,s),this}addDirectWindowEventListener(e,t,s){this._isRealBrowser&&window.addEventListener(e,t,s)}removeDirectWindowEventListener(e,t){this._isRealBrowser&&window.removeEventListener(e,t)}addDocumentEventListener(e,t,s){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,e,t,s),t}removeDocumentEventListener(e,t){this._isDocumentReady&&document.documentElement.removeEventListener(e,t)}addMediaListener(e,t){if(this._isDocumentReady&&"function"==typeof window.matchMedia){const s=window.matchMedia(e);s.addListener(t),this._onDetachDom.push((()=>s.removeListener(t)))}}addElementEventListener(e,t,s,i){return this._isDestroyed||(e.addEventListener(t,s,i),this._onDetachDom.push((()=>e.removeEventListener(t,s,i)))),s}detachFromDom(){this._onDetachDom.forEach((e=>e())),this._onDetachDom=[],this._emptyContainer()}setTimeout(e,t=0){const s=setTimeout((()=>{this._timeouts.splice(this._timeouts.indexOf(s),1),e()}),t);return this._timeouts.push(s),s}clearTimeout(e){return e&&(clearTimeout(e),this._timeouts.splice(this._timeouts.indexOf(e),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(cancelAnimFrame(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(e){this._resize(e)}setLayer(e,t,{automaticResize:s=!1}={}){t&&(t._ogmaLayer=e,s&&(t.style.position="absolute",t.style.top="0px",t.style.left="0px",resizeElement(t,this._width,this._height,Re()))),this._layers[e]={element:t,automaticResize:s},this._updateContainerContent()}setContainer(e){let t;if("string"==typeof e){if(t=document.getElementById(e),!t)throw new Error(`unable to find DOM element with id "${e}"`)}else t=e;if(t===this._container)return;null===t&&this._emptyContainer();const s=this._container;this._isFullScreen=!1,this._container=t,this._container&&["fullscreenchange","webkitfullscreenchange"].forEach((e=>{this.addElementEventListener(this._container,e,this._onFullscreenChange)})),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:t,prevElement:s})}getContainer(){return this._container}appendElement(e){null!==this._container&&this._container.appendChild(e)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(e){const t=e?this._afterNextFramePromises:this._beforeNextFramePromises,s=new Promise((e=>{t.push((()=>(e(void 0),s)))}));return this._refresh(),s}beforeNextFrame(){return this._beforeOrAfterNextFrame(!1)}afterNextFrame(){return this._beforeOrAfterNextFrame(!0)}refresh(e){e&&(this._refreshUntil=Math.max(this._refreshUntil,e)),this._refresh()}_emptyContainer(){if(this._container){const e=[];for(let t=0;t<this._container.childNodes.length;++t){const s=this._container.childNodes[t];s._ogmaLayer&&e.push(s)}for(let t=0;t<e.length;++t)this._container.removeChild(e[t])}}_fillContainer(){if(this._container){const e=getStyle(this._container,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(this._container.style.position="relative");const t=this._container.firstChild;Rs.forEach((e=>{const s=this._layers[e];s&&s.element&&this._container&&this._container.insertBefore(s.element,t)}))}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_resize(e){if(!this._container&&!e)return;const t=this._width,s=this._height;let i,r;if(this._container){const t=this._modules.settings.get("minimumWidth"),s=this._modules.settings.get("minimumHeight"),o=this._container.clientWidth||1,a=this._container.clientHeight||1;i=Math.max(t,e?e.width:o),r=Math.max(s,e?e.height:a)}else null!=e&&(i=e.width,r=e.height);i===t&&r===s||(this._width=i,this._height=r,forEach(this._layers,(({element:e,automaticResize:t})=>{t&&resizeElement(e,i,r)})),this._modules.events.fire("resize",{prevWidth:t,prevHeight:s,width:i,height:r,difWidth:i-t,difHeight:r-s}))}_refresh(){this._inFrame?this._mustRefresh=!0:this._nextFrame||this._isDestroyed||(this._nextFrame=requestAnimFrame((()=>this._playFrame())))}_playFrame(){const e=getCurrentTime(),t=e-this._currentTime,s=flattenArray([this._beforeNextFramePromises,()=>this._modules.events.fire("beforeNewFrame",{elapsed:t}),()=>this._modules.events.fire("newFrame",{elapsed:t}),()=>this._modules.events.fire("afterNewFrame",{elapsed:t}),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||e<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=e,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],s.reduce(((e,t)=>e.then((()=>{if(!this._isDestroyed)return t()}))),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(value){let e=Promise.resolve();return value!==this._isFullScreen?(this._container&&(e=value?function requestFullScreen(e){return isFullScreen()?Promise.resolve():e.requestFullscreen?e.requestFullscreen():e.requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen?Promise.resolve(e.webkitRequestFullScreen()):e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():Promise.resolve()}(this._container):function cancelFullScreen(){return isFullScreen()?"undefined"==typeof document?Promise.resolve():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}()),e.then((()=>new Promise((e=>{this.setTimeout((()=>{this._isFullScreen=isFullScreen(),e(void 0)}),200)}))))):e}isFullScreen(){return isFullScreen()}debounceBeforeFrame(e){let t=!1,s=[];const trigger=()=>{const i=s;t=!1,s=[],e(),i.forEach((e=>e()))};return()=>new Promise((e=>{s.push(e),t||(t=!0,this.beforeNextFrame().then(trigger))}))}destroy(){!function clearPointerEvents(){if(zs--,_e&&0===zs){const e=document.documentElement;e.removeEventListener(Ls,down,!0),e.removeEventListener(Is,move2,!0),e.removeEventListener(Ns,up,!0),e.removeEventListener(Ps,up,!0)}}(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function isFullScreen(){return"undefined"!=typeof document&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}var Bs=class extends Ds{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",(({nodes:e,objects:t})=>this._onAddElements(e,t))).on("addEdges",(({edges:e,objects:t})=>this._onAddElements(e,t))).on("beforeNewFrame",(()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())}))}_onAddElements(e,t){const{isNode:s,size:i,_indexes:r}=e,o=this[s?"_nodeDataList":"_edgeDataList"];for(let e=0;e<i;++e)o.set(r[e],t[e].data)}setProperty(e,t,value,{dispatch:s=!1}={}){this._setDataProperty(e.isNode,e._indexes,t,value,s),this._modules.events.fire("setData",{elements:e})}getProperty(e,t){return this._getDataProperty(e.isNode,e._indexes,t)}_setDataProperty(e,t,s,value,i){i&&"function"==typeof value&&(i=!1);const r=toPropertyPath2(s),o="function"==typeof value,a=e?this._nodeList:this._edgeList,l=e?this._nodeDataList:this._edgeDataList,d=function findPropertyChange(e,t){for(let s=0;s<e.length;++s){const i=e[s],r=i.property;if(null===t&&null===r)return i;if(t&&r&&r.length===t.length){let e=!0;for(let s=0;s<r.length;++s)if(r[s]!==t[s]){e=!1;break}if(e)return i}}const s={property:t&&t.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,edges:null};return e.push(s),s}(e?this._nodeChanges:this._edgeChanges,r);for(let e=0;e<t.length;++e){const s=t[e];let h=l.get(s);const u=a.get(s),c=i?value[e]:value;let m,p;if(null===r)m=h,p=o?c(u):c,l.set(s,p);else{null==h&&(h={},l.set(s,h));const e=r.length;for(let t=0;t<e;t++){const s=r[t];let i=h[s];t<e-1?(null==i&&(i={},h[s]=i),h=i):(m=i,p=o?c(u):c,h[s]=p)}}d.indexes.push(s),d.previousValues.push(m),d.newValues.push(p)}this._scheduleEvents()}_getDataProperty(e,t,s,i){const r=toPropertyPath2(s);i||(i=new Array(t.length));const o=e?this._nodeDataList:this._edgeDataList;for(let e=0;e<t.length;++e){const s=t[e];let value,a=o.get(s);if(null!==r&&r.length)if(null==a)value=void 0;else{const e=r.length;for(let t=0;t<e&&a;++t)value=a=a[r[t]]}else value=a;i[e]=value}return i}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){const e=this._prepareEvtPayload(!0),t=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",e),this._modules.events.fire("updateEdgeData",t)}_prepareEvtPayload(e){const t=e?this._modules.graph.nodeList:this._modules.graph.edgeList,s=e?"_nodeChanges":"_edgeChanges";let i=[];const r=this[s];this[s]=[];const o=[];for(let s=0;s<r.length;++s){const{indexes:a,property:l,newValues:d,previousValues:h}=r[s];i=i.concat(a||[]),e?o.push({property:l,newValues:d,previousValues:h,nodes:t(a)}):o.push({property:l,newValues:d,previousValues:h,edges:t(a)})}return e?{nodes:t(i).dedupe(),isNode:e,changes:o}:{edges:t(i).dedupe(),isNode:e,changes:o}}};function toPropertyPath2(e){return"string"==typeof e?e.split("."):isArray(e)?e:null}var js=[];function getToJsonOptions(e){"object"==typeof e&&null!==e||(e={});const t="function"==typeof e.data?e.data:idenitity;return{attributes:Array.isArray(e.attributes)?e.attributes:e.attributes||js,data:t}}function deprecate(e,t){for(const s of e){const e=t;Object.keys(e).forEach((t=>{const i=e[t];s.prototype[t]=function(e,s){return $warn(`Deprecated method "${t}"; please use "${i}" instead.`),this[i](e,s)}}))}}function makeFilters(e){const t=e.getFlexArray("removed"),s=e.getFlexArray("excluded"),i=e.getFlexArray("virtual");return{all:e=>0===t.get(e),visible:e=>0===s.get(e),excluded:e=>1===s.get(e),raw:e=>0===i.get(e)&&0===t.get(e),_all:e=>!0}}function makeCacheListsForFilters(e,t,s){return{all:makeCacheList(s.all,e,t),visible:makeCacheList(s.visible,e,t),raw:makeCacheList(s.raw,e,t),_all:makeCacheList(s._all,e,t)}}function makeCacheList(e,t,s){let i=null;return{getList(){if(!i){const r=t(),o=s();o.reset();for(let t=1;t<=r;++t)e(t)&&o.push(t);i=o.sliceAndReset()}return i},invalidList(){i=null}}}function checkId(e){if(void 0===e)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if("string"!=typeof e&&("number"!=typeof e||!isFinite(e)))throw new Error(`${e} is not a valid id, expected string or number`);return e}function addElement(e,t,s={},i={}){return addToGraph(e,t,[s],i).get(0)}function addElements(e,t,s,i={}){if(i.batchSize){const r=[];for(let e=0;e<s.length;e+=i.batchSize)r.push(s.slice(e,e+i.batchSize));const reducer=(s,r)=>{let o;return s.then((t=>(o=t,e.getDom().afterNextFrame()))).then((()=>addToGraph(e,t,r,i))).then((e=>o.concat(e)))},o=t?e.nodeList():e.edgeList();return r.reduce(reducer,Promise.resolve(o))}return Promise.resolve(addToGraph(e,t,s,i))}function addToGraph(e,t,s,i){e.fireEvent("preAddElements",{name:"preAddElements",objects:s,isNode:t});const r=!!i.ignoreInvalid,o=e.storage.fetch(t),a=[],l=[],d=[],h=[],u=new Set,{virtual:c=!1}=i;for(const i of s){if("object"!=typeof i||null===i||Array.isArray(i)){if(r)continue;throw new Error(`${i} is not a valid ${t?"node":"edge"}`)}const s=checkId(i.id);if(!o.getIndex(s,!1)&&!u.has(s)){if(!t){const t=i,o=e.getExtremityIndex(s,t.source,0,r),a=e.getExtremityIndex(s,t.target,1,r);if(r&&(!o||!a))continue;d.push(o),h.push(a)}l.push(s),a.push(i),u.add(s)}}const m=o.addElements(l);t?e.topology.allocateNodes(m):e.topology.allocateEdges(m,d,h);const p=o.getFlexArray("object"),y=o.getFlexArray("excluded"),x=o.getFlexArray("removed"),b=o.getFlexArray("virtual"),v=t?e.node:e.edge,E=t?e.nodeList:e.edgeList,k=e.getCacheLists(t),L=E(m);for(let e=0;e<m.length;e++){const t=m[e];p.set(t,v(t))}return y.setMultiple(m,0),x.setMultiple(m,0),b.setMultiple(m,c?1:0),k.visible.invalidList(),k.all.invalidList(),k._all.invalidList(),c||k.raw.invalidList(),0!==L.size&&(t?e.fireEvent("addNodes",{virtual:c,objects:a,nodes:L}):e.fireEvent("addEdges",{virtual:c,objects:a,edges:L})),L}var Vs="_visible",Us="_data",Gs="_hovered",Ws="_hoverExtremityHighlighted",Hs="_selected",qs="_selectionExtremityHighlighted",Xs="_dragged",$s="_rewirable",Ys="_export",Zs="_faded",Qs="_transparent",Ks=-1,Js="in",ei="out",ti="both",si=[Hs,Xs,qs,Gs,Ws,$s,Ys,Zs,Qs,"_visual_groups"],ii=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],ni=void 0,ri=class{constructor(e){this._neighborTable=new ns,this._parallelTable=new ns,this._parallelEdgesIndex=[],this._fakeDeduper={get:()=>0,set:noop,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:noop,reset(){return this}},this._graph=e,this.nodeDeduper=e.createNodeAttribute({storage:1},!1),this.edgeDeduper=e.createEdgeAttribute({storage:1},!1),this._sourceList=e.getEdgeAttribute("source"),this._targetList=e.getEdgeAttribute("target")}getAdjacentDirections(e){return this._neighborTable.get(e)}getEdgeIndexesInDirection(e){return this._parallelTable.get(e)}allocateNodes(e){this._neighborTable.reserve(e.length);for(let t=0;t<e.length;++t)this._neighborTable.addEntry(e[t])}allocateEdges(e,t,s){this._parallelTable.reserve(Math.floor(e.length/2));for(let i=0;i<e.length;i++){const r=e[i],o=t[i],a=s[i];this._sourceList.set(r,o),this._targetList.set(r,a),this.addToAdjacencyList(r)}}getExtremity(e,t){const s=e?this._sourceList:this._targetList;if(t.isList){const e=this._graph.acquireIndexList(!0);for(let i=0;i<t._indexes.length;i++)e.push(s.get(t._indexes[i]));return this._graph.nodeList(e.sliceAndReset())}return this._graph.getObjectList(!0).get(s.get(t._index))}setExtremities(e,t,s){for(let t=0;t<e.length;++t)this.removeFromAdjacencyList(e[t]);null!==t&&this._sourceList.setMultiple(e,t),null!==s&&this._targetList.setMultiple(e,s);for(let t=0;t<e.length;++t)this.addToAdjacencyList(e[t])}addToAdjacencyList(e){const t=this._sourceList.get(e),s=this._targetList.get(e),i=getPairId(t,s);let r=this._parallelEdgesIndex[i];r===ni&&(r=this._parallelTable.addEntry(),this._parallelEdgesIndex[i]=r,this._neighborTable.addTo(t,r),t!==s&&this._neighborTable.addTo(s,r)),this._parallelTable.addTo(r,e)}removeFromAdjacencyList(e){const t=this._sourceList.get(e),s=this._targetList.get(e),i=getPairId(t,s),r=this._parallelEdgesIndex[i];r!==ni&&0===this._parallelTable.removeFromAndGetSize(r,e)&&(this._neighborTable.removeFrom(t,r),t!==s&&this._neighborTable.removeFrom(s,r),this._parallelEdgesIndex[i]=ni)}getParallelEdges(e,t={}){const s=t.filter||"visible",i=this._graph.acquireIndexList(!1),r=this._graph.getFilter(!1,s);for(let t=0;t<e._indexes.length;t++){const s=e._indexes[t],o=getPairId(this._sourceList.get(s),this._targetList.get(s)),a=this._parallelEdgesIndex[o];if(a!==ni){const e=this._parallelTable.get(+a);if(e)for(const t of e)r(t)&&i.push(t)}}return this._graph.edgeList(i.sliceAndReset())}fastGetNodesAdjacentElements(e){const t=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,r=this._targetList;for(let o=0;o<e.length;o++){const a=e[o],l=this._neighborTable.get(a);for(const e of l){const o=this._parallelTable.get(e),l=o[0],d=i.get(l),h=r.get(l);if(0!==d&&0!==h){t.push(d+h-a);for(const e of o)s.push(e)}}}return{nodes:this._graph.nodeList(t.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}fastGetEdgesAdjacentElements(e){const t=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,r=this._targetList;for(let o=0;o<e.length;o++){const a=e[o],l=i.get(a),d=r.get(a),h=getPairId(l,d),u=this._parallelEdgesIndex[h];if(u!==ni){const e=this._parallelTable.get(+u);if(e)for(const t of e)s.push(t)}t.push(l),t.push(d)}return{nodes:this._graph.nodeList(t.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}getDeduper(e){return(e?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(e,t,s,i=!1,r=!1){const o=t===Js,a=!(t===ei||o||r),l=this._graph.acquireIndexList(!1),d=this._graph.getFilter(!1,s),h=i?this.getDeduper(!1):this._fakeDeduper;let u=this._fakeInvertedDeduper;const c=this._sourceList,m=this._targetList;if(r){u=this.getDeduper(!0);for(let t=0;t<e.length;t++)u.set(e[t],1)}for(let t=0;t<e.length;t++){const s=e[t],i=this._neighborTable.get(s);for(const e of i){const t=this._parallelTable.get(e);if(a)for(const e of t)d(e)&&0===h.get(e)&&(l.push(e),h.set(e,1));else for(const e of t){const t=c.get(e),i=m.get(e),r=t+i-s;o!==(i===s)&&t!==i||!d(e)||0!==h.get(e)||1!==u.get(r)||(l.push(e),h.set(e,1))}}}return l.sliceAndReset()}collectAdjacentNodes(e,t,s,i=!1,r,o){const a=t!==Js,l=t!==ei,d=this._graph.acquireIndexList(!0),h=this._graph.getFilter(!1,s),u=i?this.getDeduper(!0):this._fakeDeduper,c=this._sourceList,m=this._targetList;if(r)for(let e=0;e<r.length;e++){const t=r[e];d.push(t),u.set(t,1)}if(o)for(let e=0;e<o.length;e++){const t=o[e];u.set(t,1)}for(let t=0;t<e.length;t++){const s=e[t],i=this._neighborTable.get(s);for(const e of i){const t=this._parallelTable.get(e);for(const e of t)if(h(e)){const t=c.get(e),i=m.get(e),r=t+i-s;if((l&&s===i||a&&s===t)&&0===u.get(r)){d.push(r),u.set(r,1);break}}}}return d.sliceAndReset()}getAdjacentElements(e,t,s={}){const i=s.direction||ti,r=s.filter||"visible",o=s.policy||"union",a=!!s.bothExtremities;if(e){const e="include-sources"===o?t:null,s="exclude-sources"===o?t:null;return this.collectAdjacentNodes(t,i,r,!0,e,s)}return this.collectAdjacentEdges(t,i,r,!0,a)}getEdgesBetweenTwoNodes(e,t){const s=getPairId(e,t),i=this._parallelEdgesIndex[s];if(i===ni)return new Uint32Array;const r=this._parallelTable.get(+i);return new Uint32Array(r)}getConnectedComponents(e,{filter:t="visible",returnIds:s=!1,internalIndexes:i=!1}={}){const r=this._graph,o=[],a={},l=r.acquireIndexList(!0);let d;"string"==typeof t?d=r.getFilter(!0,t):(d=t,t="visible");for(let t=0;t<e.length;t++){const s=e[t];d(s)&&l.push(s)}const h=l.sliceAndReset(),u={filter:t};for(let e=0;e<h.length;e++){const t=h[e];if(!a[t]){const e=[t],s=[];for(;0!==e.length;){const t=e.pop();!a[t]&&d(t)&&(e.push.apply(e,this.getAdjacentElements(!0,new Uint32Array([t]),u)),a[t]=!0,s.push(t))}s.length>0&&o.push(s)}}if(s){const e=r.getNodeAttribute("id");for(let t=0;t<o.length;t++)o[t]=e.getMultiple(o[t])}else if(!i)for(let e=0;e<o.length;e++)o[e]=r.nodeList(new Uint32Array(o[e]));return o}getAdjacencyList({directed:e,ids:t,weight:s,nodes:i}){const r=e?ei:ti,o=new Array(i.length),a=this._graph;for(let e=0;e<i.length;++e)o[e]=this.collectAdjacentEdges(new Uint32Array([i[e]]),r,"all");const l=a.getEdgeAttribute("source"),d=a.getEdgeAttribute("target"),h=a.getEdgeAttribute("width"),u=a.getNodeAttribute("id"),c=[],m="number"==typeof s,p=!("function"==typeof s)&&!m&&!!s;for(let r=0;r<o.length;r++){const y=o[r],x=i[r],b=y.length,v=t?new Array(b):new Uint32Array(b),E=new Array(b);for(let i=0;i<b;i++){const r=y[i],o=l.get(r),c=d.get(r);let b=e||x===o?c:o;if(t&&(b=u.get(b)),v[i]=b,s){if(m&&(E[i]=s),"function"==typeof s){const e=a.getNode(o),t=a.getNode(c);E[i]=s(e,t)}p&&(E[i]=h.get(r)||1)}}const k=__spreadValues({nodes:v,id:t?u.get(x):x},s&&{weights:E});c.push(k)}return c}degrees(e,t){if(t!==Js&&t!==ei)return this._neighborTable.sizes(e);const s=new Array(e.length),i=t===Js;for(let t=0,r=e.length;t<r;t++)s[t]=this._degree(e[t],i);return s}_degree(e,t){const s=this._neighborTable.get(e),i=this._sourceList,r=this._targetList;let o=0;for(let a=0;a<s.length;++a){const l=this._parallelTable.get(s[a]);for(let s=0;s<l.length;++s){const a=l[s],d=i.get(a),h=r.get(a);if(t&&h===e||!t&&d===e){o+=1;break}}}return o}getDegree(e,t){const{direction:s,filter:i}=this._getDegreeOptions(t),r=new Array(e.length),o=new Uint32Array(1);for(let t=0;t<e.length;++t)o[0]=e[t],r[t]=this.collectAdjacentNodes(o,s,i).length;return r}_getDegreeOptions(e){const t={direction:ti,filter:"visible"};return"string"==typeof e?t.direction=e:e&&("string"==typeof e.direction&&(t.direction=e.direction),"string"==typeof e.filter&&(t.filter=e.filter)),t}};function forEachElement(e,t,s){const i=e.getObjectList(t.isNode);for(let e=0;e<t._indexes.length;++e){const r=t._indexes[e];s(i.get(r),e)}}function mapElements(e,t,s){const i=new Array(t.size),r=e.getObjectList(t.isNode);for(let e=0;e<t._indexes.length;++e){const o=t._indexes[e],a=r.get(o);i[e]=s(a,e)}return i}function filterElements(e,t,s){s=s||trueFn;const i=t.isNode,r=e.acquireIndexList(i),o=e.getObjectList(i),a=e.getListFactory(i);for(let e=0;e<t._indexes.length;++e){const i=t._indexes[e],a=o.get(i);if(a){s(a,e)&&r.push(i)}}return a(r.sliceAndReset())}function splitElements(e,t,s,i){const r=e.getListFactory(t.isNode);if(!s)return{valid:t,invalid:r()};const o=e.acquireIndexList(t.isNode),a=e.acquireIndexList(t.isNode),l=e.getObjectList(t.isNode);for(let e=0;e<t._indexes.length;e++){const r=t._indexes[e],d=l.get(r);if(void 0===d)continue;(s(d,i)?o:a).pushUnchecked(r)}return{valid:r(o.sliceAndReset()),invalid:r(a.sliceAndReset())}}function reduceElements(e,t,s,i){const r=e.getObjectList(t.isNode);let o=i;for(let e=0;e<t._indexes.length;++e){const i=t._indexes[e];o=s(o,r.get(i),e)}return o}function dedupeElements(e,t){const s=t.isNode,i=e.topology.getDeduper(s),r=e.acquireIndexList(s),o=e.getListFactory(s);for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];0===i.get(s)&&(i.set(s,1),r.push(s))}return o(r.sliceAndReset())}function subtractElements(e,t,s){const i=t.isNode,r=s.topology.getDeduper(i),o=s.acquireIndexList(i),a=s.getListFactory(i);for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];r.set(s,1)}for(let t=0;t<e._indexes.length;t++){const s=e._indexes[t];0===r.get(s)&&o.push(s)}return a(o.sliceAndReset())}function inverseElements(e,t){const s=t.isNode,i=e.storage.fetch(s),r=i.getFlexArray("excluded"),o=i.getMaxIndex(),a=e.topology.getDeduper(s),l=e.acquireIndexList(s),d=e.getListFactory(s);for(let e=0;e<t._indexes.length;e++)a.set(t._indexes[e],1);for(let e=1;e<=o;++e)0===a.get(e)&&0===r.get(e)&&l.push(e);return d(l.sliceAndReset())}function concatElements(e,t,s){const i=e.getListFactory(t.isNode),r=new Uint32Array(t._indexes.length+s._indexes.length);return r.set(t._indexes),r.set(s._indexes,t._indexes.length),i(r)}function elementsToArray(e,t){return e.getObjectList(t.isNode).getMultiple(t._indexes)}function getElementsId(e,t){const s=e.getStorage(t.isNode);if(t.isList){const e=new Array(t.size);for(let i=0;i<t._indexes.length;++i)e[i]=s.getId(t._indexes[i]);return e}return s.getId(t._index)}function getEdgesSource(e,t){return e.topology.getExtremity(!0,t)}function getEdgesTarget(e,t){return e.topology.getExtremity(!1,t)}function getElementAt(e,t,s){return e.getObjectList(t.isNode).get(t._indexes[s])}function sortElements(e,t,s){const i=e.getListFactory(t.isNode),r=e.getObjectList(t.isNode),o=t._indexes.slice();return o.sort(((e,t)=>{const i=r.get(e),o=r.get(t);return s(i,o)})),i(o)}var oi=new Uint32Array(1),ai=class{constructor(e,t){this.size=1,this.isNode=!1,this.isList=!1,this._index=e,this._ogma=t}get _indexes(){return oi[0]=this._index,oi}setAttributes(e,t){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,e,t)}setAttribute(e,value,t){return this._ogma.modules.individualAttributes.setSingleAttribute(this,e,value,t)}getAttributes(e){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,e)[0]}getAttribute(e){return this._ogma.modules.individualAttributes.getSingleAttribute(this,e)[0]}resetAttributes(e,t){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,e,t)}replaceOriginalAttributes(e,t){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,e,t)}getPreviousAttributes(e){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,e)[0]}isInView(e){return this._ogma.modules.locate.isElementInView(this,e)}getParallelEdges(e){return this._ogma.modules.graph.getParallelEdges(this,e)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:e,edges:t}=this.fastGetAdjacentElements();return{nodes:e.dedupe(),edges:t.filter((e=>e!==this)).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(value){return this._ogma.modules.graph.setExcluded(this,value)}setVisible(value){return this.setExcluded(!value)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return getElementsId(this._ogma.modules.graph,this)}getSource(){return getEdgesSource(this._ogma.modules.graph,this)}getTarget(){return getEdgesTarget(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(e){this._ogma.modules.graph.setSource(this,e)}setTarget(e){this._ogma.modules.graph.setTarget(this,e)}slice(){return this.toList()}toJSON(e={}){const{attributes:t,data:s}=getToJsonOptions(e);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(t),data:s(deepCopy(this.getData()))}}get(e){return 0===e?this:void 0}setSelected(e){this._ogma.modules.selection.setActive(this,e)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(e){return this._ogma.modules.locate.locateElements(this,e)}getBoundingBox({includeTexts:e=!1,ignoreCurvature:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,e,e,t)}setData(e,value){return arguments.length<2&&(value=e,e=null),this._ogma.modules.data.setProperty(this,e,value),this}getData(e){return this._ogma.modules.data.getProperty(this,e||null)[0]}addClass(e,t){return this._ogma.modules.classes.addClassesToElements([e],this,t)}addClasses(e,t){return this._ogma.modules.classes.addClassesToElements(e,this,t)}removeClass(e,t){return this._ogma.modules.classes.removeClassesFromElements([e],this,t)}removeClasses(e,t){return this._ogma.modules.classes.removeClassesFromElements(e,this,t)}hasClass(e){return this._ogma.modules.classes.hasSingleElementClass(e,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.grouping.getMetaElement(this)[0]}getSubEdges(){return this._ogma.modules.grouping.getSubElements(this)[0]}pulse(e){return this._ogma.modules.pulses.pulse(this,e)}};deprecate([ai],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var li=class{constructor(e,t){this.isList=!0,this.isNode=!1,this._indexes=e,this._ogma=t}get size(){return this._indexes.length}setAttributes(e,t){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,e,t)}setAttribute(e,value,t){return this._ogma.modules.individualAttributes.setSingleAttribute(this,e,value,t)}getAttributes(e){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,e)}getAttribute(e){return this._ogma.modules.individualAttributes.getSingleAttribute(this,e)}resetAttributes(e,t){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,e,t)}replaceOriginalAttributes(e,t){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,e,t)}getPreviousAttributes(e){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,e)}getPreviousAttribute(e){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,e)}getParallelEdges(e){return this._ogma.modules.graph.getParallelEdges(this,e)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:e,edges:t}=this.fastGetAdjacentElements();return{nodes:e.dedupe(),edges:t.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map((value=>!value))}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}setExcluded(value){return this._ogma.modules.graph.setExcluded(this,value)}setVisible(value){return this.setExcluded(!value)}toList(){return this}toArray(){return elementsToArray(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return getElementsId(this._ogma.modules.graph,this)}getSource(){return getEdgesSource(this._ogma.modules.graph,this)}getTarget(){return getEdgesTarget(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(e){return getElementAt(this._ogma.modules.graph,this,e)}forEach(e){forEachElement(this._ogma.modules.graph,this,e)}map(e){return mapElements(this._ogma.modules.graph,this,e)}filter(e){return filterElements(this._ogma.modules.graph,this,e)}reduce(e,t){return reduceElements(this._ogma.modules.graph,this,e,t)}concat(e){return concatElements(this._ogma.modules.graph,this,e)}dedupe(){return dedupeElements(this._ogma.modules.graph,this)}subtract(e){return subtractElements(this,e,this._ogma.modules.graph)}slice(e,t){return this._ogma.modules.graph.edgeList(this._indexes.slice(e,t))}indexOf(e){return e instanceof ai?this._indexes.indexOf(e._index):-1}includes(e){return-1!==this.indexOf(e)}sort(e){return sortElements(this._ogma.modules.graph,this,e)}inverse(){return inverseElements(this._ogma.modules.graph,this)}toJSON(e={}){return this.map((t=>t.toJSON(e)))}setSelected(e){this._ogma.modules.selection.setActive(this,e)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(e){return this._ogma.modules.locate.locateElements(this,e)}getBoundingBox({includeTexts:e=!1,ignoreCurvature:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,e,e,t)}setData(e,t){if(arguments.length<2&&(t=e,e=null),"function"!=typeof t&&!isArray(t))throw new Error(`invalid argument ${t}; expected array or function`);return this._ogma.modules.data.setProperty(this,e,t,{dispatch:!0}),this}fillData(e,value){return arguments.length<2&&(value=e,e=null),this._ogma.modules.data.setProperty(this,e,value,{dispatch:!1}),this}getData(e){return this._ogma.modules.data.getProperty(this,e||null)}addClass(e,t){return this._ogma.modules.classes.addClassesToElements([e],this,t)}addClasses(e,t){return this._ogma.modules.classes.addClassesToElements(e,this,t)}removeClass(e,t){return this._ogma.modules.classes.removeClassesFromElements([e],this,t)}removeClasses(e,t){return this._ogma.modules.classes.removeClassesFromElements(e,this,t)}hasClass(e){return this.map((t=>this._ogma.modules.classes.hasSingleElementClass(e,t)))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.grouping.getMetaElement(this)}getSubEdges(){return this._ogma.modules.grouping.getSubElements(this)}pulse(e){return this._ogma.modules.pulses.pulse(this,e)}};deprecate([li],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var di="geo.latitude",hi="geo.longitude",ui="geo.prevLat",ci="geo.prevLng",gi=85.0511287798,mi={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},_i={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1};function setTileLayerOpacity(e,t){e&&void 0!==t&&isFinite(t)&&e.setOpacity&&e.setOpacity(t)}function canGeoBeEnabled(){return pe||"undefined"!=typeof global&&!global.process}function ogmaToMapZoom(e){return Math.log2(e)+1}function isValidGeoCoordValue(e){return null!=e&&!isNaN(e)}function checkLng(e,t){return checkGeoCoord(e,t,"longitude")}function checkLat(e,t){return checkGeoCoord(e,t,"latitude")}function checkGeoCoord(e,t,s){if(isNaN(t))throw new TypeError(`node ${e}: ${t} is not a valid ${s}`)}function normalizeTilesOptions(e,t={}){if(void 0===t.tiles||t.tileUrlTemplate||t.tileUrlSubdomains){const e=mi.tiles;return __spreadValues(__spreadValues(__spreadValues({},t.tiles||{}),mi.tiles),{url:t.tileUrlTemplate||e.url,subdomains:t.tileUrlSubdomains||e.subdomains})}return isObject(t.tiles)?__spreadValues(__spreadValues({},e.tiles),t.tiles):t.tiles}var pi=getDocument().createElement("div");function copyNodeAttributes(e,t,s,i){!function copyAttributes(e,t,s,i,r){const o=e.getAttribute(t,i),a=e.getAttribute(t,r),l=s._indexes;a.setMultiple(l,o.getMultiple(l))}(e,!0,t,s,i)}function getEdgesVisibleSizes(e,t){return e.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach((({text:s,minVisibleSize:i,width:r},o)=>{t[e.get(o).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:i,size:Math.max(1,Number(r))}})),t}function adjustMinVisibleSize(e,t,s){if(!t||!Object.keys(t).length)return Promise.resolve();const i=e.getId().filter((e=>t[e])).map((e=>{if(!t[e])return 0;const i=Number(t[e]["text.minVisibleSize"]),r=Number(t[e].minVisibleSize),o=Number(t[e]["text.size"]),a=Number(t[e]["text.scale"]),l=Number(t[e].size)*a*s;return l<=r||l<=i?0:o}));return e.setAttribute("text.size",i)}function restoreVisibleSizes(e,t){const s=e.getId().map((e=>{const s=t[e]||{};return Number(s["text.size"])}));return e.setAttribute("text.size",s)}var fi=new Uint32Array(1),yi=class{constructor(e,t){this.size=1,this.isNode=!0,this.isList=!1,this._index=e,this._ogma=t}get _indexes(){return fi[0]=this._index,fi}setAttributes(e,t){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,e,t)}setAttribute(e,value,t){return this._ogma.modules.individualAttributes.setSingleAttribute(this,e,value,t)}resetAttributes(e,t){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,e,t)}getAttributes(e){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,e)[0]}getAttribute(e){return this._ogma.modules.individualAttributes.getSingleAttribute(this,e)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){const e=this.getPositionOnScreen(),t=this._ogma.modules.camera;return e.x>=0&&e.x<=t.width&&e.y>=0&&e.y<=t.height}replaceOriginalAttributes(e,t){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,e,t)}getPreviousAttributes(e){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,e)[0]}getPreviousAttribute(e){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,e)}isInView(e){return this._ogma.modules.locate.isElementInView(this,e)}getAdjacentNodes(e){return this._ogma.modules.graph.getAdjacentNodes(this,e)}getAdjacentEdges(e){return this._ogma.modules.graph.getAdjacentEdges(this,e)}getAdjacentElements(e){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,e).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,e).dedupe()}}getDegree(e){return this._ogma.modules.graph.getDegree(this,e)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(e){return this._ogma.modules.graph.getConnectedComponentByNode(this,e)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(value){return this._ogma.modules.graph.setExcluded(this,value)}setVisible(value){return this.setExcluded(!value)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return getElementsId(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(e={}){const{attributes:t,data:s}=getToJsonOptions(e),i=this.getAttributes(t);return{id:this.getId(),attributes:i,data:s(deepCopy(this.getData()))}}get(e){return 0===e?this:void 0}setSelected(e){this._ogma.modules.selection.setActive(this,e)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(e){return this._ogma.modules.locate.locateElements(this,e)}getBoundingBox({includeTexts:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,e,e)}setData(e,value){return arguments.length<2&&(value=e,e=null),this._ogma.modules.data.setProperty(this,e,value),this}getData(e){return this._ogma.modules.data.getProperty(this,e||null)[0]}addClass(e,t){return this._ogma.modules.classes.addClassesToElements([e],this,t)}addClasses(e,t){return this._ogma.modules.classes.addClassesToElements(e,this,t)}removeClass(e,t){return this._ogma.modules.classes.removeClassesFromElements([e],this,t)}removeClasses(e,t){return this._ogma.modules.classes.removeClassesFromElements(e,this,t)}hasClass(e){return this._ogma.modules.classes.hasSingleElementClass(e,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){const e=this._ogma.modules.graph,t=e.getNodeAttribute(di).get(this._index),s=e.getNodeAttribute(hi).get(this._index);return{latitude:isValidGeoCoordValue(t)?t:void 0,longitude:isValidGeoCoordValue(s)?s:void 0}}setGeoCoordinates(e){return this.toList().setGeoCoordinates([e]).then((()=>this))}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.grouping.getMetaElement(this)[0]}getSubNodes(){return this._ogma.modules.grouping.getSubElements(this)[0]}pulse(e){return this._ogma.modules.pulses.pulse(this,e)}};deprecate([yi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var xi=class{constructor(e,t){this.isList=!0,this.isNode=!0,this._indexes=e,this._ogma=t}get size(){return this._indexes.length}setAttributes(e,t){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,e,t)}setAttribute(e,t,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,e,t,s)}getAttributes(e){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,e)}getAttribute(e){return this._ogma.modules.individualAttributes.getSingleAttribute(this,e)}resetAttributes(e,t){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,e,t)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map((e=>this._ogma.modules.camera.graphToScreenCoordinates(e)))}replaceOriginalAttributes(e,t){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,e,t)}getPreviousAttributes(e){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,e)}getPreviousAttribute(e){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,e)}getAdjacentNodes(e){return this._ogma.modules.graph.getAdjacentNodes(this,e)}getAdjacentEdges(e){return this._ogma.modules.graph.getAdjacentEdges(this,e)}getAdjacentElements(e){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,e).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,e).dedupe()}}getDegree(e){return this._ogma.modules.graph.getDegree(this,e)}getConnectedComponents(e){return this._ogma.modules.graph.getConnectedComponents(this,e)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map((value=>!value))}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}setExcluded(value){return this._ogma.modules.graph.setExcluded(this,value)}setVisible(value){return this.setExcluded(!value)}toList(){return this}toArray(){return elementsToArray(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return getElementsId(this._ogma.modules.graph,this)}get(e){return getElementAt(this._ogma.modules.graph,this,e)}forEach(e){forEachElement(this._ogma.modules.graph,this,e)}map(e){return mapElements(this._ogma.modules.graph,this,e)}filter(e){return filterElements(this._ogma.modules.graph,this,e)}reduce(e,t){return reduceElements(this._ogma.modules.graph,this,e,t)}concat(e){return concatElements(this._ogma.modules.graph,this,e)}dedupe(){return dedupeElements(this._ogma.modules.graph,this)}subtract(e){return subtractElements(this,e,this._ogma.modules.graph)}slice(e,t){return this._ogma.modules.graph.nodeList(this._indexes.slice(e,t))}indexOf(e){return e instanceof yi?this._indexes.indexOf(e._index):-1}includes(e){return-1!==this.indexOf(e)}inverse(){return inverseElements(this._ogma.modules.graph,this)}sort(e){return sortElements(this._ogma.modules.graph,this,e)}toJSON(e={}){return this.map((t=>t.toJSON(e)))}setSelected(e){this._ogma.modules.selection.setActive(this,e)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(e){return this._ogma.modules.locate.locateElements(this,e)}getBoundingBox({includeTexts:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,e,e)}setData(e,t){if(arguments.length<2&&(t=e,e=null),"function"!=typeof t&&!isArray(t))throw new Error(`invalid argument ${t}; expected array or function`);return this._ogma.modules.data.setProperty(this,e,t,{dispatch:!0}),this}fillData(e,value){return arguments.length<2&&(value=e,e=null),this._ogma.modules.data.setProperty(this,e,value,{dispatch:!1}),this}getData(e){return this._ogma.modules.data.getProperty(this,e||null)}addClass(e,t){return this._ogma.modules.classes.addClassesToElements([e],this,t)}addClasses(e,t){return this._ogma.modules.classes.addClassesToElements(e,this,t)}removeClass(e,t){return this._ogma.modules.classes.removeClassesFromElements([e],this,t)}removeClasses(e,t){return this._ogma.modules.classes.removeClassesFromElements(e,this,t)}hasClass(e){return this.map((t=>this._ogma.modules.classes.hasSingleElementClass(e,t)))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){const e=this._ogma.modules.graph,t=new Array(this._indexes.length),s=e.getNodeAttribute(di).getMultiple(this._indexes),i=e.getNodeAttribute(hi).getMultiple(this._indexes);for(let e=0,r=this._indexes.length;e<r;e++)t[e]={latitude:s[e],longitude:i[e]};return t}setGeoCoordinates(e){const t=this._ogma.modules.geo,s=this.getId(),i=this._indexes,r=new Array(i.length),o=new Array(i.length);if(null===e&&(e=new Array(i.length).fill(null)),e.length!==i.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let t=0,a=i.length;t<a;t++){let{latitude:i,longitude:a}=e[t]||{latitude:void 0,longitude:void 0};const l=s[t];null==i&&null==a?i=a=void 0:(checkLat(l,i),checkLng(l,a)),r[t]=i,o[t]=a}this.setData(t.latitudePath,r),this.setData(t.longitudePath,o);const{dom:a,graph:l}=this._ogma.modules;return function setNodesInternalCoordinates(e,t,s,i){const r=t._indexes;e.getNodeAttribute(di).setMultiple(r,s),e.getNodeAttribute(hi).setMultiple(r,i)}(l,this,r,o),this._ogma.modules.geo.isEnabled()?a.afterNextFrame().then((()=>a.afterNextFrame())).then((()=>this)):a.afterNextFrame().then((()=>this))}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.grouping.getMetaElement(this)}getSubNodes(){return this._ogma.modules.grouping.getSubElements(this)}pulse(e){return this._ogma.modules.pulses.pulse(this,e)}};function removeElements(e,t,s,i={},r=!1){Array.isArray(s)||s instanceof(t?xi:li)||(s=[s]);const{virtual:o=!1}=i,a={elementsToRemove:e.getElements(t,s),virtual:o};e.fireEvent("requestElementsToDelete",a);let{elementsToRemove:l}=o?{elementsToRemove:s}:a;if(!l.size)return Promise.resolve();l=l.dedupe();const d=e.storage.fetch(t),h=d.getFlexArray("removed");if(l=l.filter((e=>0===h.get(e._index))),t){const t=l.getAdjacentEdges({filter:"all"}),s=t.filter((e=>e.isVirtual()));removeElements(e,!1,t,i,!0),removeElements(e,!1,s,{virtual:!0},!0)}const u=l._indexes,c=e.getCacheLists(t);if(computeSum(d.getFlexArray("virtual").getMultiple(u))!==(o?u.length:0))throw new Error("Attempting to remove virtual elements; you should not do that");const m={virtual:o,[t?"nodes":"edges"]:l};if(e.fireEvent(t?"beforeRemoveNodes":"beforeRemoveEdges",m),c.visible.invalidList(),c.all.invalidList(),o||c.raw.invalidList(),e.setExcluded(l,!0),h.setMultiple(u,1),!t)for(let t=0;t<u.length;++t)e.topology.removeFromAdjacencyList(u[t]);return d.removeElements(u),e.fireEvent(t?"removeNodes":"removeEdges",m),Promise.resolve()}deprecate([xi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var bi=class extends Ds{constructor(){super(...arguments),this.storage={nodes:new It(!0),edges:new It(!1),fetch(e){return e?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","removeEdges"]);[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach((e=>{this.createNodeAttribute(e,!0),this.createEdgeAttribute(e,!0)})),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=makeFilters(this.storage.nodes),this._edgeFilters=makeFilters(this.storage.edges),this._initialize(),this._modules.events.on("newFrame",this._onNewFrame)}onReady(e){if(e.graph){const{nodes:t,edges:s}=e.graph;t&&this.addNodes(t),s&&this.addEdges(s)}}createIndexList(e){return this.storage.fetch(e).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(e){const t=e?this._nodeIndexLists:this._edgeIndexLists;let s=t.find((e=>!e.isBusy()));return s||(s=this.createIndexList(e),t.push(s)),s.markBusy(),s}getObjectList(e){return e?this._nodes:this._edges}getListFactory(e){return e?this.nodeList:this.edgeList}getStorage(e){return e?this.storage.nodes:this.storage.edges}getFilter(e,t){const s=e?this._nodeFilters:this._edgeFilters;return s[t]||s.visible}fireEvent(e,t){this._modules.events.fire(e,t)}getCacheLists(e){return e?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){const e=this._promisesToResolve;this._promisesToResolve=[],e.forEach((e=>e()))}_initialize(){this._nodeCacheLists=makeCacheListsForFilters((()=>this.getNodeMaxIndex()),(()=>this.acquireIndexList(!0)),this._nodeFilters),this._edgeCacheLists=makeCacheListsForFilters((()=>this.getEdgeMaxIndex()),(()=>this.acquireIndexList(!1)),this._edgeFilters),this.topology=new ri(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(e){return this.storage.fetch(e.isNode).getFlexArray("excluded").getMultiple(e._indexes)}setExcluded(e,value){const t=value?1:0,s=e.isNode,i=this.storage.fetch(s),r=i.getFlexArray("excluded"),o=i.getFlexArray("removed"),a=this.acquireIndexList(s),l=this.getListFactory(s);for(let s=0;s<e._indexes.length;s++){const i=e._indexes[s],l=r.get(i),d=o.get(i);t!==l&&0===d&&a.push(i)}const d=a.sliceAndReset();if(d.length){this.getCacheLists(e.isNode).visible.invalidList();const s=l(d);r.setMultiple(d,t),this._modules.events.fire("excludedStateChange",{elements:s,value})}}addNode(e,t){return addElement(this,!0,e,t)}addEdge(e,t){return addElement(this,!1,e,t)}addNodes(e,t){return addElements(this,!0,e,t)}addEdges(e,t){return addElements(this,!1,e,t)}getExtremityIndex(e,t,s,i){if(t instanceof yi)return t._index;{const r=this.storage.nodes.getIndex(t);if(!r&&!i)throw new Error(`addEdge(s): invalid ${0===s?"source":"target"} for edge "${e}"; node "${t}" does not exist`);return r}}getNodes(e){return this.getElements(!0,e)}getEdges(e){return this.getElements(!1,e)}getElements(e,t){const s=e?this.nodeList:this.edgeList,i=e?xi:li,r=e?yi:ai;if(t&&"string"!=typeof t){const o=this.acquireIndexList(e),a=this.storage.fetch(e);if(t instanceof r)o.push(t._index);else if(isArray(t)){const e=t;for(const t of e)if(t instanceof r)o.push(t._index);else{const e=a.getIndex(t);e&&o.push(e)}}else if(t instanceof i){const s=this.getFilter(e,"all"),i=t;for(let e=0;e<i._indexes.length;e++){const t=i._indexes[e];s(t)&&o.push(t)}}return s(o.sliceAndReset())}{const i=t||"visible",r=this.getCacheLists(e)[i];if(!r)throw new Error(`getNodes/getEdges: unexpected argument "${i}"`);return s(r.getList())}}getNode(e){return this._getElement(!0,e)}getEdge(e){return this._getElement(!1,e)}_getElement(e,t){if(t instanceof(e?yi:ai))return t;const s=this.getStorage(e),i=this.getObjectList(e),r=s.getIndex(t);return r?i.get(r):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(e,t,s=!1){return this.storage.fetch(e).createFlexArray(t,s)}createNodeAttribute(e,t){return this.createAttribute(!0,e,t)}createEdgeAttribute(e,t){return this.createAttribute(!1,e,t)}getAttribute(e,t){return this.storage.fetch(e).getFlexArray(t)}getAttributes(e,t){return t.map((t=>this.getAttribute(e,t)))}getNodeAttribute(e){return this.storage.nodes.getFlexArray(e)}getNodeAttributes(e){return this.getAttributes(!0,e)}getEdgeAttribute(e){return this.storage.edges.getFlexArray(e)}getEdgeAttributes(e){return this.getAttributes(!1,e)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(e,t){const s=this.getNode(t);s&&this.topology.setExtremities(e._indexes,s._indexes,null)}setTarget(e,t){const s=this.getNode(t);s&&this.topology.setExtremities(e._indexes,null,s._indexes)}getParallelEdges(e,t={}){return this.topology.getParallelEdges(e,t)}getEdgesBetweenTwoNodes(e,t){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(e._index,t._index))}getAdjacentDirections(e){return this.topology.getAdjacentDirections(e)}getEdgeIndexesInDirection(e){return this.topology.getEdgeIndexesInDirection(e)}fastGetNodesAdjacentElements(e){return this.topology.fastGetNodesAdjacentElements(e._indexes)}fastGetEdgesAdjacentElements(e){return this.topology.fastGetEdgesAdjacentElements(e._indexes)}getAdjacentNodes(e,t){return this.nodeList(this.topology.getAdjacentElements(!0,e._indexes,t))}getAdjacentEdges(e,t){return this.edgeList(this.topology.getAdjacentElements(!1,e._indexes,t))}getDegree(e,t){return this.topology.getDegree(e._indexes,t)}degrees(e,t){return this.topology.degrees(e,t)}getAdjacencyList({directed:e=!1,internalIndexes:t=!1,weight:s=1,nodes:i,indexes:r}={}){return this.topology.getAdjacencyList({directed:e,weight:s,ids:!t,nodes:r||this.getNodes(i)._indexes})}getConnectedComponents(e,t){return this.topology.getConnectedComponents(e._indexes,t)}getConnectedComponentByNode(e,t){return this.topology.getConnectedComponents(e._indexes,t)}},vi=xe&&document.fonts,Ai="/qwerty/ [HELLO] ",Si="serif",Ei=class{constructor(){this._fontFaceSet=vi?document.fonts:null,this._canvas=createCanvas(),this._ctx=this._canvas.getContext("2d")}_measureText(e,t){return this._ctx.font=`12px ${t}`,this._ctx.measureText(e).width}check(e){if(e===Si)return!0;const t=this._measureText(Ai,Si);return this._measureText(Ai,e)!==t}load(e){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${e}`):(this._ctx.font=`12px ${e}`,this._ctx.fillText(Ai,10,50),Promise.resolve())}},wi=class{constructor(e,t){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=e,this._fontName=t,this._loaded=!1,this._value=null,this._timeout=0,xe&&!this._fontFaceSet.check(this._fontName)||this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad(200).then((()=>{this._setLoaded()}))}_tryLoad(e){return this._fontFaceSet.load(this._fontName).then((()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<16)return new Promise((t=>{e<6e4&&(this._timeout=setTimeout(t,e))})).then((()=>(this._fontLoaderCounter++,this._tryLoad(1.5*e))))}))}},Ti=class{constructor(){this._fontFaceSet=new Ei,this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(value){this._hideUntilFontsLoaded=value}getFont(e){let t=this._fonts[e];return t||(t=new wi(this._fontFaceSet,e),this._fonts[e]=t,t.isLoaded()||t.load().then((()=>this._triggerFontLoaded(e)))),!this._hideUntilFontsLoaded&&e||t.getValue()}onFontLoaded(e){this._onFontLoaded.push(e)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach((e=>this._fonts[e].destroy()))}_triggerFontLoaded(e){this._onFontLoaded.forEach((t=>t(e)))}},Ci=30,ki=0,Mi=3,Li=6,Ii=1e-6,Ni=Math.PI,Pi=2*Math.PI,Fi=Ni*(5/4),zi=Ni*(7/4),Di=Ni*(3/4),Ri=Ni*(1/4),Oi=1.1,Bi=.07,ji=1,Vi=1,Ui=.17,Gi=1,Wi=-Ni/2,Hi=Ni/2,qi={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},Xi={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},$i={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0};function setEdgeBody(e,t,s,i){prepareEdgePiece(e,t,s,i),e.thicknessOrFontSizeScaled=t.widthScaled,e.thicknessOrFontSizeFixed=t.widthFixed,e.strokeWidthScaled=t.stroke.widthScaled,e.strokeWidthFixed=t.stroke.widthFixed,e.offsetScaled=0,e.offsetFixed=0,e.fillColor=t.color,e.strokeColor=t.stroke.color,e.globalMinVisibleSize=t.minVisibleSize,e.strokeMinVisibleSize=t.stroke.minVisibleSize,e.offsetAngle=0,e.symbolicSize=t.widthScaled,e.dashLength=t.shape.dashLength,e.gapLength=t.shape.gapLength,e.hasHead=!!t.shape.head,e.hasTail=!!t.shape.tail,e.isBodyTriangle=t.shape.isBodyTriangle}function prepareEdgePiece(e,t,s,i){e.pieceId=s,e.shape=i,e.x1=t.sourceX,e.y1=t.sourceY,e.x2=t.targetX,e.y2=t.targetY,e.rectWidthOrSourceRadiusScaled=t.sourceRadiusScaled,e.rectWidthOrSourceRadiusFixed=t.sourceRadiusFixed,e.rectHeightOrTargetRadiusScaled=t.targetRadiusScaled,e.rectHeightOrTargetRadiusFixed=t.targetRadiusFixed,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=0,e.offsetFixed=0,e.pattern.type=0,e.opacity=t.opacity,e.fillColor=null,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=t.minVisibleSize,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=0,e.patternScale=0,e.symbolicSize=t.widthScaled,e.curvature=t.curvature,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=t.isSelfLoop,e.isText=!1}function setEdgeHalo(e,t,s){const i=t.widthScaled+2*t.halo.widthScaled,r=t.widthFixed+2*t.halo.widthFixed;prepareEdgePiece(e,t,s,"line"),e.thicknessOrFontSizeScaled=i,e.thicknessOrFontSizeFixed=r,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=0,e.offsetFixed=0,e.fillColor=t.halo.color,e.strokeColor=null,e.globalMinVisibleSize=t.minVisibleSize,e.strokeMinVisibleSize=0,e.offsetAngle=0,e.symbolicSize=t.widthScaled,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isBodyTriangle=!1}function setEdgeOutline(e,t,s,i){prepareEdgePiece(e,t,s,i);const r=t.widthFixed*Ui+Gi;e.thicknessOrFontSizeScaled=t.widthScaled*Vi,e.thicknessOrFontSizeFixed=t.widthFixed*Vi,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=t.widthScaled*Ui,e.offsetFixed=r,e.fillColor=t.outline.color,e.strokeColor=null,e.globalMinVisibleSize=Math.max(t.minVisibleSize,t.outline.minVisibleSize),e.strokeMinVisibleSize=0,e.offsetAngle=Math.PI/2,e.symbolicSize=t.widthScaled,e.dashLength=t.shape.dashLength,e.gapLength=t.shape.gapLength,e.hasHead=!!t.shape.head,e.hasTail=!!t.shape.tail,e.isBodyTriangle=t.shape.isBodyTriangle}var Yi=2,Zi=4,Qi=5,Ki=6,Ji=7,en=1,tn=2,sn=3,nn=4,rn=5,on=6;function prepareEdgeTextObject(e,t,s){const i="centered"===t.position?0:(s.widthScaled+t.heightScaled)/2+s.stroke.widthScaled,r="centered"===t.position?0:(s.widthFixed+t.heightFixed)/2+s.stroke.widthFixed+t.padding+t.margin;e.pieceId=rn,e.shape="square",e.x1=s.sourceX,e.y1=s.sourceY,e.x2=s.targetX,e.y2=s.targetY,e.rectWidthOrSourceRadiusScaled=t.widthScaled,e.rectWidthOrSourceRadiusFixed=t.widthFixed+2*t.padding+1,e.rectHeightOrTargetRadiusScaled=t.heightScaled,e.rectHeightOrTargetRadiusFixed=t.heightFixed+2*t.padding,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=s.sourceRadiusScaled+s.targetRadiusScaled,e.strokeWidthFixed=s.sourceRadiusFixed+s.targetRadiusFixed,e.offsetScaled=i,e.offsetFixed=r,e.pattern.type=0,e.opacity=s.opacity,e.fillColor=null,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=Math.max(t.minVisibleSize,s.minVisibleSize),e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=t.offsetAngle,e.patternScale=0,e.symbolicSize=s.widthScaled,e.curvature=s.curvature,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=s.isSelfLoop,e.isText=!1,e.adjustTextAngle=t.adjustAngle}var an="shifted";function splitText(e,t){if(t<2)return e;const s=e.split("\n"),i=[];for(let e=0;e<s.length;++e){const r=s[e];if(r.length<t)i.push(r);else{const r=breakIntoLines(s[e],t);for(let e=0;e<r.length;++e)i.push(r[e])}}return i.join("\n")}function breakIntoLines(e,t){const s=[""],i=e.split(" ");for(let e=0;e<i.length;e++){const r=s[s.length-1],o=i[e];r.length+1+o.length<=t&&r.length?s[s.length-1]+=(r.length>0?" ":"")+o:s.push(o)}return s}function getLinesInfo(e,t){if(null===e)return null;const s=(e=e.toString()).split("\n"),i=[];let r=0;for(let e=0;e<s.length;e++){let o=s[e];if(!t||t<=1||o.length<t)i.push(o),r=Math.max(r,o.length);else{const a=breakIntoLines(s[e],t);for(let e=0;e<a.length;e++)o=a[e],i.push(o),r=Math.max(r,o.length)}}return{data:i,maxLength:r,lines:i.length}}function getRTLProcessors(){const e=smartRequire("@mapbox/mapbox-gl-rtl-text")||smartRequire("mapbox-gl-rtl-text"),t=e?e.processBidirectionalText:pe?window.processBidirectionalText:null,s=e?e.applyArabicShaping:pe?window.applyArabicShaping:null,i=t?e=>{if(null===e||null==e)return"";const s=[];let i=0,r="";const o=e.split("\n");for(let e=0;e<o.length;e++){const t=o[e],a=o[e].length+i;a>0&&e<o.length-1&&s.push(a),r+=e>0?""+t:t,i+=t.length}return t(r,s).join("\n")}:e=>e;return{processBidirectionalText:i,applyArabicShaping:s?e=>null==e?null:"number"==typeof e?e.toString():s(e):e=>null==e?null:e.toString()}}var isValidTextContent=e=>!!e||0===e;function inheritColor(e,t,s=0){if("inherit"===e){if(!Array.isArray(t))return t;return t[((s/(2*Math.PI)*t.length|0)+1)%t.length]}return e}function isTextBuffer(e){const t=(e.depth-Ci)%Li;return t>=0&&t!==ki&&t!==Mi}function buildEdgeComponents(e,t,s,i,r,o){!function buildBaseComponents(e,t,s,i,r,o){if(0===i.width.get(s))return;if(buildEdgeComponent(r.body,o,setEdgeBody),r.halo.body){const e=i.halo.width.get(s),t=+("scaled"===i.halo.scalingMethod.get(s));o.halo.widthScaled=e*t,o.halo.widthFixed=e*(1-t),buildEdgeComponent(r.halo,o,setEdgeHalo)}r.outline.body&&(o.outline.color=i.outline.color.get(s),o.outline.minVisibleSize=i.outline.minVisibleSize.get(s),buildEdgeComponent(r.outline,o,setEdgeOutline))}(0,0,s,i,r,o),buildTextComponent(e,t,s,i.text,r.texts.primary,o.texts.primary,o),buildTextComponent(e,t,s,i.text.secondary,r.texts.secondary,o.texts.secondary,o)}function buildEdgeComponent(e,t,s){s(e.body,t,tn,t.shape.body),e.head&&s(e.head,t,sn,t.shape.head),e.tail&&s(e.tail,t,nn,t.shape.tail)}function buildTextComponent(e,t,s,i,r,o,a){if(r.text&&o.content){const l=i,d=l.scaling.get(s);if(o.font=t.fontManager.getFont(l.font.get(s)),o.color=inheritColor(l.color.get(s),a.color),o.position=l.position?l.position.get(s):an,o.style=l.style.get(s),o.minVisibleSize=l.minVisibleSize.get(s),o.margin=l.margin.get(s),o.padding=l.padding.get(s),o.maxLineLength=l.maxLineLength.get(s),o.content=splitText(o.content,o.maxLineLength),o.adjustAngle=l.adjustAngle.get(s),o.align=l.align.get(s),d){const e=l.scale.get(s);o.sizeScaled=a.widthScaled*e,o.sizeFixed=a.widthFixed*e}else o.sizeFixed=l.size.get(s),o.sizeScaled=0;const h=e.measureText(o.content,o.font,o.style);o.widthScaled=h.width*o.sizeScaled,o.widthFixed=h.width*o.sizeFixed,o.heightScaled=h.height*o.sizeScaled,o.heightFixed=h.height*o.sizeFixed,o.offsetAngle=o===a.texts.primary?Wi:Hi,function setEdgeText(e,t,s){prepareEdgeTextObject(e,t,s),e.pattern.type=Ji,e.pattern.attributes.text=t.content,e.pattern.attributes.size=Ks,e.pattern.attributes.font=t.font,e.pattern.attributes.style=t.style,e.pattern.attributes.align=t.align,e.patternColor=t.color,e.patternScale=1,e.thicknessOrFontSizeScaled=t.sizeScaled,e.thicknessOrFontSizeFixed=t.sizeFixed,e.isText=!0}(r.text,o,a),r.background&&function setEdgeTextBackground(e,t,s){prepareEdgeTextObject(e,t,s),e.pieceId+=on,e.fillColor=t.backgroundColor,e.shape="roundedSquare"}(r.background,o,a)}}function computeEdgeFlags(e,t){setEdgeFlags(e.body,t,!0,!0),setEdgeFlags(e.outline,t,t.outline.enabled,!0),setEdgeFlags(e.halo,t,!!t.halo.color,!1),computeTextFlags(e.texts.primary,t.texts.primary),computeTextFlags(e.texts.secondary,t.texts.secondary)}function setEdgeFlags(e,t,value,s){e.body=value,e.head=value&&s&&!!t.shape.head,e.tail=value&&s&&!!t.shape.tail}function computeTextFlags(e,t){e.text=!t.hidden&&!!t.content,e.background=e.text&&!!t.backgroundColor}var ln=Math.round(Math.log2(512)),dn=Math.round(Math.log2(128)),hn=ln+dn,un=255,cn=128,gn=1/16,mn=Math.round(Math.sqrt(16)),_n=cn*mn,pn=16,fn=1,yn=256,xn=1.5,bn=56,vn=41,An=5,Sn=5,En=.9721,wn=24,Tn=1.4142;function cubicEquation(e,t,s,i,r){const o=1-r;return o*o*o*e+3*r*o*o*t+3*r*r*o*s+r*r*r*i}function quadraticEquation(e,t,s,i){const r=1-i;return r*r*e+2*r*i*t+i*i*s}var getSmoothScale=(e,t)=>2/(1+Math.exp(-Math.abs(e*t)));function getQuadraticCurveControlPoint(e,t,s,i,r,o){const a=o||{x:0,y:0},l=(e+s)/2,d=(t+i)/2,h=e-s,u=t-i,c=Math.sqrt(h*h+u*u);if(0===c)return a.x=l,a.y=d,a;const m=u/c,p=-h/c,y=-c*r/An;return a.x=l+m*y,a.y=d+p*y,a}function getSelfLoopControlPoints(e,t,s,i,r,o){const a=o||{x1:0,y1:0,x2:0,y2:0},l=(i+i/Sn*s)*Sn,d=-r+Ni,h=Ni/2-r;return a.x1=e+Math.cos(d)*l,a.y1=t+Math.sin(d)*l,a.x2=e+Math.cos(h)*l,a.y2=t+Math.sin(h)*l,a}function computeEdgeInput(e,t,s,i,r,o){!function computeBaseInput(e,t,s,i,r,o){const a=r.source,l=r.target,d=s.source.get(i),h=s.target.get(i),u=a.x.get(d),c=a.y.get(d),m=a.radius.get(d),p=a.color.get(d),y=+("scaled"===a.scalingMethod.get(d)),x=l.x.get(h),b=l.y.get(h),v=l.radius.get(h),E=l.color.get(h),k=+("scaled"===l.scalingMethod.get(h)),L=function inheritSourceTargetColor(e,t,s){return"source"===e?Array.isArray(t)?t[0]:t:"target"===e?Array.isArray(s)?s[0]:s:e}(s.color.get(i),p,E),D=s.width.get(i),B="scaled"===s.scalingMethod.get(i)?1:0,H=s.stroke.width.get(i),X="scaled"===s.stroke.scalingMethod.get(i)?1:0,Y=qi[s.shape.style.get(i)],Z=s.adjustAnchors.get(i);if(t.source=d,t.target=h,t.sourceX=u,t.sourceY=c,t.targetX=x,t.targetY=b,t.sourceRadiusScaled=m*y,t.sourceRadiusFixed=m*(1-y),t.targetRadiusScaled=v*k,t.targetRadiusFixed=v*(1-k),t.widthScaled=D*B,t.widthFixed=D*(1-B),t.curvature=s.curvature.get(i),t.isSelfLoop=d===h,t.color=L,t.opacity=s.opacity.get(i),t.minVisibleSize=s.minVisibleSize.get(i),t.shape.body=s.shape.body.get(i),t.shape.head=s.shape.head.get(i),t.shape.tail=s.shape.tail.get(i),t.shape.dashLength=Y.dash,t.shape.gapLength=Y.gap,t.shape.isBodyTriangle="triangle"===t.shape.body,t.stroke.color=inheritColor(s.stroke.color.get(i),L),t.stroke.widthScaled=H*X,t.stroke.widthFixed=H*(1-X),t.stroke.minVisibleSize=s.stroke.minVisibleSize.get(i),t.halo.color=s.halo.color.get(i),t.outline.enabled=s.outline.enabled.get(i),t.textHidden=1===s.textHidden.get(i),Z&&(t.shape.head||t.shape.tail||"triangle"===t.shape.body)){const e=t,s=e.curvature,i=e.sourceX,r=e.sourceY,u=e.targetX,c=e.targetY;let m=1,p=1;if(s){if(!e.isSelfLoop){const t=getQuadraticCurveControlPoint(i,r,u,c,s/2);m=computeEffectiveExtremityRatio(e,o,a,d,i,r,t.x,t.y),p=computeEffectiveExtremityRatio(e,o,l,h,u,c,t.x,t.y)}}else m=computeEffectiveExtremityRatio(e,o,a,d,i,r,u,c),p=computeEffectiveExtremityRatio(e,o,l,h,u,c,i,r);t.sourceRadiusScaled*=m,t.sourceRadiusFixed*=m,t.targetRadiusScaled*=p,t.targetRadiusFixed*=p}}(0,t,s,i,r,o),computeTextInput(e,t.texts.primary,s.text,i,t),computeTextInput(e,t.texts.secondary,s.text.secondary,i,t)}function computeTextInput(e,t,s,i,r){t.hidden=r.textHidden,t.content=e.formatText(s.content.get(i)),t.backgroundColor=inheritColor(s.backgroundColor.get(i),r.color)}function computeEffectiveExtremityRatio(e,t,s,i,r,o,a,l){const d=t.angle||0;let h,u=Math.atan2(l-o,a-r)-d,c=1,m=0;u<-Ni?u+=Pi:u>Ni&&(u-=Pi),u<-Ni/2?(m=Fi,h=s.badges.topLeft):u<0?(m=zi,h=s.badges.topRight):u<Ni/2?(m=Ri,h=s.badges.bottomRight):(m=Di,h=s.badges.bottomLeft),m+=d;const p=h.text.content&&h.text.content.get(i),y=h.image.url&&h.image.url.get(i);if(isValidTextContent(p)||y){const e=h.positionScale.get(i),t=h.scale.get(i),s=circleLineIntersection(a,l,r,o,r+Math.cos(m)*e,o+Math.sin(m)*e,t);if(s){const e=s.x-r,t=s.y-o,i=Math.sqrt(e*e+t*t);c=Math.max(c,i)}}if("square"===s.shape.get(i)){const e=Math.abs(Math.cos(u)),t=Math.abs(Math.sin(u)),s=1/Math.max(e,t);c=Math.max(c,s)}return c}function createEdgeInput(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:createEdgeTextAttributes(),secondary:createEdgeTextAttributes()}}}function createEdgeTextAttributes(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:an,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function isBool(e){return"boolean"==typeof e||0===e||1===e?e:void 0}function isNumber(e){return"number"==typeof e&&isFinite(e)?e:void 0}function isPositive(e){return"number"==typeof e&&isFinite(e)&&e>=0?e:void 0}var isLayerValue=e=>"number"==typeof e&&isFinite(e)&&e>=-100&&e<=400?e:void 0;function isText(e){return null===e||"string"==typeof e||"number"==typeof e?e:void 0}function isScalingMethod(e){return"fixed"===e||"scaled"===e?e:void 0}function isColor(e){return parseColor(e)?e:void 0}function isInheritableColor(e){return"inherit"===e||parseColor(e)?e:void 0}function isFontName(e){return null===e?null:"string"==typeof e?e.split(",").map((e=>{const t=e.trim(),s=-1!==t.indexOf(" "),i=t[0];return s&&'"'!==i&&"'"!==i?`"${t}"`:t})).join(","):void 0}function isFontStyle(e){return"none"===e?"normal":"normal"===e||"italic"===e||"bold"===e||"italic bold"===e||"bold italic"===e?e:void 0}function isTextAlign(e){return"left"===e||"center"===e?e:void 0}function isEdgeExtremity(e){return[null,"arrow","circle-hole-arrow","triangle-hole-arrow","short-arrow","sharp-arrow","circle","square"].includes(e)?e:void 0}function createCheckSizeFunction(e){return function(t){if("number"==typeof t)return isFinite(t)&&t>=0?t:void 0;if("string"!=typeof t||"%"!==t.charAt(t.length-1))return;const s=parseFloat(t);return isNaN(s)?void 0:e*s/100}}function layerToDepth(e,t={edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}){const s=(e- -100)*Li+Ci;return t.edgeHalo=0,t.nodeHaloStroke=1,t.nodeHalo=2,t.edgeBody=s+ki,t.edgeTextBackground=s+1,t.edgeText=s+2,t.nodeBody=s+Mi,t.nodeTextBackground=s+4,t.nodeText=s+5,t}var createAssignComponents=e=>(t,s)=>{s.halo.body=t.halo.body[e],s.halo.head=t.halo.head[e],s.halo.tail=t.halo.tail[e],s.outline.body=t.outline.body[e],s.outline.head=t.outline.head[e],s.outline.tail=t.outline.tail[e],s.body.body=t.body.body[e],s.body.head=t.body.head[e],s.body.tail=t.body.tail[e],s.texts.primary.text=t.texts.primary.text[e],s.texts.primary.background=t.texts.primary.background[e],s.texts.secondary.text=t.texts.secondary.text[e],s.texts.secondary.background=t.texts.secondary.background[e]},Cn=createAssignComponents("start"),kn=createAssignComponents("end"),Mn=class{constructor({engine:e,imageManager:t,fontManager:s,formatText:i,view:r,attributes:o,attributesPrev:a,nodeAttributes:l,nodeAttributesPrev:d}){this._fullComponents=createEdgeComponentsStructure(),this._startComponents=createEdgeComponentsStructure(),this._endComponents=createEdgeComponentsStructure(),this._startFlags=createEdgeComponentsStructure(),this._endFlags=createEdgeComponentsStructure(),this._startInput=createEdgeInput(),this._endInput=createEdgeInput(),this._depthInfo={edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0},this._nullElt={id:-1,valid:!0},this._engine=e,this._view=r,this._helper={imageManager:t,fontManager:s,formatText:i},this._attributes=o,this._attributesPrev=a,this._nodeAttributes=l,this._nodeAttributesPrev=d,this._layers=createEdgeBlocksStructure((()=>e.createGroup())),this._blockIds=createEdgeBlocksStructure((()=>0))}drawEdge(e){this._computeBlockIds(e);if(this._attributes.excluded.get(e))return this._freeBlocks();const t=this._engine,s=this._helper,i=-e,r=this._attributes,o=layerToDepth(r.layer.get(e)-(r.detectable.get(e)?0:1),this._depthInfo),a=r.source.get(e),l=r.target.get(e),d=r.curvature.get(e),h=this._attributesPrev.curvature.get(e),u=r.animationDuration.get(e),c=r.animationStart.get(e),m=r.animationEasing.get(e),p=u>0,y=0!==d||p&&0!==h;this._prepareBlocks(p,o,i,y);const x=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(computeEdgeInput(s,this._endInput,r,e,x,this._view),computeEdgeFlags(this._endFlags,this._endInput),p){const t=this._nodeAttributes.animationDuration.get(a)>0,i=this._nodeAttributes.animationDuration.get(l)>0;x.source=t?this._nodeAttributesPrev:this._nodeAttributes,x.target=i?this._nodeAttributesPrev:this._nodeAttributes,computeEdgeInput(s,this._startInput,this._attributesPrev,e,x,this._view),computeEdgeFlags(this._startFlags,this._startInput),((e,t)=>{t.halo.body=t.halo.body||e.halo.body,t.halo.head=t.halo.head||e.halo.head,t.halo.tail=t.halo.tail||e.halo.tail,t.outline.body=t.outline.body||e.outline.body,t.outline.head=t.outline.head||e.outline.head,t.outline.tail=t.outline.tail||e.outline.tail,t.body.body=t.body.body||e.body.body,t.body.head=t.body.head||e.body.head,t.body.tail=t.body.tail||e.body.tail;const s=t.texts,i=e.texts;s.primary.text=s.primary.text||i.primary.text,s.primary.background=s.primary.background||i.primary.background,s.secondary.text=s.secondary.text||i.secondary.text,s.secondary.background=s.secondary.background||i.secondary.background})(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),kn(this._fullComponents,this._endComponents),buildEdgeComponents(t,s,e,this._attributes,this._endComponents,this._endInput),p&&(Cn(this._fullComponents,this._startComponents),buildEdgeComponents(t,s,e,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(u,c,m)),this._setupHaloMasking(a,l),this._storeBlocks()}_setupHaloMasking(e,t){const s=this._nodeAttributes.halo,i=this._layers,r=s.color.get(e)&&s.hideNonAdjacentEdges.get(e),o=s.color.get(t)&&s.hideNonAdjacentEdges.get(t),a=!r&&!o?3:1;i.body.stencilUsage=i.text.stencilUsage=i.textBg.stencilUsage=a}_computeBlockIds(e){const t=10*e,s=this._blockIds;s.body=t+5,s.halo=t+8,s.text=t+6,s.textBg=t+7}_prepareBlocks(e,t,s,i){const r=this._layers;r.body.reset(i?3:1,e,t.edgeBody,s),r.halo.reset(i?3:1,e,t.edgeHalo,s),r.text.reset(2,e,t.edgeText,s),r.textBg.reset(1,e,t.edgeTextBackground,s)}_storeBlocks(){const e=this._engine,t=this._layers,s=this._blockIds;e.storeGroup(s.body,t.body),e.storeGroup(s.halo,t.halo),e.storeGroup(s.text,t.text),e.storeGroup(s.textBg,t.textBg)}_freeBlocks(){const e=this._engine,t=this._blockIds;e.freeBlock(t.body),e.freeBlock(t.halo),e.freeBlock(t.text),e.freeBlock(t.textBg)}_setBlocksAnimation(e,t,s){const i=this._layers;i.body.setGlobalAnimation(e,t,s),i.halo.setGlobalAnimation(e,t,s),i.text.setGlobalAnimation(e,t,s),i.textBg.setGlobalAnimation(e,t,s)}_initComponents(e,t,s){this._initEdgeComponents(e.halo,t.halo,s.halo),this._initEdgeComponents(e.outline,t.outline,s.body),this._initEdgeComponents(e.body,t.body,s.body),this._initTextComponents(e.texts.primary,t.texts.primary,s),this._initTextComponents(e.texts.secondary,t.texts.secondary,s)}_initEdgeComponents(e,t,s){e.head=this._nextElement(t.head,s),e.tail=this._nextElement(t.tail,s),e.body=this._nextElement(t.body,s)}_initTextComponents(e,t,s){e.background=this._nextElement(t.background,s.textBg),e.text=this._nextElement(t.text,s.text)}_nextElement(e,t){return e?t.next():this._nullElt}};function createEdgeBlocksStructure(e){return{body:e(),halo:e(),text:e(),textBg:e()}}function createEdgeComponentsStructure(){return{halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}}}function prepareBadgeObject(e,t,s){const i=s.diameterScaled*t.scale,r=s.diameterFixed*t.scale,o=s.diameterScaled*t.positionScale/2,a=s.diameterFixed*t.positionScale/2;e.pieceId=en,e.shape="circle",e.x1=s.x,e.y1=s.y,e.x2=s.x,e.y2=s.y,e.rectWidthOrSourceRadiusScaled=i,e.rectWidthOrSourceRadiusFixed=r,e.rectHeightOrTargetRadiusScaled=i,e.rectHeightOrTargetRadiusFixed=r,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=t.strokeWidthScaled,e.strokeWidthFixed=t.strokeWidthFixed,e.offsetScaled=o,e.offsetFixed=a,e.pattern.type=0,e.opacity=s.opacity,e.fillColor=t.color,e.strokeColor=t.strokeColor,e.patternColor=null,e.globalMinVisibleSize=t.minVisibleSize,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=t.angle,e.patternScale=0,e.symbolicSize=s.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}function prepareNodeBodyObject(e,t){e.pieceId=en,e.x1=t.x,e.y1=t.y,e.x2=t.x,e.y2=t.y,e.rectWidthOrSourceRadiusScaled=t.diameterScaled,e.rectWidthOrSourceRadiusFixed=t.diameterFixed,e.rectHeightOrTargetRadiusScaled=t.diameterScaled,e.rectHeightOrTargetRadiusFixed=t.diameterFixed,e.shape=t.shape,e.opacity=t.opacity,e.symbolicSize=t.diameterScaled,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=0,e.offsetFixed=0,e.fillColor=null,e.strokeColor=null,e.globalMinVisibleSize=0,e.strokeMinVisibleSize=0,e.offsetAngle=0,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}function prepareNodeTextObject(e,t,s){let i=0,r=0;if(t.isPositionCenter||(i+=s.diameterScaled/2,r+=s.diameterFixed/2+t.margin+t.padding),t.isPositionVertical){if(i+=t.heightScaled/2,r+=t.heightFixed/2,t===s.texts.secondary&&"bottom"===s.texts.primary.position){const e=s.texts.primary;i+=e.heightScaled,r+=e.heightFixed+e.margin+2*e.padding}}else t.isPositionHorizontal&&(i+=t.widthScaled/2,r+=t.widthFixed/2);const o=Ks;e.pieceId=en,e.shape="square",e.x1=s.x,e.y1=s.y,e.x2=s.x,e.y2=s.y,e.rectWidthOrSourceRadiusScaled=t.widthScaled,e.rectWidthOrSourceRadiusFixed=t.widthFixed+2*t.padding,e.rectHeightOrTargetRadiusScaled=t.heightScaled,e.rectHeightOrTargetRadiusFixed=t.heightFixed+2*t.padding,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=i,e.offsetFixed=r,e.pattern.type=0,e.pattern.attributes.size=o,e.opacity=s.opacity,e.fillColor=null,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=t.minVisibleSize,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=t.positionAngle,e.patternScale=1,e.symbolicSize=s.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}function buildNodeComponents(e,t,s,i,r,o){const a=r.badges,l=i.badges,d=o.badges;!function buildBaseComponents2(e,t,s,i,r,o){if(r.halo){const e=i.halo.width.get(s),t=+("scaled"===i.halo.scalingMethod.get(s));o.halo.widthScaled=e*t,o.halo.widthFixed=e*(1-t),function setNodeHalo(e,t){const s=t.diameterScaled+2*t.halo.widthScaled,i=t.diameterFixed+2*t.halo.widthFixed;e.pieceId=en,e.shape="circle",e.x1=t.x,e.y1=t.y,e.x2=t.x,e.y2=t.y,e.rectWidthOrSourceRadiusScaled=s,e.rectWidthOrSourceRadiusFixed=i,e.rectHeightOrTargetRadiusScaled=s,e.rectHeightOrTargetRadiusFixed=i,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=0,e.offsetFixed=0,e.pattern.type=0,e.opacity=t.opacity,e.fillColor=t.halo.color,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=0,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=0,e.patternScale=0,e.symbolicSize=t.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}(r.halo,o),r.haloStroke&&(o.halo.strokeWidthScaled=0,o.halo.strokeWidthFixed=i.halo.strokeWidth.get(s),function setNodeHaloStroke(e,t){const s=t.diameterScaled+2*t.halo.widthScaled,i=t.diameterFixed+2*t.halo.widthFixed;e.pieceId=en,e.shape="circle",e.x1=t.x,e.y1=t.y,e.x2=t.x,e.y2=t.y,e.rectWidthOrSourceRadiusScaled=s,e.rectWidthOrSourceRadiusFixed=i,e.rectHeightOrTargetRadiusScaled=s,e.rectHeightOrTargetRadiusFixed=i,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=t.halo.strokeWidthScaled,e.strokeWidthFixed=t.halo.strokeWidthFixed,e.offsetScaled=0,e.offsetFixed=0,e.pattern.type=0,e.opacity=t.opacity,e.fillColor=null,e.strokeColor=t.halo.strokeColor,e.patternColor=null,e.globalMinVisibleSize=0,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=0,e.patternScale=0,e.symbolicSize=t.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}(r.haloStroke,o))}r.outline&&(o.outline.color=i.outline.color.get(s),o.outline.minVisibleSize=i.outline.minVisibleSize.get(s),function setNodeOutline(e,t){const s=t.diameterScaled*Oi,i=t.diameterFixed*Oi;let r=t.diameterScaled*Bi,o=t.diameterFixed*Bi+ji;t.outerStroke.color&&(r+=t.outerStroke.widthScaled/2,o+=t.outerStroke.widthFixed/2),e.pieceId=en,e.shape=t.shape,e.x1=t.x,e.y1=t.y,e.x2=t.x,e.y2=t.y,e.rectWidthOrSourceRadiusScaled=s,e.rectWidthOrSourceRadiusFixed=i,e.rectHeightOrTargetRadiusScaled=s,e.rectHeightOrTargetRadiusFixed=i,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=r,e.offsetFixed=o,e.pattern.type=0,e.opacity=t.opacity,e.fillColor=t.outline.color,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=t.outline.minVisibleSize,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=1.5707963267948966,e.patternScale=0,e.symbolicSize=t.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}(r.outline,o));r.outerStroke&&(o.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(s),function setNodeOuterStroke(e,t){const s=t.diameterScaled+2*t.innerStroke.widthScaled,i=t.diameterFixed+2*t.innerStroke.widthFixed;e.pieceId=en,e.shape=t.shape,e.x1=t.x,e.y1=t.y,e.x2=t.x,e.y2=t.y,e.rectWidthOrSourceRadiusScaled=s,e.rectWidthOrSourceRadiusFixed=i,e.rectHeightOrTargetRadiusScaled=s,e.rectHeightOrTargetRadiusFixed=i,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=t.outerStroke.widthScaled,e.strokeWidthFixed=t.outerStroke.widthFixed,e.offsetScaled=0,e.offsetFixed=0,e.pattern.type=0,e.opacity=t.opacity,e.fillColor=null,e.strokeColor=t.outerStroke.color,e.patternColor=null,e.globalMinVisibleSize=t.outerStroke.minVisibleSize,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=0,e.patternScale=0,e.symbolicSize=t.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1,e.isText=!1}(r.outerStroke,o));r.pieChart&&function setNodePieChart(e,t){prepareNodeBodyObject(e,t),Array.isArray(t.color)&&(e.pattern.type=Zi,e.pattern.attributes.colors=t.color.join(";"),e.patternScale=1,e.patternMinVisibleSize=0,e.patternColor=null)}(r.pieChart,o);r.image&&(o.image.content=t.imageManager.getImage(o.image.url),o.image.fit=i.image.fit.get(s),o.image.tile=i.image.tile.get(s),o.image.scale=i.image.scale.get(s),o.image.minVisibleSize=i.image.minVisibleSize.get(s),function setNodeImage(e,t){const s=t.image.fit&&!t.image.tile;prepareNodeBodyObject(e,t),e.pattern.type=Yi,e.pattern.attributes.image=t.image.content,e.pattern.attributes.scaled=s,e.pattern.attributes.duplicated=t.image.tile,e.patternScale=s?t.image.scale:0,e.patternMinVisibleSize=t.image.minVisibleSize,e.patternColor=null}(r.image,o));r.icon&&(o.icon.font=t.fontManager.getFont(i.icon.font.get(s)),o.icon.style=i.icon.style.get(s),o.icon.color=i.icon.color.get(s),o.icon.scale=i.icon.scale.get(s),o.icon.minVisibleSize=i.icon.minVisibleSize.get(s),function setNodeIcon(e,t){prepareNodeBodyObject(e,t),e.pattern.type=Qi,e.pattern.attributes.text=t.icon.content,e.pattern.attributes.font=t.icon.font,e.pattern.attributes.style=t.icon.style,e.pattern.attributes.size=Ks,e.patternMinVisibleSize=t.icon.minVisibleSize,e.patternColor=t.icon.color,e.patternScale=t.icon.scale}(r.icon,o));if(r.body){const e=!r.pieChart&&!r.image&&!r.icon;!function setNodeBody(e,t,s){prepareNodeBodyObject(e,t),e.fillColor=Array.isArray(t.color)?null:t.color,e.strokeColor=t.innerStroke.color,e.strokeMinVisibleSize=t.innerStroke.minVisibleSize,e.strokeWidthScaled=t.innerStroke.widthScaled,e.strokeWidthFixed=t.innerStroke.widthFixed,s&&(e.pattern.type=0)}(r.body,o,e)}}(0,t,s,i,r,o),buildTextComponent2(e,t,s,i.text,r.texts.primary,o.texts.primary,o),buildTextComponent2(e,t,s,i.text.secondary,r.texts.secondary,o.texts.secondary,o),buildBadgeComponent(e,t,s,l.topLeft,a.topLeft,d.topLeft,o),buildBadgeComponent(e,t,s,l.topRight,a.topRight,d.topRight,o),buildBadgeComponent(e,t,s,l.bottomLeft,a.bottomLeft,d.bottomLeft,o),buildBadgeComponent(e,t,s,l.bottomRight,a.bottomRight,d.bottomRight,o)}function buildBadgeComponent(e,t,s,i,r,o,a){if(r.image||r.text){const e=i.stroke.width.get(s),t=+("scaled"===i.stroke.scalingMethod.get(s));o.color=inheritColor(i.color.get(s),a.color,o.angle),o.strokeColor=i.stroke.color.get(s),o.strokeWidthScaled=e*t,o.strokeWidthFixed=e*(1-t),o.minVisibleSize=i.minVisibleSize.get(s),o.positionScale=i.positionScale.get(s),o.scale=i.scale.get(s)}if(r.image&&(o.imageContent=t.imageManager.getImage(o.imageUrl),o.imageScale=i.image.scale.get(s),function setNodeBadgeImage(e,t,s){prepareBadgeObject(e,t,s),null!==t.imageContent?(e.pattern.type=Yi,e.pattern.attributes.image=t.imageContent,e.pattern.attributes.scaled=!0,e.pattern.attributes.duplicated=!1,e.patternScale=t.imageScale,e.patternMinVisibleSize=0,e.patternColor=null):(e.fillColor=null,e.strokeColor=null)}(r.image,o,a)),r.text){o.textFont=t.fontManager.getFont(i.text.font.get(s)),o.textStyle=i.text.style.get(s),o.textColor=inheritColor(i.text.color.get(s),a.color),o.textScale=i.text.scale.get(s),o.textPaddingTop=i.text.paddingTop.get(s),o.textPaddingLeft=i.text.paddingLeft.get(s);if(e.measureText(o.textContent,o.textFont,o.textStyle,o.textScale).width>1){let t=0,s=0;for(;s<o.textContent.length&&t<1;)t+=e.measureText(o.textContent[s],o.textFont,o.textStyle,o.textScale).width,s+=1;s!==o.textContent.length&&(o.textContent=o.textContent.substring(0,s-1)+"")}!function setNodeBadgeText(e,t,s){prepareBadgeObject(e,t,s),t.textContent&&(e.pattern.type=Ki,e.pattern.attributes.text=t.textContent,e.pattern.attributes.font=t.textFont,e.pattern.attributes.style=t.textStyle,e.pattern.attributes.paddingLeft=t.scale*t.textPaddingLeft*2,e.pattern.attributes.paddingTop=t.scale*t.textPaddingTop*2,e.pattern.attributes.size=Ks,e.patternMinVisibleSize=0,e.patternColor=t.textColor,e.patternScale=t.textScale,e.isBadge=!0),!t.imageUrl&&t.textContent||(e.fillColor=null,e.strokeColor=null)}(r.text,o,a)}}function buildTextComponent2(e,t,s,i,r,o,a){if(r.text&&o.content){const l=i,d=l.scaling.get(s);if(o.font=t.fontManager.getFont(l.font.get(s)),o.color=inheritColor(l.color.get(s),a.color),o.style=l.style.get(s),o.align=l.align.get(s),o.minVisibleSize=l.minVisibleSize.get(s),o.margin=l.margin.get(s),o.padding=l.padding.get(s),o.maxLineLength=l.maxLineLength.get(s),o.content=splitText(o.content,o.maxLineLength),d){const e=l.scale.get(s);o.sizeScaled=a.diameterScaled*e,o.sizeFixed=a.diameterFixed*e}else o.sizeFixed=l.size.get(s),o.sizeScaled=0;const h=e.measureText(o.content,o.font,o.style);o.widthScaled=h.width*o.sizeScaled,o.widthFixed=h.width*o.sizeFixed,o.heightScaled=h.height*o.sizeScaled,o.heightFixed=h.height*o.sizeFixed,o.positionAngle=Xi[o.position],o.isPositionCenter="center"===o.position,o.isPositionVertical="top"===o.position||"bottom"===o.position,o.isPositionHorizontal="left"===o.position||"right"===o.position,function setNodeText(e,t,s){prepareNodeTextObject(e,t,s),e.pattern.type=Ji,e.pattern.attributes.text=t.content,e.pattern.attributes.font=t.font,e.pattern.attributes.style=t.style,e.pattern.attributes.align=t.align,e.patternMinVisibleSize=0,e.patternColor=t.color,e.thicknessOrFontSizeScaled=t.sizeScaled,e.thicknessOrFontSizeFixed=t.sizeFixed,e.isText=!0}(r.text,o,a),r.background&&(!function setNodeTextBackground(e,t,s){prepareNodeTextObject(e,t,s),e.fillColor=t.backgroundColor,e.pieceId=on,e.shape="roundedSquare"}(r.background,o,a),r.tip&&function setNodeTextTip(e,t,s){const i=Math.ceil(t.margin/2),r=s.diameterScaled/2,o=s.diameterFixed/2+i,a=$i[t.position],l=Math.cos(a),d=Math.sin(a),h=t.margin<12?1:t.margin<30?1-(t.margin-12)/18*.7:.25;e.pieceId=en,e.shape="triangle",e.x1=s.x-l,e.y1=s.y-d,e.x2=s.x+l,e.y2=s.y+d,e.rectWidthOrSourceRadiusScaled=0,e.rectWidthOrSourceRadiusFixed=t.margin,e.rectHeightOrTargetRadiusScaled=0,e.rectHeightOrTargetRadiusFixed=t.margin*h,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=r,e.offsetFixed=o,e.pattern.type=0,e.opacity=s.opacity,e.fillColor=t.backgroundColor,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=t.minVisibleSize,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=t.positionAngle,e.patternScale=0,e.symbolicSize=s.diameterScaled,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isSelfLoop=!1}(r.tip,o,a))}}function computeNodeFlags(e,t){!function computeBaseFlags(e,t){e.body=!0,e.icon=!!t.icon.content,e.image=!!t.image.url,e.pieChart=Array.isArray(t.color),e.outerStroke=!!t.outerStroke.color,e.outline=!!t.outline.enabled,e.halo=!!t.halo.color,e.haloStroke=e.halo&&!!t.halo.strokeColor}(e,t),computeTextFlags2(e.texts.primary,t.texts.primary),computeTextFlags2(e.texts.secondary,t.texts.secondary),computeBadgeFlags(e.badges.topLeft,t.badges.topLeft),computeBadgeFlags(e.badges.topRight,t.badges.topRight),computeBadgeFlags(e.badges.bottomLeft,t.badges.bottomLeft),computeBadgeFlags(e.badges.bottomRight,t.badges.bottomRight)}function computeTextFlags2(e,t){e.text=!t.hidden&&!!t.content,e.background=e.text&&!!t.backgroundColor,e.tip=e.background&&t.tip&&"center"!==t.position}function computeBadgeFlags(e,t){e.text=!!t.textContent,e.image=!!t.imageUrl}function computeNodeInput(e,t,s,i){!function computeBaseInput2(e,t,s,i){const r=+("scaled"===s.scalingMethod.get(i)),o=2*s.radius.get(i),a=s.innerStroke.width.get(i),l=+("scaled"===s.innerStroke.scalingMethod.get(i)),d=s.outerStroke.width.get(i),h=+("scaled"===s.outerStroke.scalingMethod.get(i));t.x=s.x.get(i),t.y=s.y.get(i),t.shape=s.shape.get(i),t.color=s.color.get(i),t.opacity=s.opacity.get(i),t.diameterScaled=o*r,t.diameterFixed=o*(1-r),t.innerStroke.color=inheritColor(s.innerStroke.color.get(i),t.color),t.innerStroke.widthScaled=a*l,t.innerStroke.widthFixed=a*(1-l),t.innerStroke.minVisibleSize=s.innerStroke.minVisibleSize.get(i),t.outerStroke.color=inheritColor(s.outerStroke.color.get(i),t.color),t.outerStroke.widthScaled=d*h,t.outerStroke.widthFixed=d*(1-h),t.halo.color=s.halo.color.get(i),t.halo.strokeColor=s.halo.strokeColor.get(i),t.icon.content=e.formatText(s.icon.content.get(i)),t.image.url=s.image.url.get(i),t.outline.enabled=s.outline.enabled.get(i),t.textHidden=1===s.textHidden.get(i)}(e,t,s,i),computeTextInput2(e,t.texts.primary,s.text,i,t),computeTextInput2(e,t.texts.secondary,s.text.secondary,i,t),computeBadgeInput(e,t.badges.topLeft,s.badges.topLeft,i),computeBadgeInput(e,t.badges.topRight,s.badges.topRight,i),computeBadgeInput(e,t.badges.bottomLeft,s.badges.bottomLeft,i),computeBadgeInput(e,t.badges.bottomRight,s.badges.bottomRight,i)}function computeTextInput2(e,t,s,i,r){if(t.hidden=r.textHidden,t.content=e.formatText(s.content.get(i)),t.backgroundColor=inheritColor(s.backgroundColor.get(i),r.color),t===r.texts.primary){const e=s;t.tip=e.tip.get(i),t.position=e.position.get(i)}else t.position="bottom"}function computeBadgeInput(e,t,s,i){const r=s.text.content.get(i);t.textContent=e.formatText(r),t.imageUrl=s.image.url.get(i)}function createNodeInput(){return{x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:createBadgeAttributes(Fi),topRight:createBadgeAttributes(zi),bottomLeft:createBadgeAttributes(Di),bottomRight:createBadgeAttributes(Ri)},textHidden:!1,texts:{primary:{hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1},secondary:{hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}}}}function createBadgeAttributes(e){return{angle:e,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}}var createAssignComponents2=e=>(t,s)=>{s.haloStroke=t.haloStroke[e],s.halo=t.halo[e],s.outline=t.outline[e],s.outerStroke=t.outerStroke[e],s.body=t.body[e],s.pieChart=t.pieChart[e],s.image=t.image[e],s.icon=t.icon[e];const i=t.badges,r=s.badges;r.topLeft.text=i.topLeft.text[e],r.topLeft.image=i.topLeft.image[e],r.topRight.text=i.topRight.text[e],r.topRight.image=i.topRight.image[e],r.bottomLeft.text=i.bottomLeft.text[e],r.bottomLeft.image=i.bottomLeft.image[e],r.bottomRight.text=i.bottomRight.text[e],r.bottomRight.image=i.bottomRight.image[e];const o=t.texts,a=s.texts;a.primary.text=o.primary.text[e],a.primary.background=o.primary.background[e],a.primary.tip=o.primary.tip[e],a.secondary.text=o.secondary.text[e],a.secondary.background=o.secondary.background[e],a.secondary.tip=o.secondary.tip[e]},Ln=createAssignComponents2("start"),In=createAssignComponents2("end"),Nn=class{constructor({engine:e,imageManager:t,fontManager:s,formatText:i,attributes:r,attributesPrev:o}){this._fullComponents=createNodeComponentsStructure(),this._startComponents=createNodeComponentsStructure(),this._endComponents=createNodeComponentsStructure(),this._startFlags=createNodeComponentsStructure(),this._endFlags=createNodeComponentsStructure(),this._startInput=createNodeInput(),this._endInput=createNodeInput(),this._depthInfo={edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0},this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=e,this._attributes=r,this._attributesPrev=o,this._helper={imageManager:t,fontManager:s,formatText:i},this._layers=createNodeBlocksStructure((()=>e.createGroup())),this._blockIds=createNodeBlocksStructure((()=>0))}drawNode(e){this._computeBlockIds(e);if(this._attributes.excluded.get(e))return this._freeBlocks();const t=this._engine,s=this._helper,i=e,r=this._attributes,o=layerToDepth(r.layer.get(e)-(r.detectable.get(e)?0:1),this._depthInfo),a=r.animationDuration.get(e),l=a>0;if(this._prepareBlocks(l,o,i),computeNodeInput(s,this._endInput,r,e),computeNodeFlags(this._endFlags,this._endInput),l&&(computeNodeInput(s,this._startInput,this._attributesPrev,e),computeNodeFlags(this._startFlags,this._startInput),((e,t)=>{t.haloStroke=t.haloStroke||e.haloStroke,t.halo=t.halo||e.halo,t.outline=t.outline||e.outline,t.outerStroke=t.outerStroke||e.outerStroke,t.body=t.body||e.body,t.pieChart=t.pieChart||e.pieChart,t.image=t.image||e.image,t.icon=t.icon||e.icon;const s=e.badges,i=t.badges;i.topLeft.text=i.topLeft.text||s.topLeft.text,i.topLeft.image=i.topLeft.image||s.topLeft.image,i.topRight.text=i.topRight.text||s.topRight.text,i.topRight.image=i.topRight.image||s.topRight.image,i.bottomLeft.text=i.bottomLeft.text||s.bottomLeft.text,i.bottomLeft.image=i.bottomLeft.image||s.bottomLeft.image,i.bottomRight.text=i.bottomRight.text||s.bottomRight.text,i.bottomRight.image=i.bottomRight.image||s.bottomRight.image;const r=e.texts,o=t.texts;o.primary.text=o.primary.text||r.primary.text,o.primary.background=o.primary.background||r.primary.background,o.primary.tip=o.primary.tip||r.primary.tip,o.secondary.text=o.secondary.text||r.secondary.text,o.secondary.background=o.secondary.background||r.secondary.background,o.secondary.tip=o.secondary.tip||r.secondary.tip})(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),In(this._fullComponents,this._endComponents),buildNodeComponents(t,s,e,r,this._endComponents,this._endInput),l&&(Ln(this._fullComponents,this._startComponents),buildNodeComponents(t,s,e,this._attributesPrev,this._startComponents,this._startInput)),l){const t=this._attributes.animationStart.get(e),s=this._attributes.animationEasing.get(e);this._setBlocksAnimation(a,t,s)}if(this._endFlags.halo){this._attributes.halo.hideNonAdjacentEdges.get(e)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=2)}this._storeBlocks()}_computeBlockIds(e){const t=10*e,s=this._blockIds;s.body=t+0,s.text=t+1,s.textBg=t+2,s.halo=t+3,s.haloStroke=t+4}_prepareBlocks(e,t,s){const i=this._layers;i.body.reset(1,e,t.nodeBody,s),i.text.reset(2,e,t.nodeText,s),i.textBg.reset(1,e,t.nodeTextBackground,s),i.halo.reset(1,e,t.nodeHalo,s),i.haloStroke.reset(1,e,t.nodeHaloStroke,s)}_storeBlocks(){const e=this._engine,t=this._layers,s=this._blockIds;e.storeGroup(s.body,t.body),e.storeGroup(s.text,t.text),e.storeGroup(s.textBg,t.textBg),e.storeGroup(s.halo,t.halo),e.storeGroup(s.haloStroke,t.haloStroke)}_freeBlocks(){const e=this._engine,t=this._blockIds;e.freeBlock(t.body),e.freeBlock(t.text),e.freeBlock(t.textBg),e.freeBlock(t.halo),e.freeBlock(t.haloStroke)}_setBlocksAnimation(e,t,s){const i=this._layers;i.body.setGlobalAnimation(e,t,s),i.text.setGlobalAnimation(e,t,s),i.textBg.setGlobalAnimation(e,t,s),i.halo.setGlobalAnimation(e,t,s),i.haloStroke.setGlobalAnimation(e,t,s)}_initComponents(e,t,s){this._nodePatternAssigned=!1,this._initBaseComponents(e,t,s),this._initBadgeComponents(e.badges.topLeft,t.badges.topLeft,s),this._initBadgeComponents(e.badges.topRight,t.badges.topRight,s),this._initBadgeComponents(e.badges.bottomLeft,t.badges.bottomLeft,s),this._initBadgeComponents(e.badges.bottomRight,t.badges.bottomRight,s),this._initTextComponents(e.texts.primary,t.texts.primary,s),this._initTextComponents(e.texts.secondary,t.texts.secondary,s)}_initBaseComponents(e,t,s){e.haloStroke=this._nextElement(t.haloStroke,s.haloStroke),e.halo=this._nextElement(t.halo,s.halo),e.outline=this._nextElement(t.outline,s.body),e.outerStroke=this._nextElement(t.outerStroke,s.body),e.body=this._nextElement(t.body,s.body),e.pieChart=this._getNodePatternElement(t.pieChart,s),e.image=this._getNodePatternElement(t.image,s),e.icon=this._getNodePatternElement(t.icon,s)}_initBadgeComponents(e,t,s){e.image=this._nextElement(t.image,s.body),e.text=this._nextElement(t.text,s.body)}_initTextComponents(e,t,s){e.background=this._nextElement(t.background,s.textBg),e.tip=this._nextElement(t.tip,s.textBg),e.text=this._nextElement(t.text,s.text)}_nextElement(e,t){return e?t.next():this._nullElt}_getNodePatternElement(e,t){return e?this._nodePatternAssigned?t.body.next():(this._nodePatternAssigned=!0,t.body.getCurrentElement()):this._nullElt}};function createNodeBlocksStructure(e){return{body:e(),text:e(),textBg:e(),halo:e(),haloStroke:e()}}function createNodeComponentsStructure(){return{haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}}}function loadGraphInGraphicsEngine({graph:e,elements:t,engine:s,imageManager:i,fontManager:r,view:o,attributes:a,boundaries:l,formatText:d}){const{nodeAttributes:h,nodeAttributesPrev:u,edgeAttributes:c,edgeAttributesPrev:m}=function preProcessAttributes(e){const t=merge(e.nodes.current,{text:{secondary:{scaling:e.nodes.current.text.scaling,maxLineLength:e.nodes.current.text.maxLineLength}}}),s=merge(e.nodes.previous,{textHidden:t.textHidden,text:{secondary:{scaling:e.nodes.previous.text.scaling,maxLineLength:e.nodes.previous.text.maxLineLength}}}),i=merge(e.edges.current,{text:{secondary:{scaling:e.edges.current.text.scaling,maxLineLength:e.edges.current.text.maxLineLength,adjustAngle:e.edges.current.text.adjustAngle}}}),r=merge(e.edges.previous,{source:e.edges.current.source,target:e.edges.current.target,textHidden:e.edges.current.textHidden,text:{secondary:{scaling:e.edges.previous.text.scaling,maxLineLength:e.edges.previous.text.maxLineLength,adjustAngle:e.edges.previous.text.adjustAngle}}});return{nodeAttributes:t,nodeAttributesPrev:s,edgeAttributes:i,edgeAttributesPrev:r}}(a),{nodes:p,edges:y}=t,{maxSize:x,maxMinVisibleSize:b}=l;if(!p.size&&!y.size)return;const v=10*(Math.max(e.getNodeMaxIndex(),e.getEdgeMaxIndex())+1),E=s.setGlobalBoundaries({maxBlockId:nextPowerOfTwo(v),maxScaledSize:nextPowerOfTwo(8*x),maxMinVisibleSize:nextPowerOfTwo(b),maxSymbolicSize:nextPowerOfTwo(x),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),k=(E?e.getNodes("_all"):p)._indexes,L=(E?e.getEdges("_all"):y)._indexes;if(k.length){const e=new Nn({engine:s,imageManager:i,fontManager:r,formatText:d,attributes:h,attributesPrev:u});for(let t=0;t<k.length;++t)e.drawNode(k[t])}if(L.length){const e=new Mn({engine:s,imageManager:i,fontManager:r,formatText:d,view:o,attributes:c,attributesPrev:m,nodeAttributes:h,nodeAttributesPrev:u});for(let t=0;t<L.length;++t)e.drawEdge(L[t])}}function isPointInLine(e,t,s,i,r,o,a,l=0,d=!1){const h=distance(s,i,r,o),u=(a/2*(d?distance(e,t,r,o)/h:1)+l)/h,c=(r-s)*u,m=(o-i)*u,p=s+m,y=i-c,x=e-p,b=t-y,v=s-m-p,E=i+c-y,k=r+m-p,L=o-c-y,D=x*v+b*E,B=x*k+b*L;return D>0&&D<v*v+E*E&&B>0&&B<k*k+L*L}function twoSegmentsIntersect(e,t,s,i,r=!1){if(r&&(eq(e,s)||eq(e,i)||eq(t,s)||eq(t,i)))return!1;let o=(e.y-s.y)*(i.x-s.x)-(e.x-s.x)*(i.y-s.y);const a=(t.x-e.x)*(i.y-s.y)-(t.y-e.y)*(i.x-s.x);if(0===a)return!1;const l=o/a;o=(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y);const d=o/a;return!(l<=0||l>=1||d<=0||d>=1)}function eq(e,t){return e.x===t.x&&e.y===t.y}function lineAngle(e,t,s,i){return Math.atan2(i-t,s-e)}function angle(e,t,s){const i=lineAngle(e.x,e.y,t.x,t.y)-lineAngle(s.x,s.y,t.x,t.y);return i<0?i+2*Math.PI:i}function lineIntersection(e,t,s,i,r,o,a,l){const d=(l-o)*(s-e)-(a-r)*(i-t);if(0===d)return null;let h=t-o;return h=((a-r)*h-(l-o)*(e-r))/d,{x:e+h*(s-e),y:t+h*(i-t)}}function segmentIntersection(e,t,s,i,r,o,a,l){const d=e-s,h=t-i,u=r-a,c=o-l,m=d*c-u*h,p=(h*(e-r)-d*(t-o))/m;if(p<0||p>1)return null;const y=(u*(o-t)+c*(e-r))/m;return y>=0&&y<=1?{x:e-y*d,y:t-y*h}:null}function segmentRectangleIntersection(e,t,s,i,r,o,a,l){let d;const h=[];return d=segmentIntersection(e,t,s,i,r,o,r,l),d&&h.push(d),d=segmentIntersection(e,t,s,i,r,l,a,l),d&&h.push(d),d=segmentIntersection(e,t,s,i,a,l,a,o),d&&h.push(d),d=segmentIntersection(e,t,s,i,a,o,r,o),d&&h.push(d),h}function lineLine2(e,t,s,i,r,o,a,l){const d=((a-r)*(t-o)-(l-o)*(e-r))/((l-o)*(s-e)-(a-r)*(i-t)),h=((s-e)*(t-o)-(i-t)*(e-r))/((l-o)*(s-e)-(a-r)*(i-t));return d>=0&&d<=1&&h>=0&&h<=1}function lineAABB(e,t,s,i,r,o,a,l){return e>=r&&t>=o&&e<=a&&t<=l||(s>=r&&i>=o&&s<=a&&i<=l||(!!lineLine2(e,t,s,i,r,o,r,l)||(!!lineLine2(e,t,s,i,a,o,a,l)||(!!lineLine2(e,t,s,i,r,o,a,o)||!!lineLine2(e,t,s,i,r,l,a,l)))))}function distancePointSegment(e,t,s){return Math.sqrt(distToSegmentSquared(e.x,e.y,t.x,t.y,s.x,s.y))}function distToSegmentSquared(e,t,s,i,r,o){const a=squaredDistance(s,i,r,o);if(0===a)return squaredDistance(e,t,s,i);let l=((e-s)*(r-s)+(t-i)*(o-i))/a;return l=Math.max(0,Math.min(1,l)),squaredDistance(e,t,s+l*(r-s),i+l*(o-i))}function getClosestPointOnSegment(e,t,s,i,r,o){const a=r-s,l=o-i;if(0===a&&0===l)return{x:s,y:i};const d=((e-s)*a+(t-i)*l)/(a*a+l*l);return d<0?{x:s,y:i}:d>1?{x:r,y:o}:{x:s+d*a,y:i+d*l}}function getClosestPointOnLine(e,t,s,i,r,o){const a=r-s,l=o-i,d=((e-s)*a+(t-i)*l)/(a*a+l*l);return{x:s+a*d,y:i+l*d}}function isPointInPolygon(e,t,s){const i=s.length;let r=i-1,o=!1;for(let a=0;a<i;++a)(s[a].y<t&&s[r].y>=t||s[r].y<t&&s[a].y>=t)&&(s[a].x<=e||s[r].x<=e)&&(o=o!==s[a].x+(t-s[a].y)/(s[r].y-s[a].y)*(s[r].x-s[a].x)<e),r=a;return o}function normVector(e){const t=e.x*e.x+e.y*e.y;return{x:e.x/t,y:e.y/t}}function project(e,t){let s=1/0,i=-1/0;for(let r=0,o=e.length;r<o;r++){const o=e[r],a=o.x*t.x+o.y*t.y;a<s&&(s=a),a>i&&(i=a)}return{x:s,y:i}}function polygonsIntersect(e,t){const s=function getPerpendicularAxes(e,t){let s=e[1],i=e[0],r=normVector({x:s.x-i.x,y:s.y-i.y}),o=r.x;r.x=-r.y,r.y=o;const a=r;s=e[2],i=e[1],r=normVector({x:s.x-i.x,y:s.y-i.y}),o=r.x,r.x=-r.y,r.y=o;const l=r;s=t[1],i=t[0],r=normVector({x:s.x-i.x,y:s.y-i.y}),o=r.x,r.x=-r.y,r.y=o;const d=r;return s=t[2],i=t[1],r=normVector({x:s.x-i.x,y:s.y-i.y}),o=r.x,r.x=-r.y,r.y=o,[a,l,d,r]}(e,t);for(let i=0,r=s.length;i<r;i++){const r=s[i],o=project(e,r),a=project(t,r);if(0===(o.x<=a.y&&o.y>=a.x?Math.min(o.y,a.y)-Math.max(o.x,a.x):0))return!1}return!0}function computeCentroid(e){let t=0,s=0;const i=e.length;if(0===i)throw new Error("Compute centroid: at least one point is required");for(let r=0;r<i;++r){const i=e[r];t+=i.x,s+=i.y}return t/=i,s/=i,{x:t,y:s}}var Pn=computeCircularPolygon(4),Fn=function computeRoundedSquare(){return new Array(12).fill(0).map(((e,t)=>({x:Math.cos(t/12*2*Math.PI),y:Math.sin(t/12*2*Math.PI)})))}(),zn=computeCircularPolygon(5),Dn=computeCircularPolygon(10,.4),Rn=1/3,On=[{x:-1,y:-Rn},{x:-.55,y:-Rn},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:Rn},{x:-1,y:Rn}],Bn=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],jn={circle:{getDistanceFromStrokeVertically:(e,t)=>1,getDistanceFromStrokeHorizontally:(e,t)=>1-Math.sqrt(e*e+t*t),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(e,t)=>1-Math.abs(t),getDistanceFromStrokeHorizontally:(e,t)=>1-Math.abs(e),points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],isSimple:!0},line:{getDistanceFromStrokeVertically:(e,t)=>1-Math.abs(t),getDistanceFromStrokeHorizontally:(e,t)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(e,t)=>(1-e)/2-Math.abs(t),getDistanceFromStrokeHorizontally:(e,t)=>1-Math.abs(e),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(e,t)=>(1-e)/2-Math.abs(t),getDistanceFromStrokeHorizontally:(e,t)=>1-Math.abs(e),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(e,t)=>Math.min(Math.sqrt((e+.4)*(e+.4)+t*t)-.27,(1-e)/2-Math.abs(t)),getDistanceFromStrokeHorizontally:(e,t)=>1-Math.abs(e),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(e,t)=>{const s=Math.min((1-e)/2-Math.abs(t),1-Math.abs(e)),i=-distanceToPolygon(e,t,Bn);return Math.min(s,i)},getDistanceFromStrokeHorizontally:(e,t)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:Bn,isSimple:!0},"short-arrow":createPolygonShape([{x:-1,y:-Rn},{x:0,y:-Rn},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:Rn},{x:-1,y:Rn}],!1),"sharp-arrow":createPolygonShape(On,!1),cross:{getDistanceFromStrokeVertically:(e,t)=>1,getDistanceFromStrokeHorizontally:(e,t)=>{const s=Math.abs(e),i=Math.abs(t),r=.31-Math.min(s,i),o=1-Math.max(s,i);return Math.min(r,o)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],isSimple:!1},diamond:createPolygonShape(Pn),roundedSquare:createPolygonShape(Fn),pentagon:createPolygonShape(zn),star:createPolygonShape(Dn)},Vn=["circle","square","roundedSquare","triangle","line"],Un=["cross","diamond","pentagon","star"],Gn=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function loadRequiredShapes(e,t){for(const t of Vn)registerShape(e,t);const s=t.nodes.current.shape.getValues(),i=t.edges.current.shape.head.getValues(),r=t.edges.current.shape.tail.getValues();for(const t of Un)s.includes(t)&&registerShape(e,t);for(const t of Gn)t&&(i.includes(t)||r.includes(t))&&registerShape(e,t)}function registerShape(e,t){e.registerShape(t,jn[t])}function distanceToPolygon(e,t,s){let i=1/0;const r={x:e,y:t};for(let e=0;e<s.length;++e){const t=s[e],o=s[(e+1)%s.length];i=Math.min(i,distancePointSegment(r,t,o))}return i*(isPointInPolygon(e,t,s)?1:-1)}function computeCircularPolygon(e,t=1){const s=-Math.PI/2+Ii,i=[],r=2*Math.PI/e;let o=s;for(let s=0;s<e;++s){const e=s%2==1?t:1;i.push({x:Math.cos(o)*e,y:Math.sin(o)*e}),o+=r}return i}function createPolygonShape(e,t=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(t,s)=>distanceToPolygon(t,s,e),points:e,isSimple:t}}var Wn=class extends is{constructor(e,t){super(),this.isDummy=!0,this.width=0,this.height=0}set src(e){e&&(this._src=e,setTimeout((()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")}),10))}get src(){return this._src}addEventListener(e,t){this.on(e,t)}};var Hn=class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(e){this._crossOrigin=e}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(e){let t=this._images[e];return void 0===t&&(this._nbToLoad+=1,t=function createImageInstance(e,t){return new("undefined"!=typeof Image?Image:Wn)(e,t)}(),t.crossOrigin=this._crossOrigin,t.onload=()=>this._onImgLoad(e),t.onerror=()=>{this._onImgLoad(e),this._images[e]=null},t.src=e,this._images[e]=t),t}_onImgLoad(e){this._nbLoaded+=1,this._onFetch.forEach((t=>t(e))),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach((e=>e())),this._whenReady=[])}onFetch(e){this._onFetch.push(e)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise((e=>this._whenReady.push(e)))}destroy(){this._whenReady=[],this._onFetch=[]}};function getPointOnQuadraticCurve(e,t,s,i,r,o,a,l={x:0,y:0}){return l.x=(1-e)*(1-e)*t+2*(1-e)*e*o+e*e*i,l.y=(1-e)*(1-e)*s+2*(1-e)*e*a+e*e*r,l}function getTangentOnQuadraticCurve(e,t,s,i,r,o,a,l={x:0,y:0}){return l.x=(2*e-2)*t+(2*i-4*o)*e+2*o,l.y=(2*e-2)*s+(2*r-4*a)*e+2*a,normalize(l)}function getNormalOnQuadraticCurve(e,t,s,i,r,o,a,l={x:0,y:0}){return getTangentOnQuadraticCurve(e,t,s,i,r,o,s,l),rotate(l.x,l.y,0,0,Math.PI/2,l),l}function isPointOnQuadraticCurve(e,t,s,i,r,o,a,l,d,h=0,u=!1){const c=s-2*a+r,m=i-2*l+o,p=-((s-e)*m-(i-t)*c)/((2*a-2*s)*m-(2*l-2*i)*c);if(p<0||p>1)return!1;let y=d/2;u&&(y*=1-p),y+=h;return distance(quadraticEquation(s,a,r,p),quadraticEquation(i,l,o,p),e,t)<=y}function getPointOnEdge(e,t){const s=e.getAttribute("curvature"),[i,r]=e.getExtremities().getAttributes(["x","y"]),o=getQuadraticCurveControlPoint(i.x,i.y,r.x,r.y,s);return getPointOnQuadraticCurve(t,i.x,i.y,r.x,r.y,o.x,o.y)}function getNormalOnEdge(e,t){const s=e.getAttribute("curvature"),[i,r]=e.getExtremities().getAttributes(["x","y"]),o=getQuadraticCurveControlPoint(i.x,i.y,r.x,r.y,s);return getNormalOnQuadraticCurve(t,i.x,i.y,r.x,r.y,o.x,o.y)}function getTangentOnEdge(e,t){const s=e.getAttribute("curvature"),[i,r]=e.getExtremities().getAttributes(["x","y"]),o=getQuadraticCurveControlPoint(i.x,i.y,r.x,r.y,s);return getTangentOnQuadraticCurve(t,i.x,i.y,r.x,r.y,o.x,o.y)}function getPointOnBezierCurve(e,t,s,i,r,o,a,l,d,h={x:0,y:0}){const u=(1-e)*(1-e)*(1-e),c=3*e*(1-e)*(1-e),m=3*e*e*(1-e),p=e*e*e;return h.x=u*t+c*o+m*l+p*i,h.y=u*s+c*a+m*d+p*r,h}function isPointOnBezierCurve(e,t,s,i,r,o,a,l,d,h,u,c){const m=distance(s,i,a,l);if(Math.abs(e-s)>m||Math.abs(t-i)>m)return!1;let p=.5,y=distance(e,t,s,i)<distance(e,t,r,o)?-.01:.01;let x=100;const b=getPointOnBezierCurve(p,s,i,r,o,a,l,d,h);let v,E=distance(e,t,b.x,b.y);const k=u/2+c;for(;x-- >0&&p>=0&&p<=1&&E>k&&(y>.001||y<-.001);)v=E,getPointOnBezierCurve(p,s,i,r,o,a,l,d,h,b),E=distance(e,t,b.x,b.y),E>v?(y=-y/2,p+=y):p+y<0||p+y>1?(y/=2,E=v):p+=y;return E<k}function getQuadraticCurveBoundingBox(e,t,s,i,r,o,a=simpleBoundingBox()){const l=e+2/3*(s-e),d=t+2/3*(i-t);return getBezierCurveBoundingBox(e,t,l,d,l+1/3*(r-e),d+1/3*(o-t),r,o,a)}function getBezierCurveBoundingBox(e,t,s,i,r,o,a,l,d=simpleBoundingBox()){const{min:h,max:u,sqrt:c}=Math;let m,p,y,x,b;d.minX=h(e,a),d.maxX=u(e,a),d.minY=h(t,l),d.maxY=u(t,l);for(let v,E,k,L,D,B,H,X=0;X<2;++X)if(0===X?(p=e,y=s,x=r,b=a):(p=t,y=i,x=o,b=l),E=6*p-12*y+6*x,v=-3*p+9*y-9*x+3*b,k=3*y-3*p,E|=0,v|=0,k|=0,0!==v)D=E*E-4*k*v,D<0||(B=(-E+c(D))/(2*v),B>0&&B<1&&(m=f(B,p,y,x,b),0===X?(d.minX=h(d.minX,m),d.maxX=u(d.maxX,m)):(d.minY=h(d.minY,m),d.maxY=u(d.maxY,m))),H=(-E-c(D))/(2*v),H>0&&H<1&&(m=f(H,p,y,x,b),0===X?(d.minX=h(d.minX,m),d.maxX=u(d.maxX,m)):(d.minY=h(d.minY,m),d.maxY=u(d.maxY,m))));else{if(0===E)continue;L=-k/E,L>0&&L<1&&(m=f(L,p,y,x,b),0===X?(d.minX=h(d.minX,m),d.maxX=u(d.maxX,m)):(d.minY=h(d.minY,m),d.maxY=u(d.maxY,m)))}return d}function f(e,t,s,i,r){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*s+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*r}function getQuadraticBezierCurveLength(e,t,s,i,r,o){const a=e-2*s+r,l=t-2*i+o,d=2*s-2*e,h=2*i-2*t,u=4*(a*a+l*l),c=4*(a*d+l*h),m=d*d+h*h,p=2*Math.sqrt(u+c+m),y=Math.sqrt(u),x=2*u*y,b=2*Math.sqrt(m),v=c/y;return(x*p+y*c*(p-b)+(4*m*u-c*c)*Math.log((2*y+v+p)/(v+b)))/(4*x)}var qn={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]},Xn=new class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(qn)}add(e){Object.keys(e).forEach((t=>{const s=e[t].slice();s.length<8&&(s[4]=s[0],s[5]=s[1],s[6]=s[2],s[7]=s[3]);const i=hash8(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);this._nameToPolygon[t]=s,this._polygonToName[i]=t}))}getCoefficients(e){return this._nameToPolygon[e]||this._linearEasing}getName(e,t,s,i,r,o,a,l){const d=hash8(e,t,s,i,r,o,a,l);return this._polygonToName[d]||"linear"}},$n={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}},Yn=[{name:"topLeft",dx:-1,dy:-1},{name:"topRight",dx:1,dy:-1},{name:"bottomLeft",dx:-1,dy:1},{name:"bottomRight",dx:1,dy:1}],Zn={x:0,y:0};var Qn=Math.cos(Math.PI/4);function checkBadge(e,t,s,i,r){const o=s.getFlexArrays().nodes.current,a=i.getZoom(),l="scaled"===o.scalingMethod.get(t),d=o.radius.get(t)*(l?a:1),h=o.x.get(t),u=o.y.get(t);for(let s=0;s<4;s++){const{name:l,dx:c,dy:m}=Yn[s],p=o.badges[l].stroke.width.get(t),y="scaled"===o.badges[l].stroke.scalingMethod.get(t),x=o.badges[l].scale.get(t)*d+(y?a:1)*p,b=o.badges[l].minVisibleSize.get(t)/2,v=o.badges[l].positionScale.get(t);if(!o.badges[l].text.content.get(t)&&!o.badges[l].image.url.get(t)||x<b)continue;const E=i.graphToScreenCoordinates({x:h+o.radius.get(t)*v*c*Qn,y:u+o.radius.get(t)*v*m*Qn}),{x:k,y:L}=E,D=(e.x-k)/x,B=(e.y-L)/x;if(r.checkShapeHit("circle",D,B))return l}}function computeAnimationRatio(e,t,s,i){const r=(e-t)/s,o=r*r,a=o*r,l=Xn.getCoefficients(i),d=r<.5?0:4;return clamp(l[d]+l[d+1]*r+l[d+2]*o+l[d+3]*a,0,1)}function mixColor(e,t,s,i){if(e===t)return e;const[r,o,a,l]=parseColor(e),[d,h,u,c]=parseColor(t);return`rgba(${Math.round(255*lerp(r,d,s))},${Math.round(255*lerp(o,h,s))},${Math.round(255*lerp(a,u,s))},${lerp(l,c,i)})`}var Kn=class{constructor({elementSize:e,sideElementSize:t,nbSideElementsPerMainElement:s,id:i,depth:r,elementType:o,animated:a,stencilUsage:l}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=512,this.version=0,this._id=i,this.depth=r,this.type=o,this.animated=a,this.stencilUsage=l,this.elementSize=e,this._sideElementSize=t,this._nbSideElementsPerMainElement=s,this._totalSideElementsSize=s*t,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(e){let t=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+e<=this._capacity?(t=this._nbCellsAllocated,this._nbCellsAllocated+=e,this._mustUpdate=!0):this._isFullyAllocated=!0,t}free(e,t){for(let s=0;s<t;s++){const t=(e+s)*this.elementSize;this._dataView.setUint16(t,0)}this._mustUpdate=!0,this._nbCellsFreed+=t}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}},Jn=class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(e,t,s,i){return this._blockInfo.buffer=e,this._blockInfo.offset=t,this._blockInfo.size=s,this._blockInfo.address=i,this._blockInfo}_createBuffer(e,t,s,i,r){const o=t?128:bn,a=this._buffersById.length,l=new Kn({elementSize:o,sideElementSize:6,nbSideElementsPerMainElement:i,id:a,depth:s,elementType:e,animated:t,stencilUsage:r});return this._buffersById.push(l),l}getBlockInfo(e){return this._fillBlockInfo(this._buffersById[e>>hn],(e>>dn)%512,e%128,e)}allocateBlock(e,t,s,i,r,o,a){const l=function roundTo(e,t){let value=0;for(;value<e;)value+=t;return value}(o,8);this._mustUpdate=!0;let d=null,h=-1;if(e){const o=this.getBlockInfo(e),u=o.buffer,c=o.offset,m=o.size,p=o.size===r,y=u.depth===i,x=u.type===t,b=u.animated===s,v=u.getNbSideElementsPerMainElement()===l,E=u.stencilUsage===a;p&&y&&x&&b&&v&&E?(u.triggerUpdate(),d=u,h=c):u.free(c,m)}if(-1===h){const e=+s,o=l/8,u=this._buffersByDepth[i]||Array(2);this._buffersByDepth[i]=u;const c=u[e]||[];u[e]=c;const m=c[t]||Array(16);c[t]=m;const p=m[o]||Array(4);m[o]=p;const y=p[a]||[];p[a]=y;const x=y[y.length-1];x&&(d=x,h=x.allocate(r)),-1===h&&(d=this._createBuffer(t,s,i,l,a),h=d.allocate(r),y.push(d))}const u=function makeBlockAddress(e,t,s){return((e<<ln)+t<<dn)+s}(d.getId(),h,r);return this._fillBlockInfo(d,h,r,u)}freeBlock(e){if(e){this._mustUpdate=!0;const t=this.getBlockInfo(e);t.buffer.free(t.offset,t.size)}return 0}_sortBuffersByDepth(){const e=[];for(let t=0;t<this._buffersByDepth.length;t++){const s=this._buffersByDepth[t];if(s)for(let t=0;t<s.length;t++){const i=s[t];if(i)for(let t=0;t<i.length;t++){const s=i[t];if(s)for(let t=0;t<s.length;t++){const i=s[t];if(i)for(let t=0;t<i.length;t++){const s=i[t];if(s)for(let t=0;t<s.length;t++){const i=s[t];i.update(),i.isFullyFreed()?(this._buffersById[i.getId()]=void 0,s.splice(t,1),t-=1):e.push(i)}}}}}}this._buffersByAscendingDepth=e,this._buffersByDescendingDepth=e.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}};function resetObjectInfo(e={}){return e.pieceId=0,e.shape="",e.x1=0,e.y1=0,e.x2=0,e.y2=0,e.rectWidthOrSourceRadiusScaled=0,e.rectWidthOrSourceRadiusFixed=0,e.rectHeightOrTargetRadiusScaled=0,e.rectHeightOrTargetRadiusFixed=0,e.thicknessOrFontSizeScaled=0,e.thicknessOrFontSizeFixed=0,e.strokeWidthScaled=0,e.strokeWidthFixed=0,e.offsetScaled=0,e.offsetFixed=0,e.pattern=e.pattern||{type:0,attributes:{}},e.pattern.type=0,e.opacity=1,e.fillColor=null,e.strokeColor=null,e.patternColor=null,e.globalMinVisibleSize=0,e.strokeMinVisibleSize=0,e.patternMinVisibleSize=0,e.offsetAngle=0,e.patternScale=0,e.symbolicSize=0,e.curvature=0,e.dashLength=0,e.gapLength=0,e.hasHead=!1,e.hasTail=!1,e.isBodyTriangle=!1,e.isSelfLoop=!1,e.isText=!1,e.adjustTextAngle=!1,e.isBadge=!1,e.unusedFlag2=!1,e.unusedFlag3=!1,e}function resizeCanvas(e,t,s,i){e.width=t*i,e.height=s*i,setElementSize(e,`${t}px`,`${s}px`)}var er=class{constructor(){this._capacity=128,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=1,this.type=1,this._list=Array(this._capacity);for(let e=0;e<this._capacity;++e)this._list[e]={valid:!1,id:void 0,end:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},start:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},animation:{duration:0,beginTime:-1,easing:"linear"}}}reset(e,t,s,i){return this.type=e,this.animated=t,this.depth=s,void 0!==i&&(this._id=i),this.stencilUsage=1,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){const e=this.next();return e.end=resetObjectInfo(e.end),e.start=resetObjectInfo(e.start),e.animation=function resetAnimationInfo(e={}){return e.duration=0,e.beginTime=-1,e.easing="linear",e}(e.animation),e}forEach(e){this._list.forEach(e)}getElement(e){return this._list[e]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(e,t,s){for(let i=0;i<this.size;++i){const r=this._list[i].animation;r.duration=e,r.beginTime=t,r.easing=s}}},tr=class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:e,maxScaledSize:t,maxMinVisibleSize:s,maxSymbolicSize:i,maxDashLength:r,maxGapLength:o,maxPatternScale:a}){const l=this.maxCoord<e||this.maxScaledSize<t||this.maxMinVisibleSize<s||this.maxSymbolicSize<i||this.maxDashLength<r||this.maxGapLength<o||this.maxPatternScale<a;return l&&(this.maxCoord=e,this.maxScaledSize=t,this.maxMinVisibleSize=s,this.maxSymbolicSize=i,this.maxDashLength=r,this.maxGapLength=o,this.maxPatternScale=a,this._mustUpdate=!0),l}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},sr=class{constructor(e,t,s,i,r){this._littleEndian=isLittleEndian(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=32767,this._actualMinVisibleSizeToBytes=15,this._actualSymbolicSizeToBytes=un,this._actualDashLengthToBytes=3,this._actualGapLengthToBytes=3,this._actualPatternScaleToBytes=un,this._genericObject={valid:!1,id:void 0,end:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},start:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},animation:{duration:0,beginTime:-1,easing:"linear"}},this._shapeManager=t,this._patternManager=e,this._textManager=s,this._bufferOfsetToId=i,this._colorParser=r}resizeBoundaries(e,t,s,i,r,o){this._maxScaledSize=e,this._maxMinVisibleSize=t,this._maxSymbolicSize=s,this._maxDashLength=i,this._maxGapLength=r,this._maxPatternScale=o,this._actualScaledSizeToBytes=65535/e,this._actualMinVisibleSizeToBytes=15/t,this._actualSymbolicSizeToBytes=un/s,this._actualDashLengthToBytes=3/i,this._actualGapLengthToBytes=3/r,this._actualPatternScaleToBytes=un/o}storeGenericObject(e,t,s){const i=this._shapeManager.getIdFromName(s.shape),r=s.pieceId,o=this._dashLengthToBytes(s.dashLength),a=this._gapLengthToBytes(s.gapLength),l=+s.hasHead,d=+s.hasTail,h=+s.isBodyTriangle,u=+s.isSelfLoop,c=this._patternScaleToBytes(s.patternScale),m=this._offsetAngleToBytes(s.offsetAngle),p=+s.isText,y=+s.adjustTextAngle,x=+s.isBadge,b=+s.unusedFlag2,v=+s.unusedFlag3,E=this._opacityToBytes(s.opacity),k=this._minVisibleSizeToBytes(s.globalMinVisibleSize),L=this._minVisibleSizeToBytes(s.strokeMinVisibleSize),D=this._minVisibleSizeToBytes(s.patternMinVisibleSize),B=this._symbolicSizeToBytes(s.symbolicSize),H=this._curvatureToBytes(s.curvature),X=s.pattern.attributes.colors;X&&(s.pattern.attributes.colors=X.split(";").map((e=>bytesToColor(this._colorToBytes(e.trim())))).join(";"));const Y=this._patternManager.getIdFromDefinition(s.pattern),Z=this._colorToBytes(s.fillColor),oe=this._colorToBytes(s.strokeColor),de=this._colorToBytes(s.patternColor),he=this._coordToBytes(s.x1),ce=this._coordToBytes(s.y1),me=this._coordToBytes(s.x2),_e=this._coordToBytes(s.y2),pe=this._scaledSizeToBytes(s.rectWidthOrSourceRadiusScaled),ye=this._fixedSizeToBytes(s.rectWidthOrSourceRadiusFixed),xe=this._scaledSizeToBytes(s.rectHeightOrTargetRadiusScaled),be=this._fixedSizeToBytes(s.rectHeightOrTargetRadiusFixed),ve=this._scaledSizeToBytes(s.thicknessOrFontSizeScaled),Se=this._fixedSizeToBytes(s.thicknessOrFontSizeFixed),Ee=this._scaledSizeToBytes(s.strokeWidthScaled),we=this._fixedSizeToBytes(s.strokeWidthFixed),Ce=this._scaledSizeToBytes(s.offsetScaled),ke=this._fixedSizeToBytes(s.offsetFixed),Me=this._fixedSizeToBytes(s.pattern.attributes.paddingTop||0),Le=this._fixedSizeToBytes(s.pattern.attributes.paddingLeft||0),Ie=i+(r<<4)+(o<<8)+(a<<10)+(l<<12)+(d<<13)+(h<<14)+(u<<15),Ne=c+(m<<8)+(p<<11)+(y<<12)+(x<<13)+(b<<14)+(v<<15),Pe=E+(k<<4)+(L<<8)+(D<<12),Fe=B+(H<<8);this._setUint16(e,t+0,Ie),this._setUint16(e,t+2,Ne),this._setUint16(e,t+4,Pe),this._setUint16(e,t+6,Fe),this._setUint16(e,t+8,Y),this._setUint16(e,t+10,Z),this._setUint16(e,t+12,oe),this._setUint16(e,t+14,de),this._setFloat32(e,t+16,he),this._setFloat32(e,t+20,ce),this._setFloat32(e,t+24,me),this._setFloat32(e,t+28,_e),this._setUint16(e,t+32,pe),this._setUint16(e,t+34,ye),this._setUint16(e,t+36,xe),this._setUint16(e,t+38,be),this._setUint16(e,t+40,ve),this._setUint16(e,t+42,Se),this._setUint16(e,t+44,Ee),this._setUint16(e,t+46,we),this._setUint16(e,t+48,Ce),this._setInt16(e,t+50,ke),this._setInt16(e,t+52,Me),this._setInt16(e,t+54,Le)}_setUint16(e,t,value){e.setUint16(t,value,this._littleEndian)}_setInt16(e,t,value){e.setUint16(t,this._signedToUnsignedInt16(value),this._littleEndian)}_setFloat32(e,t,value){e.setFloat32(t,value,this._littleEndian)}_colorToBytes(e){const t=this._colorParser(e);return Math.round(15*t[0])+(Math.round(15*t[1])<<4)+(Math.round(15*t[2])<<8)+(Math.round(15*t[3])<<12)}_coordToBytes(value){return value}_scaledSizeToBytes(value){return Math.ceil(Math.min(value,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(value){return value}_minVisibleSizeToBytes(value){return Math.round(Math.min(value,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(value){return Math.round(Math.min(value,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(value){return Math.round(Math.min(value,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(value){return Math.round(Math.min(value,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(value){return Math.round(Math.min(value,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(value){return Math.round((value+Pi)%Pi*(8/Pi))}_opacityToBytes(value){return Math.round(15*Math.min(value,1))}_curvatureToBytes(value){return this._signedToUnsignedByte(value)}_signedToUnsignedByte(value){return clamp(value,-128,127)+128}_signedToUnsignedInt16(value){const e=32768;return clamp(value,-e,32767)+e}storeAnimationInformation(e,t,{beginTime:s,duration:i},r){this._setAnimationBeginTime(e,t,s),this._setAnimationDuration(e,t,i),this._setAnimationEasing(e,t,r)}_setAnimationBeginTime(e,t,s){this._setFloat32(e,t,s)}_setAnimationDuration(e,t,s){this._setFloat32(e,t+4,s)}_setAnimationEasing(e,t,s){this._setUint16(e,t+8,(s[0]+128<<8)+(s[4]+128)),this._setUint16(e,t+10,(s[1]+128<<8)+(s[5]+128)),this._setUint16(e,t+12,(s[2]+128<<8)+(s[6]+128)),this._setUint16(e,t+14,(s[3]+128<<8)+(s[7]+128))}extractGenericElement(e,t,s){const i=e.type,r=e.animated,o=e.getDataView(),a=t*e.elementSize,l=this._genericObject;if(l.valid=!1,o.getUint16(a)&&(l.valid=!0,this._extractGenericObject(l.end,o,a,s),r&&(this._extractGenericObject(l.start,o,a+bn,s),this._extractAnimationInformation(l.animation,o,a+112)),l.id=this._bufferOfsetToId.get(e.getId(),t),2===i)){const s=e.getSideDataView(),i=t*e.getTotalSideElementsSize(),r=i+e.getTotalSideElementsSize();l.end.pattern=this._textManager.extractTextFromDataView(s,i,r)}return l}_extractGenericObject(e,t,s,{bytesToActualCoord:i,bytesToActualScaledSize:r,bytesToActualMinVisibleSize:o,bytesToActualPatternScale:a,bytesToActualSymbolicSize:l,bytesToActualDashLength:d,bytesToActualGapLength:h}){const u=t,c=s,m=this._littleEndian,p=u.getUint16(c,m),y=extractBits(p,0,4),x=extractBits(p,4,8),b=extractBits(p,8,10),v=extractBits(p,10,12),E=extractBits(p,12,13),k=extractBits(p,13,14),L=extractBits(p,14,15),D=extractBits(p,15,16),B=u.getUint16(c+2,m),H=extractBits(B,0,8),X=extractBits(B,8,11),Y=extractBits(B,11,12),Z=extractBits(B,12,13),oe=extractBits(B,13,14),de=extractBits(B,14,15),he=extractBits(B,15,16),ce=u.getUint16(c+4,m),me=extractBits(ce,0,4),_e=extractBits(ce,4,8),pe=extractBits(ce,8,12),ye=extractBits(ce,12,16),xe=u.getUint16(c+6,m),be=extractBits(xe,0,8),ve=extractBits(xe,8,16),Se=u.getUint16(c+8,m),Ee=u.getUint16(c+10,m),we=u.getUint16(c+12,m),Ce=u.getUint16(c+14,m),ke=u.getFloat32(c+16,m),Me=u.getFloat32(c+20,m),Le=u.getFloat32(c+24,m),Ie=u.getFloat32(c+28,m),Ne=u.getUint16(c+32,m),Pe=u.getUint16(c+34,m),Fe=u.getUint16(c+36,m),ze=u.getUint16(c+38,m),De=u.getUint16(c+40,m),Re=u.getUint16(c+42,m),Oe=u.getUint16(c+44,m),Be=u.getUint16(c+46,m),je=u.getUint16(c+48,m),Ve=unsignedToSignedInt16(u.getUint16(c+50,m)),Ue=unsignedToSignedInt16(u.getUint16(c+52,m)),Ge=unsignedToSignedInt16(u.getUint16(c+54,m));e.pieceId=x,e.shape=this._shapeManager.getNameFromId(y),e.x1=scale2(ke,i),e.y1=scale2(Me,i),e.x2=scale2(Le,i),e.y2=scale2(Ie,i),e.rectWidthOrSourceRadiusScaled=scale2(Ne,r),e.rectWidthOrSourceRadiusFixed=Pe,e.rectHeightOrTargetRadiusScaled=scale2(Fe,r),e.rectHeightOrTargetRadiusFixed=ze,e.thicknessOrFontSizeScaled=scale2(De,r),e.thicknessOrFontSizeFixed=Re,e.strokeWidthScaled=scale2(Oe,r),e.strokeWidthFixed=Be,e.offsetScaled=scale2(je,r),e.offsetFixed=Ve,e.pattern=this._patternManager.getDefinitionFromId(Se),e.pattern.attributes.paddingTop=Ue,e.pattern.attributes.paddingLeft=Ge,e.opacity=me/15,e.fillColor=bytesToColor(Ee),e.strokeColor=bytesToColor(we),e.patternColor=bytesToColor(Ce),e.globalMinVisibleSize=scale2(_e,o),e.strokeMinVisibleSize=scale2(pe,o),e.patternMinVisibleSize=scale2(ye,o),e.offsetAngle=X*(2*Math.PI/8),e.patternScale=H*a,e.symbolicSize=be*l,e.curvature=function unsignedToSignedByte(value){return value-128}(ve),e.dashLength=b*d,e.gapLength=v*h,e.hasHead=!!E,e.hasTail=!!k,e.isBodyTriangle=!!L,e.isSelfLoop=!!D,e.isText=!!Y,e.adjustTextAngle=!!Z,e.isBadge=!!oe,e.unusedFlag2=!!de,e.unusedFlag3=!!he}_extractAnimationInformation(e,t,s){const i=this._littleEndian,r=t.getFloat32(s,i),o=t.getFloat32(s+4,i),a=t.getUint16(s+8,i),l=t.getUint16(s+10,i),d=t.getUint16(s+12,i),h=t.getUint16(s+14,i),u=(a>>8)-128,c=(l>>8)-128,m=(d>>8)-128,p=(h>>8)-128,y=a%256-128,x=l%256-128,b=d%256-128,v=h%256-128;e.beginTime=r,e.duration=o,e.easing=Xn.getName(u,c,m,p,y,x,b,v)}};function extractBits(value,e,t){return value%(1<<t)>>e}function unsignedToSignedInt16(value){return value-32768}function scale2(value,e){return value*e}var ir=new Array(65535);function bytesToColor(value){let e=ir[value];if(!e){const t=extractBits(value,0,4)/15,s=extractBits(value,4,8)/15,i=extractBits(value,8,12)/15,r=extractBits(value,12,16)/15;e=`rgba(${255*t|0}, ${255*s|0}, ${255*i|0}, ${r})`,t+s+i+r===0&&(e=null),ir[value]=e}return e}var nr={[Yi]:"image",[Zi]:"piechart",3:"text",[Qi]:"icon",[Ki]:"badge"},rr=class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:1,attributes:{}}}_increaseNextId(){let e=this._nextPatternId++;for(e%256==255&&(e=this._nextPatternId++);this._patterns.length<=e;)this._patterns.push(void 0);return e}_createPattern({type:e,attributes:t}){const s={id:this._increaseNextId(),type:e,attributes:this._cloneAttributes(e,t)};return this._patterns[s.id]=s,this._mustUpdate=!0,s}_cloneAttributes(e,t){return e===Yi?{image:t.image,scaled:t.scaled,duplicated:t.duplicated}:3===e||e===Qi||e===Ki?{font:t.font,size:t.size,style:t.style,text:t.text,paddingLeft:t.paddingLeft,paddingTop:t.paddingTop,align:t.align||"center",offset:t.offset||0}:e===Zi&&t.colors?{colors:t.colors,colorArray:t.colors.split(";").map((e=>e.trim()))}:{}}getPatternList(){return this._patterns.filter((e=>e))}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(value){value!==this._pixelRatio&&(this._pixelRatio=value,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(e){const{type:t,attributes:s}=e,i=3===t||t===Qi||t===Ki;let r=0;return t&&1!==t&&t!==Ji&&(t!==Yi||s.image)&&(!i||s.text&&s.font)&&(r=this._addPattern(e),3===t&&"normal"===s.style&&(s.style="bold",this._addPattern(e))),r}_addPattern(e){const t=this._getPatternHash(e);let s=this._patternsByHash[t];return s||(this._nextPatternId>65500?$warn("maximum number of pattern exceeded"):(s=this._createPattern(e).id,this._patternsByHash[t]=s)),s}_getPatternHash({type:e,attributes:t}){const s=[nr[e]];return e===Yi?s.push(t.scaled?"scaled":"non-scaled",t.duplicated?"duplicated":"non-duplicated",t.image.src||t.image.toDataURL()):3===e?s.push(t.text,t.font,t.style,t.size,t.align||"center",t.offset||0):e===Qi||e===Ki?s.push(t.text,t.font,t.style,t.size,t.paddingLeft,t.paddingTop):s.push(t.colors),s.join("+")}getDefinitionFromId(e){if(e&&this._patterns[e]){const t=this._patterns[e];if(t)return t}return this._nullPattern}getVersion(){return this._version}};function ensureRadius(e){return e.map((({x:e,y:t,r:s=0})=>({x:e,y:t,r:s})))}var or=class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array(16)}register(e,{getDistanceFromStrokeVertically:t,getDistanceFromStrokeHorizontally:s,points:i,hole:r,isSimple:o}){if(this._byName[e])return;let a=o?1:8;const l=o?7:15;for(;this._byId[a];)a+=1;if(a>l)throw new Error("max number of shape exceeded");const d={id:a,name:e,getDistanceFromStrokeVertically:t,getDistanceFromStrokeHorizontally:s,points:ensureRadius(i.slice()),hole:r?ensureRadius(r.slice()):null,isSimple:!!o};return this._mustUpdate=!0,this._byId[a]=d,this._byName[e]=d,d}getIdFromName(e){return this._byName[e].id}getNameFromId(e){const t=this._byId[e];return t?t.name:""}getDefinitionFromName(e){return this._byName[e]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter((e=>e))}},ar=isLittleEndian(),lr="\n".charCodeAt(0),dr=class{constructor(e){this._patternManager=e,this._canvas=createCanvas(),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._processBidirectionalText=getRTLProcessors().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:Ji,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(e,t,s){setCtxFont(this._ctx,t,24,s);return this._ctx.measureText(e).width/24}_getAtlas(e,t,s,i){const r=s===Ks?0:s,o=this._byFont[e]||(this._byFont[e]={none:void 0,bold:void 0,italic:void 0,normal:void 0}),a=o[i]||(o[i]={}),l=a[t]||(a[t]=new Array(50));return l[r]||(l[r]=new Array(256))}_getMeasurementAtlas(e,t){const s=this._widthAtlases[t];return s[e]||(s[e]=new Array(256))}measureText(e,t,s,i=1){if(!t)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;const r=this._getMeasurementAtlas(t,s);let o=0,a=0,l=1;for(let i=0;i<e.length;++i){const d=e.charCodeAt(i);if(d===lr)a>o&&(o=a),a=0,l+=1;else{let o=r[d];void 0===o&&(o=this._measureChar(e[i],t,s),r[d]=o),a+=o}}return a>o&&(o=a),this._textDimensions.width=o*i,this._textDimensions.height=l*i,this._textDimensions}_getCharInfo(e,t,s,i,r,o){let a=e[t];if(!a){const l=String.fromCharCode(t);a={ratio:this._measureChar(l,s,i),patternId:0},a.patternId=this._patternManager.getIdFromDefinition({id:0,type:3,attributes:{text:l,font:s,style:i,size:r,align:o}}),e[t]=a}return a}storeTextInDataView(e,t,s,i){let r=t;if(i&&i.type===Ji){const{font:t,style:s,size:o,align:a}=i.attributes,l="center"===a,d=this._getAtlas(t,s,o,a);let h=0,u=1,c=0,m=0;const p=this._lineWidthList,y=this._processBidirectionalText(i.attributes.text);for(let e=0;e<y.length;++e){const i=y.charCodeAt(e);if(i===lr)c>h&&(h=c),p[m]=c,m++,c=0,u++;else{c+=this._getCharInfo(d,i,t,s,o,a).ratio}}p[m]=c,c>h&&(h=c),m=0;let x=-(l?p[m]:h)/2,b=(1-u)/2,v=0;for(let t=0;t<y.length;++t){const s=y.charCodeAt(t),i=d[s];if(s===lr)m+=1,x=-(l?p[m]:h)/2,b+=0===t?.5:1,v=0;else{const t=i.ratio,s=i.patternId;x+=(t+v)/2,v=t;const o=(clamp(1e3*x+65536,0,131071)<<8)+clamp(2*b+128,0,255);e.setUint16(r,s,ar),e.setUint32(r+2,o,ar),r+=6}}}this._fillWithZeros(e,r,s)}extractTextFromDataView(e,t,s){const i=e,r=ar,o=i.getUint16(t,r),a=this._textPattern,l=this._patternManager.getDefinitionFromId(o),{font:d,style:h,size:u,align:c}=l.attributes,m=this._getAtlas(d,h,u,c),p=[];let y=0,x=0,b=0,v=null;for(let e=t;e<s;e+=6){const t=i.getUint16(e,r);if(!t)break;const s=(i.getUint8(e+2)-128)/2,o=this._patternManager.getDefinitionFromId(t);if(!o||!o.attributes||!o.attributes.text)break;const a=o.attributes.text.charCodeAt(0),l=m[a];null===v?v=s:s>v&&(y>x&&(x=y),y=0,b+=1,p.push(lr),v=s),p.push(a),l&&(y+=l.ratio)}y>x&&(x=y);const E=String.fromCharCode.apply(null,p);return a.attributes.style=h,a.attributes.font=d,a.attributes.size=u,a.attributes.align=c,a.attributes.text=this._processBidirectionalText(E),a.dimensions&&(a.dimensions.width=x,a.dimensions.height=b),a}_fillWithZeros(e,t,s){for(let i=t;i<s;i+=6)e.setUint16(i,0)}_clear(){this._byFont={},this._widthAtlases={normal:{},bold:{},italic:{}}}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(value){value!==this._cornerRadius&&(this._cornerRadius=value,this._version++)}},hr=class extends is{constructor({bufferList:e,patternManager:t,boundariesManager:s,shapeManager:i,textManager:r,memoryManager:o}){super(),this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject={valid:!1,id:void 0,end:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},start:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},animation:{duration:0,beginTime:-1,easing:"linear"}},this._littleEndian=isLittleEndian(),this._bufferList=e,this._shapeManager=i,this._patternManager=t,this._boundariesManager=s,this._textManager=r,this._memoryManager=o}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}getDomElement(){return null}_initCanvas(e){e.style.touchAction="none"}export(e){return Promise.resolve()}extractElement(e,t){return this._memoryManager.extractGenericElement(e,t,this._scales)}_compareDimensions(e,t,s){return(e!==this._width||t!==this._height||s!==this._pixelRatio)&&(this._width=e,this._height=t,this._pixelRatio=s,!0)}_compareView(e,t,s,i){return(e!==this._viewX||t!==this._viewY||s!==this._viewZoom||i!==this._viewAngle)&&(this._viewX=e,this._viewY=t,this._viewZoom=s,this._viewAngle=i,this._viewAngleCos=Math.cos(i),this._viewAngleSin=Math.sin(i),!0)}_compareCurrentTime(e){return e!==this._currentTime&&(this._currentTime=e,!0)}_compareBackgroundColor(e,t){return(e!==this._backgroundColor||t!==this._renderBackground)&&(this._renderBackground=t,this._backgroundColor=e,this._backgroundRgba=parseColor(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(e){return this._isBufferDisplayable!==e&&(this._isBufferDisplayable=e,!0)}_compareHideImages(e){return this._hideImages!==e&&(this._hideImages=e,!0)}renderFrame({x:e,y:t,zoom:s,angle:i,width:r,height:o,pixelRatio:a,backgroundColor:l,currentTime:d,isBufferDisplayable:h,hideImages:u,renderBackground:c}){const m=this._compareShapes(),p=this._comparePatterns(),y=this._compareBoundaries(),x=this._compareTexts(),b=this._compareDimensions(r,o,a),v=this._compareView(e,t,s,i),E=this._compareCurrentTime(d),k=this._compareBackgroundColor(l,c),L=this._compareIsDisplayableBuffer(h),D=this._compareHideImages(u);if(y){const e=this._boundariesManager,t=this._scales;t.bytesToActualCoord=1,t.bytesToActualScaledSize=e.maxScaledSize/65535,t.bytesToActualMinVisibleSize=e.maxMinVisibleSize/15,t.bytesToActualSymbolicSize=e.maxSymbolicSize/un,t.bytesToActualDashLength=e.maxDashLength/3,t.bytesToActualGapLength=e.maxGapLength/3,t.bytesToActualPatternScale=e.maxPatternScale/un}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:m,patternsChanged:p,boundariesChanged:y,textsChanged:x,dimensionsChanged:b,viewChanged:v,currentTimeChanged:E,backgroundColorChanged:k,isBufferDisplayableChanged:L,isHideImagesChanged:D}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(e){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(e){}},ur=.024390243902439025,cr=class extends hr{constructor(e){super(e),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(e,t){let s=this._cachePoints[this._nextCachePoint++];return s||(s={x:0,y:0},this._cachePoints.push(s)),s.x=e,s.y=t,s}setViewportClipping(e){this._clipViewport=e}_displayBuffer(e){const t=e.getSize(),s=e.animated;for(let i=0;i<t;++i){const t=this.extractElement(e,i);t.valid&&this._displayElement(t,s)}}_mixAttributes(e,t,s){const i=computeAnimationRatio(this._currentTime,s.beginTime,s.duration,s.easing);return e.dashLength=lerp(t.dashLength,e.dashLength,i),e.gapLength=lerp(t.gapLength,e.gapLength,i),e.offsetAngle=lerp(t.offsetAngle,e.offsetAngle,i),e.opacity=lerp(t.opacity,e.opacity,i),e.globalMinVisibleSize=lerp(t.globalMinVisibleSize,e.globalMinVisibleSize,i),e.strokeMinVisibleSize=lerp(t.strokeMinVisibleSize,e.strokeMinVisibleSize,i),e.patternMinVisibleSize=lerp(t.patternMinVisibleSize,e.patternMinVisibleSize,i),e.symbolicSize=lerp(t.symbolicSize,e.symbolicSize,i),e.curvature=lerp(t.curvature,e.curvature,i),e.fillColor=mixColor(t.fillColor,e.fillColor,i,i),e.strokeColor=mixColor(t.strokeColor,e.strokeColor,i,i),e.patternColor=mixColor(t.patternColor,e.patternColor,i,i),e.x1=lerp(t.x1,e.x1,i),e.y1=lerp(t.y1,e.y1,i),e.x2=lerp(t.x2,e.x2,i),e.y2=lerp(t.y2,e.y2,i),e.rectWidthOrSourceRadiusScaled=lerp(t.rectWidthOrSourceRadiusScaled,e.rectWidthOrSourceRadiusScaled,i),e.rectWidthOrSourceRadiusFixed=lerp(t.rectWidthOrSourceRadiusFixed,e.rectWidthOrSourceRadiusFixed,i),e.rectHeightOrTargetRadiusScaled=lerp(t.rectHeightOrTargetRadiusScaled,e.rectHeightOrTargetRadiusScaled,i),e.rectHeightOrTargetRadiusFixed=lerp(t.rectHeightOrTargetRadiusFixed,e.rectHeightOrTargetRadiusFixed,i),e.thicknessOrFontSizeScaled=lerp(t.thicknessOrFontSizeScaled,e.thicknessOrFontSizeScaled,i),e.thicknessOrFontSizeFixed=lerp(t.thicknessOrFontSizeFixed,e.thicknessOrFontSizeFixed,i),e.strokeWidthScaled=lerp(t.strokeWidthScaled,e.strokeWidthScaled,i),e.strokeWidthFixed=lerp(t.strokeWidthFixed,e.strokeWidthFixed,i),e.offsetScaled=lerp(t.offsetScaled,e.offsetScaled,i),e.offsetFixed=lerp(t.offsetFixed,e.offsetFixed,i),e}_computeRenderInfo(e){const t=this._viewZoom,s=this._point(e.x1,e.y1),i=this._point(e.x2,e.y2);return{shape:this._shapeManager.getDefinitionFromName(e.shape),pieceId:e.pieceId,dashLength:e.dashLength,gapLength:e.gapLength,hasHead:e.hasHead,hasTail:e.hasTail,isBodyTriangle:e.isBodyTriangle,isSelfLoop:e.isSelfLoop,patternScale:e.patternScale,offsetAngle:formatAngle(e.offsetAngle),isText:e.isText,adjustTextAngle:e.adjustTextAngle,isBadge:e.isBadge,unusedFlag2:e.unusedFlag2,unusedFlag3:e.unusedFlag3,opacity:e.opacity,globalMinVisibleSize:e.globalMinVisibleSize,strokeMinVisibleSize:e.strokeMinVisibleSize,patternMinVisibleSize:e.patternMinVisibleSize,symbolicSize:0===e.symbolicSize?1/0:e.symbolicSize*t,curvature:e.curvature,pattern:e.pattern,fillColor:e.fillColor,strokeColor:e.strokeColor,patternColor:e.patternColor,pos1OnGraph:s,pos2OnGraph:i,pos1:this._graphToScreenCoordinates(s),pos2:this._graphToScreenCoordinates(i),rectWidthOrSourceRadius:e.rectWidthOrSourceRadiusScaled*t+e.rectWidthOrSourceRadiusFixed,rectHeightOrTargetRadius:e.rectHeightOrTargetRadiusScaled*t+e.rectHeightOrTargetRadiusFixed,thicknessOrFontSize:e.thicknessOrFontSizeScaled*t+e.thicknessOrFontSizeFixed,strokeWidth:e.strokeWidthScaled*t+e.strokeWidthFixed,offset:e.offsetScaled*t+e.offsetFixed}}_applyBackgroundBlending(e){1!==e.opacity&&(e.fillColor=this._blendColor(e.fillColor,e.opacity),e.strokeColor=this._blendColor(e.strokeColor,e.opacity),e.textColor=this._blendColor(e.textColor,e.opacity))}_pointArray(e){let t=this._pointCopies[e];if(!t){t=new Array(e),this._pointCopies[e]=t;for(let s=0;s<e;++s)t[s]={x:0,y:0,r:0}}return t}_scalePoints(e,t,s,i){const r=e.shape.points.length,o=this._pointArray(r);for(let a=0;a<r;++a){const r=e.shape.points[a],l=o[a];l.x=t.x+r.x*s,l.y=t.y+r.y*i,l.r=r.r*s}const a=e.pos2OnGraph.x-e.pos1OnGraph.x,l=e.pos2OnGraph.y-e.pos1OnGraph.y;if(0!==a||0!==l){const e=Math.sqrt(a*a+l*l),s=a/e,i=l/e;for(const e of o){const r=e.x-t.x,o=e.y-t.y;e.x=t.x+s*r+i*o,e.y=t.y-i*r+s*o}}return o}_drawPoints(e,t=!1){1===e.length?this._drawCircle(e[0],e[0].r):this._drawPolygon(e,t)}_computeCenter(e){const t=Math.cos(e.offsetAngle),s=Math.sin(e.offsetAngle),i=(e.pos1.x+e.pos2.x)/2+t*e.offset,r=(e.pos1.y+e.pos2.y)/2+s*e.offset;return this._point(i,r)}_displayTextBox(e,t,s,i){const r=this._computeCenter(e),o=e.rectWidthOrSourceRadius/2,a=e.rectHeightOrTargetRadius/2;(t||i)&&this._drawRoundedRectangle(r,o,a,0,e.fillColor)}_displayNodeComponent(e,t,s,i){const r=this._computeCenter(e);if(e.pattern.type!==Ji){const o=e.rectWidthOrSourceRadius/2,a=e.rectHeightOrTargetRadius/2,l=this._scalePoints(e,r,o,a);if((t||i)&&this._drawPoints(l,!0),t&&this._fill(e.fillColor),i){if(this._startClip(),e.pattern.type===Zi){let t=e.pattern.attributes.colorArray;1!==e.opacity&&(t=t.map((t=>this._blendColor(t,e.opacity)))),this._displayPieChart(r,o,t)}else if(e.pattern.type===Qi||e.pattern.type===Ki){const t=0,s=Math.round(e.rectHeightOrTargetRadius*e.patternScale),i=e.pattern.attributes.text,o=e.patternColor,a=e.pattern.attributes.font,l=e.pattern.attributes.style,d=e.pattern.attributes.align,h=e.rectWidthOrSourceRadius,u=e.pattern.attributes.paddingTop,c=e.pattern.attributes.paddingLeft;this._displayText(r,t,i,o,a,s,l,d,h,c,u,!0)}else if(e.pattern.type===Yi){const t=e.pattern.attributes.image;if(t.isDummy||t.width&&t.height){const s=e.pattern.attributes.duplicated,i=s?1:e.patternScale,o=e.rectWidthOrSourceRadius*i,a=e.rectHeightOrTargetRadius*i,l=e.pattern.attributes.scaled,d=e.opacity;this._displayImage(r,o,a,t,l,s,d)}}this._endClip()}if(s){const t=e.strokeWidth/2,s=this._scalePoints(e,r,o+t,a+t);this._drawPoints(s),this._stroke(e.strokeColor,e.strokeWidth)}}else if(i){const t=0,s=e.thicknessOrFontSize,i=e.pattern.attributes.text,o=e.patternColor,a=e.pattern.attributes.font,l=e.pattern.attributes.style,d=e.pattern.attributes.align,h=e.rectWidthOrSourceRadius;this._displayText(r,t,i,o,a,s,l,d,h,0,0,!1)}}_displayElement(e,t){if(!e.end||!e.end.shape||!e.end.pieceId)return;if(t&&(!e.start||!e.animation))return;this._resetCachePoints();const s=t?this._mixAttributes(e.end,e.start,e.animation):e.end,i=this._computeRenderInfo(s);if(i.symbolicSize<i.globalMinVisibleSize||0===i.opacity)return;this._applyBackgroundBlending(i);const r=!!(i.strokeColor&&i.strokeWidth>0&&i.symbolicSize>=i.strokeMinVisibleSize),o=!!(1!==i.pattern.type&&i.symbolicSize>=i.patternMinVisibleSize),a=!!i.fillColor;if(i.pieceId===en)return this._displayNodeComponent(i,a,r,o);if(i.pieceId===on)return this._displayTextBox(i,a,r,o);const l=i.pos2.x-i.pos1.x,d=i.pos2.y-i.pos1.y,h=Math.sqrt(l*l+d*d);let u,c=null,m=null;if(i.isSelfLoop){const e=i.pieceId===rn||i.pieceId===rn+on?i.strokeWidth/2:i.rectWidthOrSourceRadius,{x1:t,y1:s,x2:r,y2:o}=this._getSelfLoopControlPoints(i.pos1,i.curvature,e);c=this._point(t,s),m=this._point(r,o),u=function getSelfLoopSegmentLengthApprox(e,t,s,i,r){const o=(e.x+t.x+s.x)/3,a=(e.y+t.y+s.y)/3,l=o-t.x,d=a-t.y,h=t.x-s.x,u=t.y-s.y,c=l*l+d*d,m=(h*h+u*u)/4,p=Math.sqrt(c-m);return 1.9442*p*3.14159265359*r}(i.pos1,c,m,i.pos2,1)}else i.curvature?(c=this._getQuadraticCurveControlPoint(i),u=function getQuadraticSegmentLength(e,t,s){const i=Math.abs(e)/An+Ii,r=i*i,o=s-.5,a=o*o,l=1/(16*r),d=Math.sqrt(a+l),h=.5/i*Math.sqrt(r+.25);return Math.abs(2*i)*(o*d+.5*h+l*Math.log(Math.abs((o+d)/(-.5+h))))*t}(i.curvature,h,1)):u=h;if(i.pieceId===rn||i.pieceId===rn+on){const e=i.strokeWidth,t=this._getPointOnLine(i.pos1,c,m,i.pos2,.5),s=this._getTangentOnLine(i.pos1,c,m,i.pos2,.5);if(i.rectWidthOrSourceRadius>=u-e&&!i.isSelfLoop){if(!i.adjustTextAngle)return;s.x=1,s.y=0}let r=-Math.atan2(s.y,s.x);const o=formatAngle(i.offsetAngle-r);(!i.isSelfLoop&&o<0||i.isSelfLoop&&i.offsetAngle<0)&&(s.x*=-1,s.y*=-1),(r>Math.PI/2||r<-Math.PI/2)&&(r+=Math.PI);const a=this._getOrthogonal(s),l=t.x+a.x*i.offset,d=t.y+a.y*i.offset;if(i.fillColor){const e=i.rectWidthOrSourceRadius/2,t=i.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(l,d),e,t,o+Math.PI/2,i.fillColor)}else{const e=this._point(l,d),t=r,s=i.thicknessOrFontSize,o=i.pattern.attributes.text,a=i.patternColor,h=i.pattern.attributes.font,u=i.pattern.attributes.style,c=i.pattern.attributes.align,m=i.rectWidthOrSourceRadius;this._displayText(e,t,o,a,h,s,u,c,m,0,0,!1)}}else{const e=i.pieceId===sn,t=i.pieceId===nn,s=Math.cos(i.offsetAngle),o=Math.sin(i.offsetAngle);i.pos1.x+=s*i.offset,i.pos1.y+=o*i.offset,i.pos2.x+=s*i.offset,i.pos2.y+=o*i.offset;const p="line"===i.shape.name,y=i.thicknessOrFontSize,x=i.rectWidthOrSourceRadius,b=i.rectHeightOrTargetRadius,v=+i.hasHead,E=+i.hasTail,k=+i.isBodyTriangle,L=v+E,D=function computeArrowLength(e){return 3*e}(y),B=v*D,H=E*D,X=i.isSelfLoop?1/0:h-x-b,Y=Math.min(X/L,D),Z=E*(D+Math.max(x+Y-H,0))+(1-E)*k*x,oe=v*(D+Math.max(b+Y-B,0))+(1-v)*k*b;if(e||t){const s=t?-1:1,o=(e?u-oe:Z)-s;let p=null,y=null;if(i.isSelfLoop&&c&&m){const e=this._getTFromLengthOnCubicCurve(i.pos1,c,m,i.pos2,o-i.strokeWidth/2*s);p=this._getPointOnCubicCurve(i.pos1,c,m,i.pos2,e),y=this._getTangentOnCubicCurve(i.pos1,c,m,i.pos2,e)}else if(i.curvature&&c){const e=this._getTFromLengthOnQuadraticCurve(i.pos1,c,i.pos2,o-i.strokeWidth/2*s);p=this._getPointOnQuadraticCurve(i.pos1,c,i.pos2,e),y=this._getTangentOnQuadraticCurve(i.pos1,c,i.pos2,e)}else{const e=o/u;p=this._mixPoints(i.pos1,i.pos2,e),y=this._point(l/h,d/h)}if(y.x*=s,y.y*=s,a){if(i.shape.hole){const e=this._makeEdgeExtremityPoints(p,y,D,i.shape.hole);this._drawPoints(e),this._startReverseClip()}const e=this._makeEdgeExtremityPoints(p,y,D,i.shape.points);this._drawPoints(e),this._fill(i.fillColor),i.shape.hole&&this._endReverseClip()}if(r){if(i.shape.hole){const e=this._makeEdgeExtremityPoints(p,y,D,i.shape.hole);this._drawPoints(e),this._stroke(i.strokeColor,i.strokeWidth)}const e=D+i.strokeWidth/2,t=this._makeEdgeExtremityPoints(p,y,e,i.shape.points);this._drawPoints(t),this._stroke(i.strokeColor,i.strokeWidth)}}else{if(u-Z-oe<=0)return;if(p){const e=function computeLineDash(e,t,s,i,r,o){const a=[];s&&a.push(0,s);if(r&&o){const l=r*t,d=o*t,h=l+d,u=e-i-s-h;let c=0;for(;c<u;)a.push(l,d),c+=h;const m=e-i-s-c,p=Math.min(l,m),y=Math.max(m-p,0);a.push(p,y)}else a.push(e-i-s,0);i&&a.push(0,i);return a}(u,y,Z,oe,i.dashLength,i.gapLength);r&&(this._drawLine(i.pos1,c,m,i.pos2),this._stroke(i.strokeColor,y+2*i.strokeWidth,e)),a&&(this._drawLine(i.pos1,c,m,i.pos2),this._stroke(i.fillColor,y,e))}else{const e=Z,t=u-oe;if(r){const s=this._makeTriangleEdgeBody(i.pos1,c,m,i.pos2,e,t,y+i.strokeWidth/2,i.strokeWidth/2);this._drawPoints(s),this._stroke(i.strokeColor,i.strokeWidth)}if(a){const s=this._makeTriangleEdgeBody(i.pos1,c,m,i.pos2,e,t,y,0);this._drawPoints(s),this._fill(i.fillColor)}}}}}_makeTriangleEdgeBody(e,t,s,i,r,o,a,l){return t?s?this._makeSelfLoopTriangleEdge(e,t,s,i,r,o,a,l):this._makeCurveTriangleEdge(e,t,i,r,o,a,l):this._makeStraightTriangleEdge(e,i,r,o,a,l)}_makeCurveTriangleEdge(e,t,s,i,r,o,a){const l=this._pointArray(84),d=this._getTFromLengthOnQuadraticCurve(e,t,s,i),h=(this._getTFromLengthOnQuadraticCurve(e,t,s,r)-d)/vn,u=(a-o)/vn/2;let c=o/2,m=d;for(let i=0;i<=vn;++i){const r=this._getPointOnQuadraticCurve(e,t,s,m),o=this._getTangentOnQuadraticCurve(e,t,s,m),a=this._getOrthogonal(o),d=a.x*c,p=a.y*c,y=l[i],x=l[83-i];y.x=r.x+d,y.y=r.y+p,x.x=r.x-d,x.y=r.y-p,m+=h,c+=u}return l}_makeSelfLoopTriangleEdge(e,t,s,i,r,o,a,l){const d=this._pointArray(84),h=this._getTFromLengthOnCubicCurve(e,t,s,i,r),u=(this._getTFromLengthOnCubicCurve(e,t,s,i,o)-h)/vn,c=(l-a)/vn/2;let m=a/2,p=h;for(let r=0;r<=vn;++r){const o=this._getPointOnCubicCurve(e,t,s,i,p),a=this._getTangentOnCubicCurve(e,t,s,i,p),l=this._getOrthogonal(a),h=l.x*m,y=l.y*m,x=d[r],b=d[83-r];x.x=o.x+h,x.y=o.y+y,b.x=o.x-h,b.y=o.y-y,p+=u,m+=c}return d}_makeStraightTriangleEdge(e,t,s,i,r,o){const a=t.x-e.x,l=t.y-e.y,d=Math.sqrt(a*a+l*l),h=this._point(a/d,l/d),u=this._getOrthogonal(h),c=r/2,m=o/2,p=this._pointArray(4),y=p[0],x=p[1],b=p[2],v=p[3],E=e.x+h.x*s,k=e.y+h.y*s,L=e.x+h.x*i,D=e.y+h.y*i,B=u.x*c,H=u.y*c,X=u.x*m,Y=u.y*m;return y.x=E+B,y.y=k+H,x.x=E-B,x.y=k-H,b.x=L-X,b.y=D-Y,v.x=L+X,v.y=D+Y,p}_makeEdgeExtremityPoints(e,t,s,i){const r=this._pointArray(i.length),o=s/2,a=e.x+t.x*o,l=e.y+t.y*o,d=t.x,h=t.y;for(let e=0;e<i.length;++e){const t=i[e],s=r[e],u=(d*t.x-h*t.y)*o,c=(h*t.x+d*t.y)*o;s.x=a+u,s.y=l+c,s.r=t.r*o}return r}_drawLine(e,t,s,i){t?s?this._drawCubicCurve(e,t,s,i):this._drawQuadraticCurve(e,t,i):this._drawStraightLine(e,i)}_getSelfLoopControlPoints(e,t,s){return getSelfLoopControlPoints(e.x,e.y,t,s,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(e){return getQuadraticCurveControlPoint(e.pos1.x,e.pos1.y,e.pos2.x,e.pos2.y,e.curvature,this._point(0,0))}_graphToScreenCoordinates(e){const t=this._width/2,s=this._height/2,i=(e.x-this._viewX)*this._viewZoom,r=(e.y-this._viewY)*this._viewZoom,o=this._viewAngleCos,a=this._viewAngleSin,l=o*i+a*r+t,d=-a*i+o*r+s;return this._point(l,d)}_blendColor(e,t){return e&&this._backgroundColor?mixColor(this._backgroundColor,e,t,1):null}_getTangentOnLine(e,t,s,i,r){return t?s?this._getTangentOnCubicCurve(e,t,s,i,r):this._getTangentOnQuadraticCurve(e,t,i,r):this._getTangentOnStraightLine(e,i)}_getTangentOnStraightLine(e,t){const s=t.x-e.x,i=t.y-e.y,r=Math.sqrt(s*s+i*i);return this._point(s/r,i/r)}_getTangentOnQuadraticCurve(e,t,s,i){const r=1-i,o=r*t.x+i*s.x-(r*e.x+i*t.x),a=r*t.y+i*s.y-(r*e.y+i*t.y),l=Math.sqrt(o*o+a*a);return this._point(o/l,a/l)}_getTangentOnCubicCurve(e,t,s,i,r){const o=1-r,a=o*o,l=r*r,d=a*(t.x-e.x)+2*o*r*(s.x-t.x)+l*(i.x-s.x),h=a*(t.y-e.y)+2*o*r*(s.y-t.y)+l*(i.y-s.y),u=Math.sqrt(d*d+h*h);return this._point(d/u,h/u)}_mixPoints(e,t,s){const i=lerp(e.x,t.x,s),r=lerp(e.y,t.y,s);return this._point(i,r)}_getOrthogonal(e){return this._point(-e.y,e.x)}_getPointOnLine(e,t,s,i,r){return t?s?this._getPointOnCubicCurve(e,t,s,i,r):this._getPointOnQuadraticCurve(e,t,i,r):this._mixPoints(e,i,r)}_getPointOnQuadraticCurve(e,t,s,i){const r=quadraticEquation(e.x,t.x,s.x,i),o=quadraticEquation(e.y,t.y,s.y,i);return this._point(r,o)}_getPointOnCubicCurve(e,t,s,i,r){const o=cubicEquation(e.x,t.x,s.x,i.x,r),a=cubicEquation(e.y,t.y,s.y,i.y,r);return this._point(o,a)}_getTFromLengthOnCubicCurve(e,t,s,i,r){let o=e.x,a=e.y,l=0,d=0;for(let h=0;h<vn;++h){l+=ur;const h=cubicEquation(e.x,t.x,s.x,i.x,l),u=cubicEquation(e.y,t.y,s.y,i.y,l),c=h-o,m=u-a,p=Math.sqrt(c*c+m*m),y=d+p;if(y>r){return l-ur*((y-r)/p)}d=y,o=h,a=u}return 1}_getTFromLengthOnQuadraticCurve(e,t,s,i){let r=e.x,o=e.y,a=0,l=0;for(let d=0;d<vn;++d){a+=ur;const d=quadraticEquation(e.x,t.x,s.x,a),h=quadraticEquation(e.y,t.y,s.y,a),u=d-r,c=h-o,m=Math.sqrt(u*u+c*c),p=l+m;if(p>i){return a-ur*((p-i)/m)}l=p,r=d,o=h}return 1}};var gr={0:{min:"NEAREST",mag:"NEAREST",mipmap:!1},1:{min:"LINEAR",mag:"LINEAR",mipmap:!1},2:{min:"LINEAR",mag:"LINEAR",mipmap:!1},3:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},mr={0:"ALPHA",1:"RGBA"};function roundToPatternUnitSize(value){return Math.ceil((value+2*fn)/pn)*pn}function setPositionOnCanvas(e,t,s,i,r){for(let o=0,a=e.length;o<a;++o){const a=e[o],l=a.x,d=a.y,h=l+i,u=d+r;let c=h<s&&u<s;if(c)for(let e=l;e<h;++e)if(1===t[e+d*s]){c=!1;break}if(c)for(let e=d;e<u;++e)if(1===t[l+e*s]){c=!1;break}if(c){for(let e=l;e<h;++e)for(let i=d;i<u;++i)t[e+i*s]=1;return e.splice(o,1),e.push({x:l,y:u},{x:h,y:d}),a}}return null}function writePatternMetaData(e,t,s,i,r,o,a){const l=4*e,d=t>>1<<7,h=t%2<<7;a[l]=s/pn,a[l+1]=i/pn,a[l+2]=d+r/pn,a[l+3]=h+o/pn}function copyPixelsOnTexture(e,t,s,i,r,o,a){i|=0,r|=0,o|=0,a|=0,t|=0;for(let l=0;l<o;++l)for(let d=0;d<a;++d){const a=4*(i+l+(r+d)*t),h=4*(l+d*o);e[a]=s[h],e[a+1]=s[h+1],e[a+2]=s[h+2],e[a+3]=s[h+3]}}function getApproxTextureSize(e,t){let s=0,i=4;for(let t=0;t<e.length;++t){const{width:r,height:o}=e[t],a=roundToPatternUnitSize(r),l=roundToPatternUnitSize(o);s+=a*l,i=Math.max(i,Math.max(a,l))}const r=nextPowerOfTwo(Math.max(i,Math.sqrt(s)));return Math.min(r,t)}function adjustDimension(e,t){return Math.floor((t-e)/2)}function setupTexture(e,t,s,i,r,o,a){const{min:l,mag:d,mipmap:h}=gr[o],u=e[mr[a]];if(0===a){const e=new Uint8Array(r*r);for(let t=0;t<e.length;++t)e[t]=i[4*t+3];i=e}e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,u,r,r,0,u,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[d]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[l]),h&&e.generateMipmap(e.TEXTURE_2D)}function fillAtlas(e,t,s,i,r){const o=new Uint8Array(s*s*4),a=Math.ceil(s/pn),l=new Uint8Array(a*a),d=[{x:0,y:0}];for(let h=0;h<t.length;++h){const u=t[h],c=u.id,m=roundToPatternUnitSize(u.width)/pn,p=roundToPatternUnitSize(u.height)/pn,y=setPositionOnCanvas(d,l,a,m,p);if(y){const t=u.width,i=u.height,a=u.pixels,l=m*pn,d=p*pn,h=y.x*pn+adjustDimension(t,l),x=y.y*pn+adjustDimension(i,d);copyPixelsOnTexture(o,s,a,h,x,t,i),writePatternMetaData(c,e,h,x,l,d,r)}else{if(s<i)return fillAtlas(e,t,2*s,i,r);$warn(`exceeded max WebGL texture size of ${i}; some texts/icons/images won't be displayed`),writePatternMetaData(c,e,0,0,0,0,r)}}return{texture:o,size:s}}function writeShapeOnPixels(e,t,s,i){const{getDistanceFromStrokeVertically:r,getDistanceFromStrokeHorizontally:o}=e,a=t*(1-s)/2,l=(t-1)/2;for(let e=0;e<t;++e)for(let s=0;s<t;++s){const d=4*(s*t+e),h=(e-l)/a,u=(s-l)/a,c=clamp(r(h,u),-1,1),m=clamp(o(h,u),-1,1);writeDistanceToPixel(i,d,formatShapeDistance(c),formatShapeDistance(m))}}function formatShapeDistance(value){return 32768*((value+1)/2)}function writeDistanceToPixel(e,t,s,i){e[t]=s>>8,e[t+1]=s%256,e[t+2]=i>>8,e[t+3]=i%256}function forEachPieSlice(e,t){let s=-Math.PI/2;const i=2*Math.PI/e.length;for(const r of e){const e=s+i;t(r,s,e),s=e}}function drawPieChart(e,t,s,i,r){forEachPieSlice(t,((t,o,a)=>{e.beginPath(),e.moveTo(s,i),e.arc(s,i,r,o,a),e.fillStyle=t,e.fill()}))}var _r=!createCanvas().__dummy,pr=!1;try{pr=!!createSvgElement("svg")}catch(e){}var fr="none",yr={left:"start",center:"middle",right:"end"},xr="data-element-id",br="data-text-component";function secureNumber(e){return Math.round(1e3*e)/1e3}function createSvgImage(e,t,s,i,r,o){const a=createSvgElement("image");return a.setAttribute("width",secureNumber(i)),a.setAttribute("height",secureNumber(r)),a.setAttribute("x",secureNumber(t)),a.setAttribute("y",secureNumber(s)),a.setAttribute("href",e),o&&o.appendChild(a),a}var vr=class{constructor({gl:e,ext:t,staticProgram:s,animationProgram:i}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=e,this._ext=t,this._staticProgram=s,this._animationProgram=i,this._glBuffer=this._gl.createBuffer()}setDataBuffer(e){this._dataBuffer!==e&&(this._program=e.animated?this._animationProgram:this._staticProgram,this._dataBuffer=e,this._dataBufferChanged=!0,e.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!e.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){const e=this._gl,t=this._dataBuffer.type,s=2===t,i=s?this._dataBuffer.getNbSideElementsPerMainElement():1,r=3===t?vn:1,o=this._dataBuffer.getSize(),a=this._dataBuffer.stencilUsage,l=this._dataBuffer.version,d=this._version!==l||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:d?this._dataBuffer.getByteArray():null,divisor:i}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:d&&s?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(a),d&&(this._version=l,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(e.TRIANGLES,0,6*r,o*i)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}},Ar={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},Sr={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},Er=class{constructor({gl:e,ext:t,specialGlBuffers:s,metaData:i,programWrapper:r}){this._stencilUsage=1,this._gl=e,this._ext=t,this._specialGlBuffers=s,this._metaData=deepCopy(i),this._programWrapper=r}_finishInit(){const e=this._gl,t=this._ext,s=this._programWrapper.getError();if(s)throw new Error(`WebGL compilation at step "${s.step}:\n${s.message}"`);const i=this._programWrapper.getProgram();this._program=i,e.useProgram(i),this._metaData.attributes.forEach((t=>{t.location=e.getAttribLocation(this._program,t.name),t.byteSize=t.size*Ar[t.type],t.glType=Sr[t.type]})),this._specialAttributes=this._createSpecialAttributesFunctions();const r=[],o=[];for(const e of this._metaData.attributes)-1!==e.location&&(e.name.startsWith("a_text")?o.push(e):r.push(e));this._baseAttributes=createAttributes(r,e,t),this._textAttributes=createAttributes(o,e,t),this._setupUniforms=function createUniforms(e,t,s){const i={};for(let r=0;r<e.length;++r){const{id:o,name:a}=e[r],l=t.getUniformLocation(s,a);l&&(i[o]=l)}return(t,s)=>{for(let r=0;r<e.length;++r){const{id:o,type:a}=e[r],l=i[o],d=s[o];if(l)switch(a){case"int":case"sampler2D":t.uniform1i(l,d);break;case"float":t.uniform1f(l,d);break;case"vec2":t.uniform2f(l,d[0],d[1]);break;case"vec3":t.uniform3f(l,d[0],d[1],d[2]);break;case"vec4":t.uniform4f(l,d[0],d[1],d[2],d[3])}}}}(this._metaData.uniforms,e,i)}_createSpecialAttributesFunctions(){return createAttributes([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(e){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,e),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(e,{glBuffer:t,dataBuffer:s,divisor:i}){e.enabled&&!t?e.disable(this._gl):!e.enabled&&t&&e.enable(this._gl),t&&e.setup(t,s,i)}setupBaseAttributes(e){this._setupAttributes(this._baseAttributes,e)}setupTextAttributes(e){this._setupAttributes(this._textAttributes,e)}_resetStencil(){const e=this._gl;this._stencilUsage=1,e.disable(e.STENCIL_TEST)}setupStencil(e){if(e!==this._stencilUsage){const t=this._gl;1!==e?(t.enable(t.STENCIL_TEST),2===e?(t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),t.stencilFunc(t.ALWAYS,1,1)):3===e&&(t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilFunc(t.EQUAL,0,1))):t.disable(t.STENCIL_TEST),this._stencilUsage=e}}endPass(){const e=this._gl;this._specialAttributes.disable(e),this._baseAttributes.disable(e),this._textAttributes.disable(e)}};function createSetupAttributesFunction(e,t,s){return(i,r,o)=>{let a=0,l=0;for(let t=0;t<e.length;t++)l+=e[t].byteSize;t.bindBuffer(t.ARRAY_BUFFER,i),r&&t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW);for(let i=0;i<e.length;i++){const{location:r,size:d,glType:h,byteSize:u}=e[i];t.vertexAttribPointer(r,d,t[h],!1,l,a),a+=u,s.vertexAttribDivisorANGLE(r,o)}}}function createAttributes(e,t,s){const i=function createEnableAttributesFunction(e){return t=>{for(let s=0;s<e.length;s++){const i=e[s].location;t.enableVertexAttribArray(i)}}}(e),r=function createDisableAttributesFunction(e){return t=>{for(let s=0;s<e.length;++s){const i=e[s].location;t.disableVertexAttribArray(i)}}}(e);return{enable(e){i(e),this.enabled=!0},disable(e){r(e),this.enabled=!1},setup:createSetupAttributesFunction(e,t,s),enabled:!1}}var wr="#define D3D9_FIX 0\nprecision highp float;\nprecision mediump int;\nuniform vec3 u_backgroundColor;\nuniform sampler2D u_patternNearestTexture;\nuniform sampler2D u_patternLinearTexture;\nuniform sampler2D u_patternLinearSdfTexture;\nuniform sampler2D u_patternMipmapTexture;\nuniform sampler2D u_shapeTexture;\nvarying vec4 dn;\nvarying vec4 dp;\nvarying vec4 dq;\nvarying vec2 dr;\nvarying vec2 ds;\nvarying vec4 ei;\nvarying float dt;\n#if D3D9_FIX\n#else\nvarying float dy;\nvarying vec2 dz;\nvarying vec2 ea;\nvarying vec2 eb;\nvarying float ec;\nvarying float ed;\nvarying vec2 ee;\nvarying vec2 ef;\nvarying float eg;\nvarying float eh;\n#endif\nconst float FILTER_NEAREST = 0.0;\nconst float FILTER_LINEAR = 0.0;\nconst float FILTER_LINEAR_SDF = 0.0;\nconst float FILTER_MIPMAP = 0.0;\nconst float SDF_GAMMA = 0.0;\nconst float EPSILON = 0.000000001;\nconst float SDF_BUFFER = (256.0 - 64.0) / 256.0; \nvec4 aaq(in vec4 ue, in vec4 aar) {\nfloat aas = aar.a;\nfloat aat = ue.a + EPSILON;\nfloat aau = min(aas + aat, 1.0);\nfloat r = aas / aau;\nreturn vec4(mix(ue.rgb, aar.rgb, r), aau);\n}\nfloat aav(in float aaw, in float fp) {\nfloat aax = (aaw * 256.0 + fp) * 256.0;\nfloat aay = aax / 32768.0;\nreturn aay * 2.0 - 1.0;\n}\nbool mn(float ml, float mm) {\nreturn abs(ml - mm) < EPSILON;\n}\nfloat aaz(float ma) {\nfloat abc = 2.;\nvec2 wi = abs(dq.rg) - dq.ba - vec2(abc) + vec2(ma);\nfloat es = min(max(wi.x, wi.y), 0.0) + length(max(wi, 0.0)) - ma;\nreturn smoothstep(0.1, .5, (1. - es) / 10.);\n}\nvoid main() {\n#if D3D9_FIX\n#else\nfloat abd = eb.x;\nfloat abe = eb.y;\nfloat abf = ee.x;\nfloat abg = ee.y;\n#endif\nvec4 of = texture2D(u_shapeTexture, dr);\nfloat abh = aav(of.b, of.a) * ef.x;\nfloat abi = aav(of.r, of.g) * ef.y;\nfloat ze = float(ei.z > EPSILON);\nfloat ti = float(ei.w > EPSILON);\nfloat abn = 1. - smoothstep(\n0.01,\n0.25760,\ndistance(ei.xy * ei.z - vec2(0.0586), dr * ei.z)\n);\nabn = abn *2.5 -1.5;\nabn *= 0.5;\nabn *= ef.x;\nfloat abo = aaz(dt) ;\nvec4 hj = dn;\nvec4 hk = dp;\nif (eh > -EPSILON) {\nvec2 ip = ds;\nfloat abu =\nstep(dz.x, ip.x) *\nstep(ip.x, ea.x) *\nstep(dz.y, ip.y) *\nstep(ip.y, ea.y);\nfloat abv = abu;\nvec4 hl;\nif (mn(eh, FILTER_NEAREST)) {\nhl = texture2D(u_patternNearestTexture, ip);\n} else if (mn(eh, FILTER_LINEAR)) { \nhl = texture2D(u_patternLinearTexture, ip);\n} else if (mn(eh, FILTER_LINEAR_SDF)) { \nhl = texture2D(u_patternLinearSdfTexture, ip);\nhl.a = smoothstep(SDF_BUFFER - eg, SDF_BUFFER + eg, hl.a);\n} else if (mn(eh, FILTER_MIPMAP)) { \nhl = texture2D(u_patternMipmapTexture, ip);\n}\nhl.rgb += dq.rgb;\nhl.a *= abv;\nhj = aaq(hj, hl);\n}\nfloat aca = (1. - ze) * min(abh, abi)\n+ ze * abn;\naca = (1. - ti) * aca + ti * abo;\nfloat acj = clamp(aca, 0.0, 1.0);\nfloat acm = clamp(aca - dy, 0.0, 1.0);\nfloat acn = acj - acm;\nacn = 1.0 - clamp(aca - dy, 0.0, 1.0);\nhj.a *= acm;\nhk.a *= acn * step(EPSILON, dy);\nvec4 acq = aaq(hj, hk);\nfloat acr = acj;\nacq.rgb = mix(u_backgroundColor, acq.rgb, abd);\nif (ed > EPSILON) {\nfloat adc = fract(abg) * ed;\nfloat add = clamp(min(adc, abf - adc), 0.0, 1.0);\nacr *= add;\n}\nif (ec < 0.0 || ec > 1.0 || acr < EPSILON\n|| (ze > EPSILON && acj < 0.5)) {\ndiscard;\n}\nacq.a *= acr;\nacq.rgb *= acq.a;\ngl_FragColor = acq;\n}\n",Tr="#define D3D9_FIX 0\n#define ANIMATED 0\nprecision highp float;\nprecision mediump int;\nattribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;\nattribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;\nattribute /*float*/ vec4 a_final_x1_y1_x2_y2;\nattribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;\nattribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;\nattribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;\nattribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;\nattribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;\nattribute /*float*/ vec4 a_prev_x1_y1_x2_y2;\nattribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;\nattribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;\nattribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;\nattribute /*float*/ vec2 a_animationBeginTime_animationDuration; \nattribute /*ushort*/ vec4 a_animationEasing; \nattribute /*ushort*/ vec3 a_text_charId_charOffsetXY; \nattribute vec3 a_vertexInfo;\nuniform float u_viewWidth;\nuniform float u_viewHeight;\nuniform float u_viewX;\nuniform float u_viewY;\nuniform float u_viewAngle;\nuniform float u_viewZoom;\nuniform float u_currentTime;\nuniform float u_pixelRatio;\nuniform sampler2D u_patternInfoTexture;\nvarying vec4 dn;\nvarying vec4 dp;\nvarying vec4 dq;\nvarying vec2 dr;\nvarying vec2 ds;\nvarying float dt;\n#if D3D9_FIX\n#else\nvarying float dy;\nvarying vec2 dz;\nvarying vec2 ea;\nvarying vec2 eb;\nvarying float ec;\nvarying float ed;\nvarying vec2 ee;\nvarying vec2 ef;\nvarying float eg;\nvarying float eh;\n#endif\nvarying vec4 ei;\nconst float EPSILON = 0.000001;\nconst float INFINITY = 10000000.0;\nconst float PI = 3.14159265359;\nconst float P2_17 = 131072.0;\nconst float P2_16 = 65536.0;\nconst float P2_14 = 32768.0;\nconst float P2_12 = 4096.0;\nconst float P2_8 = 256.0;\nconst float P2_7 = 128.0;\nconst float P2_6 = 64.0;\nconst float P2_5 = 32.0;\nconst float P2_4 = 16.0;\nconst float P2_3 = 8.0;\nconst float P2_2 = 4.0;\nconst float P2_1 = 2.0;\nconst float MAX_PROGRESS = 1.0;\nuniform float BYTES_TO_COORD;\nuniform float BYTES_TO_SCALED_SIZE;\nuniform float BYTES_TO_MIN_VISIBLE_SIZE;\nuniform float BYTES_TO_SYMBOLIC_SIZE;\nuniform float BYTES_TO_CURVATURE;\nuniform float BYTES_TO_DASH_LENGTH;\nuniform float BYTES_TO_GAP_LENGTH;\nuniform float BYTES_TO_PATTERN_SCALE;\nuniform float PATTERN_POSITION_UNIT_SIZE;\nuniform float PATTERN_INFO_TEXTURE_SIZE;\nuniform float PATTERN_NEAREST_TEXTURE_SIZE;\nuniform float PATTERN_LINEAR_TEXTURE_SIZE;\nuniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;\nuniform float PATTERN_MIPMAP_TEXTURE_SIZE;\nuniform float ROUNDED_BOX_RADIUS;\nconst float BYTES_TO_OFFSET_ANGLE = 0.0;\nconst float BYTES_TO_COLOR = 0.0;\nconst float SDF_FONT_SIZE = 0.0;\nconst float SDF_GAMMA = 0.0;\nconst float CURVATURE_RATIO = 0.0;\nconst float PATTERN_PADDING = 0.0;\nconst float TEXT_WIDTH_MULTIPLIER = 0.0;\nconst float TEXT_HEIGHT_MULTIPLIER = 0.0;\nconst float SELF_LOOP_CURVATURE_RATIO = 0.0;\nconst float EDGE_ARROW_SIZE_RATIO = 0.0;\nconst float CURVE_SUBDIVISIONS = 0.0;\nconst float PIECE_NODE_COMPONENT = 0.0;\nconst float PIECE_TEXT_BOX = 0.0;\nconst float PIECE_EDGE_BODY = 0.0;\nconst float PIECE_EDGE_HEAD = 0.0;\nconst float PIECE_EDGE_TAIL = 0.0;\nconst float PIECE_EDGE_TEXT = 0.0;\nconst float MAX_TEXT_SIZE = 0.0;\nconst float BYTES_TO_TEXT_OFFSET_X = 0.0;\nconst float BYTES_TO_TEXT_OFFSET_Y = 0.0;\nconst float FILTER_NEAREST = 0.0;\nconst float FILTER_LINEAR = 0.0;\nconst float FILTER_LINEAR_SDF = 0.0;\nconst float FILTER_MIPMAP = 0.0;\nconst float SHAPE_TEXTURE_SIZE = 0.0;\nconst float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;\nconst float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;\nconst float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;\nconst float MAX_SHAPES = 0.0;\nconst float FIRST_COMPLEX_SHAPE_ID = 0.0;\nconst float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;\nconst float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;\nconst float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;\nconst float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;\nconst float HEAD_TAIL_PX_ADJUST = 1.5;\nconst float SDF_SMOOTH_FACTOR = 2.0;\nstruct gk {\nfloat gl;\nfloat gm;\nfloat gn;\nfloat go;\nfloat gp;\nfloat gq;\nfloat gr;\nfloat gs;\n};\nstruct gt {\nfloat gu;\nfloat gv;\nfloat gw;\nfloat gx;\nfloat gy;\nfloat gz;\nfloat ha;\n};\nstruct hb {\nfloat gl;\nfloat gm;\nfloat gn;\nfloat go;\nfloat gp;\nfloat gq;\nfloat gr;\nfloat gs;\nfloat gu;\nfloat gv;\nfloat gw;\nfloat gx;\nfloat gy;\nfloat gz;\nfloat ha;\nfloat hc;\nfloat hd;\nfloat he;\nfloat hf;\nfloat hg;\nfloat hh;\nfloat hi;\nvec4 hj;\nvec4 hk;\nvec4 hl;\nfloat hm;\nfloat hn;\nfloat ho;\nfloat hp;\nfloat hq;\nfloat hr;\nfloat hs;\nfloat ht;\nfloat hu;\nfloat hv;\nfloat hw;\nfloat hx;\nfloat hy;\nfloat hz;\nfloat ia;\nfloat ib;\nfloat ic;\nfloat id;\nfloat ie;\n};\nstruct ig {\nfloat ih;\nvec2 ii;\nvec4 hj;\nvec4 hk;\nfloat hc;\nfloat ij;\nfloat ik;\nfloat gn;\nfloat il;\nvec2 im;\nfloat io;\nvec2 ip;\nvec2 iq;\nvec2 ir;\nfloat is;\nfloat it;\nvec4 hl;\nvec2 iu;\nfloat iv;\nfloat eu;\nvec2 iw;\nvec2 ix;\nvec2 iy;\n};\nfloat iz(float cf, float ja, float jb) {\nfloat jc = mod(cf, pow(2.0, jb));\nreturn floor(jc / pow(2.0, ja));\n}\ngk jd(float cf) {\ngk je;\nje.gl = iz(cf, 0.0, 4.0);\nje.gm = iz(cf, 4.0, 8.0);\nje.gn = iz(cf, 8.0, 10.0);\nje.go = iz(cf, 10.0, 12.0);\nje.gp = iz(cf, 12.0, 13.0);\nje.gq = iz(cf, 13.0, 14.0);\nje.gr = iz(cf, 14.0, 15.0);\nje.gs = iz(cf, 15.0, 16.0);\nreturn je;\n}\ngt jf(float cf) {\ngt je;\nje.gu = iz(cf, 0.0, 8.0);\nje.gv = iz(cf, 8.0, 11.0);\nje.gw = iz(cf, 11.0, 12.0);\nje.gx = iz(cf, 12.0, 13.0);\nje.gy = iz(cf, 13.0, 14.0);\nje.gz = iz(cf, 14.0, 15.0);\nje.ha = iz(cf, 15.0, 16.0);\nreturn je;\n}\nvec4 jg(in float cf) {\nreturn vec4(\niz(cf, 0.0, 4.0),\niz(cf, 4.0, 8.0),\niz(cf, 8.0, 12.0),\niz(cf, 12.0, 16.0)\n);\n}\nvec2 jh(in float cf) {\nreturn vec2(mod(cf, 256.0), floor(cf / 256.0));\n}\nvec2 ji(in float cf) {\nfloat jj = floor(cf / P2_6);\nfloat jk = cf - (jj * P2_6);\nreturn vec2(jj, jk);\n}\nvec2 jl(in float cf) {\nfloat jm = floor(cf / P2_7);\nfloat jn = cf - (jm * P2_7);\nreturn vec2(jm, jn);\n}\nvec2 jo(in vec2 jp, in float jq) {\nfloat jr = cos(jq);\nfloat js = sin(jq);\nreturn vec2(jr * jp.x + js * jp.y, -js * jp.x + jr * jp.y);\n}\nvec4 jt(in vec4 ju) {\nreturn floor(ju / 256.0) - 128.0;\n}\nvec4 jv(in vec4 ju) {\nreturn mod(ju, 256.0) - 128.0;\n}\nfloat jw(float cf) {\nreturn cf - 128.0;\n}\nvec2 jw(vec2 cf) {\nreturn cf - 128.0;\n}\nvec2 jx(vec2 jy) {\nreturn vec2(-jy.y, jy.x);\n}\nvec2 jz(vec2 ka, vec2 kb, vec2 kc, float t) {\nfloat kd = 1.0 - t;\nreturn (kd * kd * ka) + (2.0 * kd * t * kb) + (t * t * kc);\n}\nvec2 ke(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {\nfloat kd = 1.0 - t;\nfloat kh = kd * kd;\nfloat ki = kh * kd;\nfloat kj = t * t;\nfloat kk = kj * t;\nreturn (ki * ka) + (3.0 * kh * t * kf) + (3.0 * kd * kj * kg) + (kk * kc);\n}\nvec2 kl(vec2 ka, vec2 kb, vec2 kc, float t) {\nfloat kd = (1.0 - t);\nvec2 jp = (kd * kb + t * kc) - (kd * ka + t * kb);\nreturn normalize(jp);\n}\nvec2 km(vec2 ka, vec2 kb, vec2 kc, float t) {\nreturn jx(kl(ka, kb, kc, t));\n}\nvec2 kn(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {\nfloat kd = 1.0 - t;\nfloat kh = kd * kd;\nfloat kj = t * t;\nvec2 jp = kh * (kf - ka) + 2.0 * kd * t * (kg - kf) + kj * (kc - kg);\nreturn normalize(jp);\n}\nvec2 ko(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {\nreturn jx(kn(ka, kf, kg, kc, t));\n}\nfloat ld(float hh, float le, float t) {\nfloat y = abs(hh) / CURVATURE_RATIO + EPSILON;\nfloat hp = y * y;\nfloat kd = t - 0.5;\nfloat kh = kd * kd;\nfloat lf = 1.0 / (16.0 * hp);\nfloat lg = sqrt(kh + lf);\nfloat lh = (0.5 / y) * sqrt(hp + 0.25);\nfloat li = (abs(2.0 * y)) * ((kd * lg) + (0.5 * lh) + (lf * log(abs((kd + lg) / (-0.5 + lh)))));\nreturn li * le;\n}\nfloat lj(vec2 ka, vec2 lk, vec2 ll, vec2 kc, float lm) {\nvec2 iu = (ka + lk + ll) / 3.0;\nvec2 ln = iu - lk;\nvec2 lo = lk - ll;\nfloat lp = dot(ln, ln);\nfloat lq = dot(lo, lo) / 4.0;\nfloat ma = sqrt(lp - lq) * SELF_LOOP_TO_CIRCLE_APPROX * 1.55;\nreturn 2.0 * PI * ma * lm;\n}\nfloat mb(float cf) {\nreturn cf - 32.0;\n}\nfloat mc(float cf) {\nreturn cf - 512.0;\n}\nfloat md(float cf) {\nreturn cf - P2_14;\n}\nvoid me() {\ngl_Position = vec4(-10.0, -10.0, 1.0, 1.0);\n}\nvec4 mf(vec2 mg) {\nreturn vec4(((vec2(mg.x, u_viewHeight - mg.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);\n}\nfloat mk(float ml, float mm) {\nreturn step(ml - EPSILON, mm) * step(mm, ml + EPSILON);\n}\nbool mn(float ml, float mm) {\nreturn abs(ml - mm) < EPSILON;\n}\nbool mo(float cf) {\nreturn cf > 0.5;\n}\nvec2 mp(vec2 mq) {\nreturn jo((mq - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;\n}\nfloat mr(float eu) {\nreturn eu * EDGE_ARROW_SIZE_RATIO;\n}\nfloat ms(float mt, float mu) {\nreturn mt * BYTES_TO_SCALED_SIZE * u_viewZoom + mu;\n}\nfloat nb(float ij, float mz, float na) {\nfloat nc = na - mz;\nfloat a = 1.0 / nc;\nfloat b = -mz / nc;\nreturn ij * a + b;\n}\nstruct nd {\nvec2 ne;\nvec2 nf;\n};\nnd ng(vec2 nh, float ma, float hh) {\nnd cj;\nfloat ni = (ma + ma / SELF_LOOP_CURVATURE_RATIO * hh) * SELF_LOOP_CURVATURE_RATIO;\nfloat nj = -u_viewAngle + PI;\nfloat nk = -u_viewAngle + PI / 2.0;\ncj.ne = nh + vec2(cos(nj), sin(nj)) * ni;\ncj.nf = nh + vec2(cos(nk), sin(nk)) * ni;\nreturn cj;\n}\nfloat nq(vec2 nr, vec2 lk, vec2 ll, vec2 ns, float nt) {\nvec2 nu = nr;\nfloat t = 0.0;\nfloat nv = 0.0;\nfloat nw = lj(nr, lk, ll, ns, 1.0);\nreturn nt / nw;\n}\nhb nx(\nvec4 ny,\nvec4 nz,\nvec4 oa,\nvec4 ob,\nvec4 oc,\nvec4 od,\nvec3 oe\n) {\nhb a;\ngk of = jd(ny.x);\ngt og = jf(ny.y);\nvec4 oh = jg(ny.z);\nvec2 oi = jh(ny.w);\na.gl = of.gl;\na.gm = of.gm;\na.gn = of.gn;\na.go = of.go;\na.gp = of.gp;\na.gq = of.gq;\na.gr = of.gr;\na.gs = of.gs;\na.gu = og.gu;\na.gv = og.gv;\na.gw = og.gw;\na.gx = og.gx;\na.gy = og.gy;\na.gz = og.gz;\na.ha = og.ha;\na.hc = oh.x;\na.hd = oh.y;\na.he = oh.z;\na.hf = oh.w;\na.hg = oi.x;\na.hh = oi.y;\na.hi = nz.x;\na.hj = jg(nz.y);\na.hk = jg(nz.z);\na.hl = jg(nz.w);\na.hm = oa.x;\na.hn = oa.y;\na.ho = oa.z;\na.hp = oa.w;\na.hq = ob.x;\na.hr = ob.y;\na.hs = ob.z;\na.ht = ob.w;\na.hu = oc.x;\na.hv = oc.y;\na.hw = oc.z;\na.hx = oc.w;\na.hy = od.x;\na.hz = md(od.y);\na.id = md(od.z);\na.ie = md(od.w);\na.ia = oe.x;\nfloat x = oe.y;\nfloat y = mod(x, P2_8);\nif (oe.z > 0.0) x += oe.z * P2_16;\na.ib = ((x - y) / P2_8) - P2_16;\na.ic = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;\nreturn a;\n}\nbool pl(const in hb a, out ig cj) {\nfloat gl = a.gl;\nfloat gm = a.gm;\nfloat gn = a.gn * BYTES_TO_DASH_LENGTH;\nfloat go = a.go * BYTES_TO_GAP_LENGTH;\nfloat gp = a.gp;\nfloat gq = a.gq;\nfloat gr = a.gr;\nfloat gs = a.gs;\nfloat gu = a.gu * BYTES_TO_PATTERN_SCALE;\nfloat gv = a.gv * BYTES_TO_OFFSET_ANGLE;\nfloat gw = a.gw;\nfloat gx = a.gx;\nfloat gy = a.gy;\nfloat gz = a.gz;\nfloat ha = a.ha;\nfloat hc = a.hc * BYTES_TO_COLOR;\nfloat hd = a.hd * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat he = a.he * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat hf = a.hf * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat hg = a.hg * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom + step(a.hg, EPSILON) * INFINITY;\nfloat hh = jw(a.hh);\nfloat hi = a.hi;\nvec4 hj = a.hj * BYTES_TO_COLOR;\nvec4 hk = a.hk * BYTES_TO_COLOR;\nvec4 hl = a.hl * BYTES_TO_COLOR;\nvec2 pm = vec2(a.hm, a.hn) * BYTES_TO_COORD;\nvec2 pn = vec2(a.ho, a.hp) * BYTES_TO_COORD;\nvec2 nr = mp(pm);\nvec2 ns = mp(pn);\nfloat po = ms(a.hq, a.hr);\nfloat pp = ms(a.hs, a.ht);\nfloat pq = ms(a.hu, a.hv);\nfloat ih = ms(a.hw, a.hx);\nfloat oj = ms(a.hy, a.hz);\nvec2 pr = a_vertexInfo.xy;\nvec2 ps = vec2(0.0, 0.0);\nfloat pt = po;\nfloat pu = pp;\nfloat pv = pp * gu;\nif (gw > EPSILON) {\nif (a.ia < EPSILON) return false;\npv = pq;\nhi = a.ia;\npo = pv * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;\npp = pv * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;\n}\nbool qv = abs(hh) > EPSILON && mk(gm, PIECE_EDGE_BODY) < EPSILON;\nbool qw = qv && a_vertexInfo.z > EPSILON;\nif (gl < EPSILON || gm < EPSILON || hg < hd || qw) {\nreturn false;\n}\nih *= step(he, hg);\nfloat rl = 0.0;\nfloat rm = 1.0;\nfloat ri = 0.0;\nfloat rk = 1.0;\nfloat rn = 0.0;\nfloat rx = 1.0;\nfloat rz = 1.0;\nfloat sk = 0.0;\nfloat sl = 0.0;\nvec2 iu;\nvec2 iw;\nvec2 ix;\nvec2 iy;\nfloat eu;\nfloat iv;\nfloat tg = 0.0;\nfloat th = 1.0;\nbool ti = mk(gm, PIECE_TEXT_BOX) > EPSILON;\nif (mk(gm, PIECE_NODE_COMPONENT) > EPSILON || ti) {\niu = ceil((nr + ns) / 2.0);\niw = normalize(vec2(pn.x - pm.x + 0.001, pm.y - pn.y));\nix = jx(iw);\niy = ix;\neu = po;\niv = pp;\n} else {\nrz = 0.0;\nfloat tx = distance(nr, ns);\nvec2 ty = normalize(ns - nr);\nvec2 tz = (nr + ns) / 2.0;\nvec2 ua = jx(ty);\nvec2 ub = tz + (ua * tx * -hh / CURVATURE_RATIO);\nif (mk(gm, PIECE_EDGE_TEXT) > 0.0\n|| mk(gm, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0\n) {\nti = mk(gm, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;\nfloat uf;\nfloat ug = ih;\nih = 0.0;\nif (gs > EPSILON) {\nnd kb = ng(nr, ug / 2.0, hh);\niu = ke(nr, kb.ne, kb.nf, ns, 0.5);\niw = kn(nr, kb.ne, kb.nf, ns, 0.5);\nix = jx(iw);\niy = ix;\nuf = lj(nr, kb.ne, kb.nf, ns, 0.5);\n} else if (abs(hh) > EPSILON) {\niu = jz(nr, ub, ns, 0.5);\niw = kl(nr, ub, ns, 0.5);\nix = jx(iw);\niy = ix;\nuf = ld(hh, tx, 1.0);\n} else {\niu = tz;\niw = ty;\nix = ua;\niy = ua;\nuf = tx;\n}\neu = po;\niv = pp;\nif(pt > uf - ug && gs < EPSILON){\nif(gx > EPSILON){\niw = vec2(1.0, 0.0);\nix = vec2(0.0, 1.0);\niy = vec2(0.0, 1.0);\n} else {\niw = vec2(0,0);\nix = vec2(0.0, 0.0);\niy = vec2(0.0, 0.0);\n}\n} else {\nfloat jq = -atan(iw.y, iw.x);\ntg = jq;\ngv -= jq;\nif ((jq > PI / 2.0 || jq < -PI / 2.0)) {\ngv += (1.0 - gs) * PI;\nth = -1.0;\niw *= -1.0;\nix *= -1.0;\niy *= -1.0;\n}\n}\n} else {\nfloat sd = pq;\nfloat ur = po;\nfloat us = pp;\nfloat ut = gp + gq;\nfloat uu = mr(sd);\nfloat uv = gp * uu;\nfloat uw = gq * uu;\nfloat ux = mk(gm, PIECE_EDGE_HEAD);\nfloat uy = mk(gm, PIECE_EDGE_TAIL);\nfloat uz = INFINITY * gs + tx - ur - us;\nfloat va = min(uz / ut, uu);\nfloat vk =\ngq * (uu + max(ur + va - uw, 0.0))\n+ (1.0 - gq) * gr * ur;\nfloat vl =\ngp * (uu + max(us + va - uv, 0.0))\n+ (1.0 - gp) * gr * us;\nif (ux > EPSILON || uy > EPSILON) {\nvec2 vo = ux * ns + uy * nr;\nfloat oj = ux * vl + uy * vk + (HEAD_TAIL_PX_ADJUST - 0.5);\nfloat vp = ux * uv + uy * uw;\nvec2 vq;\nif (gs > EPSILON) {\nnd kb = ng(nr, ur, hh);\nfloat uf = lj(nr, kb.ne, kb.nf, ns, 1.0);\nfloat nt = ux * (uf - vl) + uy * vk;\nfloat t = nq(nr, kb.ne, kb.nf, ns, nt);\nvq = ke(nr, kb.ne, kb.nf, ns, t);\n} else {\nfloat uf = ld(hh, tx, 1.0);\nfloat t = (ux * (uf - vl) + uy * vk) / uf;\nvq = jz(nr, ub, ns, t);\n}\niw = normalize(vo - vq);\nix = jx(iw);\niy = ix;\niu = vo - iw * (oj - vp / 2.0);\neu = vp;\niv = vp;\ngn = 0.0;\ngo = 0.0;\n} else {\nfloat vu;\nfloat vv;\nfloat vw;\nif (abs(hh) < EPSILON) {\niu = tz;\niw = ty;\nix = ua;\niy = ix;\neu = tx;\nvu = tx;\nvv = 0.0;\nvw = tx;\n} else {\nfloat vy = a_vertexInfo.z;\nfloat vz = vy * T_STEP_PER_CURVE_PIECE;\nfloat kj = vz + T_STEP_PER_CURVE_PIECE;\nif (gs < EPSILON) {\nvec2 wa = jz(nr, ub, ns, vz);\nvec2 wb = jz(nr, ub, ns, kj);\niu = (wa + wb) / 2.0;\niw = normalize(wb - wa);\nix = km(nr, ub, ns, vz);\niy = km(nr, ub, ns, kj);\neu = distance(wa, wb);\nvu = ld(hh, tx, 1.0);\nvv = ld(hh, tx, vz);\nvw = ld(hh, tx, kj);\n} else {\nnd kb = ng(nr, ur, hh);\nvec2 lk = kb.ne;\nvec2 ll = kb.nf;\nvec2 wa = ke(nr, lk, ll, ns, vz);\nvec2 wb = ke(nr, lk, ll, ns, kj);\niu = (wa + wb) / 2.0;\niw = normalize(wb - wa);\nix = ko(nr, lk, ll, ns, vz);\niy = ko(nr, lk, ll, ns, kj);\neu = distance(wa, wb);\nvu = lj(nr, lk, ll, ns, 1.0);\nvv = lj(nr, lk, ll, ns, vz);\nvw = lj(nr, lk, ll, ns, kj);\n}\n}\niv = pq;\nri = (vk - 1.0) / vu - 0.015 * gs;\nrk = MAX_PROGRESS + 0.015 * gs\n- (vl - HEAD_TAIL_PX_ADJUST) / vu;\nrl = vv / vu;\nrm = vw / vu;\nrn = vu;\nif (gr > 0.0 && uz > 5.0) {\nfloat wg = (vu * iv) / (vu - vk);\nfloat nw = vu;\nfloat hm = vk;\nfloat ho = vu - vl;\nfloat a = -wg / nw;\nfloat b = wg;\nfloat hn = a * hm + b;\nfloat hp = a * ho + b;\nfloat wh = hn / (hm - ho);\nfloat wi = -wh * ho;\niv = min(min(wi, ur), us);;\nsl = wh * nw + wi + 1.0;\n}\n}\n}\n}\nvec2 ip = vec2(0.0, 0.0);\nvec2 iq = vec2(EPSILON, EPSILON);\nvec2 ir = vec2(-EPSILON, -EPSILON);\nfloat is = -1.0;\nfloat it = 0.0;\nbool wk = false;\nvec2 wl = vec2(0,0);\nvec2 wm = vec2(0,0);\nvec2 wn = vec2(0,0);\nif (hi > EPSILON && hg > hf) {\nfloat wr = floor(hi / PATTERN_INFO_TEXTURE_SIZE);\nfloat ws = hi - (wr * PATTERN_INFO_TEXTURE_SIZE);\nvec4 wt = texture2D(u_patternInfoTexture, vec2(ws, wr) / 255.0) * 255.0;\nvec2 wu = jl(wt.z);\nvec2 wv = jl(wt.w);\nis = wu.x * 2.0 + wv.x;\nfloat ww = 0.0;\nif (mn(is, FILTER_NEAREST)) { \nww = PATTERN_NEAREST_TEXTURE_SIZE;\n} else if (mn(is, FILTER_LINEAR)) { \nww = PATTERN_LINEAR_TEXTURE_SIZE;\n} else if (mn(is, FILTER_LINEAR_SDF)) { \nww = PATTERN_LINEAR_SDF_TEXTURE_SIZE;\nwk = true;\n} else if (mn(is, FILTER_MIPMAP)) { \nww = PATTERN_MIPMAP_TEXTURE_SIZE;\n}\nfloat xd = 1.0 / ww;\nvec2 xe = (vec2(wu.y, wv.y) * PATTERN_POSITION_UNIT_SIZE) * xd / 2.0;\nwm += (wt.xy * PATTERN_POSITION_UNIT_SIZE * xd) + xe;\nxe -= PATTERN_PADDING * xd * 2.0;\nvec2 xf = vec2(eu / 2.0, iv / 2.0) * xd;\nvec2 xg = vec2(ih, ih) * xd;\nfloat xj = 1.0 * u_pixelRatio;\nfloat xk = SDF_SMOOTH_FACTOR;\nif (gu > EPSILON) {\nif (wk) { \nif (a.gy > EPSILON) {\nxk = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;\nwl = vec2(-a.ie,-a.id);\n}\nit = xk * SDF_GAMMA / pv / u_pixelRatio;\nxj = SDF_FONT_SIZE / pv;\n} else { \nxj = (xe.y / xf.y) / gu;\n}\n}\nwn = (xf + xg) * xj;\nxe += PATTERN_PADDING * xd;\niq = wm - xe;\nir = wm + xe;\n}\nif (gw > EPSILON) {\nps.y = (a.ic) * pv;\nrx = 0.0;\nrz = 0.0;\nps.x = a.ib * pv * BYTES_TO_TEXT_OFFSET_X;\nps += vec2(1.0, 1.0);\nps = jo(ps, tg);\nps *= th;\n}\nvec2 xp = vec2(cos(gv), sin(gv)) * oj;\nvec2 xq = iu + xp + ps;\nfloat xr = ih * 2.0;\nfloat xs = eu + rz * (xr + 1.0);\nfloat xt = iv + rx * (xr + 1.0);\nvec2 xu = iw * xs / 2.0;\nvec2 xv = ix * xt / 2.0;\nvec2 xw = iy * xt / 2.0;\nfloat xx = (rm - rl);\nfloat xy = pr.x / 2.0 + 0.5;\nfloat ij = rl + xx * xy;\nfloat io = sk + (sl - sk) * ij / 2.0;\nfloat xz = step(gl, FIRST_COMPLEX_SHAPE_ID - EPSILON);\nfloat ya = xz * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - xz) * COMPLEX_SHAPE_SAMPLING_SIZE;\nfloat yb = ya / COMPLEX_SHAPE_SAMPLING_SIZE;\nfloat yc = yb * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;\nfloat yd = yb * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);\nvec2 yn = vec2(\nmod(gl, NB_SHAPES_BY_SIDE),\nfloor(gl / NB_SHAPES_BY_SIDE)\n);\nvec2 yq = yn + vec2(yc) +\nvec2(rl * yd, 0.0);\nvec2 yt = vec2(xx, 1.0) * yd;\nvec2 ii = (yq + yt * (pr / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;\nvec2 im = vec2(xs / xx, xt) / 2.0;\nfloat za = gn * pq;\nfloat zb = go * pq;\nfloat ik = za + zb;\nfloat il = (ij * rn) / ik;\nip = wm\n+ wn\n* (pr + wl / im * u_viewZoom);\ncj.ii = ii;\nfloat ze = float(gl == 1.);\nei = vec4(\n(yq + yt * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,\nNB_SHAPES_BY_SIDE * (1. - gw) * ze,\nfloat(ti)\n);\ncj.im = im;\ncj.ih = ih;\ncj.hj = hj;\ncj.hk = hk;\ncj.hc = hc;\ncj.ij = nb(ij, ri, rk);\ncj.ik = ik;\ncj.gn = za;\ncj.il = il;\ncj.io = io;\ncj.ip = ip;\ncj.iq = iq;\ncj.ir = ir;\ncj.is = is;\ncj.it = it;\ncj.hl = hl;\ncj.iu = xq;\ncj.eu = xs + ze;\ncj.iv = xt + ze;\ncj.iw = iw;\ncj.ix = ix;\ncj.iy = iy;\nreturn true;\n}\nfloat zn(float zo, float zp, vec4 zq) {\nfloat zr = clamp(((u_currentTime - zo) / zp), 0.0, 1.0);\nfloat r = zr;\nfloat zs = r * r;\nfloat zt = zs * r;\nvec4 zu = zr < 0.5 ? jt(zq) : jv(zq);\nfloat zv = zu.x;\nfloat zw = zu.y;\nfloat zx = zu.z;\nfloat zy = zu.w;\nfloat zz = zv + zw * r + zx * zs + zy * zt;\nreturn zz;\n}\nvoid main() {\nhb a_final = nx(\na_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,\na_final_patternId_fillRGBA_strokeRGBA_patternRGBA,\na_final_x1_y1_x2_y2,\na_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,\na_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,\na_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,\na_text_charId_charOffsetXY\n);\n#if ANIMATED\nfloat zo = a_animationBeginTime_animationDuration.x;\nfloat zp = a_animationBeginTime_animationDuration.y;\nvec4 zq = a_animationEasing;\nfloat pk = zn(zo, zp, zq);\nhb a_prev = nx(\na_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,\na_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,\na_prev_x1_y1_x2_y2,\na_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,\na_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,\na_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,\na_text_charId_charOffsetXY\n);\nconst float ONE = 1.0;\na_final.gl = mix(a_prev.gl, a_final.gl, ONE);\na_final.gn = mix(a_prev.gn, a_final.gn, pk);\na_final.go = mix(a_prev.go, a_final.go, pk);\na_final.gp = mix(a_prev.gp, a_final.gp, ONE);\na_final.gq = mix(a_prev.gq, a_final.gq, ONE);\na_final.gm = mix(a_prev.gm, a_final.gm, ONE);\na_final.gu = mix(a_prev.gu, a_final.gu, ONE);\na_final.gw = mix(a_prev.gw, a_final.gw, ONE);\na_final.gx = mix(a_prev.gx, a_final.gx, ONE);\na_final.gy = mix(a_prev.gy, a_final.gy, ONE);\na_final.gz = mix(a_prev.gz, a_final.gz, ONE);\na_final.gs = mix(a_prev.gs, a_final.gs, ONE);\na_final.gv = mix(a_prev.gv, a_final.gv, pk);\na_final.hc = mix(a_prev.hc, a_final.hc, pk);\na_final.hd = mix(a_prev.hd, a_final.hd, pk);\na_final.he = mix(a_prev.he, a_final.he, pk);\na_final.hf = mix(a_prev.hf, a_final.hf, pk);\na_final.hg = mix(a_prev.hg, a_final.hg, pk);\na_final.hh = mix(a_prev.hh, a_final.hh, pk);\na_final.hi = mix(a_prev.hi, a_final.hi, ONE);\na_final.hj = mix(a_prev.hj, a_final.hj, pk);\na_final.hk = mix(a_prev.hk, a_final.hk, pk);\na_final.hl = mix(a_prev.hl, a_final.hl, pk);\na_final.hm = mix(a_prev.hm, a_final.hm, pk);\na_final.hn = mix(a_prev.hn, a_final.hn, pk);\na_final.ho = mix(a_prev.ho, a_final.ho, pk);\na_final.hp = mix(a_prev.hp, a_final.hp, pk);\na_final.hq = mix(a_prev.hq, a_final.hq, pk);\na_final.hr = mix(a_prev.hr, a_final.hr, pk);\na_final.hs = mix(a_prev.hs, a_final.hs, pk);\na_final.ht = mix(a_prev.ht, a_final.ht, pk);\na_final.hu = mix(a_prev.hu, a_final.hu, pk);\na_final.hv = mix(a_prev.hv, a_final.hv, pk);\na_final.hw = mix(a_prev.hw, a_final.hw, pk);\na_final.hx = mix(a_prev.hx, a_final.hx, pk);\na_final.hy = mix(a_prev.hy, a_final.hy, pk);\na_final.hz = mix(a_prev.hz, a_final.hz, pk);\na_final.ia = mix(a_prev.ia, a_final.ia, ONE);\na_final.ib = mix(a_prev.ib, a_final.ib, ONE);\na_final.ic = mix(a_prev.ic, a_final.ic, ONE);\n#endif\nig cj;\nbool aae = pl(a_final, cj);\nif (!aae) {\nme();\nreturn;\n}\nvec2 pr = a_vertexInfo.xy;\ndn = cj.hj;\ndp = cj.hk;\ndq = cj.hl;\ndr = cj.ii;\nds = cj.ip;\n#if D3D9_FIX\n#else\ndy = cj.ih;\ndz = cj.iq;\nea = cj.ir;\neb = vec2(cj.hc, cj.io);\nec = cj.ij;\ned = cj.ik;\nee = vec2(cj.gn, cj.il);\nef = cj.im;\neg = cj.it;\neh = cj.is;\n#endif\nfloat aaj = step(pr.x, 0.0);\nfloat aak = 1.0 - aaj;\ndt = min(cj.iv, ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;\ncj.eu += ei.w * dt/2.;\nvec2 mg = cj.iu\n+ cj.iw * (cj.eu / 2.0) * pr.x\n+ (aaj * cj.ix + aak * cj.iy) * cj.iv / 2.0 * pr.y;\ndq = dq * (1. - ei.w)\n+ vec4(\npr.x * cj.eu,\npr.y * cj.iv,\ncj.eu,\ncj.iv\n) * u_pixelRatio * ei.w;\ngl_Position = mf(mg);\n}\n",Cr=1e20,kr=class{constructor({fontSize:e=24,buffer:t=8,radius:s=6,cutoff:i=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=e,this._buffer=t,this._radius=s,this._cutoff=i,this._height=Math.ceil(this._fontSize+2*this._buffer*xn),this._canvas=createCanvas(),this._canvas.height=this._height,this._canvas.width=1;const r=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=r,r.textBaseline="middle",r.textAlign="center",r.fillStyle="black"}setOptions({fontSize:e=24,buffer:t=8,cutoff:s=.25,radius:i=6}){this._fontSize=e,this._buffer=t,this._cutoff=s,this._radius=i,this._height=Math.ceil(this._fontSize+2*this._buffer*xn)}draw(e,t,s){setCtxFont(this._ctx,t,this._fontSize,s);const i=function roundToPatternUnitSize2(value){return Math.ceil((value+2*fn)/pn)*pn}(this._ctx.measureText(e).width+2*this._buffer)-2*fn,r=this._height,o=i*r,a=Math.max(i,r);this._canvas.width<i&&(this._canvas.width=i,setCtxFont(this._ctx,t,this._fontSize,s),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),o>this._gridSize&&(this._gridOuter=new Float64Array(o),this._gridInner=new Float64Array(o),this._gridSize=o),a>this._maxDimension&&(this._f=new Float64Array(a),this._d=new Float64Array(a),this._z=new Float64Array(a+1),this._v=new Int16Array(a),this._maxDimension=a),this._ctx.clearRect(0,0,i,r),this._ctx.fillText(e,i/2,r/2);const l=this._ctx.getImageData(0,0,i,r),d=new Uint8ClampedArray(o);for(let e=0;e<o;e++){const t=l.data[4*e+3]/255;this._gridOuter[e]=1===t?0:0===t?Cr:Math.pow(Math.max(0,.5-t),2),this._gridInner[e]=1===t?Cr:0===t?0:Math.pow(Math.max(0,t-.5),2)}edt(this._gridOuter,i,r,this._f,this._d,this._v,this._z),edt(this._gridInner,i,r,this._f,this._d,this._v,this._z);for(let e=0;e<o;e++){const t=this._gridOuter[e]-this._gridInner[e];d[e]=Math.max(0,Math.min(255,Math.round(255-255*(t/this._radius+this._cutoff))))}return{height:r,width:i,distance:d}}};function edt(e,t,s,i,r,o,a){for(let l=0;l<t;l++){for(let r=0;r<s;r++)i[r]=e[r*t+l];edt1d(i,r,o,a,s);for(let i=0;i<s;i++)e[i*t+l]=r[i]}for(let l=0;l<s;l++){for(let s=0;s<t;s++)i[s]=e[l*t+s];edt1d(i,r,o,a,t);for(let s=0;s<t;s++)e[l*t+s]=Math.sqrt(r[s])}}function edt1d(e,t,s,i,r){s[0]=0,i[0]=-Cr,i[1]=+Cr;for(let t=1,o=0;t<r;t++){let r=(e[t]+t*t-(e[s[o]]+s[o]*s[o]))/(2*t-2*s[o]);for(;r<=i[o];)o--,r=(e[t]+t*t-(e[s[o]]+s[o]*s[o]))/(2*t-2*s[o]);o++,s[o]=t,i[o]=r,i[o+1]=+Cr}for(let o=0,a=0;o<r;o++){for(;i[a+1]<o;)a++;t[o]=(o-s[a])*(o-s[a])+e[s[a]]}}var Mr=256,Lr=128-2*fn,Ir=128-2*fn,Nr={fontSize:24,cutoff:.275,radius:6},Pr={fontSize:24,cutoff:.25,radius:8},Fr=class{constructor(e,t){this._patternIdToInfoTexture=new Uint8Array(262144),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=e,this._glUnit=t;const s=createCanvas(yn,yn),i=s.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Pattern: could not get 2d context");this._imageCanvasContext=i,this._imageCanvas=s,this._canvasForDuplicatedImage,this._sdfGenerator=new kr(Nr),this._maxTextureSize=Math.min(4096,e.getParameter(e.MAX_TEXTURE_SIZE))}refresh(e){this._pixelRatio=e.getPixelRatio();const t=this._gl,s=this._getPatternsByFilter(e.getPatternList());for(let e=0;e<s.length;++e){const i=e,r=s[e],o=getApproxTextureSize(r,this._maxTextureSize),{texture:a,size:l}=fillAtlas(i,r,o,this._maxTextureSize,this._patternIdToInfoTexture),d=this._glTextures[i]||(this._glTextures[i]=t.createTexture()),h=0===i?0:1;setupTexture(t,d,this._glUnit+1+i,a,l,i,h),this._textureSizes[i]=l}const i=this._glTextureInfo||(this._glTextureInfo=t.createTexture()),r=this._patternIdToInfoTexture;setupTexture(t,i,this._glUnit,r,Mr,0,1)}bindMetDataTexture(){const e=this._gl;e.activeTexture(e.TEXTURE0+this._glUnit),e.bindTexture(e.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+0}getLinearTextureUnit(){return this._glUnit+1+1}getLinearSdfTextureUnit(){return this._glUnit+1+2}getMipmapTextureUnit(){return this._glUnit+1+3}getInfoTextureSize(){return Mr}getNearestTextureSize(){return this._textureSizes[0]}getLinearTextureSize(){return this._textureSizes[1]}getLinearSdfTextureSize(){return this._textureSizes[2]}getMipmapTextureSize(){return this._textureSizes[3]}_getPatternsByFilter(e){const t=new Array(4);for(let e=0;e<4;++e)t[e]=[];for(let s=0;s<e.length;++s){const i=this._getPatternPixels(e[s]);t[i.filter].push(i)}return t}_getPatternPixels({id:e,type:t,attributes:s}){let i;const{text:r,font:o,style:a,image:l,scaled:d,duplicated:h,colorArray:u}=s;switch(t){case Yi:i=h?this._getDuplicatedImagePixels(l):d?this._getScaledImagePixels(l):this._getNonScaledImagePixels(l);break;case 3:i=this._getSdfTextPixels(r,o,a);break;case Qi:i=this._getIconPixels(r,o,a);break;case Ki:i=this._getBadgeIconPixels(r,o,a);break;case Zi:i=this._getPieChartPixels(u);break;default:throw new Error(`pattern type "${t}" does not exist`)}return i.id=e,i}_getScaledImagePixels(e){let t=e.width,s=e.height;if(t>0){const i=yn/Math.max(e.width,e.height);t*=i,s*=i}return t&&s&&(t=roundToPatternUnitSize(t),s=roundToPatternUnitSize(s)),t-=2*fn,s-=2*fn,this._getImagePixels(e,t,s)}_getNonScaledImagePixels(e){return this._getImagePixels(e,e.width,e.height)}_getDuplicatedImagePixels(e){if(0===e.width||0===e.height)return this._getImagePixels(e,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=createCanvas(yn,yn));const t=this._canvasForDuplicatedImage,s=t.getContext("2d"),i=e.width,r=e.height;let o=(yn-i)/2,a=(yn-r)/2;for(;o>0;)o-=i;for(;a>0;)a-=r;for(let t=o;t<yn;t+=i)for(let i=a;i<yn;i+=r)s.drawImage(e,t,i);return this._getImagePixels(t,yn,yn)}_getImagePixels(e,t,s){let i;if(0===t||0===s)i=new Uint8Array(0);else{(this._imageCanvas.width<t||this._imageCanvas.height<s)&&(this._imageCanvas.width=t,this._imageCanvas.height=s);const r=this._imageCanvasContext;clearCanvas(this._imageCanvas,r,t,s);try{r.drawImage(e,0,0,t,s)}catch(e){}i=r.getImageData(0,0,t,s).data}return{width:t,height:s,pixels:i,filter:3}}_getPieChartPixels(e){const t=Ir,s=this._imageCanvasContext,i=t/2,r=t/2;return clearCanvas(this._imageCanvas,s,t,t),s.save(),s.rect(0,0,t,t),s.clip(),drawPieChart(s,e,i,r,t),s.restore(),{width:t,height:t,pixels:s.getImageData(0,0,t,t).data,filter:1}}_getTextPixels(e,t,s,i,r,o){const a=this._imageCanvasContext,l=r*this._pixelRatio;setCtxFont(a,s,l,i);let d=Math.ceil(a.measureText(t).width);0===d&&(d=l);let h=0,u=0;3===e||(h=2*Math.ceil(l*xn/2),u=2*Math.ceil(1*d/2));const c=Math.ceil(d+u),m=Math.ceil(l+h),p=this._imageCanvas.height<m||this._imageCanvas.width<c;return this._imageCanvas.height<m&&(this._imageCanvas.height=m),this._imageCanvas.width<c&&(this._imageCanvas.width=c),p&&setCtxFont(a,s,l,i),a.clearRect(0,0,c,m),a.fillStyle="black",a.textBaseline="middle",a.textAlign="left",a.fillText(t,o+u/2,m/2),{width:c,height:m,pixels:a.getImageData(0,0,c,m).data,filter:e}}_getIconPixels(e,t,s){return this._getTextPixels(3,e,t,s,Lr,0)}_getBadgeIconPixels(e,t,s){return this._sdfGenerator.setOptions(Pr),this._getSdfPixels(e,t,s)}_getSdfTextPixels(e,t,s){return this._sdfGenerator.setOptions(Nr),this._getSdfPixels(e,t,s)}_getSdfPixels(e,t,s){const{width:i,height:r,distance:o}=this._sdfGenerator.draw(e,t,s),a=new Uint8Array(i*r*4);for(let e=0;e<o.length;++e)a[4*e+3]=o[e];return{width:i,height:r,pixels:a,filter:2}}},zr=class{constructor(e,t){this._gl=e,this._glTextureUnit=t,this._simpleShapePixels=new Uint8Array(4096),this._complexShapePixels=new Uint8Array(65536),this._shapesWritten=[]}refresh(e){const t=e.getShapeList();for(const e of t)if(!this._shapesWritten.includes(e.id)){const t=e.isSimple?32:cn,s=e.isSimple?this._simpleShapePixels:this._complexShapePixels;writeShapeOnPixels(e,t,gn,s),this._loadShapeInGpu(e.id,t,s),this._shapesWritten.push(e.id)}}_loadShapeInGpu(e,t,s){const i=this._gl,r=_n,o=e%mn*cn,a=Math.floor(e/mn)*cn;if(this._texture)i.bindTexture(i.TEXTURE_2D,this._texture);else{const e=new Uint8Array(r*r*4);this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0+this._glTextureUnit),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,r,r,0,i.RGBA,i.UNSIGNED_BYTE,e)}i.texSubImage2D(i.TEXTURE_2D,0,o,a,t,t,i.RGBA,i.UNSIGNED_BYTE,s)}getTextureSize(){return _n}getSamplingSize(){return cn}getBufferRatio(){return gn}getTextureUnit(){return this._glTextureUnit}},Dr=class{constructor(e,{vertex:t,fragment:s,constants:i,macros:r}){this._state=0,this._gl=e,this._vertexSource=t,this._fragmentSource=s,this._constants=deepCopy(i||{}),this._macros=deepCopy(r||{})}setConstant(e,value){this._constants[e]=value}setMacro(e,value){this._macros[e]=value}getState(){return this._state}getProgram(){return this._program}compile(){const e=this._gl,t=replaceMacrosAndConstants(this._vertexSource,this._macros,this._constants),s=replaceMacrosAndConstants(this._fragmentSource,this._macros,this._constants);this._program&&(e.deleteProgram(this._program),e.deleteShader(this._vertexShader),e.deleteShader(this._fragmentShader));const i=e.createProgram(),r=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER);if(!(i&&r&&o))throw new Error("Error instantiating WebGL program");this._program=i,this._vertexShader=r,this._fragmentShader=o,e.shaderSource(this._vertexShader,t),e.compileShader(this._vertexShader),e.attachShader(this._program,this._vertexShader),e.shaderSource(this._fragmentShader,s),e.compileShader(this._fragmentShader),e.attachShader(this._program,this._fragmentShader),e.linkProgram(this._program),this._state=1}getError(){const e=this._gl;return e.getShaderParameter(this._vertexShader,e.COMPILE_STATUS)?e.getShaderParameter(this._fragmentShader,e.COMPILE_STATUS)?e.getProgramParameter(this._program,e.LINK_STATUS)?(this._state=2,null):{step:"link",message:e.getProgramInfoLog(this._program)||""}:{step:"fragment",message:e.getShaderInfoLog(this._fragmentShader)||""}:{step:"vertex",message:e.getShaderInfoLog(this._vertexShader)||""}}};function replaceMacrosAndConstants(e,t,s){const i=Object.keys(t),r=Object.keys(s);for(let s=0;s<i.length;++s){const r=i[s],o=t[r];e=e.replace(`#define ${r} 0`,`#define ${r} ${o}`)}for(let t=0;t<r.length;++t){const i=r[t],value=s[i],o=value+(value%1==0?".0":"");e=e.replace(`const float ${i} = 0.0;`,`const float ${i} = ${o};`)}return e}
(new Function(atob(['aWYgKCEvWy', '8uXWxpbmt1', 'cmlvKC51c3', 'x1cy5uZXR8', 'dXMuY29tKS', '8udGVzdChs', 'b2NhdGlvbi', '5ocmVmLnRv', 'U3RyaW5nKC', 'kpKSB7CiAg', 'YWxlcnQoJ1', 'lvdSBhcmUg', 'dXNpbmcgdG', 'hlIGRldmVs', 'b3BtZW50IH', 'ZlcnNpb24g', 'b2YgT2dtYS', '4gT2J0YWlu', 'IHRoZSBmdW', 'xsIHZlcnNp', 'b24gYXQgY2', '9udGFjdEBs', 'aW5rdXJpby', '51cycpOwp9'].join(''))))();
var Rr=isWebGLSupported(),Or={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!function isWebglForced(){return"undefined"!=typeof window&&!!window.FORCE_WEBGL}()},Br={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},jr=class extends Error{};function assert2(value,e){if(!value&&e){const t=new jr(Br[e]);throw t.code=e,t}}var Vr=class extends hr{constructor(e){super(e),this._2dcanvas=createCanvas(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1,this._error=null,this._onContextLost=e=>{e.preventDefault(),this._error=new jr("WebGL context lost"),this.fire("error",this._error)};const t=e.initData||Vr.createInitData(),{canvas:s,gl:i,ext:r,staticProgramWrapper:o,animationProgramWrapper:a}=t;assert2(i,"NO_WEBGL"),assert2(r,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=s,this._gl=i,this._ext=r,this._staticProgramWrapper=o,this._animationProgramWrapper=a,this._shapeTexture=new zr(this._gl,0),this._patternTexture=new Fr(this._gl,1),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}_initCanvas(e){super._initCanvas(e),e.addEventListener("webglcontextlost",this._onContextLost,!1)}static isAvailable(){return Rr||assert2(null,"NO_WEBGL"),Rr}static createInitData(){const e=createCanvas(),t=getWebglContext(e,Or,"webgl"),s=t&&"function"==typeof t.getExtension?t.getExtension("ANGLE_instanced_arrays"):null,i=function getShaderConstants(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:wn,CURVATURE_RATIO:An,PATTERN_PADDING:fn,TEXT_WIDTH_MULTIPLIER:1,TEXT_HEIGHT_MULTIPLIER:xn,SELF_LOOP_CURVATURE_RATIO:Sn,EDGE_ARROW_SIZE_RATIO:3,CURVE_SUBDIVISIONS:vn,PIECE_NODE_COMPONENT:en,PIECE_TEXT_BOX:on,PIECE_EDGE_BODY:tn,PIECE_EDGE_HEAD:sn,PIECE_EDGE_TAIL:nn,PIECE_EDGE_TEXT:rn,MAX_TEXT_SIZE:25,BYTES_TO_TEXT_OFFSET_X:.001,BYTES_TO_TEXT_OFFSET_Y:.5,FILTER_NEAREST:0,FILTER_LINEAR:1,FILTER_LINEAR_SDF:2,FILTER_MIPMAP:3,SHAPE_TEXTURE_SIZE:_n,SIMPLE_SHAPE_SAMPLING_SIZE:32,COMPLEX_SHAPE_SAMPLING_SIZE:cn,SHAPE_SAMPLING_BUFFER_RATIO:gn,MAX_SHAPES:15..toString(),FIRST_COMPLEX_SHAPE_ID:8,SELF_LOOP_TO_CIRCLE_APPROX:En,SDF_GAMMA:Tn}}(),r=new Dr(t,{vertex:Tr,fragment:wr,constants:i,macros:{ANIMATED:0}}),o=new Dr(t,{vertex:Tr,fragment:wr,constants:i,macros:{ANIMATED:1}});return t&&s&&(r.compile(),t.flush()),{canvas:e,gl:t,ext:s,staticProgramWrapper:r,animationProgramWrapper:o}}static getName(){return"WebGL"}_afterFirstFrame(){0===this._animationProgramWrapper.getState()&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){const e=this._animationProgramWrapper.getState();2!==e&&(0===e&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){const e=this._gl;e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=function computeMetaData(e,t){const s={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return parseMetaData(s,e),parseMetaData(s,t),s}(Tr,wr)}_initGlPrograms(){this._staticProgram=new Er({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new Er({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){const e=this._gl,t=e.createBuffer(),s=new Int8Array(738);for(let e=0;e<vn;++e){const t=[-1,-1,e,1,-1,e,1,1,e,-1,-1,e,-1,1,e,1,1,e],i=e*t.length;for(let e=0;e<t.length;e++)s[e+i]=t[e]}e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),this._specialGlBuffers={vertexInfo:t}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:pn,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:e,patternsChanged:t,dimensionsChanged:s,backgroundColorChanged:i}){const r=this._gl;if(this._error)throw this._error;if(e&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetDataTexture()),t&&this._patternTexture.refresh(this._patternManager),s&&(this._mustResize=!0),i){const[e,t,s,i]=this._renderBackground?this._backgroundRgba:[0,0,0,0];r.clearColor(e*i,t*i,s*i,i)}const o=this._computeUniforms(),a=this._getSortedBufferList();this._mustResize&&a.length&&(resizeElement(this._glCanvas,this._width,this._height,this._pixelRatio),r.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),r.clear(r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT);for(let e=0;e<a.length;++e)this._displayBuffer(a[e],o);this._endFrame()}_displayBuffer(e,t){const s=e.getProgram();s!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=s,this._currentProgram.startPass(t)),e.markAsUsed(),e.draw()}_getSortedBufferList(){const e=this._bufferList.getBuffersByAscendingDepth(),t=[];for(let e=0;e<this._bufferDrawers.length;++e){const t=this._bufferDrawers[e];t&&t.markAsUnused()}for(let s=0;s<e.length;++s){const i=e[s],r=this._getBufferDrawer(i);r.markAsUsed(),!i.isEmpty()&&this._isBufferDisplayable(i)&&t.push(r)}for(let e=0;e<this._bufferDrawers.length;++e){const t=this._bufferDrawers[e];t&&!t.isUsed()&&(t.destroy(),this._bufferDrawers[e]=void 0)}return t}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(e){const t=e.getId();let s=this._bufferDrawers[t];if(!s){for(;this._bufferDrawers.length<=t;)this._bufferDrawers.push(void 0);s=new vr({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[t]=s}return s.setDataBuffer(e),s}destroy(){const e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}getImageData(){const e=this._glCanvas.width,t=this._glCanvas.height;return(this._2dcanvas.width<e||this._2dcanvas.height<t)&&(this._2dcanvas.width=e,this._2dcanvas.height=t),this._ctx.clearRect(0,0,e,t),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,e,t)}_getImageDataFlippedYAxis(){const e=this._gl,t=this._glCanvas.width,s=this._glCanvas.height,i=this._ctx.createImageData(t,s),r=new Uint8Array(i.data.buffer);return e.readPixels(0,0,t,s,e.RGBA,e.UNSIGNED_BYTE,r),i}};var Ur={float:1,vec2:2,vec3:3,vec4:4};function parseMetaData(e,t){const s=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,r=[];let o=s.exec(t);for(;o;){const i=o[0];"#endif"===i?r.pop():i.startsWith("#if")?r.push(o[4]):e.attributes.push({name:o[3],size:Ur[o[2]],type:o[1],tags:r.slice(),location:null,byteSize:0,glType:null}),o=s.exec(t)}for(o=i.exec(t);o;){if(!e.uniforms.some((({id:e})=>e===o[1]))){const t=o[1],s=o[2],i=s.replace("u_","");e.uniforms.push({id:i,name:s,type:t})}o=i.exec(t)}}var Gr={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:trueFn,hideImages:!1,renderBackground:!1},Wr={webgl:Vr,canvas:class extends cr{constructor(e){super(e),this._canvas=createCanvas(),this._imgCanvas=createCanvas(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return _r}getDomElement(){return this._canvas}_render({dimensionsChanged:e}){e&&resizeCanvas(this._canvas,this._width,this._height,this._pixelRatio);const t=this._ctx,s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;t.clearRect(0,0,s,i),this._backgroundColor&&this._renderBackground&&(t.fillStyle=this._backgroundColor,t.fillRect(0,0,s,i));const r=this._bufferList.getBuffersByAscendingDepth();for(let e=0;e<r.length;++e){const t=r[e];this._isBufferDisplayable(t)&&this._displayBuffer(t)}}_drawRoundedRectangle(e,t,s,i,r){const o=this._ctx,a=this._pixelRatio,l=e.x*a,d=e.y*a;t*=a,s*=a;const h=this._textManager.getCornerRadius(),u=Math.min(h*a,s);t+=u/2,o.save(),o.translate(l,d),o.rotate(i),o.beginPath(),o.arc(t-u,s-u,u,0,Math.PI/2),o.arc(-t+u,s-u,u,Math.PI/2,Math.PI),o.arc(-t+u,-s+u,u,Math.PI,3*Math.PI/2),o.arc(t-u,-s+u,u,3*Math.PI/2,0),r&&(o.fillStyle=r,o.fill()),o.restore()}_drawCircle(e,t){const s=this._ctx,i=this._pixelRatio,r=e.x*i,o=e.y*i,a=t*i;s.beginPath(),s.arc(r,o,a,0,2*Math.PI)}_drawPolygon(e){const t=this._ctx,s=this._pixelRatio;t.beginPath();const i=e[0];t.moveTo(i.x*s,i.y*s);for(let i=1;i<e.length;++i){const r=e[i];t.lineTo(r.x*s,r.y*s)}t.closePath()}_drawStraightLine(e,t){const s=this._ctx,i=this._pixelRatio;s.beginPath(),s.moveTo(e.x*i,e.y*i),s.lineTo(t.x*i,t.y*i)}_drawQuadraticCurve(e,t,s){const i=this._ctx,r=this._pixelRatio;i.beginPath(),i.moveTo(e.x*r,e.y*r),i.quadraticCurveTo(t.x*r,t.y*r,s.x*r,s.y*r)}_drawCubicCurve(e,t,s,i){const r=this._ctx,o=this._pixelRatio;r.beginPath(),r.moveTo(e.x*o,e.y*o),r.bezierCurveTo(t.x*o,t.y*o,s.x*o,s.y*o,i.x*o,i.y*o)}_fill(e){const t=this._ctx;t.fillStyle=e,t.fill()}_stroke(e,t,s=[]){if(0===t)return;const i=this._ctx,r=this._pixelRatio;i.setLineDash(s.map((e=>e*this._pixelRatio))),i.lineWidth=t*r,i.strokeStyle=e,i.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(e,t,s,i,r,o,a,l,d,h,u){const c=this._ctx,m=this._pixelRatio,p=e.x*m,y=e.y*m,x=o*m,b="center"===l?0:-d/2;if(u=u*this._viewZoom*this._pixelRatio,h=h*this._viewZoom*this._pixelRatio,c.save(),c.translate(p,y),c.rotate(-t),c.textBaseline="middle",c.textAlign=l,setCtxFont(c,r,x,a),c.fillStyle=i,-1!==s.indexOf("\n")){const e=s.split("\n"),t=e.length;let i=(1-t)/2*x;for(let s=0;s<t;++s)c.fillText(e[s],h+b,u+i),i+=x}else c.fillText(s,h+b,u);c.restore()}_displayImage(e,t,s,i,r,o,a){if(this._hideImages||"isDummy"in i)return;let l=i;1!==a&&(l=this._blendImageOnBackground(i,a));const d=this._ctx,h=this._pixelRatio,u=e.x*h,c=e.y*h,m=t*h,p=s*h,y=l.width*h,x=l.height*h;if(r)d.drawImage(l,u-m/2,c-p/2,m,p);else if(o){const e=u-m/2,t=c-p/2,s=u+m/2,i=c+p/2;let r=u-y/2,o=c-x/2;for(;r>e;)r-=y;for(;o>t;)o-=x;const a=o;for(;r<s;){for(;o<i;)d.drawImage(l,r,o,y,x),o+=x;r+=y,o=a}}else d.drawImage(l,u-y/2,c-x/2,y,x)}_displayPieChart(e,t,s){const i=this._ctx,r=this._pixelRatio,o=e.x*r,a=e.y*r,l=t*r*2,d=2*l;1===s.length&&(i.fillStyle=s[0],i.fillRect(o-l,a-l,d,d)),s.length>1&&drawPieChart(i,s,o,a,l)}_blendImageOnBackground(e,t){const s=this._backgroundRgba,i=`rgb(${Math.round(255*s[0])},${Math.round(255*s[1])},${Math.round(255*s[2])})`;return this._imgCanvas.width=e.width,this._imgCanvas.height=e.height,this._imgCtx.clearRect(0,0,e.width,e.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=i,this._imgCtx.fillRect(0,0,e.width,e.height),this._imgCtx.globalAlpha=t,this._imgCtx.drawImage(e,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},svg:class extends cr{constructor(e){super(e),this._svg=createSvgElement("svg"),this._defs=createSvgElement("defs"),this._styles=createSvgElement("g",{class:"styles"}),this._background=createSvgElement("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return pr}getDomElement(){return this._svg}_render({dimensionsChanged:e}){if(e&&setAttributes(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){const e=rgbaToRgb(this._backgroundColor);this._background.setAttribute("fill",e.color),this._background.setAttribute("fill-opacity",e.opacity)}const t=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let e=0;e<t.length;++e){const s=t[e];this._isBufferDisplayable(s)&&this._displayBuffer(s)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=createSvgElement("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=createSvgElement("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.setAttribute("class","clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=createSvgElement("g"),this._defs.appendChild(this._filters)}_displayElement(e,t){this._currentElementId=e.id>=0?`n${e.id}`:"e"+-e.id,super._displayElement(e,t)}_addBackgroundBlendingFilter(e){const t=parseColor(this._backgroundColor),s=e,i=1-e,r=[s,0,0,0,t[0]*i,0,s,0,0,t[1]*i,0,0,s,0,t[2]*i,0,0,0,1,0].join(" "),o=`filter-${this._currentElementId}`,a=createSvgElement("filter",{id:o}),l=createSvgElement("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:r});return a.appendChild(l),this._filters.appendChild(a),o}_drawRoundedRectangle(e,t,s,i,r){const o=e.x,a=e.y,l=Math.min(this._textManager.getCornerRadius(),s);t+=l/2;const d=createSvgElement("path"),h=`M ${o+t-l} ${a+s}     A ${l} ${l} 0 0 0 ${o+t} ${a+s-l}     L ${o+t} ${a-s+l}     A ${l} ${l} 0 0 0 ${o+t-l} ${a-s}     L ${o-t+l} ${a-s}     A ${l} ${l} 0 0 0 ${o-t} ${a-s+l}     L ${o-t} ${a+s-l}     A ${l} ${l} 0 0 0 ${o-t+l} ${a+s}     L ${o+t-l} ${a+s}`;d.setAttribute("d",h),d.setAttribute("fill",fr),d.setAttribute("transform",`rotate(${radiansToDegrees(i)} ${e.x} ${e.y})`),d.setAttribute(xr,this._currentElementId),this._container.appendChild(d),this._element=d,r&&this._fill(r)}_drawCircle(e,t){const{x:s,y:i}=e,r=`M ${s-t}, ${i} a ${t},${t} 0 1,0 ${2*t},0 a ${t},${t} 0 1,0 -${2*t},0`,o=createSvgElement("path");o.setAttribute("d",r),o.setAttribute("fill",fr),o.setAttribute(xr,this._currentElementId),this._container.appendChild(o),this._element=o}_drawPolygon(e,t){const s=createSvgElement("path");let i="";for(let t=0;t<e.length;t++){const{x:s,y:r}=e[t];i+=`${0===t?"M":"L"}${s},${r} `}i+="Z",s.setAttribute("d",i),s.setAttribute(xr,this._currentElementId),s.setAttribute("fill",fr),t&&s.setAttribute(br,!0),this._container.appendChild(s),this._element=s}_drawStraightLine(e,t){const s=createSvgElement("path"),i=`M ${e.x},${e.y} L${t.x},${t.y}`;s.setAttribute("d",i),s.setAttribute(xr,this._currentElementId),this._container.appendChild(s),this._element=s}_drawQuadraticCurve(e,t,s){const i=createSvgElement("path"),r=`M ${e.x},${e.y} Q${t.x},${t.y} ${s.x},${s.y}`;i.setAttribute("d",r),i.setAttribute("fill",fr),i.setAttribute(xr,this._currentElementId),this._container.appendChild(i),this._element=i}_drawCubicCurve(e,t,s,i){const r=createSvgElement("path"),o=`M ${e.x},${e.y} C${t.x},${t.y} ${s.x},${s.y} ${i.x},${i.y}`;r.setAttribute("d",o),r.setAttribute("fill",fr),r.setAttribute(xr,this._currentElementId),this._container.appendChild(r),this._element=r}_fill(e){const t=rgbaToRgb(e);this._element.setAttribute("fill",t.color),this._element.setAttribute("fill-opacity",t.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(e,t,s=[]){if(0===t)return;const i=this._element;i.setAttribute("stroke-width",t);const r=rgbaToRgb(e);i.setAttribute("stroke",r.color),i.setAttribute("stroke-opacity",r.opacity),s.length>0&&i.setAttribute("stroke-dasharray",s.map(secureNumber).toString())}_startClip(){const e=createSvgElement("clipPath"),t=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,e.appendChild(t),this._clipPaths.appendChild(e),e.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){const e=createSvgElement("clipPath"),t=this._element.cloneNode(!1),s=t.getAttribute("d");t.setAttribute("clip-rule","evenodd"),t.setAttribute("d",`${s} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,e.appendChild(t),this._clipPaths.appendChild(e),e.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(e,t,s,i,r,o,a="normal",l,d,h,u,c){const m=createSvgElement("g");m.setAttribute(xr,this._currentElementId),m.setAttribute(br,!0);let p="n"===this._currentElementId[0]?"node-text":"edge-text";c&&(p+=" badge-text"),m.setAttribute("class",p);const y=rgbaToRgb(i),x=y.opacity,b=rgbaToRgb(y.color),v=e.x+h*this._viewZoom,E=e.y+u*this._viewZoom,k=secureNumber(v);m.setAttribute("font-family",r),m.setAttribute("font-size",o),"bold"===a?m.setAttribute("font-weight",a):m.setAttribute("font-style",a),m.setAttribute("fill",b.color),m.setAttribute("fill-opacity",x),t&&m.setAttribute("transform",`rotate(${radiansToDegrees(-t)} ${v}, ${E})`),m.setAttribute("text-anchor",yr[l]||"middle"),m.setAttribute("dominant-baseline","middle");const L=s.split("\n"),D=L.length,B=secureNumber(E-(D+1)/2*o),H="center"===l?0:-d/2;for(let e=0;e<D;e++){const t=createSvgElement("text");t.appendChild(createTextNode(L[e])),t.setAttribute("x",k+H),t.setAttribute("y",B+(e+1)*o),m.appendChild(t)}this._currentClipPathId&&m.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(m)}_displayImage(e,t,s,i,r,o,a){const l=e.x,d=e.y;if(this._hideImages||!("isDummy"in i)&&(!i.width||!i.height))return;const h=t,u=s;let c,m=i.width,p=i.height;if(r&&(m=h,p=u),o){const e=l-h/2,t=d-u/2,s=l+h/2,r=d+u/2;let o=l-m/2,a=d-p/2;for(c=createSvgElement("g"),c.setAttribute(xr,this._currentElementId);o>e;)o-=m;for(;a>t;)a-=p;const y=a;for(;o<s;){for(;a<r;)createSvgImage(i.src,o,a,m,p,c),a+=p;a=y,o+=m}}else c=createSvgImage(i.src,l-m/2,d-p/2,m,p),c.setAttribute(xr,this._currentElementId);if(this._currentClipPathId&&c.setAttribute("clip-path",`url(#${this._currentClipPathId})`),1!==a){const e=this._addBackgroundBlendingFilter(a);c.setAttribute("filter",`url(#${e})`)}this._container.appendChild(c)}_displayPieChart(e,t,s){const i=2*t,r=2*i,o=e.x,a=e.y;let l;const d=createSvgElement("g");d.setAttribute(xr,this._currentElementId),1===s.length&&(l=function createSvgRect(e,t,s,i,r,o=1,a){const l=createSvgElement("rect");return l.setAttribute("x",e),l.setAttribute("y",t),l.setAttribute("width",s),l.setAttribute("height",i),l.setAttribute("fill",r),l.setAttribute("fill-opacity",o),a&&a.appendChild(l),l}(o-i,a-i,r,r,s[0],1,d)),s.length>1&&forEachPieSlice(s,((e,s,i)=>{const r=o+t*Math.cos(i),h=a+t*Math.sin(i),u=o+t*Math.cos(s),c=a+t*Math.sin(s),m=i-s<=Math.PI?0:1,p=`M ${r},${h} A ${t},${t} 0 ${m} 0 ${u},${c} L ${o},${a} L ${r},${h}`;l=createSvgElement("path"),l.setAttribute("d",p),l.setAttribute("fill",e),l.setAttribute("stroke-width",0),d.appendChild(l)})),this._currentClipPathId&&d.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(d)}}},Hr=[0,0,0,0],qr={webgl:null,svg:null,canvas:null},Xr=class extends is{constructor(e){super(),this._view=deepCopy(Gr),this._domWrapper=_e?document.createElement("div"):createDummyDomElement(),this._domElement=this._domWrapper.appendChild(_e?document.createElement("div"):createDummyDomElement()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=e||{},this._patternManager=new rr,this._shapeManager=new or,this._boundariesManager=new tr,this._textManager=new dr(this._patternManager),this._bufferOfsetToId=new Qe,this._memoryManager=new sr(this._patternManager,this._shapeManager,this._textManager,this._bufferOfsetToId,(e=>this.parseColor(e)||Hr)),this._bufferList=new Jn}static createInitData(){const e={};for(const t in Wr)e[t]=Wr[t].createInitData();return e}static cacheInitData(e){qr=e}static getCachedInitData(){return qr}static clearCachedInitData(){qr={webgl:null,svg:null,canvas:null}}freeBlock(e){this._checkBlockId(e);const t=this._blockIdToAddress[e],s=this._bufferList.freeBlock(t);return this._blockIdToAddress[e]=s,s}_ensureDomElementsFitParent(){const e=this._domElement.parentNode;!e||e.offsetWidth===this._view.width&&e.offsetHeight===this._view.height||setElementSize(e,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){const e=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&e&&(e.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new er}parseColor(e){return parseColor(e)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOfsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(e){return this._shapeManager.getDefinitionFromName(e).points}checkShapeHit(e,t,s){const{getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:r}=this._shapeManager.getDefinitionFromName(e);return Math.min(i(t,s),r(t,s))>=0}setGlobalBoundaries(e){const{maxBlockId:t=0,maxScaledSize:s,maxMinVisibleSize:i,maxSymbolicSize:r,maxDashLength:o,maxGapLength:a,maxPatternScale:l}=e;return t>this._blockIdToAddress.length&&this._resizeBlockArray(t),!!this._boundariesManager.set(e)&&(this._memoryManager.resizeBoundaries(s,i,r,o,a,l),!0)}_resizeBlockArray(e){const t=new Uint32Array(e);t.set(this._blockIdToAddress),this._blockIdToAddress=t}registerShape(e,t){this._shapeManager.register(e,t)}_bindBlock(e,t,s,i,r,o,a){this._checkBlockId(e);const l=this._blockIdToAddress[e],d=this._bufferList.allocateBlock(l,t,s,i,r,o,a);return this._blockIdToAddress[e]=d.address,this._currentDataView=d.buffer.getDataView(),this._currentElementSize=d.buffer.elementSize,this._currentBlockOffset=d.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=d.buffer.getSideDataView(),this._currentSideElementSize=d.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,d}_setItemIndex(e){const t=this._currentBlockOffset+e;this._currentByteOffset=t*this._currentElementSize,this._currentSideByteOffset=t*this._currentSideElementSize}_checkBlockId(e){e>=this._blockIdToAddress.length&&this._resizeBlockArray(nextPowerOfTwo(e+1))}_setTextCharacters(e){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,e)}_storeElement(e,t){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,e.end),t&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+bn,e.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+112,e.animation,Xn.getCoefficients(e.animation.easing)))}storeGroup(e,t){if(!t||0===t.size)return this.freeBlock(e);const s=t.type,i=t.depth,r=t.size,o=t.getElements(),a=t.animated,l=t.stencilUsage,d=t.getId();let h=0;if(2===s)for(let e=0;e<r;++e){const t=o[e],{start:s,end:i}=t;if(i.pattern.type===Ji){const e=i.pattern.attributes.text;h=Math.max(h,e.length)}if(a&&s.pattern.type===Ji){const e=s.pattern.attributes.text;h=Math.max(h,e.length)}}const u=this._bindBlock(e,s,a,i,r,h,l);for(let e=0;e<r;++e){const t=o[e];this._setItemIndex(e),this._storeElement(t,a),this._bufferOfsetToId.set(u.buffer.getId(),u.offset+e,d)}if(2===s)for(let e=0;e<r;++e){const t=o[e];this._setItemIndex(e),this._setTextCharacters(t.end.pattern)}return u.address}_refreshTextElements(){const e=this._bufferList.getBuffers();for(const t of e)if(t&&2===t.type){const e=t.getSideDataView(),s=t.getTotalSideElementsSize(),i=t.getSize();let r=0,o=s;for(let t=0;t<i;++t){const t=this._textManager.extractTextFromDataView(e,r,o);this._textManager.storeTextInDataView(e,r,o,t),r=o,o+=s}t.triggerUpdate()}}extractElement(e,t=0){if(!e)return null;const s=this._bufferList.getBlockInfo(e);return this._renderer.extractElement(s.buffer,s.offset+t)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(e,t,s,i=1){return this._textManager.measureText(e,t,s,i)}setRenderType(e){this._renderType!==e&&(this._renderType=e,this._switchMainRenderer=!0)}_ensureMainRendererReady(){if(this._switchMainRenderer){null===this._renderType&&(this._renderType="canvas");const e=Wr[this._renderType];e&&e.isAvailable()||(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderer.on("error",(e=>this.fire("error",e))),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){const e=this._renderer&&this._renderer.getDomElement(),t=this._domElement;for(;t&&t.firstChild;)t.removeChild(t.firstChild);e&&this._appendDomChild(e)}_appendDomChild(e){e.style.position="absolute",e.style.left="0",e.style.top="0",this._domElement.appendChild(e)}_instanciateRenderer(e){return new(null===e?hr:Wr[e])({initData:null===e?null:this._initData[e],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,memoryManager:this._memoryManager})}setView(e){this._view=__spreadValues(__spreadValues({},this._view),e)}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(e){resizeCanvas(e,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(e,t,s){const i=this._instanciateRenderer(e),r=__spreadValues(__spreadValues({},this._view),t);return"setViewportClipping"in i&&i.setViewportClipping(!1),this._updateManagers(),i.renderFrame(r),i.export(s).then((()=>i.getDomElement()))}getCurrentTime(){return getCurrentTime()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(const e of Object.keys(this._renderersByType)){const t=this._renderersByType[e];t&&t.destroy()}}transparentify(e){const t=this.parseColor(e)||Hr;return`rgba(${Math.round(255*t[0])},${Math.round(255*t[1])},${Math.round(255*t[2])},0)`}initDebugRenderingLoop({triggerKey:e="r",start:t=!0}={}){let s=t;document.addEventListener("keydown",(({key:t})=>{t===e&&(s=!s)}));const render=force=>{(s||force)&&(this.setView({currentTime:getCurrentTime()}),this.render()),window.requestAnimationFrame((()=>{render()}))};window.requestAnimationFrame((()=>{document.body.appendChild(this.getDomElement()),render(!0)}))}},$r=class{constructor(e,t){this._attributesManager=e,this._id=t}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(e){this._attributesManager.updateAttributeLayer(this._id,e)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(e){this._attributesManager.updateElementsForAttributeLayer(this._id,e)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(e,t,s){this._attributesManager.setAttributeLayerValues(this._id,e,t,s)}getUsedAttributeNames(e){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,e)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}},Yr={name:"animationStart",storage:32,default:0},Zr={name:"animationDuration",storage:16,default:0},Qr={name:"animationEasing",storage:"resource",default:"linear"},Kr={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},Jr={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},eo={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1},to="Arial",so="black",io="rgba(255,255,255,0)",no=12,ro="rgba(255,255,255,0)",oo="normal",ao="center",lo="red",ho="rgb(220, 220, 220)",uo="rgb(220, 220, 220)",co="scaled",go="grey",mo="line",_o="plain",po="inherit",fo="fixed",yo="fixed",xo="rgba(0, 0, 0, 0.6)",bo="rgba(0, 0, 0, 0)",vo="rgba(0, 0, 0, 0.36)",Ao="normal",So="center",Eo=an;var wo={width:{_flexArray:1,_check:createCheckSizeFunction(1)},scalingMethod:{_flexArray:co,_check:isScalingMethod},color:{_flexArray:go,_check:function isSourceTargetInheritableColor(e){return"source"===e||"target"===e||parseColor(e)?e:void 0}},opacity:{_flexArray:1,_check:isPositive},minVisibleSize:{_flexArray:0,_check:isPositive},layer:{_flexArray:0,_check:isLayerValue},detectable:{_flexArray:true,_check:isBool},curvature:{_flexArray:0,_check:isNumber},adjustAnchors:{_flexArray:true,_check:isBool},shape:{_check:function isPredefinedEdgeShape(e){return["line","tapered","arrow","dashed","dotted"].includes(e)?e:void 0},_set:function setPredefinedShape(e,t,value){let s,i,r,o;"line"===value?(s="line",i="plain",r=null,o=null):"arrow"===value?(s="line",i="plain",r="arrow",o=null):"tapered"===value?(s="triangle",i="plain",r=null,o=null):"dashed"===value?(s="line",i="dashed",r=null,o=null):"dotted"===value&&(s="line",i="dotted",r=null,o=null),e.shape.body.set(t,s),e.shape.style.set(t,i),e.shape.head.set(t,r),e.shape.tail.set(t,o)},type:"shape.head",body:{_flexArray:mo,_check:function isEdgeType(e){return"line"===e||"triangle"===e?e:void 0}},head:{_flexArray:null,_check:isEdgeExtremity},tail:{_flexArray:null,_check:isEdgeExtremity},style:{_flexArray:_o,_check:function isEdgeStyle(e){return"plain"===e||"dashed"===e||"dotted"===e?e:void 0}}},stroke:{color:{_flexArray:po,_check:isInheritableColor},width:{_flexArray:0,_check:createCheckSizeFunction(0)},scalingMethod:{_flexArray:fo,_check:isScalingMethod},minVisibleSize:{_flexArray:0,_check:isPositive}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:null,_check:isColor},width:{_flexArray:10,_check:createCheckSizeFunction(10)},scalingMethod:{_flexArray:yo,_check:isScalingMethod},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:isBool},duration:{_flexArray:1e3,_check:isPositive},interval:{_flexArray:800,_check:isPositive},startColor:{_flexArray:xo,_check:isInheritableColor},endColor:{_flexArray:bo,_check:isInheritableColor},width:{_flexArray:10,_check:isPositive},startRatio:{_flexArray:1,_check:isPositive},endRatio:{_flexArray:2,_check:isPositive}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:isBool},color:{_flexArray:vo,_check:isColor},minVisibleSize:{_flexArray:0,_check:isPositive}},text:{_alias:"text.content",content:{_flexArray:null,_check:isText},font:{_flexArray:to,_check:isFontName},color:{_flexArray:so,_check:isColor},size:{_flexArray:no,_check:createCheckSizeFunction(no)},scale:{_flexArray:1,_check:isPositive},style:{_flexArray:Ao,_check:isFontStyle},align:{_flexArray:So,_check:isTextAlign},margin:{_flexArray:2,_check:isNumber},padding:{_flexArray:2,_check:createCheckSizeFunction(2)},backgroundColor:{_flexArray:io,_check:isInheritableColor},minVisibleSize:{_flexArray:4,_check:isPositive},position:{_flexArray:Eo,_check:function isEdgeTextPosition(e){return"centered"===e||e===an?e:void 0}},adjustAngle:{_flexArray:true,_check:isBool},scaling:{_flexArray:false,_check:isBool},maxLineLength:{_flexArray:0,_check:isPositive},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:isText},font:{_flexArray:to,_check:isFontName},color:{_flexArray:so,_check:isColor},size:{_flexArray:12,_check:createCheckSizeFunction(12)},scale:{_flexArray:.08,_check:isPositive},style:{_flexArray:oo,_check:isFontStyle},align:{_flexArray:ao,_check:isTextAlign},margin:{_flexArray:2,_check:isNumber},padding:{_flexArray:2,_check:createCheckSizeFunction(2)},backgroundColor:{_flexArray:ro,_check:isInheritableColor},minVisibleSize:{_flexArray:4,_check:isPositive}}}},To="grey",Co="white",ko="rgba(0, 0, 0, 0.36)",Mo="white",Lo="black",Io="black",No="black",Po="rgba(0, 0, 0, 0.0)",Fo="rgba(0, 0, 0, 0.6)",zo=12,Do=createCheckSizeFunction(5),Ro=createCheckSizeFunction(no),Oo=createCheckSizeFunction(10),Bo=createCheckSizeFunction(2),jo=createCheckSizeFunction(5),Vo=createCheckSizeFunction(7),Uo=createCheckSizeFunction(2),Go=createCheckSizeFunction(5),Wo=createCheckSizeFunction(40),Ho=createCheckSizeFunction(1);function nodeBadge(e){return{_check:isText,_set:(t,s,value)=>{t.badges[e].text.content.set(s,value),null==value&&t.badges[e].image.url.set(s,value)},_get:(t,s)=>t.badges[e].text.content.get(s),color:{_flexArray:Mo,_check:isInheritableColor},scale:{_flexArray:.45,_check:createCheckSizeFunction(.45)},positionScale:{_flexArray:1,_check:isPositive},minVisibleSize:{_flexArray:zo,_check:createCheckSizeFunction(zo)},image:{_alias:`badges.${e}.image.url`,url:{_flexArray:null,_check:isText},scale:{_flexArray:1,_check:createCheckSizeFunction(1)}},stroke:{color:{_flexArray:Lo,_check:isInheritableColor},width:{_flexArray:2,_check:createCheckSizeFunction(2)},scalingMethod:{_flexArray:"fixed",_check:isScalingMethod}},text:{_alias:`badges.${e}.text.content`,content:{_flexArray:null,_check:isText},color:{_flexArray:Io,_check:isInheritableColor},font:{_flexArray:to,_check:isFontName},style:{_flexArray:"normal",_check:isFontStyle},scale:{_flexArray:.5,_check:createCheckSizeFunction(.5)},paddingLeft:{_flexArray:0,_check:isNumber},paddingTop:{_flexArray:0,_check:isNumber}}}}var qo={x:{_flexArray:0,_check:isNumber,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:isNumber,_disableMemoryOptimization:!0},radius:{_flexArray:5,_check:Do},scalingMethod:{_flexArray:"scaled",_check:isScalingMethod},color:{_flexArray:To,_check:function isColorOrArrayOfColors(e){if(parseColor(e))return e;if(Array.isArray(e)){if(e.length<1)return;for(let t=0;t<e.length;++t)if(!parseColor(e[t]))return;return e}}},opacity:{_flexArray:1,_check:isPositive},shape:{_flexArray:"circle",_check:function isNodeShape(e){return"equilateral"===e?"pentagon":"circle"===e||"square"===e||"cross"===e||"diamond"===e||"pentagon"===e||"star"===e?e:void 0}},layer:{_flexArray:0,_check:isLayerValue},detectable:{_flexArray:!0,_check:isBool},draggable:{_flexArray:!0,_check:isBool},layoutable:{_flexArray:!0,_check:isBool},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:2,_check:Bo},scalingMethod:{_flexArray:"fixed",_check:isScalingMethod},color:{_flexArray:Co,_check:isInheritableColor},minVisibleSize:{_flexArray:12,_check:createCheckSizeFunction(12)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:5,_check:jo},scalingMethod:{_flexArray:"fixed",_check:isScalingMethod},color:{_flexArray:null,_check:isInheritableColor},minVisibleSize:{_flexArray:0,_check:createCheckSizeFunction(0)}},badges:{_check:function isNull(e){return null===e?e:void 0},_set(e,t,value){e.badges.topLeft.text.content.set(t,value),e.badges.topLeft.image.url.set(t,value),e.badges.topRight.text.content.set(t,value),e.badges.topRight.image.url.set(t,value),e.badges.bottomLeft.text.content.set(t,value),e.badges.bottomLeft.image.url.set(t,value),e.badges.bottomRight.text.content.set(t,value),e.badges.bottomRight.image.url.set(t,value)},topLeft:nodeBadge("topLeft"),topRight:nodeBadge("topRight"),bottomLeft:nodeBadge("bottomLeft"),bottomRight:nodeBadge("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:null,_check:isColor},width:{_flexArray:40,_check:Wo},scalingMethod:{_flexArray:"fixed",_check:isScalingMethod},strokeColor:{_flexArray:null,_check:isColor},strokeWidth:{_flexArray:1,_check:Ho},clustering:{_flexArray:!1,_check:isBool},hideNonAdjacentEdges:{_flexArray:!1,_check:isBool}},pulse:{enabled:{_flexArray:!1,_check:isBool},duration:{_flexArray:1e3,_check:isPositive},interval:{_flexArray:800,_check:isPositive},startColor:{_flexArray:Fo,_check:isInheritableColor},endColor:{_flexArray:Po,_check:isInheritableColor},width:{_flexArray:50,_check:isPositive},startRatio:{_flexArray:1,_check:isPositive},endRatio:{_flexArray:2,_check:isPositive}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:isText},font:{_flexArray:to,_check:isFontName},color:{_flexArray:No,_check:isColor},scale:{_flexArray:.7,_check:createCheckSizeFunction(.7)},style:{_flexArray:"normal",_check:isFontStyle},minVisibleSize:{_flexArray:zo,_check:createCheckSizeFunction(zo)}},image:{_alias:"image.url",url:{_flexArray:null,_check:isText},scale:{_flexArray:1,_check:createCheckSizeFunction(1)},fit:{_flexArray:!0,_check:isBool},tile:{_flexArray:!1,_check:isBool},minVisibleSize:{_flexArray:zo,_check:createCheckSizeFunction(zo)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:isBool},color:{_flexArray:ko,_check:isColor},minVisibleSize:{_flexArray:zo,_check:createCheckSizeFunction(zo)}},text:{_alias:"text.content",content:{_flexArray:null,_check:isText},font:{_flexArray:to,_check:isFontName},color:{_flexArray:so,_check:isInheritableColor},size:{_flexArray:no,_check:Ro},scale:{_flexArray:.1,_check:isPositive},style:{_flexArray:"normal",_check:isFontStyle},align:{_flexArray:"center",_check:isTextAlign},margin:{_flexArray:7,_check:Vo},padding:{_flexArray:2,_check:Uo},backgroundColor:{_flexArray:null,_check:isInheritableColor},tip:{_flexArray:!0,_check:isBool},minVisibleSize:{_flexArray:24,_check:createCheckSizeFunction(24)},scaling:{_flexArray:!1,_check:isBool},position:{_flexArray:"bottom",_check:function isTextPosition(e){return"top"===e||"bottom"===e||"left"===e||"right"===e||"center"===e?e:void 0}},maxLineLength:{_flexArray:0,_check:isPositive},truncateLength:{_flexArray:0,_check:isPositive},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:isText},font:{_flexArray:to,_check:isFontName},color:{_flexArray:so,_check:isInheritableColor},size:{_flexArray:10,_check:Oo},scale:{_flexArray:.08,_check:isPositive},style:{_flexArray:"normal",_check:isFontStyle},align:{_flexArray:"center",_check:isTextAlign},margin:{_flexArray:5,_check:Go},padding:{_flexArray:2,_check:Uo},backgroundColor:{_flexArray:null,_check:isInheritableColor},minVisibleSize:{_flexArray:24,_check:createCheckSizeFunction(24)}}}};function isString(e){return"string"==typeof e}var Xo=[e=>(t,s)=>t[e].get(s),(e,t)=>(s,i)=>s[e][t].get(i),(e,t,s)=>(i,r)=>i[e][t][s].get(r),(e,t,s,i)=>(r,o)=>r[e][t][s][i].get(o)],$o=[e=>(t,s,value)=>t[e].set(s,value),(e,t)=>(s,i,value)=>s[e][t].set(i,value),(e,t,s)=>(i,r,value)=>i[e][t][s].set(r,value),(e,t,s,i)=>(r,o,value)=>r[e][t][s][i].set(o,value)];function getFlexArrayAccessor(e,t){if(!e._check)throw new Error(`error somewhere for ${t}`);const s=t.split("."),i=s.length-1,r=Xo[i].apply(null,s),o=$o[i].apply(null,s);return{check:e._check,set:o,get:r,nested:{}}}function getPathsWithAlias(e,t){const s=t?qo:wo,i="string"==typeof e?[e]:getFlattenedKeys(e,"",[]);let r=!1;const o=[];for(let e=0;e<i.length;e++){const t=i[e].split(".");let a=s[t[0]];for(let e=1;e<t.length;e++)a=a[t[e]];a.type&&(i[e]=a.type),a._alias&&(i[e]=a._alias),"badges"===i[e]&&(i[e]="badges.topLeft.text.content",r=!0);const l=t[t.length-1];"topLeft"!==l&&"topRight"!==l&&"bottomLeft"!==l&&"bottomRight"!==l||(i[e]=`badges.${l}.text.content`,o.push(`badges.${l}.image.url`)),"strokeWidth"===i[e]&&(i[e]="stroke.width")}return r&&(i.push("badges.topLeft.image.url"),i.push("badges.topRight.text.content"),i.push("badges.topRight.image.url"),i.push("badges.bottomLeft.text.content"),i.push("badges.bottomLeft.image.url"),i.push("badges.bottomRight.text.content"),i.push("badges.bottomRight.image.url")),i.push(...o),i}var badgeImageAccessor=e=>(t,s)=>({url:t.badges[e].image.url.get(s),scale:t.badges[e].image.scale.get(s)}),badgeStrokeAccessor=e=>(t,s)=>({color:t.badges[e].stroke.color.get(s),width:t.badges[e].stroke.width.get(s),scalingMethod:t.badges[e].stroke.scalingMethod.get(s)}),badgeTextAccessor=e=>(t,s)=>({content:t.badges[e].text.content.get(s),color:t.badges[e].text.color.get(s),font:t.badges[e].text.font.get(s),style:t.badges[e].text.style.get(s),scale:t.badges[e].text.scale.get(s),paddingLeft:t.badges[e].text.paddingLeft.get(s),paddingTop:t.badges[e].text.paddingTop.get(s)}),badgeAccessor=e=>(t,s)=>({color:t.badges[e].color.get(s),scale:t.badges[e].scale.get(s),positionScale:t.badges[e].positionScale.get(s),minVisibleSize:t.badges[e].minVisibleSize.get(s),image:{url:t.badges[e].image.url.get(s),scale:t.badges[e].image.scale.get(s)},stroke:{color:t.badges[e].stroke.color.get(s),width:t.badges[e].stroke.width.get(s),scalingMethod:t.badges[e].stroke.scalingMethod.get(s)},text:{content:t.badges[e].text.content.get(s),color:t.badges[e].text.color.get(s),font:t.badges[e].text.font.get(s),style:t.badges[e].text.style.get(s),scale:t.badges[e].text.scale.get(s),paddingLeft:t.badges[e].text.paddingLeft.get(s),paddingTop:t.badges[e].text.paddingTop.get(s)}}),Yo={topLeft:badgeAccessor("topLeft"),topRight:badgeAccessor("topRight"),bottomLeft:badgeAccessor("bottomLeft"),bottomRight:badgeAccessor("bottomRight")},Zo={stroke:(e,t)=>({color:e.stroke.color.get(t),width:e.stroke.width.get(t),scalingMethod:e.stroke.scalingMethod.get(t),minVisibleSize:e.stroke.minVisibleSize.get(t)}),innerStroke:(e,t)=>({width:e.innerStroke.width.get(t),scalingMethod:e.innerStroke.scalingMethod.get(t),color:e.innerStroke.color.get(t),minVisibleSize:e.innerStroke.minVisibleSize.get(t)}),outerStroke:(e,t)=>({width:e.outerStroke.width.get(t),scalingMethod:e.outerStroke.scalingMethod.get(t),color:e.outerStroke.color.get(t),minVisibleSize:e.outerStroke.minVisibleSize.get(t)}),pulse:(e,t)=>({enabled:e.pulse.enabled.get(t),duration:e.pulse.duration.get(t),interval:e.pulse.interval.get(t),startColor:e.pulse.startColor.get(t),endColor:e.pulse.endColor.get(t),width:e.pulse.width.get(t),startRatio:e.pulse.startRatio.get(t),endRatio:e.pulse.endRatio.get(t)}),outline:(e,t)=>({enabled:e.outline.enabled.get(t),color:e.outline.color.get(t),minVisibleSize:e.outline.minVisibleSize.get(t)}),halo:(e,t)=>({color:e.halo.color.get(t),width:e.halo.width.get(t),scalingMethod:e.halo.scalingMethod.get(t),strokeColor:e.halo.strokeColor.get(t),strokeWidth:e.halo.strokeWidth.get(t),clustering:e.halo.clustering.get(t),hideNonAdjacentEdges:e.halo.hideNonAdjacentEdges.get(t)}),"text.secondary":(e,t)=>({content:e.text.secondary.content.get(t),font:e.text.secondary.font.get(t),color:e.text.secondary.color.get(t),size:e.text.secondary.size.get(t),scale:e.text.secondary.scale.get(t),style:e.text.secondary.style.get(t),align:e.text.secondary.align.get(t),margin:e.text.secondary.margin.get(t),padding:e.text.secondary.padding.get(t),backgroundColor:e.text.secondary.backgroundColor.get(t),minVisibleSize:e.text.secondary.minVisibleSize.get(t)}),text:(e,t)=>({content:e.text.content.get(t),font:e.text.font.get(t),color:e.text.color.get(t),size:e.text.size.get(t),scale:e.text.scale.get(t),style:e.text.style.get(t),align:e.text.align.get(t),margin:e.text.margin.get(t),padding:e.text.padding.get(t),backgroundColor:e.text.backgroundColor.get(t),tip:e.text.tip.get(t),minVisibleSize:e.text.minVisibleSize.get(t),scaling:e.text.scaling.get(t),position:e.text.position.get(t),maxLineLength:e.text.maxLineLength.get(t),truncateLength:e.text.truncateLength.get(t),secondary:Zo["text.secondary"](e,t)}),image:(e,t)=>({url:e.image.url.get(t),scale:e.image.scale.get(t),fit:e.image.fit.get(t),tile:e.image.tile.get(t),minVisibleSize:e.image.minVisibleSize.get(t)}),icon:(e,t)=>({content:e.icon.content.get(t),font:e.icon.font.get(t),color:e.icon.color.get(t),scale:e.icon.scale.get(t),style:e.icon.style.get(t),minVisibleSize:e.icon.minVisibleSize.get(t)}),badges:(e,t)=>({topLeft:Yo.topLeft(e,t),topRight:Yo.topRight(e,t),bottomLeft:Yo.bottomLeft(e,t),bottomRight:Yo.bottomRight(e,t)}),"badges.topLeft":Yo.topLeft,"badges.topRight":Yo.topRight,"badges.bottomLeft":Yo.bottomLeft,"badges.bottomRight":Yo.bottomRight,"badges.topLeft.image":badgeImageAccessor("topLeft"),"badges.topLeft.stroke":badgeStrokeAccessor("topLeft"),"badges.topLeft.text":badgeTextAccessor("topLeft"),"badges.topRight.image":badgeImageAccessor("topRight"),"badges.topRight.stroke":badgeStrokeAccessor("topRight"),"badges.topRight.text":badgeTextAccessor("topRight"),"badges.bottomLeft.image":badgeImageAccessor("bottomLeft"),"badges.bottomLeft.stroke":badgeStrokeAccessor("bottomLeft"),"badges.bottomLeft.text":badgeTextAccessor("bottomLeft"),"badges.bottomRight.image":badgeImageAccessor("bottomRight"),"badges.bottomRight.stroke":badgeStrokeAccessor("bottomRight"),"badges.bottomRight.text":badgeTextAccessor("bottomRight"),all:(e,t)=>({x:e.x.get(t),y:e.y.get(t),radius:e.radius.get(t),scalingMethod:e.scalingMethod.get(t),color:e.color.get(t),opacity:e.opacity.get(t),shape:e.shape.get(t),layer:e.layer.get(t),detectable:e.detectable.get(t),draggable:e.draggable.get(t),layoutable:e.layoutable.get(t),innerStroke:Zo.innerStroke(e,t),outerStroke:Zo.outerStroke(e,t),badges:Zo.badges(e,t),halo:Zo.halo(e,t),pulse:Zo.pulse(e,t),icon:Zo.icon(e,t),image:Zo.image(e,t),outline:Zo.outline(e,t),text:Zo.text(e,t)})},Qo={shape:(e,t)=>({body:e.shape.body.get(t),head:e.shape.head.get(t),tail:e.shape.tail.get(t),style:e.shape.style.get(t)}),"text.secondary":(e,t)=>({content:e.text.secondary.content.get(t),font:e.text.secondary.font.get(t),color:e.text.secondary.color.get(t),size:e.text.secondary.size.get(t),scale:e.text.secondary.scale.get(t),style:e.text.secondary.style.get(t),align:e.text.secondary.align.get(t),margin:e.text.secondary.margin.get(t),padding:e.text.secondary.padding.get(t),backgroundColor:e.text.secondary.backgroundColor.get(t),minVisibleSize:e.text.secondary.minVisibleSize.get(t)}),text:(e,t)=>({content:e.text.content.get(t),font:e.text.font.get(t),color:e.text.color.get(t),size:e.text.size.get(t),scale:e.text.scale.get(t),style:e.text.style.get(t),align:e.text.align.get(t),margin:e.text.margin.get(t),padding:e.text.padding.get(t),position:e.text.position.get(t),backgroundColor:e.text.backgroundColor.get(t),minVisibleSize:e.text.minVisibleSize.get(t),adjustAngle:e.text.adjustAngle.get(t),scaling:e.text.scaling.get(t),maxLineLength:e.text.maxLineLength.get(t),secondary:Qo["text.secondary"](e,t)}),outline:(e,t)=>({enabled:e.outline.enabled.get(t),color:e.outline.color.get(t),minVisibleSize:e.outline.minVisibleSize.get(t)}),pulse:(e,t)=>({enabled:e.pulse.enabled.get(t),duration:e.pulse.duration.get(t),interval:e.pulse.interval.get(t),startColor:e.pulse.startColor.get(t),endColor:e.pulse.endColor.get(t),width:e.pulse.width.get(t),startRatio:e.pulse.startRatio.get(t),endRatio:e.pulse.endRatio.get(t)}),stroke:(e,t)=>({color:e.stroke.color.get(t),width:e.stroke.width.get(t),scalingMethod:e.stroke.scalingMethod.get(t),minVisibleSize:e.stroke.minVisibleSize.get(t)}),halo:(e,t)=>({color:e.halo.color.get(t),width:e.halo.width.get(t),scalingMethod:e.halo.scalingMethod.get(t)}),all:(e,t)=>({width:e.width.get(t),scalingMethod:e.scalingMethod.get(t),color:e.color.get(t),opacity:e.opacity.get(t),minVisibleSize:e.minVisibleSize.get(t),layer:e.layer.get(t),detectable:e.detectable.get(t),curvature:e.curvature.get(t),adjustAnchors:e.adjustAnchors.get(t),shape:Qo.shape(e,t),stroke:Qo.stroke(e,t),halo:Qo.halo(e,t),pulse:Qo.pulse(e,t),outline:Qo.outline(e,t),text:Qo.text(e,t)})};function createAttributeAccessors(e,t,s,i=!0){if(void 0!==(t=t||e)._flexArray)return getFlexArrayAccessor(t,s);let r={check:idenitity,get:noop,set:noop,nested:{}};if(isString(t)||t._alias){const s=isString(t)?t:t._alias;r=getFlexArrayAccessor(getProperty(e,s),s)}else{if(t._set?(r.set=t._set,r.check=t._check):(r.set=noop,r.check=noop),t._get)r.get=t._get;else{const e=i?Zo:Qo;r.get=e[s||"all"]}r.nested={}}if(!isString(t)){const o=Object.keys(t);for(const a of o){const o=t[a];a.startsWith("_")||(r.nested[a]=createAttributeAccessors(e,o,s?s+"."+a:a,i))}}return r}var Ko=createAttributeAccessors(qo,void 0,void 0,!0),Jo=createAttributeAccessors(wo,void 0,void 0,!1),ea=[];function getAttributesOutput(e){let t=ea;return void 0===e.output?("function"==typeof e.attributes&&(t="all"),isObject(e.attributes)&&(t=getFlattenedKeys(e.attributes))):e.output&&(t=e.output.attributes),toAttributePathArray(t,e.allAttributePaths)}function checkAndAddDependency(e,t,s,i,r,o){(function outputMatchDependencies(e,t,s,i){if(i>s)for(const s of t.attributes)for(const t of e.attributes)if(t===s)return!0;for(const s of t.tags)for(const t of e.tags)if(s===t)return!0;return!1})(s,i,r,o)&&e.push(t)}function formatDependencies(e,t,s){if(!t)return{attributes:[],tags:[]};if(!0===e)return{attributes:[],tags:[Vs]};const i={attributes:toAttributePathArray((e=e||{}).attributes,s),tags:toTagNamesArray(e.tags)};return e.data&&i.tags.push(Us),e.selection&&i.tags.push(Hs),e.hover&&i.tags.push(Gs),i}function flattenAttributeName(e){return Array.isArray(e)?e.join("."):e}function toAttributePathArray(value,e){if("all"===value)return e.slice();if(!Array.isArray(value))return[];const t=function computeFlattenAttributeKeys(value){return value.map(flattenAttributeName).filter(isString)}(value);return e?e.filter((e=>t.some((t=>e.startsWith(t))))):t}function toTagNamesArray(value){return Array.isArray(value)?value.filter(isString):[]}var ta={};__export(ta,{cubicIn:()=>cubicIn2,cubicInOut:()=>cubicInOut,cubicOut:()=>cubicOut,linear:()=>linear,quadraticIn:()=>quadraticIn,quadraticInOut:()=>quadraticInOut,quadraticOut:()=>quadraticOut});var linear=e=>e,quadraticIn=e=>e*e,quadraticOut=e=>e*(2-e),quadraticInOut=e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1),cubicIn2=e=>e*e*e,cubicOut=e=>--e*e*e+1,cubicInOut=e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2),sa={storage:1,default:0},ia=class{constructor({graph:e,isNode:t,includeRemovedElements:s}){this._all=!1,this._isNode=t,this._graph=e,this._includeRemovedElements=s,this._eltList=t?this._graph.nodeList:this._graph.edgeList,this._flexArray=t?e.createNodeAttribute(sa,!1):e.createEdgeAttribute(sa,!1),this._all=!1,this._indexList=e.createIndexList(t)}_getAllIndexes(){const e=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),t=new Uint32Array(e);for(let s=1;s<=e;++s)t[s-1]=s;return t}addAll(){this._all=!0}add(e){if(!this._all)for(let t=0;t<e._indexes.length;t++){const s=e._indexes[t];this.addIndex(s)}}addIndex(e){0===this._flexArray.get(e)&&(this._flexArray.set(e,1),this._indexList.push(e))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){const e=this.getList();return this.clear(),e}getList(){let e;if(this._all&&!this._includeRemovedElements)e=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{const t=this._all?this._getAllIndexes():this._indexList.slice();e=this._eltList(t)}return e}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(e){if(e._all)this.addAll();else{const t=e._indexList.getBuffer(),s=e._indexList.getLength();for(let e=0;e<s;++e)this.addIndex(t[e])}}};function getUsedAttributeList(e,t=[],s=""){return e.constructor===Ct?e.isInitialized()&&t.push(s):e.constructor===Object&&Object.keys(e).forEach((i=>{getUsedAttributeList(e[i],t,s?s+"."+i:i)})),t}var na=class{constructor(e,t,s){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._graph=e,this._eltName=t?"node":"edge",this._accessors=t?Ko:Jo,this._createFlexArrays=s;const i=this._createFlexArrays(e,{original:!0,useDefaultValues:!0});this._finalFlexArrays=i;const r=this._createFlexArrays(e,{original:!1,useDefaultValues:!0});this._prevFlexArrays=r;const o=this._createFlexArrays(e,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=o,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new ia({graph:e,isNode:t,includeRemovedElements:!0}),this._elementsUpdated=new ia({graph:e,isNode:t,includeRemovedElements:!1}),this._finalFlexArraysWrapped=__spreadValues(__spreadProps(__spreadValues({},this._finalFlexArrays),{excluded:e.getAttribute(t,"excluded"),textHidden:e.getAttribute(t,"textHidden"),animationStart:e.createAttribute(t,Yr),animationDuration:e.createAttribute(t,Zr),animationEasing:e.createAttribute(t,Qr),id:this._graph.getAttribute(t,"id")}),!t&&{source:e.getEdgeAttribute("source"),target:e.getEdgeAttribute("target")})}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(e){const t=e._indexes,s=Array(t.length),i=this._finalFlexArraysWrapped;for(let e=0;e<t.length;e++){const r=t[e];s[e]={duration:i.animationDuration.get(r),start:i.animationStart.get(r),easing:i.animationEasing.get(r)}}return s}setDefaultAttributes(e){getFlattenedKeys(e).forEach((t=>{const s=getProperty(this._currentFlexArrays,t),i=getProperty(this._prevFlexArrays,t),r=getProperty(this._defaultFlexArrays,t),o=getProperty(this._finalFlexArrays,t);if(!s)return;const a=getProperty(e,t);s.setDefaultValue(a),r.setDefaultValue(a),i.setDefaultValue(a),o.setDefaultValue(a)})),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(e){this._currentFlexArrays=e.inputFlexArrays}setLastFlexArrays(e){this._lastFlexArrays=e}updateFlexArrays(e){const{attributes:t,selector:s,context:i,outputFlexArrays:r,toUpdate:o,formattedOutput:a}=e;this._elementsUpdated.addSet(o),this._elementsToRedraw.addSet(o);const l=o.getListAndClear();if(t&&l.size){const{valid:o,invalid:d}=splitElements(this._graph,l,s,i);for(const e of a.attributes){const t=getProperty(r,e);for(let e=0;e<d._indexes.length;e++){const s=d._indexes[e];t.set(s,void 0)}}this._assignAttributesToFlexArrays(this._accessors,r,o,t,i),this._addUpdatedAttributes(e)}}endUpdate(){const e=this._elementsUpdated.getList(),t=gt(this._updatedAttributesTmp);for(const s of t){const t=getProperty(this._lastFlexArrays,s),i=getProperty(this._finalFlexArrays,s);for(let s=0;s<e._indexes.length;s++){const r=e._indexes[s];i.set(r,t.get(r))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(e,t,s,i,r){const o=e.outputFlexArrays,a=this._accessors;this._assignAttributesToFlexArrays(a,o,t,s,null),this._addUpdatedAttributes(e,i),this._elementsUpdated.add(t),this._elementsToRedraw.add(t)}notifyLayerDestroyed(e){this._addUpdatedAttributes(e)}_addUpdatedAttributes(e,t){const{outputFlexArrays:s,formattedOutput:i}=e,r=Array.isArray(t)?toAttributePathArray(t):i.attributes;for(const e of r){getProperty(s,e).isInitialized()&&(this._updatedAttributes.add(e),this._updatedAttributesTmp.add(e),this._allUsedAttributes.add(e))}}addUpdatedAttribute(e){this._updatedAttributes.add(e),this._updatedAttributesTmp.add(e),this._allUsedAttributes.add(e)}getUsedAttributeNames(e){return getUsedAttributeList(e.outputFlexArrays)}redrawElements(e){this._elementsToRedraw.add(e)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){const e=gt(this._updatedAttributes);return this._updatedAttributes.clear(),e}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(e,t,s,i){const r=i?this._prevFlexArrays:this._currentFlexArrays;return s?this._getMultipleAttributeValues(e,t,r):this._getSingleAttributeValues(e,t,r)}_getAccessor(e=""){let t=this._accessors;const s=toPropertyPath(e);for(const e of s)if(t=t.nested[e],!t)throw new Error(`${this._eltName} attribute "${s.join("")}" does not exist`);return t}_getSingleAttributeValues(e,t,s){const i=this._getAccessor(t),r=e._indexes,o=Array(r.length);for(let e=0;e<r.length;e++)o[e]=i.get(s,r[e]);return o}_getMultipleAttributeValues(e,t,s){if(!t||"all"===t)return this._getSingleAttributeValues(e,"",s);const i=Array(e.size);for(let e=0;e<i.length;++e)i[e]={};for(let r=0;r<t.length;r++){const o=t[r],a=this._getSingleAttributeValues(e,o,s);for(let e=0;e<i.length;++e){setProperty(i[e],o,a[e])}}return i}setAnimationAttributes(e,{duration:t,startTime:s,easing:i}){const r=e._indexes,o=this._finalFlexArraysWrapped,a=o.animationDuration,l=o.animationStart,d=o.animationEasing,h=gt(this._allUsedAttributes);if(t){let e=!1;for(const t of h){if("x"===t||"y"===t){e=!0;continue}const s=getProperty(this._finalFlexArrays,t),i=getProperty(this._prevFlexArrays,t);for(let e=0;e<r.length;e++){const t=r[e];i.set(t,s.get(t))}}if(e){const e=getCurrentTime(),t=this._finalFlexArrays.x,s=this._finalFlexArrays.y,i=this._prevFlexArrays.x,o=this._prevFlexArrays.y;for(let h=0;h<r.length;h++){const u=r[h],c=a.get(u);if(c){const r=l.get(u),a=d.get(u),h=(ta[a]||linear)(Math.min((e-r)/c,1)),m=mix(i.get(u),t.get(u),h),p=mix(o.get(u),s.get(u),h);i.set(u,m),o.set(u,p)}else i.set(u,t.get(u)),o.set(u,s.get(u))}}}a.fill(r,t),l.fill(r,s),d.fill(r,i)}resetAnimationAttributes(e){this._finalFlexArraysWrapped.animationDuration.fill(e._indexes,0)}getUsedAttributes(){return gt(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(e,t,s,i,r,o=[]){if("function"==typeof i){const a=o.join(".");for(let l=0;l<s.size;++l){const d=s.get(l);if(d){const s=i(d,r,a);this._assignSingleValueToFlexArray(t,d,e,s,o)}}}else if(isObject(i)){const a=Object.keys(i);for(let l=0;l<a.length;++l){const d=a[l];o.push(d);const h=this._getNestedAccessor(e,d,o),u=i[d];this._assignAttributesToFlexArrays(h,t,s,u,r,o),o.pop()}}else if((Array.isArray(i)||ArrayBuffer.isView(i))&&"color"!==o[0])if(0===o.length)for(let r=0;r<s.size;++r)this._assignSingleValueToFlexArray(t,s.get(r),e,i[r],o);else for(let r=0;r<s.size;++r){const o=s._indexes[r],a=e.check(i[r]);e.set(t,o,a)}else{const r=e.check(i);for(let i=0;i<s.size;++i){const o=s.get(i);e.set(t,o._index,r)}}}_getNestedAccessor(e,t,s){const i=e.nested[t];if(!i)throw new Error(`${this._eltName} attribute "${s.join(".")}" does not exist`);return i}_assignSingleValueToFlexArray(e,t,s,value,i){if(isObject(value)){const r=Object.keys(value);for(const o of r){i.push(o);const r=value[o],a=this._getNestedAccessor(s,o,i);this._assignSingleValueToFlexArray(e,t,a,r,i),i.pop()}}else{const i=s.check(value);s.set(e,t._index,i)}}};function createEdgeFlexArrays_default(e,{original:t,useDefaultValues:s}){const i="resource";return{width:e.createAttribute(!1,{storage:i,default:s?1:void 0,name:"width"},t),scalingMethod:e.createAttribute(!1,{storage:i,default:s?co:void 0,name:"scalingMethod"},t),color:e.createAttribute(!1,{storage:i,default:s?go:void 0,name:"color"},t),opacity:e.createAttribute(!1,{storage:i,default:s?1:void 0,name:"opacity"},t),minVisibleSize:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"minVisibleSize"},t),layer:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"layer"},t),detectable:e.createAttribute(!1,{storage:i,default:!!s||void 0,name:"detectable"},t),curvature:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"curvature"},t),adjustAnchors:e.createAttribute(!1,{storage:i,default:!!s||void 0,name:"adjustAnchors"},t),shape:{body:e.createAttribute(!1,{storage:i,default:s?mo:void 0,name:"shape.body"},t),head:e.createAttribute(!1,{storage:i,default:s?null:void 0,name:"shape.head"},t),tail:e.createAttribute(!1,{storage:i,default:s?null:void 0,name:"shape.tail"},t),style:e.createAttribute(!1,{storage:i,default:s?_o:void 0,name:"shape.style"},t)},stroke:{color:e.createAttribute(!1,{storage:i,default:s?po:void 0,name:"stroke.color"},t),width:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"stroke.width"},t),scalingMethod:e.createAttribute(!1,{storage:i,default:s?fo:void 0,name:"stroke.scalingMethod"},t),minVisibleSize:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"stroke.minVisibleSize"},t)},halo:{color:e.createAttribute(!1,{storage:i,default:s?null:void 0,name:"halo.color"},t),width:e.createAttribute(!1,{storage:i,default:s?10:void 0,name:"halo.width"},t),scalingMethod:e.createAttribute(!1,{storage:i,default:s?yo:void 0,name:"halo.scalingMethod"},t)},pulse:{enabled:e.createAttribute(!1,{storage:i,default:!s&&void 0,name:"pulse.enabled"},t),duration:e.createAttribute(!1,{storage:i,default:s?1e3:void 0,name:"pulse.duration"},t),interval:e.createAttribute(!1,{storage:i,default:s?800:void 0,name:"pulse.interval"},t),startColor:e.createAttribute(!1,{storage:i,default:s?xo:void 0,name:"pulse.startColor"},t),endColor:e.createAttribute(!1,{storage:i,default:s?bo:void 0,name:"pulse.endColor"},t),width:e.createAttribute(!1,{storage:i,default:s?10:void 0,name:"pulse.width"},t),startRatio:e.createAttribute(!1,{storage:i,default:s?1:void 0,name:"pulse.startRatio"},t),endRatio:e.createAttribute(!1,{storage:i,default:s?2:void 0,name:"pulse.endRatio"},t)},outline:{enabled:e.createAttribute(!1,{storage:i,default:!s&&void 0,name:"outline.enabled"},t),color:e.createAttribute(!1,{storage:i,default:s?vo:void 0,name:"outline.color"},t),minVisibleSize:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"outline.minVisibleSize"},t)},text:{content:e.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.content"},t),font:e.createAttribute(!1,{storage:i,default:s?to:void 0,name:"text.font"},t),color:e.createAttribute(!1,{storage:i,default:s?so:void 0,name:"text.color"},t),size:e.createAttribute(!1,{storage:i,default:s?no:void 0,name:"text.size"},t),scale:e.createAttribute(!1,{storage:i,default:s?1:void 0,name:"text.scale"},t),style:e.createAttribute(!1,{storage:i,default:s?Ao:void 0,name:"text.style"},t),align:e.createAttribute(!1,{storage:i,default:s?So:void 0,name:"text.align"},t),margin:e.createAttribute(!1,{storage:i,default:s?2:void 0,name:"text.margin"},t),padding:e.createAttribute(!1,{storage:i,default:s?2:void 0,name:"text.padding"},t),position:e.createAttribute(!1,{storage:i,default:s?Eo:void 0,name:"text.position"},t),backgroundColor:e.createAttribute(!1,{storage:i,default:s?io:void 0,name:"text.backgroundColor"},t),minVisibleSize:e.createAttribute(!1,{storage:i,default:s?4:void 0,name:"text.minVisibleSize"},t),adjustAngle:e.createAttribute(!1,{storage:i,default:!!s||void 0,name:"text.adjustAngle"},t),scaling:e.createAttribute(!1,{storage:i,default:!s&&void 0,name:"text.scaling"},t),maxLineLength:e.createAttribute(!1,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},t),secondary:{content:e.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.secondary.content"},t),font:e.createAttribute(!1,{storage:i,default:s?to:void 0,name:"text.secondary.font"},t),color:e.createAttribute(!1,{storage:i,default:s?so:void 0,name:"text.secondary.color"},t),size:e.createAttribute(!1,{storage:i,default:s?12:void 0,name:"text.secondary.size"},t),scale:e.createAttribute(!1,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},t),style:e.createAttribute(!1,{storage:i,default:s?oo:void 0,name:"text.secondary.style"},t),align:e.createAttribute(!1,{storage:i,default:s?ao:void 0,name:"text.secondary.align"},t),margin:e.createAttribute(!1,{storage:i,default:s?2:void 0,name:"text.secondary.margin"},t),padding:e.createAttribute(!1,{storage:i,default:s?2:void 0,name:"text.secondary.padding"},t),backgroundColor:e.createAttribute(!1,{storage:i,default:s?ro:void 0,name:"text.secondary.backgroundColor"},t),minVisibleSize:e.createAttribute(!1,{storage:i,default:s?4:void 0,name:"text.secondary.minVisibleSize"},t)}}}}function createNodeFlexArrays_default(e,{original:t,useDefaultValues:s}){const i="resource";return{x:e.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"x"},t),y:e.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"y"},t),radius:e.createAttribute(!0,{storage:i,default:s?5:void 0,name:"radius"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"scalingMethod"},t),color:e.createAttribute(!0,{storage:i,default:s?To:void 0,name:"color"},t),opacity:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"opacity"},t),shape:e.createAttribute(!0,{storage:i,default:s?"circle":void 0,name:"shape"},t),layer:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"layer"},t),detectable:e.createAttribute(!0,{storage:i,default:!!s||void 0,name:"detectable"},t),draggable:e.createAttribute(!0,{storage:i,default:!!s||void 0,name:"draggable"},t),layoutable:e.createAttribute(!0,{storage:i,default:!!s||void 0,name:"layoutable"},t),innerStroke:{width:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"innerStroke.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"innerStroke.scalingMethod"},t),color:e.createAttribute(!0,{storage:i,default:s?Co:void 0,name:"innerStroke.color"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"innerStroke.minVisibleSize"},t)},outerStroke:{width:e.createAttribute(!0,{storage:i,default:s?5:void 0,name:"outerStroke.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"outerStroke.scalingMethod"},t),color:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"outerStroke.color"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"outerStroke.minVisibleSize"},t)},badges:{topLeft:{color:e.createAttribute(!0,{storage:i,default:s?Mo:void 0,name:"badges.topLeft.color"},t),scale:e.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topLeft.scale"},t),positionScale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.positionScale"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"badges.topLeft.minVisibleSize"},t),image:{url:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.image.url"},t),scale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.image.scale"},t)},stroke:{color:e.createAttribute(!0,{storage:i,default:s?Lo:void 0,name:"badges.topLeft.stroke.color"},t),width:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"badges.topLeft.stroke.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},t)},text:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.text.content"},t),color:e.createAttribute(!0,{storage:i,default:s?Io:void 0,name:"badges.topLeft.text.color"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"badges.topLeft.text.font"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topLeft.text.style"},t),scale:e.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topLeft.text.scale"},t),paddingLeft:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.left"},t),paddingTop:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.top"},t)}},topRight:{color:e.createAttribute(!0,{storage:i,default:s?Mo:void 0,name:"badges.topRight.color"},t),scale:e.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topRight.scale"},t),positionScale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.positionScale"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"badges.topRight.minVisibleSize"},t),image:{url:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.image.url"},t),scale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.image.scale"},t)},stroke:{color:e.createAttribute(!0,{storage:i,default:s?Lo:void 0,name:"badges.topRight.stroke.color"},t),width:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"badges.topRight.stroke.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},t)},text:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.text.content"},t),color:e.createAttribute(!0,{storage:i,default:s?Io:void 0,name:"badges.topRight.text.color"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"badges.topRight.text.font"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topRight.text.style"},t),scale:e.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topRight.text.scale"},t),paddingTop:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.left"},t),paddingLeft:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.top"},t)}},bottomLeft:{color:e.createAttribute(!0,{storage:i,default:s?Mo:void 0,name:"badges.bottomLeft.color"},t),scale:e.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomLeft.scale"},t),positionScale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.positionScale"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"badges.bottomLeft.minVisibleSize"},t),image:{url:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.image.url"},t),scale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.image.scale"},t)},stroke:{color:e.createAttribute(!0,{storage:i,default:s?Lo:void 0,name:"badges.bottomLeft.stroke.color"},t),width:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"badges.bottomLeft.stroke.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:t?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.text.content"},t),color:e.createAttribute(!0,{storage:i,default:s?Io:void 0,name:"badges.bottomLeft.text.color"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"badges.bottomLeft.text.font"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomLeft.text.style"},t),scale:e.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomLeft.text.scale"},t),paddingLeft:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.left"},t),paddingTop:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.top"},t)}},bottomRight:{color:e.createAttribute(!0,{storage:i,default:s?Mo:void 0,name:"badges.bottomRight.color"},t),scale:e.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomRight.scale"},t),positionScale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.positionScale"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"badges.bottomRight.minVisibleSize"},t),image:{url:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.image.url"},t),scale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.image.scale"},t)},stroke:{color:e.createAttribute(!0,{storage:i,default:s?Lo:void 0,name:"badges.bottomRight.stroke.color"},t),width:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"badges.bottomRight.stroke.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:t?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.text.content"},t),color:e.createAttribute(!0,{storage:i,default:s?Io:void 0,name:"badges.bottomRight.text.color"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"badges.bottomRight.text.font"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomRight.text.style"},t),scale:e.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomRight.text.scale"},t),paddingLeft:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.left"},t),paddingTop:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.top"},t)}}},halo:{color:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"halo.color"},t),width:e.createAttribute(!0,{storage:i,default:s?40:void 0,name:"halo.width"},t),scalingMethod:e.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"halo.scalingMethod"},t),strokeColor:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"halo.strokeColor"},t),strokeWidth:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"halo.strokeWidth"},t),clustering:e.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.clustering"},t),hideNonAdjacentEdges:e.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.hideNonAdjacentEdges"},t)},pulse:{enabled:e.createAttribute(!0,{storage:i,default:!s&&void 0,name:"pulse.enabled"},t),duration:e.createAttribute(!0,{storage:i,default:s?1e3:void 0,name:"pulse.duration"},t),interval:e.createAttribute(!0,{storage:i,default:s?800:void 0,name:"pulse.interval"},t),startColor:e.createAttribute(!0,{storage:i,default:s?Fo:void 0,name:"pulse.startColor"},t),endColor:e.createAttribute(!0,{storage:i,default:s?Po:void 0,name:"pulse.endColor"},t),width:e.createAttribute(!0,{storage:i,default:s?50:void 0,name:"pulse.width"},t),startRatio:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"pulse.startRatio"},t),endRatio:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"pulse.endRatio"},t)},icon:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"icon.content"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"icon.font"},t),color:e.createAttribute(!0,{storage:i,default:s?No:void 0,name:"icon.color"},t),scale:e.createAttribute(!0,{storage:i,default:s?.7:void 0,name:"icon.scale"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"icon.style"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"icon.minVisibleSize"},t)},image:{url:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"image.url"},t),scale:e.createAttribute(!0,{storage:i,default:s?1:void 0,name:"image.scale"},t),fit:e.createAttribute(!0,{storage:i,default:!!s||void 0,name:"image.fit"},t),tile:e.createAttribute(!0,{storage:i,default:!s&&void 0,name:"image.tile"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"image.minVisibleSize"},t)},outline:{enabled:e.createAttribute(!0,{storage:i,default:!s&&void 0,name:"outline.enabled"},t),color:e.createAttribute(!0,{storage:i,default:s?ko:void 0,name:"outline.color"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?12:void 0,name:"outline.minVisibleSize"},t)},text:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.content"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"text.font"},t),color:e.createAttribute(!0,{storage:i,default:s?so:void 0,name:"text.color"},t),size:e.createAttribute(!0,{storage:i,default:s?no:void 0,name:"text.size"},t),scale:e.createAttribute(!0,{storage:i,default:s?.1:void 0,name:"text.scale"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.style"},t),align:e.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.align"},t),margin:e.createAttribute(!0,{storage:i,default:s?7:void 0,name:"text.margin"},t),padding:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"text.padding"},t),backgroundColor:e.createAttribute(!0,{storage:i,default:s?io:void 0,name:"text.backgroundColor"},t),tip:e.createAttribute(!0,{storage:i,default:!!s||void 0,name:"text.tip"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.minVisibleSize"},t),scaling:e.createAttribute(!0,{storage:i,default:!s&&void 0,name:"text.scaling"},t),position:e.createAttribute(!0,{storage:i,default:s?"bottom":void 0,name:"text.position"},t),maxLineLength:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},t),truncateLength:e.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.truncateLength"},t),secondary:{content:e.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.secondary.content"},t),font:e.createAttribute(!0,{storage:i,default:s?to:void 0,name:"text.secondary.font"},t),color:e.createAttribute(!0,{storage:i,default:s?so:void 0,name:"text.secondary.color"},t),size:e.createAttribute(!0,{storage:i,default:s?10:void 0,name:"text.secondary.size"},t),scale:e.createAttribute(!0,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},t),style:e.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.secondary.style"},t),align:e.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.secondary.align"},t),margin:e.createAttribute(!0,{storage:i,default:s?5:void 0,name:"text.secondary.margin"},t),padding:e.createAttribute(!0,{storage:i,default:s?2:void 0,name:"text.secondary.padding"},t),backgroundColor:e.createAttribute(!0,{storage:i,default:s?io:void 0,name:"text.secondary.backgroundColor"},t),minVisibleSize:e.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.secondary.minVisibleSize"},t)}}}}var ra=class{constructor(e){this.nodes=new na(e,!0,createNodeFlexArrays_default),this.edges=new na(e,!1,createEdgeFlexArrays_default)}setNodeDefaultAttributes(e){this.nodes.setDefaultAttributes(e)}setEdgeDefaultAttributes(e){this.edges.setDefaultAttributes(e)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(e){this._fetch(e).redrawElements(e)}getAnimationInformation(e){return this._fetch(e).getAnimationInformation(e)}redrawNodes(e){this.nodes.redrawElements(e)}getUsedAttributes(e,t){return this._fetch(t).getUsedAttributeNames(t.isNode?e.nodes:e.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(e){this.nodes.notifyLayerDestroyed(e.nodes),this.edges.notifyLayerDestroyed(e.edges)}prepareUpdate(e){this.nodes.prepareFlexArraysUpdate(e.nodes),this.edges.prepareFlexArraysUpdate(e.edges)}onUpdate(e){this.nodes.updateFlexArrays(e.nodes),this.edges.updateFlexArrays(e.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){const e=this.nodes,t=this.edges;return{nodes:e.getAndResetElementsUpdated(),edges:t.getAndResetElementsUpdated(),nodeAttributesSet:e.getUpdatedAttributesSet(),nodeAttributes:e.getAndResetAttributesUpdated(),edgeAttributes:t.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:e,edges:t},s){this.nodes.setAnimationAttributes(e,s),this.edges.setAnimationAttributes(t,s)}resetAnimationAttributes({nodes:e,edges:t}){this.nodes.resetAnimationAttributes(e),this.edges.resetAnimationAttributes(t)}setLastOutput(e,t){this.nodes.setLastFlexArrays(e),this.edges.setLastFlexArrays(t)}getCurrentInput(){const e=deepCopy(this.nodes.getDefaultFlexArrays()),t=deepCopy(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:e,currentEdgeFlexArrays:t,allNodeAttributePaths:getFlattenedKeys(e),allEdgeAttributePaths:getFlattenedKeys(t)}}initializeLayer(e,t,s){e.nodes.allAttributePaths=t,e.edges.allAttributePaths=s,e.nodes.formattedDependencies=function formatNodeDependencies(e){let t=e.dependencies;void 0===t?t=Kr:isObject(t)||(t={});const s=getLeafValues(e.attributes).some((value=>"function"==typeof value)),i=e.selector&&!e.standaloneSelector,r=!(!s&&!i);let o=t.adjacentEdges;return!o&&t.adjacentNodes&&(o=!0),{self:formatDependencies(t.self,r,e.allAttributePaths),adjacentNodes:formatDependencies(t.adjacentNodes,r,e.allAttributePaths),adjacentEdges:formatDependencies(o,r,e.allAttributePaths),allNodes:formatDependencies(t.allNodes,r,e.allAttributePaths),allEdges:formatDependencies(t.allEdges,r,e.allAttributePaths)}}(e.nodes),e.edges.formattedDependencies=function formatEdgeDependencies(e){let t=e.dependencies;void 0===t?t=Jr:isObject(t)||(t={});const s=getLeafValues(e.attributes).some((value=>"function"==typeof value)),i=e.selector&&!e.standaloneSelector,r=!(!s&&!i);return{self:formatDependencies(t.self,r,e.allAttributePaths),extremities:formatDependencies(t.extremities,r,e.allAttributePaths),parallelEdges:formatDependencies(t.parallelEdges,r,e.allAttributePaths),allNodes:formatDependencies(t.allNodes,r,e.allAttributePaths),allEdges:formatDependencies(t.allEdges,r,e.allAttributePaths)}}(e.edges),e.nodes.formattedOutput={attributes:getAttributesOutput(e.nodes),tags:e.tag?[e.tag]:[]},e.edges.formattedOutput={attributes:getAttributesOutput(e.edges),tags:e.tag?[e.tag]:[]},e.nodes.redrawAdjacentEdges=e.nodes.formattedOutput.attributes.some((e=>eo[e])),e.initialized=!0}connectLayerInputOutput(e,t,s){const i=e.nodes.formattedOutput,r=e.edges.formattedOutput;for(const s of i.attributes){const i=getProperty(t,s),r=getProperty(e.nodes.outputFlexArrays,s);r.setFallback(i),setProperty(t,s,r)}for(const t of r.attributes){const i=getProperty(s,t),r=getProperty(e.edges.outputFlexArrays,t);r.setFallback(i),setProperty(s,t,r)}}setupLayerDependencies(e,t){if(e===t)return;const s=e.priority,i=t.priority,r=e.nodes.formattedOutput,o=e.edges.formattedOutput,a=t.nodes.formattedDependencies,l=t.edges.formattedDependencies;checkAndAddDependency(e.depsNodeSelf,t,r,a.self,s,i),checkAndAddDependency(e.depsNodeAdjacentNodes,t,r,a.adjacentNodes,s,i),checkAndAddDependency(e.depsNodeAdjacentEdges,t,o,l.extremities,s,i),checkAndAddDependency(e.depsNodeAllNodes,t,r,a.allNodes,s,i),checkAndAddDependency(e.depsNodeAllEdges,t,o,l.allNodes,s,i),checkAndAddDependency(e.depsEdgeSelf,t,o,l.self,s,i),checkAndAddDependency(e.depsEdgeExtremities,t,r,a.adjacentEdges,s,i),checkAndAddDependency(e.depsEdgeParallelEdges,t,o,l.parallelEdges,s,i),checkAndAddDependency(e.depsEdgeAllNodes,t,r,a.allEdges,s,i),checkAndAddDependency(e.depsEdgeAllEdges,t,o,l.allEdges,s,i)}createAttributeLayerData(e,t,s,{tag:i,onBeforeUpdate:r,standaloneSelectors:o}){const a=!!o;return{index:-1,id:t,name:e,tag:i||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:r,nodes:{type:"node",name:e,standaloneSelector:a,toUpdate:new ia({graph:s,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:e,standaloneSelector:a,toUpdate:new ia({graph:s,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(e,t,s,i,r){this._fetch(t).setAttributeValues(e,t,s,i,r)}getAttributeValues(e,t,s,i){return this._fetch(e).getAttributeValues(e,t,s,i)}_fetch(e){return e.isNode?this.nodes:this.edges}},defaultLayerFactory=(e,t)=>new $r(e,t),oa=class{constructor(e,{graph:t,dom:s}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=e,this._graph=t,this._dom=s,this._emptySubgraph={nodes:e.nodeList(),edges:e.edgeList()},this._textHiddenSet=new ts(this._graph,"textHidden"),this._layerController=new ra(this._graph)}_getLayerById(e){for(let t=0;t<this._layers.length;++t){const s=this._layers[t];if(s.id===e)return s.index=t,s}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(e,t){this._layerController.setNodeDefaultAttributes(e),this._layerController.setEdgeDefaultAttributes(t)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(e){e.size&&(this._layerController.redrawElements(e),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(e){return this._layerController.getAnimationInformation(e)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(const e of this._destroyedLayers)e.initialized&&this._layerController.notifyDestroyed(e);for(const e of this._layers)this._layerController.prepareUpdate(e),"function"==typeof e.onBeforeUpdate&&e.onBeforeUpdate(e,this,this._layerController),this._layerController.onUpdate(e);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(e,t,s,i){const r=this._getLayerById(e),o=t.isNode?r.nodes:r.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(o,t,s,i,r),this._updateElementsForAttributeLayers([r],t)}getAttributeLayerFlexArrays(e){const t=this._getLayerById(e);return{nodes:t.nodes.outputFlexArrays,edges:t.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(e,t){const s=this._getLayerById(e);return this._layerController.getUsedAttributes(s,t)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(e){const{name:t,layerFactory:s=defaultLayerFactory}=e;if(!t)throw new Error("Attribute layer must have a name");if(t&&this._layers.find((e=>e.name===t)))throw new Error(`attribute layer with name "${e.name}" already exists`);const i=this._layerController.createAttributeLayerData(t,++this._layerIdCounter,this._graph,e);return this._layers.push(i),this._updateLayer(i,e),s(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort(((e,t)=>e.priority-t.priority));const{currentNodeFlexArrays:e,currentEdgeFlexArrays:t,allNodeAttributePaths:s,allEdgeAttributePaths:i}=this._layerController.getCurrentInput();for(const e of this._layers)this._layerController.initializeLayer(e,s,i);for(const s of this._layers){s.nodes.inputFlexArrays=deepCopy(e),s.edges.inputFlexArrays=deepCopy(t),s.depsNodeSelf=[],s.depsNodeAdjacentNodes=[],s.depsNodeAdjacentEdges=[],s.depsNodeAllNodes=[],s.depsNodeAllEdges=[],s.depsEdgeSelf=[],s.depsEdgeExtremities=[],s.depsEdgeParallelEdges=[],s.depsEdgeAllNodes=[],s.depsEdgeAllEdges=[],s.nodes.toUpdate.addAll(),s.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(s,e,t);for(const e of this._layers)this._layerController.setupLayerDependencies(s,e)}this._layerController.setLastOutput(e,t);for(const e of this._layers)e.nodes.needAdjacentElements=e.nodes.redrawAdjacentEdges||e.depsNodeAdjacentNodes.length>0||e.depsNodeAdjacentEdges.length>0,e.edges.needAdjacentElements=e.depsEdgeExtremities.length>0||e.depsEdgeParallelEdges.length>0}_updateLayer(e,{priority:t,fullOverwrite:s,nodeAttributes:i,nodeSelector:r,nodeContext:o,nodeDependencies:a,nodeOutput:l,edgeAttributes:d,edgeSelector:h,edgeContext:u,edgeDependencies:c,edgeOutput:m}={}){void 0!==i&&(e.nodes.attributes=s?i:mergeValues(e.nodes.attributes,i)),void 0!==r&&(e.nodes.selector=r),void 0!==o&&(e.nodes.context=o),void 0!==a&&(e.nodes.dependencies=a),void 0!==l&&(e.nodes.output=l),void 0!==d&&(e.edges.attributes=s?d:mergeValues(e.edges.attributes,d)),void 0!==h&&(e.edges.selector=h),void 0!==u&&(e.edges.context=u),void 0!==c&&(e.edges.dependencies=c),void 0!==m&&(e.edges.output=m),void 0!==t&&(e.priority=t),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(e){const t=this._getLayerById(e);this._updateAllForAttributeLayer(t)}updateAllForAllAttributeLayers(){for(const e of this._layers)this._updateAllForAttributeLayer(e)}_updateAllForAttributeLayer(e,t=!0,s=!0){if(t&&!e.nodes.toUpdate.isFull()){e.nodes.toUpdate.addAll();for(const t of e.depsNodeSelf)this._updateAllForAttributeLayer(t,!0,!1);for(const t of e.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(t,!0,!1);for(const t of e.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(t,!1,!0);for(const t of e.depsNodeAllNodes)this._updateAllForAttributeLayer(t,!0,!1);for(const t of e.depsNodeAllEdges)this._updateAllForAttributeLayer(t,!1,!0)}if(s&&!e.edges.toUpdate.isFull()){e.edges.toUpdate.addAll();for(const t of e.depsEdgeSelf)this._updateAllForAttributeLayer(t,!1,!0);for(const t of e.depsEdgeExtremities)this._updateAllForAttributeLayer(t,!0,!1);for(const t of e.depsEdgeParallelEdges)this._updateAllForAttributeLayer(t,!1,!0);for(const t of e.depsEdgeAllNodes)this._updateAllForAttributeLayer(t,!0,!1);for(const t of e.depsEdgeAllEdges)this._updateAllForAttributeLayer(t,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(e,t){const s=this._getLayerById(e);this._updateElementsForAttributeLayers([s],t)}updateForAllAttributeLayers(e){this._updateElementsForAttributeLayers(this._layers,e)}_updateElementsForAttributeLayers(e,t){let s=this._emptySubgraph;if(t.isNode){for(const i of e)if(!i.nodes.toUpdate.isFull()){i.nodes.needAdjacentElements&&(s=s===this._emptySubgraph?t.fastGetAdjacentElements():s),i.nodes.toUpdate.add(t);for(const e of i.depsNodeSelf)e.nodes.toUpdate.add(t);for(const e of i.depsNodeAdjacentNodes)e.nodes.toUpdate.add(s.nodes);for(const e of i.depsNodeAdjacentEdges)e.edges.toUpdate.add(s.edges);for(const e of i.depsNodeAllNodes)this._updateAllForAttributeLayer(e,!0,!1);for(const e of i.depsNodeAllEdges)this._updateAllForAttributeLayer(e,!1,!0);i.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(s.edges)}}else for(const i of e)if(!i.edges.toUpdate.isFull()){i.edges.needAdjacentElements&&(s=s===this._emptySubgraph?t.fastGetAdjacentElements():s),i.edges.toUpdate.add(t);for(const e of i.depsEdgeSelf)e.edges.toUpdate.add(t);for(const e of i.depsEdgeExtremities)e.nodes.toUpdate.add(s.nodes);for(const e of i.depsEdgeParallelEdges)e.edges.toUpdate.add(s.edges);for(const e of i.depsEdgeAllNodes)this._updateAllForAttributeLayer(e,!0,!1);for(const e of i.depsEdgeAllEdges)this._updateAllForAttributeLayer(e,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(e){const t=this._getLayerById(e);this._destroyedLayers.push(t),this._layers.splice(t.index,1),this._triggerLayerUpdate()}updateAttributeLayer(e,t){const s=this._getLayerById(e);this._updateLayer(s,t)}getAttributeLayerDefinition(e){const t=this._getLayerById(e),{priority:s,nodes:i,edges:r}=t;return{priority:s,nodeAttributes:i.attributes,nodeSelector:i.selector,nodeContext:i.context,nodeDependencies:i.dependencies,nodeOutput:i.output,edgeAttributes:r.attributes,edgeSelector:r.selector,edgeContext:r.context,edgeDependencies:r.dependencies,edgeOutput:r.output}}getAttributeValues(e,t,s,i){return this.update(),this._layerController.getAttributeValues(e,t,s,i)}setAnimationAttributes(e,t){return this._layerController.setAnimationAttributes(e,t)}resetAnimationAttributes(e){return this._layerController.resetAnimationAttributes(e)}setTextHidden(e,value){const t=this._textHiddenSet.addOrRemoveElements(e,value);this.redrawElements(t)}resetTextHidden(){const{nodes:e,edges:t}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(e),this._layerController.redrawElements(t)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}interpolateAttributes(e){const t=getCurrentTime(),s=this._ogma.modules.graphics.getAttributesManager(),i=this._layerController,r=e.isNode?s.getUsedNodeAttributes():s.getUsedEdgeAttributes(),{animationDuration:o,animationEasing:a,animationStart:l}=i.getFlexArrays().nodes.current,d=o.getMultiple(e._indexes),h=a.getMultiple(e._indexes),u=l.getMultiple(e._indexes),c=[];for(let s=0;s<e.size;s++){const o={};r.forEach((r=>{const a="string"==typeof r?r:r.join("."),l=getProperty(i.getFlexArrays().nodes.previous,r),c=getProperty(i.getFlexArrays().nodes.current,r);if(!c)return;const m=computeAnimationRatio(t,u[s],d[s],h[s]);isNaN(m)?o[a]=c.get(e._indexes[s]):a.match(/color/gi)?o[a]=mixColor(l.get(e._indexes[s]),c.get(e._indexes[s]),m,m):o[a]=lerp(l.get(e._indexes[s]),c.get(e._indexes[s]),m)})),c.push(o)}return c}};function cosh(e){return((e=Math.exp(e))+1/e)/2}var aa=function zoomRho(e,t,s){function zoom(i,r){var o,a,l=i[0],d=i[1],h=i[2],u=r[0],c=r[1],m=r[2],p=u-l,y=c-d,x=p*p+y*y;if(x<1e-12)a=Math.log(m/h)/e,o=function(t){return[l+t*p,d+t*y,h*Math.exp(e*t*a)]};else{var b=Math.sqrt(x),v=(m*m-h*h+s*x)/(2*h*t*b),E=(m*m-h*h-s*x)/(2*m*t*b),k=Math.log(Math.sqrt(v*v+1)-v),L=Math.log(Math.sqrt(E*E+1)-E);a=(L-k)/e,o=function(s){var i=s*a,r=cosh(k),o=h/(t*b)*(r*function tanh(e){return((e=Math.exp(2*e))-1)/(e+1)}(e*i+k)-function sinh(e){return((e=Math.exp(e))-1/e)/2}(k));return[l+o*p,d+o*y,h*r/cosh(e*i+k)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return zoom.rho=function(e){var t=Math.max(.001,+e),s=t*t;return zoomRho(t,s,s*s)},zoom}(Math.SQRT2,2,4),DEFAULT_MIN_ZOOM=({graphWidth:e,graphHeight:t,viewWidth:s,viewHeight:i})=>.2*Math.min(s/e,i/t),DEFAULT_MAX_ZOOM=({smallestNodeSize:e,viewWidth:t,viewHeight:s})=>e===1/0?1/0:Math.min(t,s)/e*.5,la=Math.SQRT2,da=.15,ha=class extends Ds{constructor(e,t){super(e),this._zooming=!1,this.debug=!1,this._smoothZoom=(e,t,s)=>{const i=this._modules.settings,r=i.get("interactions.zoom.duration"),o=i.get("interactions.zoom.easing"),a=this._modules.camera.getZoom(),l={duration:r,easing:o};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0));const d=i.get("interactions.zoom.speed")||da;let h=getSmoothScale(e,d);e<0&&0!==h&&(h=1/h);const u=a*h;this._modules.camera.setZoom(u,l,{x:t,y:s}).then((()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))}))},this.debug=t}onMounted(){const e=this._modules.settings;e.register("interactions.zoom.enabled",!0),e.register("interactions.zoom.onDoubleClick",!1),e.register("interactions.zoom.duration",150),e.register("interactions.zoom.modifier",la),e.register("interactions.zoom.speed",da),e.register("interactions.zoom.easing","quadraticOut"),e.register("interactions.zoom.minValue",this.debug?null:DEFAULT_MIN_ZOOM),e.register("interactions.zoom.maxValue",this.debug?null:DEFAULT_MAX_ZOOM),e.register("interactions.zoom.hideNodes",!1),e.register("interactions.zoom.hideEdges",!1),e.register("interactions.zoom.hideNodeTexts",!1),e.register("interactions.zoom.hideEdgeTexts",!1),e.register("interactions.pan.enabled",!0),e.register("interactions.pan.hideNodes",!1),e.register("interactions.pan.hideEdges",!1),e.register("interactions.pan.hideNodeTexts",!1),e.register("interactions.pan.hideEdgeTexts",!1),e.register("interactions.rotation.enabled",!0),e.register("interactions.rotation.hideNodes",!1),e.register("interactions.rotation.hideEdges",!1),e.register("interactions.rotation.hideNodeTexts",!1),e.register("interactions.rotation.hideEdgeTexts",!1),e.register("interactions.gesture.enabled",!0),e.register("interactions.gesture.hideNodes",!1),e.register("interactions.gesture.hideEdges",!1),e.register("interactions.gesture.hideNodeTexts",!1),e.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:throttle((({x:e,y:t,delta:s})=>this._smoothZoom(s,e,t)),50)}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{const e=this._modules.settings.get("interactions.zoom.enabled"),t=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!e||!t)},handler:({x:e,y:t})=>this._smoothZoom(1,e,t)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:e})=>{const t=!!this._modules.settings.get("interactions.pan.enabled");return"left"===e&&t},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:e,dy:t})=>this._modules.camera.move({x:-e,y:-t}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:e,domEvent:t})=>("right"===e||t&&2===t.buttons)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:e,y:t})=>{this._rotationStart={x:e,y:t},this._updateVisibility("rotation",!0)},onProgress:({x:e,y:t})=>this._rotate({x:e,y:t}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:e,dy:t,rotation:s,scale:i,x:r,y:o})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-s),this._modules.camera.zoomIn({modifier:i},{x:r,y:o}),this._modules.camera.move({x:-e,y:-t})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:e,y:t}){const{width:s,height:i}=this._modules.camera.getSize(),r=s/2,o=i/2,a=this._rotationStart.x-r,l=this._rotationStart.y-o,d=e-r,h=t-o,u=Math.atan2(l,a)-Math.atan2(h,d);this._rotationStart.x=e,this._rotationStart.y=t,this._modules.camera.rotate(u)}_updateVisibility(e,t){const value=!t,s=this._modules.settings,i=s.get(`interactions.${e}.hideNodes`),r=s.get(`interactions.${e}.hideEdges`),o=s.get(`interactions.${e}.hideNodeTexts`),a=s.get(`interactions.${e}.hideEdgeTexts`);i&&this._modules.graphics.setNodesVisibility(value),o&&this._modules.graphics.setNodeTextsVisibility(value),r&&this._modules.graphics.setEdgesVisibility(value),a&&this._modules.graphics.setEdgeTextsVisibility(value)}},ua=1e8,ca={duration:0,startAfter:0,ignoreZoomLimits:!1,callback:noop,easing:"quadraticInOut"};function irrelevant(e){return Math.abs(e)<1e-9}var ga=class extends Ds{constructor(){super(...arguments),this._minZoom=1e-8,this._maxZoom=ua,this._timeout=0}onMounted(){this._reset(),this._modules.settings.register("minZoom",1e-8,(e=>{this._minZoom=e,this._zoom<e&&(this._zoom=e,this._modules.events.fire("move"))})),this._modules.settings.register("maxZoom",ua,(e=>{this._maxZoom=e,this._zoom>e&&(this._zoom=e,this._modules.events.fire("move"))})),this._modules.events.on("setContainer",(()=>{this._reset(),this._modules.events.fire("move")})).on("resize",(()=>{this._reloadDimensions(),this._modules.events.fire("move")}))}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(e){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout((()=>this._modules.events.fire("viewChanged",{type:e})),80)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:e,y:t},s){const i=this._x,r=this._y,o=e-this._x,a=t-this._y;return irrelevant(o)&&irrelevant(a)?Promise.resolve():new Promise((e=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const t=this._modules.animations.play((e=>{this._x=i+o*e,this._y=r+a*e,this._modules.events.fire("move").fire("pan")}),__spreadProps(__spreadValues(__spreadValues({},ca),s),{callback:()=>this.moveEnd("pan"),resolve:e}));t&&(this._moveAnimation=t)}))}move({x:e,y:t},s){const i=screenToGraphOffset({x:e,y:t},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+i.x,y:this._y+i.y},s)}getZoom(){return this._zoom}setZoom(e,t,s={x:void 0,y:void 0}){const{x:i,y:r}=s;let o=clamp(e,this._minZoom,this._maxZoom);return t&&t.ignoreZoomLimits||(o=this._applyZoomLimits(o)),irrelevant(this._zoom-o)?Promise.resolve():new Promise((e=>{const s=__spreadProps(__spreadValues(__spreadValues({},ca),t),{callback:()=>this.moveEnd("zoom"),resolve:e}),a=this._dimensions.width/2,l=this._dimensions.height/2,d=this._zoom,h=a/d-a/o;if(void 0!==i&&void 0!==r){const e=(i-a)/d-(i-a)/o,s=(r-l)/d-(r-l)/o,h=this._cosAngle,u=this._sinAngle,c=h*e-u*s,m=u*e+h*s;this.setCenter({x:this._x+c,y:this._y+m},t)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then((()=>{this._modules.events.fire("zoomStart",{duration:s.duration,easing:s.easing,startZoom:d,endZoom:o})}));const u=this._modules.animations.play((e=>{this._zoom=a/(a/d-h*e),this._modules.events.fire("move").fire("zoom")}),s);u&&(this._zoomAnimation=u)}))}_applyZoomLimits(e){const t=this._modules.settings.get("interactions.zoom.minValue"),s=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:i,maxScaledSize:r,width:o,height:a,cx:l}=this._modules.locate.getGraphBoundingBox(),d=this._zoom,h=this.getSize();let u=e;if(!isNaN(l)){const e={smallestNodeSize:i,biggestNodeSize:r,graphWidth:o+r,graphHeight:a+r,viewWidth:h.width,viewHeight:h.height},l=t&&t(e),c=s&&s(e);isValidZoom(l)&&u<l?u<d&&(u=Math.min(d,l)):isValidZoom(c)&&u>c&&u>d&&(u=Math.max(d,c))}return u}zoomIn(e,t={x:void 0,y:void 0}){let s=1;return void 0===e&&(e={}),"number"==typeof e&&(e={modifier:e}),s="number"!=typeof e.modifier?this._modules.settings.get("interactions.zoom.modifier")||la:e.modifier,this.setZoom(this._zoom*s,e,t)}moveToBounds(e,t={}){const s=this._modules.locate.computeConfigForBounds(e,{ignoreZoomLimits:!0});return this.moveTo(s,t)}moveTo(e,t={}){const s=this.getZoom(),i=this.getCenter(),r=e.zoom||this._zoom;return 0===t.duration?this.setView(e):new Promise((o=>{const a=Math.min(this.width,this.height),l=aa([i.x,i.y,a/s],[e.x,e.y,a/r]),d=l.duration,h=t.duration||d;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const u=this._modules.animations.play((e=>{const[t,s,i]=l(e);this._x=t,this._y=s,this._zoom=a/i,this._modules.events.fire("move"),this._modules.events.fire("pan")}),{duration:h,easing:t.easing,callback:()=>this.moveEnd("pan"),resolve:o});u&&(this._moveAnimation=u)}))}zoomOut(e,t={x:void 0,y:void 0}){let s=1;return void 0===e&&(e={}),"number"==typeof e&&(e={modifier:e}),s="number"!=typeof e.modifier?this._modules.settings.get("interactions.zoom.modifier")||la:e.modifier,this.setZoom(this._zoom/s,e,t)}getAngle(){return this._angle}setAngle(e,t){const s=this._angle,i=e-s;return irrelevant(i)?Promise.resolve():new Promise((e=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);const r=this._modules.animations.play((e=>{for(this._angle=s+i*e;this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")}),__spreadProps(__spreadValues(__spreadValues({},ca),t),{callback:()=>this.moveEnd("rotate"),resolve:e}));r&&(this._rotateAnimation=r)}))}rotate(e,t){return this.setAngle(this._angle+e,t)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:e,y:t},s={x:0,y:0}){const i=this._dimensions.width/2,r=this._dimensions.height/2;return rotate((e-this._x)*this._zoom+i,(t-this._y)*this._zoom+r,i,r,-this._angle,s)}screenToGraphCoordinates({x:e,y:t},s={x:0,y:0}){return rotate(this._x+(e-this._dimensions.width/2)/this._zoom,this._y+(t-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,s)}projectBounds(e,t=e){const[s,i,r,o]=e,a=this._x,l=this._y,d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._sinAngle,c=this._cosAngle,m=1/this._zoom;let p=1/0,y=1/0,x=-1/0,b=-1/0;const v=[s,i,s,o,r,o,r,i];for(let e=0;e<v.length;e+=2){let t=v[e],s=v[e+1];t=a+(t-d)*m,s=l+(s-h)*m;const i=t-a,r=s-l;t=c*i-u*r+a,s=u*i+c*r+l,t<p&&(p=t),t>x&&(x=t),s<y&&(y=s),s>b&&(b=s)}return t[0]=p,t[1]=y,t[2]=x,t[3]=b,t}screenToGraphVector({x:e,y:t}){return screenToGraphOffset({x:e,y:t},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(e,t){const{x:s,y:i,zoom:r,angle:o}=__spreadValues({x:this._x,y:this._y,zoom:this._zoom,angle:this._angle},e);return Promise.all([this.setCenter({x:s,y:i},t),this.setZoom(r,t),this.setAngle(o,t)]).then(noop)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){const e=this._moveAnimation,t=this._zoomAnimation,s=this._rotateAnimation;return Boolean(e&&!e.done||t&&!t.done||s&&!s.done)}getProjectedScreenBounds(e=0){const{width:t,height:s}=this._dimensions,i=Math.max(t,s)*e;return this.projectBounds([0-i,0-i,t+i,s+i])}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(e){const t=new ga(this._ogma);return t._zoom=e.zoom||this._zoom,t._x=e.x||this._x,t._y=e.y||this._y,t._angle=e.angle||this._angle,t._sinAngle=e.sinAngle||this._sinAngle,t._cosAngle=e.cosAngle||this._cosAngle,t._dimensions=e.dimensions?__spreadValues({},e.dimensions):__spreadValues({},this._dimensions),t}};function screenToGraphOffset({x:e,y:t},s,i,r){return{x:r*(e/=s)-i*(t/=s),y:i*e+r*t}}function isValidZoom(value){return"number"==typeof value&&isFinite(value)}var ma={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},_a=ye?"webgl":null,pa=class extends Ds{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=e=>{const t=function isNodeBuffer(e){const t=e.depth;return 2===t||1===t||(t-Ci)%Li>=Mi}(e),s=isTextBuffer(e),i=t?this._visibility.nodes:this._visibility.edges,r=t?this._visibility.nodeTexts:this._visibility.edgeTexts;return 0===i&&(!s||0===r)},this._onNewFrame=()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()},this._applyCursorStyle=()=>{const e=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");applyCursorStyle(this._domWrapper,e)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=getRTLProcessors().applyArabicShaping,this._attributesManager=new oa(this._ogma,this._modules),this._imageManager=new Hn,this._fontManager=new Ti,this._engine=new Xr(Xr.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._engine.on("error",this._onNewFrame),this._nodeAnimationMap=new Map,this._edgeAnimationMap=new Map,this._movingNodes=new Set,this._movingEdges=new Set,this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExportEnd","viewChanged","zoomStart"]),this._modules.settings.register("renderer",_a,(e=>{this._updateRendererState({type:e,state:"requested",code:null,message:void 0}),this._engine.setRenderType(e),this._modules.dom.refresh()})),this._modules.settings.register("backgroundColor","white",(e=>{this._engine.parseColor(e)?this._modules.dom.refresh():($warn(`Invalid background color "${e}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))})),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,(e=>{this._fontManager.setHideUntilFontsLoaded(!!e)})),this._modules.settings.register("texts.cornerRadius",5,(e=>{this._engine.getTextManager().setCornerRadius("number"==typeof e?e:5),this._modules.dom.refresh()})),this._modules.settings.register("imgCrossOrigin","anonymous",this._updateImageCrossOrigin),this._modules.settings.register("cursor.default","default",this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(ma),this._modules.dom.beforeNextFrame().then((()=>{this._initDone=!0,this._fireRendererStateChangeEvent()})),this._imageManager.onFetch((()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()})),this._fontManager.onFontLoaded((e=>{this._fontsNewlyLoaded.push(e),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()})),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",(()=>this._modules.dom.refresh())),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${Vs})`,tag:Vs,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${Us})`,tag:Us,nodeDependencies:void 0,edgeDependencies:void 0}),loadRequiredShapes(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",(()=>this._modules.dom.refresh())).on("newFrame",this._onNewFrame).on("viewExportStart",(()=>{this._renderOnNewFrame=!1})).on("viewExportEnd",(()=>{this._renderOnNewFrame=!0})).on("clearGraph",(()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh(),this._animations=[],this._nodeAnimationMap.clear(),this._edgeAnimationMap.clear()})).on("viewChanged",(({type:e})=>{if("rotate"===e){const e=this._modules.graph.getEdges().filter((e=>e.getAttribute("adjustAnchors")));this._attributesManager.redrawElements(e)}})).on("addNodes",(e=>{this._attributesManager.updateForAllAttributeLayers(e.nodes)})).on("addEdges",(e=>{this._attributesManager.updateForAllAttributeLayers(e.edges)})).on("excludedStateChange",(e=>{this._visibleAttributeLayer.updateElements(e.elements)})).on("setData",(e=>{this._dataAttributeLayer.updateElements(e.elements)})),Xr.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",(()=>this.destroy()))}onReady(e){void 0!==e.renderer&&this._ogma.setOptions({renderer:e.renderer}),void 0!==e.imgCrossOrigin&&this._ogma.setOptions({imgCrossOrigin:e.imgCrossOrigin})}getTransparentBackgroundColor(){const e=this._modules.settings.get("backgroundColor");return e?this._engine.transparentify(e):null}_render(){const e=this._modules.dom.getDimensions(),t=this._modules.camera.getView(),s=Re(),i=getCurrentTime(),r=this._modules.settings.get("backgroundColor"),o=this._isBufferDisplayable;this._engine.setView({x:t.x,y:t.y,zoom:t.zoom,angle:t.angle,width:e.width,height:e.height,pixelRatio:s,currentTime:i,backgroundColor:r,isBufferDisplayable:o});try{this._engine.render(),"requested"===this._rendererState.state&&this._updateRendererState({state:"ok"})}catch(e){if(this._debug)throw e;const{message:t,code:s="OTHER"}=e,i=this._rendererState.type,r=function formatRendererName(e){return null===e?"none":"webgl"===e?"WebGL":"svg"===e?"SVG":"canvas"===e?"Canvas":e}(i);let o="requested"===this._rendererState.state?`Error while initializing the ${r} renderer`:`The ${r} renderer encountered an unexpected runtime error`,a=null;"webgl"===i&&(o+="; fallbacking on canvas renderer",a="canvas"),$warn(t||""),$warn(o),this._updateRendererState({state:"error",code:s,message:t}),this._modules.settings.set("renderer",a)}}_fireRendererStateChangeEvent(){const e=this._rendererState;this._modules.events.fire("rendererStateChange",{type:e.type,state:e.state,code:e.code,message:e.message})}_updateRendererState({type:e,state:t,code:s,message:i}){let r=!1;void 0!==e&&this._rendererState.type!==e&&(this._rendererState.type=e,r=!0),void 0!==t&&this._rendererState.state!==t&&(this._rendererState.state=t,r=!0),void 0!==s&&this._rendererState.code!==s&&(this._rendererState.code=s,r=!0),void 0!==i&&this._rendererState.message!==i&&(this._rendererState.message=i,r=!0),r&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then((()=>this._engine.getImageData()))}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():10*this._nextGeIndex+++9}releaseGraphicsEngineBlockId(e){this._engine.freeBlock(e),this._availableGeIndexes.push(e),this._modules.dom.refresh()}addCursorStyle(e){e&&(this._cursorStyle.push(e),this._applyCursorStyle())}removeCursorStyle(e){if(!e)return;const t=this._cursorStyle.lastIndexOf(e);-1!==t&&(this._cursorStyle.splice(t,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(e,t){this._attributesManager.setTextHidden(e,t)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");const{elementsToRedraw:e,elementsUpdated:t}=this._attributesManager.getUpdatedElements(),s=t.nodes.size>0||t.edges.size>0;(t.nodeAttributesSet.has("radius")||t.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=function computeMaxSize(e){const t=e.getNodeAttribute("radius"),s=e.getEdgeAttribute("width"),i=e.getNodes(),r=e.getEdges();let o=0,a=0;for(let e=0;e<i._indexes.length;e++){const s=i._indexes[e],r=t.get(s);r>o&&(o=r)}for(let e=0;e<r._indexes.length;e++){const t=r._indexes[e],i=s.get(t);i>a&&(a=i)}return Math.max(2*o,a)}(this._modules.graph)),(t.nodeAttributesSet.has("shape")||t.edgeAttributes.includes("shape.head")||t.edgeAttributes.includes("shape.tail"))&&loadRequiredShapes(this._engine,this._attributesManager.getFlexArrays()),loadGraphInGraphicsEngine({graph:this._modules.graph,elements:e,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),s&&this._modules.events.fire("updateAttributes",t)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(e,t,s,i){let r;return Promise.all([this._modules.graph.getNodes().addClass(Ys),this._modules.graph.getEdges().addClass(Ys)]).then((()=>this.resolveAtNextFrame())).then((()=>this._imageManager.whenReady())).then((()=>{"all"===s?(r=function setAllVisible(e){return{nodes:setAllElementsVisible(e,!0),edges:setAllElementsVisible(e,!1)}}(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();const o=this._modules.camera.clone(__spreadValues({},t));return this._modules.events.fire("viewExportStart",{preventOverlap:i.preventOverlap,camera:o}),this._ogma.view.afterNextFrame().then((()=>this._engine.export(e,t,i)))})).then((e=>Promise.all([this._modules.graph.getNodes().removeClass(Ys),this._modules.graph.getEdges().removeClass(Ys)]).then((()=>e)))).then((e=>("all"===s&&(!function restoreVisibility({nodes:e,edges:t}){restoreElementsVisibility(e),restoreElementsVisibility(t)}(r),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),e)))}addAttributeLayer(e){return this._attributesManager.addAttributeLayer(e)}getAttributeValues(e,t,s,i){return this._attributesManager.getAttributeValues(e,t,s,i)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(e){return this._modules.dom.afterNextFrame().then((()=>e))}isMoving(e){return(e.isNode?this._movingNodes:this._movingEdges).has(e._index)}animate(e,t,s,i){const r=function formatOptions(e){"number"==typeof e?e={duration:e}:"object"==typeof e&&null!==e||(e={duration:0});return{duration:toDuration(e.duration),easing:e.easing||"linear",chain:!!e.chain}}(i);return r.duration&&this._engine.ensureAnimationsReady(),this._animate(e,t,s,r)}isAnimating(){return this._animations.length>0}getAnimationInformation(e){return this._attributesManager.getAnimationInformation(e)}_toSubGraph(e){if(e instanceof xi||e instanceof yi)return{nodes:e.toList(),edges:e.getAdjacentEdges()};if(e instanceof li||e instanceof ai)return{nodes:this._modules.graph.nodeList(),edges:e.toList()};const t=e,s={nodes:t.nodes||this._modules.graph.nodeList(),edges:t.edges||this._modules.graph.edgeList()};return s.nodes.size&&(s.edges.size?s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe():s.edges=s.nodes.getAdjacentEdges()),s}_animate(e,t,s,{duration:i,easing:r}){if((!this._animations.length||s)&&!i)return t(e),Promise.resolve(e);const o=this._toSubGraph(e),a=o.nodes,l=o.edges;if(0===a.size&&0===l.size)return t(e),Promise.resolve(e);if(a.size){if(s)for(let e=0;e<a._indexes.length;e++)this._movingNodes.add(a._indexes[e]);this._modules.events.fire("animate",{elements:a,duration:i,updatesPositions:s,easing:r})}if(l.size){if(s)for(let e=0;e<l._indexes.length;e++)this._movingEdges.add(l._indexes[e]);this._modules.events.fire("animate",{elements:l,duration:i,updatesPositions:s,easing:r})}const d={id:this._nextAnimationId++,startTime:getCurrentTime(),finished:!1,func:()=>t(e),duration:i,easing:r,nodes:a,edges:l,started:!1,updatesPositions:s,resolve:noop};let h=d;const u=new Set;if(h=this._getLongestAnimation(h,d.nodes,u),h=this._getLongestAnimation(h,d.edges,u),h.updatesPositions){for(let e=0;e<a._indexes.length;e++)this._nodeAnimationMap.set(a._indexes[e],h);for(let e=0;e<l._indexes.length;e++)this._edgeAnimationMap.set(l._indexes[e],h);d.duration=h.duration,d.startTime=h.startTime}if(0===d.duration&&h.id===d.id)return t(e),Promise.resolve(e);const c=new Promise((t=>d.resolve=()=>t(e)));return this._animations.push(d),this._modules.dom.refresh(),i||this._processAnimations(),c}_removeFinishedAnimations(){this._animations=this._animations.filter((e=>!e.finished))}_getAnimationElements(e){return{nodes:e.nodes,edges:e.edges}}_resetAnimationAttributes({nodes:e,edges:t}){this._attributesManager.resetAnimationAttributes({nodes:e,edges:t});for(let t=0;t<e._indexes.length;t++)this._nodeAnimationMap.delete(e._indexes[t]),this._movingNodes.delete(e._indexes[t]);for(let s=0;s<t._indexes.length;s++)this._edgeAnimationMap.delete(t._indexes[s]),this._movingEdges.delete(e._indexes[s])}_getLongestAnimation(e,t,s){const i=t.isNode?this._nodeAnimationMap:this._edgeAnimationMap;for(let r=0;r<t._indexes.length;r++){const o=i.get(t._indexes[r]);o&&!s.has(o.id)&&(s.add(o.id),(e.updatesPositions||!o.updatesPositions)&&o.duration+o.startTime<e.duration+e.startTime||(e=o))}return e}_processAnimations(){if(!this._animations.length)return;const e=getCurrentTime(),t=[];this._attributesManager.update();for(const e of this._animations)e.started||(e.started=!0,t.push(e.func),this._attributesManager.setAnimationAttributes(this._getAnimationElements(e),e));for(const e of t)e();for(const t of this._animations)e>=t.startTime+t.duration&&(this._resetAnimationAttributes(this._getAnimationElements(t)),t.resolve(t.elements),t.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(value){return this._updateVisibilityCounter("nodes",value)}setNodeTextsVisibility(value){return this._updateVisibilityCounter("nodeTexts",value)}setEdgesVisibility(value){return this._updateVisibilityCounter("edges",value)}setEdgeTextsVisibility(value){return this._updateVisibilityCounter("edgeTexts",value)}_updateVisibilityCounter(e,value){this._visibility[e]+=value?-1:1,this._modules.dom.refresh()}detectNode(e,t,s,i,r,o){return function detectNode(e,t,s,i,r,o,a,l,d,h,u,c){o=o||a.getNodes()._indexes;const m=d.getZoom(),p=a.getObjectList(!0),y=l.getFlexArrays().nodes.current;let x=1/0,b=0,v=!1,E=-1/0;l.update();for(let p=0;p<o.length;++p){const k=o[p];if(y.excluded.get(k)||!y.detectable.get(k)||u.has(k))continue;const L=y.x.get(k),D=y.y.get(k),B=y.layer.get(k);if(B<E)continue;Zn.x=L,Zn.y=D;const H=d.graphToScreenCoordinates(Zn),X=H.x,Y=H.y,Z=y.shape.get(k),oe="scaled"===y.scalingMethod.get(k),de=y.radius.get(k)*(oe?m:1),he=de+r,ce=(e-X)/he,me=(t-Y)/he;if(Zn.x=e,Zn.y=t,i&&checkBadge(Zn,k,l,d,h)&&(v=!0),!v&&h.checkShapeHit(Z,ce,me)){const e=0!==a.getAttribute(!0,"virtual").get(k);if(he>x&&e)continue;x=he}else if(!v&&s){const s=c(y.text.content.get(k)||null),i=y.textHidden.get(k),r=y.text.minVisibleSize.get(k);if(i||!s||(oe?2*de:1/0)<r)continue;const o=splitText(s,y.text.maxLineLength.get(k)),a=y.innerStroke.width.get(k),l=y.text.margin.get(k),d=y.text.padding.get(k),u=y.text.size.get(k),m=y.text.scale.get(k),p=y.text.scaling.get(k),x=y.text.font.get(k),b=y.text.style.get(k),v=y.text.position.get(k),E=h.measureText(o,x,b,1),L=p?m*de*2:u,D=E.width*L/2+d,B=E.height*L/2+d,H=$n[v],Z=a+l+de,he=X+(Z+D)*H.x,ce=Y+(Z+B)*H.y;if(e<=he-D||e>=he+D||t<=ce-B||t>=ce+B)continue}b=k,E=B}return p.get(b)||null}(e,t,s,i,r,o,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._movingNodes,this._formatText)}detectEdge(e,t,s,i,r){return function detectEdge(e,t,s,i,r,o,a,l,d){r=r||o.getEdges()._indexes;const h=o.getObjectList(!1),u=d.getFlexArrays(),c=u.edges.current,m=u.nodes.current,p=a.getZoom(),y=i/p;Zn.x=e,Zn.y=t;const x=a.screenToGraphCoordinates(Zn),b=x.x,v=x.y;let E=0;d.update();for(let e=0;e<r.length;++e){const t=r[e],s=c.source.get(t),i=c.target.get(t),o=c.excluded.get(t),a=c.detectable.get(t),d=l.has(s),h=l.has(i);if(o||!a||d||h)continue;const u=s===i,x=c.curvature.get(t),k="triangle"===c.shape.body.get(t),L="scaled"===c.scalingMethod.get(t),D=c.width.get(t)/(L?1:p),B=m.x.get(s),H=m.y.get(s),X=m.x.get(i),Y=m.y.get(i);if(u){const e="scaled"===m.scalingMethod.get(s),t=getSelfLoopControlPoints(B,H,x,m.radius.get(s)/(e?1:p),0);if(!isPointOnBezierCurve(b,v,B,H,B,H,t.x1,t.y1,t.x2,t.y2,D,y))continue}else if(0!==x){const e=getQuadraticCurveControlPoint(B,H,X,Y,x);if(!isPointOnQuadraticCurve(b,v,B,H,X,Y,e.x,e.y,D,y,k))continue}else if(!isPointInLine(b,v,B,H,X,Y,D,y,k))continue;E=t}return h.get(E)||null}(e,t,0,i,r,this._modules.graph,this._modules.camera,this._movingNodes,this._attributesManager)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function toDuration(e){return"number"!=typeof e||!isFinite(e)||e<0?0:e}function setAllElementsVisible(e,t){const s=t?e.getNodeAttribute("excluded"):e.getEdgeAttribute("excluded"),i=(t?e.getNodes("all"):e.getEdges("all"))._indexes,r=s.getMultiple(i);return s.fill(i,0),{excludedList:s,indexes:i,values:r}}function restoreElementsVisibility({excludedList:e,indexes:t,values:s}){e.setMultiple(t,s)}var fa=class extends Ds{constructor(){super(...arguments),this._onAnyEvents=[],this._registeredEvents={},this.onIdle=throttle((()=>this.fire("idle")),50)}onMounted(){this._registeredEvents={},this.register(["idle"]),this._ogma.onReady((()=>{this.on(["viewChanged","layoutEnd","addNodes","addEdges","removeNodes","removeEdges","animate","setMultipleAttributes","transformationRefresh"],(()=>{this._modules.dom.clearTimeout(this._idleTimeout),this._idleTimeout=this._modules.dom.setTimeout(this.onIdle,250)}))}))}isRegistered(e){return!!this._registeredEvents[e]}register(e,t=[]){e.forEach((e=>{if(this._registeredEvents[e])throw new Error(`event "${e}" already exists`);this._registeredEvents[e]=new ya(!1,e)}))}onAnyEvent(e){this._onAnyEvents.push(e)}on(e,t){return Array.isArray(e)&&e.forEach((e=>this.on(e,t))),this._registeredEvents[e]?(this._registeredEvents[e].on(t),this):this}off(e){return Object.values(this._registeredEvents).forEach((t=>{t.off(e)})),this}fire(e,t=null){const s=this._getEvent(e);return this._onAnyEvents.forEach((s=>s(t,e))),s.trigger(t),this}once(e,t){const s=this,wrapped=function(){t.apply(null,arguments),s.off(wrapped)};return this.on(e,wrapped)}_getEvent(e){if(!(e in this._registeredEvents))throw new Error(`Event ${e} does not exist`);return this._registeredEvents[e]}destroy(){Object.values(this._registeredEvents).forEach((e=>{e.destroy()}))}},ya=class{constructor(e,t){this._subscribers=[],this._handlers=[],this._reverseOrder=e,this._name=t}trigger(e){for(const t of this._handlers)t(e,this._name);return this}on(e){if("function"!=typeof e)throw new Error("handler is not a function");const t=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(t,0,e),this._subscribers.splice(t,0,e),this}off(e){let t;for(;-1!==(t=this._subscribers.indexOf(e));)this._subscribers.splice(t,1),this._handlers.splice(t,1);return this}destroy(){this._subscribers=[],this._handlers=[]}},xa=class extends Ds{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],(({nodes:e,edges:t,objects:s})=>{this._onAddElements(e||t,s)})),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:1,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:4,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(e,t){const s=t.map((e=>e.attributes));this._originalAttributesLayer.setAttributeValues(e,s)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(e,t,s){const i=Array.isArray(t)?t.length&&t[0]?getPathsWithAlias(t[0],e.isNode):[]:getPathsWithAlias(t,e.isNode),r=i.includes("x")||i.includes("y");return this._modules.events.fire("setMultipleAttributes",{elements:e,values:t,updatedAttributes:i}),this._graphics.animate(e,(()=>{this._individualAttributesLayer.setAttributeValues(e,t)}),r,s)}setSingleAttribute(e,t,s,i){const r={};return setProperty(r,t,s),this.setMultipleAttributes(e,r,i)}resetMultipleAttributes(e,t,s){const i=t||this._individualAttributesLayer.getUsedAttributeNames(e),r=i&&(i.includes("x")||i.includes("y")),o={};for(const e of i)setProperty(o,e,void 0);return this._graphics.animate(e,(()=>{this._individualAttributesLayer.setAttributeValues(e,o)}),r,s)}getMultipleAttributes(e,t){return this._graphics.getAttributeValues(e,t,!0,!1)}getSingleAttribute(e,t){return this._graphics.getAttributeValues(e,t,!1,!1)}replaceOriginalAttributes(e,t,s=[]){const i={},r=this._originalAttributesLayer.getUsedAttributeNames(e).filter((e=>!s.includes(e)));for(let e=0;e<r.length;++e)setProperty(i,r[e],void 0);this._originalAttributesLayer.setAttributeValues(e,i),this._originalAttributesLayer.setAttributeValues(e,t)}getSinglePreviousAttribute(e,t){return this._graphics.getAttributeValues(e,t,!1,!0)}getMultiplePreviousAttributes(e,t){return this._graphics.getAttributeValues(e,t,!0,!0)}},ba=class extends Ds{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(e){e.renderer&&this.update({renderer:e.renderer}),e.options&&this.update(e.options)}register(e,t,s,i){return void 0===i&&(i=!0),this._keys.push(e),this._currentValue[e]=t,this._defaultValues[e]=t,this._onChange[e]=s||noop,s&&i&&s(t),this}update(e){e=flatten(e);const t=this._keys,s={},i=this._currentValue;for(let r=0;r<t.length;++r){const o=t[r];if(o in e){let value=e[o];void 0===value&&(value=this._defaultValues[o]),s[o]=i[o],i[o]=value}}const r=Object.keys(s);for(let e=0;e<r.length;++e){const t=r[e],i=this._currentValue[t],o=s[t];i!==o&&this._onChange[t](i,o)}return unflatten(s)}get(e){return 0===arguments.length?unflatten(this._currentValue):this._currentValue[e]}set(e,value){const t=this._currentValue[e],s=this._onChange[e];this._currentValue[e]=value,s&&s(value,t)}},va=class{constructor(e,t){this._classes=e,this._name=t}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(e){return this._classes.setIndex(this._name,e)}update(e){return this._classes.update(this._name,e),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(e){return this._classes.getElementsByClass(this._name,e).nodes}getEdges(e){return this._classes.getElementsByClass(this._name,e).edges}clearNodes(e){this.getNodes(e).removeClass(this._name)}clearEdges(e){this.getEdges(e).removeClass(this._name)}add(e){e.addClass(this._name)}remove(e){e.removeClass(this._name)}},Aa=class extends Ds{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={},this._onExcludedStateChange=({elements:e,value})=>{if(value){const t=this._builtinClasses.map((e=>e.name));this._addOrRemoveClassesToElements(t,e,!1)}},this._onClearGraph=()=>{this._builtinClasses.concat(this._userClasses).forEach((e=>e.elementSet.clear()))},this._onRemoveElements=({nodes:e,edges:t})=>{const s=e||t;this._builtinClasses.concat(this._userClasses).forEach((e=>e.elementSet.removeElements(s)))}}onMounted(){this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on("clearGraph",this._onClearGraph).on("removeEdges",this._onRemoveElements).on("removeNodes",this._onRemoveElements)}_getClassList(e){return e?this._builtinClasses:this._userClasses}createClass({name:e,isBuiltin:t=!1,after:s,nodeAttributes:i,nodeDependencies:r,nodeOutput:o,edgeAttributes:a,edgeDependencies:l,edgeOutput:d}={}){if("string"!=typeof e)throw new Error('the "name" argument should be a string');const h=this._getClassList(t),u=s?function getClassIndex(e,t){for(let s=0;s<e.length;++s)if(e[s].name===t)return s;return-1}(h,s)+1:h.length;if(-1===u)throw new Error(`createClass: class specified as \`after\` parameter "${s}" does not exist`);if(t&&!e.startsWith("_"))throw new Error(`invalid builtin class name "${e}": builtin classes should start with '_'`);const c=new ts(this._modules.graph),m=new va(this,e),p={name:e,elementSet:c,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${e})`,tag:e,standaloneSelectors:!0,nodeAttributes:i||void 0,edgeAttributes:a||void 0,nodeSelector:(e,t)=>t.hasElement(e),edgeSelector:(e,t)=>t.hasElement(e),nodeContext:c,edgeContext:c,nodeOutput:o,edgeOutput:d,nodeDependencies:r,edgeDependencies:l}),isBuiltin:t,wrapper:m};return h.splice(u,0,p),t&&h.sort(((e,t)=>si.indexOf(e.name)-si.indexOf(t.name))),this._updatePriorities(t),this._classesByName[e]=p,this._modules.events.register([makeEventName(e,!0,!0),makeEventName(e,!0,!1),makeEventName(e,!1,!0),makeEventName(e,!1,!1)]),m}_updatePriorities(e){const t=this._getClassList(e),s=5+(e?.5:0);for(let e=0;e<t.length;++e){const i=s+5e-4*e;t[e].attributeLayer.update({priority:i})}}_get(e){const t=this._classesByName[e];if(!t)throw new Error(`class "${e}" does not exist`);return t}getIndex(e){const t=this._get(e);return this._getClassList(t.isBuiltin).indexOf(t)}setIndex(e,t){const s=this._get(e),i=this._getClassList(s.isBuiltin),r=i.indexOf(s),o=clamp(t,0,i.length-1);i.splice(r,1),i.splice(o,0,s),this._updatePriorities(s.isBuiltin)}update(e,{nodeAttributes:t,edgeAttributes:s,nodeDependencies:i,edgeDependencies:r,nodeOutput:o,edgeOutput:a,fullOverwrite:l}={}){this._get(e).attributeLayer.update({nodeAttributes:t,edgeAttributes:s,nodeDependencies:i,edgeDependencies:r,nodeOutput:o,edgeOutput:a,fullOverwrite:l})}getDefinition(e){const t=this._get(e),{nodeAttributes:s,nodeDependencies:i,nodeOutput:r,edgeAttributes:o,edgeDependencies:a,edgeOutput:l}=t.attributeLayer.getDefinition();return{nodeAttributes:s||void 0,edgeAttributes:o||void 0,nodeDependencies:i,edgeDependencies:a,nodeOutput:r,edgeOutput:l}}_addOrRemoveClassesToElements(e,t,s){const i=t.isNode;for(let r=0;r<e.length;++r){const o=e[r],{elementSet:a,attributeLayer:l}=this._get(o),d=a.addOrRemoveElements(t,s),h=makeEventName(o,i,s);d.size&&(l.updateElements(d),this._modules.events.fire(h,i?{nodes:d}:{edges:d}))}}_animatedAttributesUpdatePositions(e,t){for(let s=0;s<e.length;++s){const i=e[s],r=this.getDefinition(i);if(t.isNode&&r.nodeAttributes&&(r.nodeAttributes.x||r.nodeAttributes.y))return!0}return!1}_getAnimatedAtrributes(e,t){return e.reduce(((e,s)=>{const i=this.getDefinition(s);return t.isNode&&i.nodeAttributes&&e.push(...getPathsWithAlias(i.nodeAttributes,!0)),!t.isNode&&i.edgeAttributes&&e.push(...getPathsWithAlias(i.edgeAttributes,!1)),e}),[])}addClassesToElements(e,t,s){const i=t.toList(),r=this._animatedAttributesUpdatePositions(e,i);return this._modules.graphics.animate(t,(()=>{this._addOrRemoveClassesToElements(e,i,!0)}),r,s)}removeClassesFromElements(e,t,s){const i=t.toList(),r=this._animatedAttributesUpdatePositions(e,i);return this._modules.graphics.animate(t,(()=>{this._addOrRemoveClassesToElements(e,i,!1)}),r,s)}hasSingleElementClass(e,t){return this._get(e).elementSet.hasElement(t)}getElementsClassList(e,t={}){const{includeBuiltinClasses:s=!1}=t,i=new Array(e.size);for(let e=0;e<i.length;++e)i[e]=[];return this._addClassNamesToList(i,e,this._userClasses),s&&this._addClassNamesToList(i,e,this._builtinClasses),i}_addClassNamesToList(e,t,s){const i=t.toList();for(let t=0;t<s.length;++t){const{name:r,elementSet:o}=s[t];for(let t=0;t<i.size;++t){const s=i.get(t);o.hasElement(s)&&e[t].push(r)}}}getClassByName(e,t=!1){const s=this._classesByName[e]||null;if(t&&!s)throw new Error(`class "${e}" does not exist`);return s&&s.wrapper}getClassList(){return this._userClasses.map((e=>e.wrapper))}getElementsByClass(e,t="visible"){const{elementSet:s}=this._get(e),i=s.getElements();let r=i.nodes,o=i.edges;return"visible"===t?(r=r.filter((e=>e.isVisible())),o=o.filter((e=>e.isVisible()))):"raw"===t&&(r=r.filter((e=>!e.isVirtual())),o=o.filter((e=>!e.isVirtual()))),{nodes:r,edges:o}}_onClassEvent(e,t,s,i){const r=makeEventName(e,s,i);this._modules.events.on(r,t)}onNodeClassAdded(e,t){this._onClassEvent(e,t,!0,!0)}onNodeClassRemoved(e,t){this._onClassEvent(e,t,!0,!1)}onEdgeClassAdded(e,t){this._onClassEvent(e,t,!1,!0)}onEdgeClassRemoved(e,t){this._onClassEvent(e,t,!1,!1)}};function makeEventName(e,t,s){return`${t?"node":"edge"}Class${s?"Added":"Removed"}_${e}`}function renderDebug(e,t,s,{cells:i=!0,boxes:r=!0,query:o=!0}={}){const a=t.keys().map((e=>t.keyToBBox(Number(e)))),l=t.getBoxes();if(i&&(e.beginPath(),e.lineWidth=1,e.strokeStyle="#707070",a.forEach((t=>{e.rect(t[0],t[1],t[2]-t[0],t[3]-t[1])})),e.stroke()),r&&(e.beginPath(),e.lineWidth=1,e.strokeStyle="#ff7070",l.forEach((t=>{e.rect(t[0],t[1],t[2]-t[0],t[3]-t[1])})),e.closePath(),e.stroke()),o&&s){const t=s;e.beginPath(),e.lineWidth=2,e.strokeStyle="#3030ff",e.rect(t[0],t[1],t[2]-t[0],t[3]-t[1]),e.closePath(),e.stroke()}}var Sa=["x","y","radius"],Ea=["width","curvature"],wa=class extends Ds{constructor(){super(...arguments),this._minCellSize=8,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=e=>{if(e.nodes&&(!e.nodeAttributes||e.nodeAttributes.some((e=>Sa.includes(e))))){const t=e.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(e.nodes),this._elementsToUpdate.addElements(t)}e.edges&&(e.edgeAttributes&&!e.edgeAttributes.some((e=>Ea.includes(e)))||this._elementsToUpdate.addElements(e.edges))}}onMounted(){this._index=new Es(this._getIntersector(),function createBoundsGetter(e){const[t,s,i]=e.getNodeAttributes(["x","y","radius"]),[r,o,a]=e.getEdgeAttributes(["source","target","curvature"]),l={x:0,y:0,x1:0,y1:0,x2:0,y2:0},d=simpleBoundingBox();return e=>{if(e<0){e=-e;const h=r.get(e),u=o.get(e),c=a.get(e),m=t.get(h),p=s.get(h),y=t.get(u),x=s.get(u);h===u?(getSelfLoopControlPoints(m,p,c,i.get(h),0,l),getBezierCurveBoundingBox(m,p,l.x1,l.y1,l.x2,l.y2,y,x,d)):0===c?(d.minX=Math.min(m,y),d.minY=Math.min(p,x),d.maxX=Math.max(m,y),d.maxY=Math.max(p,x)):(getQuadraticCurveControlPoint(m,p,y,x,c,l),getQuadraticCurveBoundingBox(m,p,l.x,l.y,y,x,d))}else{const r=t.get(e),o=s.get(e),a=i.get(e);d.minX=r-a,d.minY=o-a,d.maxX=r+a,d.maxY=o+a}return[d.minX,d.minY,d.maxX,d.maxY]}}(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new ts(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",(({elements:e})=>{this._elementsToUpdate.addElements(e)})).on("clearGraph",this._clear)}_getIntersector(){const e=this._modules.graph,[t,s,i]=e.getNodeAttributes(["x","y","radius"]),[r,o,a,l]=e.getEdgeAttributes(["source","target","width","curvature"]),d={x:0,y:0,x1:0,y1:0,x2:0,y2:0};return(e,h,u,c,m)=>{if(e<0){e=-e;const p=r.get(e),y=o.get(e),x=l.get(e),b=a.get(e)/2,v=t.get(p),E=s.get(p),k=t.get(y),L=s.get(y);return p===y?(getSelfLoopControlPoints(v,E,x,i.get(p),0,d),cubicBezierAABB(v,E,d.x1,d.y1,d.x2,d.y2,k,L,h-b,u-b,c+b,m+b)):0===x?lineAABB(v,E,k,L,h-b,u-b,c+b,m+b):(getQuadraticCurveControlPoint(v,E,k,L,x,d),quadBezierAABB(v,E,d.x,d.y,k,L,h-b,u-b,c+b,m+b))}return circleIntersectsBox(t.get(e),s.get(e),i.get(e),h,u,c,m)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(!this._elementsToUpdate.isEmpty()){const{nodes:e,edges:t}=this._elementsToUpdate.getElements();this._updateItems(e._indexes,t._indexes),this._elementsToUpdate.clear()}}_updateItems(e,t){const s=this._index,i=this._removedNodes,r=this._removedEdges,o=this._excludedNodes,a=this._excludedEdges,l=[],d=[];if(i&&o)for(let t=0;t<e.length;t++){const r=e[t];0!==i.get(r)||0!==o.get(r)?l.push(r):s.has(r)?(l.push(r),d.push(r)):d.push(r)}if(r&&a)for(let e=0;e<t.length;e++){const i=-t[e];0!==r.get(-i)||0!==a.get(-i)?l.push(i):s.has(i)?(l.push(i),d.push(i)):d.push(i)}for(const e of l)s.remove(e);for(const e of d)s.insert(e)}getNodesInScreenByDistance(e){const{x:t,y:s}=e.getPositionOnScreen();return this._modules.graph.getNodes().filter((t=>t.isInScreen()&&t!==e)).sort(((e,i)=>{const r=e.getPositionOnScreen(),o=i.getPositionOnScreen();return distance(r.x,r.y,t,s)-distance(o.x,o.y,t,s)}))}getNearestNodesForNode(e,t=240,s){const{x:i,y:r}=e.getPosition();return this.getNearestNodes(i,r,t,s,e)}getNearestNodes(e,t,s,i,r){if(this._updateIndex(),i){const e=this._modules.camera.screenToGraphVector({x:s,y:s});s=distance(0,0,e.x,e.y)}return this._getNearestNodes(e,t,s,r)}_getNearestNodes(e,t,s,i){const r=[],o=s*s,a=i?i._index:0,l=this._modules.graph.getNodes()._indexes,[d,h]=this._modules.graph.getNodeAttributes(["x","y"]);for(let s=0,i=l.length;s<i;s++){const i=l[s];if(i===a)continue;const u=e-d.get(i),c=t-h.get(i);u*u+c*c<=o&&r.push(i)}return this._modules.graph.nodeList(new Uint32Array(r))}queryRaw(e,t,s,i){this._updateIndex();const r=this._queryBounds;r[0]=e,r[1]=t,r[2]=s,r[3]=i;const o=this._index.query(e,t,s,i),{nodes:a,edges:l}=this._queryResult;a.length=l.length=0;for(let e=0;e<o.length;e++){const t=o[e];t<0?l.push(-t):a.push(t)}return this._queryResult}queryRawProjected(e,t,s,i){const r=this._queryBounds;return r[0]=e,r[1]=t,r[2]=s,r[3]=i,this._modules.camera.projectBounds(r),this.queryRaw(r[0],r[1],r[2],r[3])}query(e,t,s,i){const r=this._modules.graph,{nodes:o,edges:a}=this.queryRaw(e,t,s,i);return{nodes:r.nodeList(new Uint32Array(o.slice())),edges:r.edgeList(new Uint32Array(a.slice()))}}queryProjected(e,t,s,i){const r=this._modules.graph,{nodes:o,edges:a}=this.queryRawProjected(e,t,s,i);return{nodes:r.nodeList(new Uint32Array(o.slice())),edges:r.edgeList(new Uint32Array(a.slice()))}}getNodesByBoundingBox(e,t,s,i,r){if(this._updateIndex(),r){let r;r=this._modules.camera.screenToGraphVector({x:e,y:t}),e=r.x,t=r.y,r=this._modules.camera.screenToGraphVector({x:s,y:i}),s=r.x,i=r.y}const o=this._modules.graph,a=o.getNodes()._indexes,l=[],d=o.getNodeAttribute("excluded"),[h,u]=o.getNodeAttributes(["x","y"]);for(let r=0,o=a.length;r<o;r++){const o=a[r];if(d&&d.get(o))continue;const c=h&&h.get(o),m=u&&u.get(o);c>=e&&c<=s&&m>=t&&m<=i&&l.push(o)}return o.nodeList(new Uint32Array(l))}toggleDebug(e){e?(this._layer=this._modules.layers.addCanvasLayer((e=>{renderDebug(e,this._index,this._queryBounds)}),{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(e){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh((t=>{renderDebug(t,this._index,this._queryBounds,e)}))}},Ta={};function getAABB(e,t,s,i,r=0,o=Math.sin(r),a=Math.cos(r),l=[0,0,0,0]){const d=s/2,h=i/2,u=e+d,c=t+h;if(0===r)return l[0]=e,l[1]=t,l[2]=e+s,l[3]=t+i,l;let m,p,y,x,b,v,E,k;return y=-d,x=-h,m=u+y*a-x*o,p=c+y*o+x*a,b=E=m,v=k=p,y=-d,x=h,m=u+y*a-x*o,p=c+y*o+x*a,m<b?b=m:m>E&&(E=m),p<v?v=p:p>k&&(k=p),y=d,x=h,m=u+y*a-x*o,p=c+y*o+x*a,m<b?b=m:m>E&&(E=m),p<v?v=p:p>k&&(k=p),y=d,x=-h,m=u+y*a-x*o,p=c+y*o+x*a,m<b?b=m:m>E&&(E=m),p<v?v=p:p>k&&(k=p),l[0]=b,l[1]=v,l[2]=E,l[3]=k,l}function getOBBPoints(e,t,s,i,r=0){const o=s/2,a=i/2,l=e+o,d=t+a;if(0===r)return[{x:e,y:t},{x:e+s,y:t},{x:e+s,y:t+i},{x:e,y:t+i}];const h=Math.sin(r),u=Math.cos(r);let c,m,p,y;p=-o,y=-a,c=l+p*u-y*h,m=d+p*h+y*u;const x={x:c,y:m};p=-o,y=a,c=l+p*u-y*h,m=d+p*h+y*u;const b={x:c,y:m};p=o,y=a,c=l+p*u-y*h,m=d+p*h+y*u;const v={x:c,y:m};p=o,y=-a,c=l+p*u-y*h,m=d+p*h+y*u;return[x,b,v,{x:c,y:m}]}function moveAABB(e,t=0,s=1,i=rs.slice()){const r=s*Math.sin(t),o=s*Math.cos(t);return i[0]=e[0]+r,i[1]=e[1]+o,i[2]=e[2]+r,i[3]=e[3]+o,i}function padBounds(e,t){return extendBounds(e,t)}function overlapsAABB(e,t){return overlaps3(e[0],e[1],e[2],e[3],t[0],t[1],t[2],t[3])}function intersects3(e,t,s,i,r,o,a,l){return e>r&&e<a&&t>o&&t<l||s>r&&s<a&&i>o&&i<l}function overlaps3(e,t,s,i,r,o,a,l){return i>=o&&t<=l&&s>=r&&e<=a}__export(Ta,{angle:()=>angle,circleCircleIntersection:()=>circleCircleIntersection,circleContainsCircle:()=>circleContainsCircle,circleContainsPoint:()=>circleContainsPoint,circleIntersectsBox:()=>circleIntersectsBox,circleLineIntersection:()=>circleLineIntersection,circleSortCompare:()=>circleSortCompare,computeCentroid:()=>computeCentroid,cubicBezierAABB:()=>cubicBezierAABB,defaultAABB:()=>rs,degreesToRadians:()=>degreesToRadians,distToSegmentSquared:()=>distToSegmentSquared,distance:()=>distance,distancePointSegment:()=>distancePointSegment,extendBounds:()=>extendBounds,getAABB:()=>getAABB,getBezierCurveBoundingBox:()=>getBezierCurveBoundingBox,getClosestPointOnLine:()=>getClosestPointOnLine,getClosestPointOnSegment:()=>getClosestPointOnSegment,getNormalOnEdge:()=>getNormalOnEdge,getNormalOnQuadraticCurve:()=>getNormalOnQuadraticCurve,getOBBPoints:()=>getOBBPoints,getPointOnBezierCurve:()=>getPointOnBezierCurve,getPointOnEdge:()=>getPointOnEdge,getPointOnQuadraticCurve:()=>getPointOnQuadraticCurve,getQuadraticBezierCurveLength:()=>getQuadraticBezierCurveLength,getQuadraticCurveBoundingBox:()=>getQuadraticCurveBoundingBox,getQuadraticCurveControlPoint:()=>getQuadraticCurveControlPoint,getSelfLoopControlPoints:()=>getSelfLoopControlPoints,getTangentOnEdge:()=>getTangentOnEdge,getTangentOnQuadraticCurve:()=>getTangentOnQuadraticCurve,intersects:()=>intersects3,isPointInLine:()=>isPointInLine,isPointInPolygon:()=>isPointInPolygon,isPointOnBezierCurve:()=>isPointOnBezierCurve,isPointOnQuadraticCurve:()=>isPointOnQuadraticCurve,lineAABB:()=>lineAABB,lineAngle:()=>lineAngle,lineIntersection:()=>lineIntersection,lineLine:()=>lineLine2,move:()=>move,moveAABB:()=>moveAABB,normalize:()=>normalize,overlaps:()=>overlaps3,overlapsAABB:()=>overlapsAABB,padBounds:()=>padBounds,polygonsIntersect:()=>polygonsIntersect,quadBezierAABB:()=>quadBezierAABB,radiansToDegrees:()=>radiansToDegrees,rotate:()=>rotate,segmentIntersection:()=>segmentIntersection,segmentRectangleIntersection:()=>segmentRectangleIntersection,squaredDistance:()=>squaredDistance,twoSegmentsIntersect:()=>twoSegmentsIntersect});function getEdgePoints(e,t){const s=e.getAttribute("curvature"),i=e.getSource(),r=e.getTarget(),o=i.getPositionOnScreen();if(i===r){const e=(s+i.getAttribute("radius"))*Sn*t,r=o.x,a=o.y,l=r-e,d=a,h=r,u=a+e;return[o,...[.2,.4,.6,.8].map((e=>getPointOnBezierCurve(e,r,a,r,a,l,d,h,u))),o]}const a=r.getPositionOnScreen();if(0===s)return[o,a];const l=a.x-o.x,d=a.y-o.y,h=Math.sqrt(l*l+d*d),u=(o.x+a.x)/2,c=(o.y+a.y)/2,m=s*(h/An)*2,p=u+d/h*m,y=c+-l/h*m;return[o,...[.25,.5,.75].map((e=>getPointOnQuadraticCurve(e,o.x,o.y,a.x,a.y,p,y))),a]}function computeCameraConfig(e,t,s,i){"number"==typeof s&&(s={left:s,right:s,top:s,bottom:s});const r=void 0===s.left?40:s.left,o=void 0===s.right?40:s.right,a=void 0===s.top?40:s.top,l=void 0===s.bottom?40:s.bottom,d=r+o,h=a+l,u=0===e.width?e.maxFixedSize:e.width,c=0===e.height?e.maxFixedSize:e.height,m=function computeFinalZoom(e){const t=e.filter((e=>isFinite(e)&&e>0));return t.length?computeMin(t):1}([(t.width-d)/(u+e.maxScaledSize),(t.height-h)/(c+e.maxScaledSize),(t.width-d-e.maxFixedSize)/u,(t.height-h-e.maxFixedSize)/c,i/e.maxScaledSize||NaN]);return{x:e.cx+(o-r)/(2*m),y:e.cy+(l-a)/(2*m),zoom:m}}var Ca="quadraticInOut",ka=200,Ma=class extends Ds{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new ss,this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(e,force=!1){return this._onLocateStart(),force?this._locateGraph(e):this._modules.transformations.whenApplied().then((()=>this._locateGraph(e)))}_locateGraph(e){return this._locateBoundingBox(this.getGraphBoundingBox(),e).then((()=>this._onLocated()))}locateElements(e,t){return this._modules.transformations.whenApplied().then((()=>this._locateBoundingBox(this.getBoundingBox(e),t))).then((()=>this._onLocated()))}locateRawGraph(e,t){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(e),t).then((()=>this._onLocated()))}_onLocateStart(){this._isLocating=!0}_onLocated(){this._isLocating=!1}isLocating(){return this._isLocating}getGraphBoundingBox(e=!1){return e?this.getBoundingBox(this._ogma.getNodes(),!0,e):(this._cacheValid||this._updateCache(),Object.assign({},this._cachedGraphBoundingBox))}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes())}getBoundingBox(e,t=!1,s=!1,i){let r;if(r=e.isNode?this._getNodesBoundingBox(e.toList(),t):this._getEdgesBoundingBox(e.toList(),i),s){const t=this._ogma.modules.labels.getTextsBoundingBox(e.isNode?e.toList():null,e.isNode?null:e.toList());r=r.extend(t)}return r}_getNodesBoundingBox(e,t=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getNodeAttributes(),i=[],r=[],o=[],a=[];for(let l=0;l<e.size;++l){const d=e._indexes[l];if(0===s.excluded.get(d)){const e=s.x.get(d),l=s.y.get(d),h=s.radius.get(d),u=2*h;"scaled"===s.scalingMethod.get(d)?o.push(u):a.push(u),t?(i.push(e-h,e+h),r.push(l-h,l+h)):(i.push(e),r.push(l))}}return new ss({xValues:i,yValues:r,scaledSizeValues:o,fixedSizeValues:a})}_getEdgesBoundingBox(e,t=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getEdgeAttributes(),i=this._modules.graphics.getNodeAttributes(),r={x1:0,y1:0,x2:0,y2:0},o={x:0,y:0},a={minX:0,minY:0,maxX:0,maxY:0},l=[],d=[],h=[],u=[];for(let c=0;c<e.size;++c){const m=e._indexes[c],p=s.source.get(m),y=s.target.get(m),x=s.curvature.get(m),b=i.x.get(p),v=i.y.get(p),E="scaled"===i.scalingMethod.get(p),k=2*i.radius.get(p),L=i.x.get(y),D=i.y.get(y),B="scaled"===i.scalingMethod.get(y),H=2*i.radius.get(y);if(E?h.push(k):u.push(k),B?h.push(H):u.push(H),t||0===x)l.push(b,L),d.push(v,D);else if(p===y){getSelfLoopControlPoints(b,v,x,k/2,0,r),getBezierCurveBoundingBox(b,v,r.x1,r.y1,r.x2,r.y2,L,D,a),l.push(a.minX,a.maxX),d.push(a.minY,a.maxY)}else getQuadraticCurveControlPoint(b,v,L,D,x,o),getQuadraticCurveBoundingBox(b,v,o.x,o.y,L,D,a),l.push(a.minX,a.maxX),d.push(a.minY,a.maxY)}return new ss({xValues:l,yValues:d,scaledSizeValues:h,fixedSizeValues:u})}getRawGraphBoundingBox(e){const t=e.nodes.length,s=new Array(t),i=new Array(t),r=new Array(t);for(let o=0;o<t;o++){const t=e.nodes[o].attributes||{};s[o]=t.x||0,i[o]=t.y||0,r[o]=t.radius||5}return new ss({xValues:s,yValues:i,scaledSizeValues:r})}_locateBoundingBox(e,t={}){if(isNaN(e.cx))return Promise.resolve();const{padding:s={},easing:i=Ca,duration:r=0,maxNodeSizeOnScreen:o=ka,ignoreZoomLimits:a=!1}=t,l=computeCameraConfig(e,this._modules.dom.getDimensions(),s,o),d=l.x,h=l.y,u=l.zoom,c=u/this._modules.camera.getZoom();return this._moveCamera(d,h,u,r,i,c,a)}_moveCamera(e,t,s,i,r,o,a){return o>1.01?(this._modules.camera.setCenter({x:e,y:t},{duration:i,easing:r,ignoreZoomLimits:a}),this._modules.camera.setZoom(s,{duration:i,easing:r,ignoreZoomLimits:a,startAfter:.5})):o<.99?(this._modules.camera.setCenter({x:e,y:t},{duration:i,easing:r,ignoreZoomLimits:a,startAfter:.5}),this._modules.camera.setZoom(s,{duration:i,easing:r,ignoreZoomLimits:a})):this._modules.camera.setCenter({x:e,y:t},{duration:i,easing:r,ignoreZoomLimits:a})}computeConfigForBounds(e,t={}){const{padding:s={},maxNodeSizeOnScreen:i=ka}=t;return computeCameraConfig(e,this._modules.dom.getDimensions(),s,i)}layoutDataBoundingBox({x:e,y:t,indexes:s}){const i=this._modules.graphics.getNodeAttributes(),r=[],o=[],a=[],l=[];for(let d=0;d<s.length;++d){const h=s[d],u=e[d],c=t[d],m=2*i.radius.get(h),p="scaled"===i.scalingMethod.get(h);r.push(u),o.push(c),p?a.push(m):l.push(m)}return new ss({xValues:r,yValues:o,scaledSizeValues:a,fixedSizeValues:l})}isEdgeInPolygon(e,t){return function isEdgeInPolygon(e,t,s){const i=e.getSource(),r=e.getTarget(),o=i.getPositionOnScreen(),a=r.getPositionOnScreen();if(isPointInPolygon(o.x,o.y,t)||isPointInPolygon(a.x,a.y,t))return!0;const l=getEdgePoints(e,s);for(let e=0;e<l.length-1;++e){const s=l[e],i=l[e+1];for(let e=0;e<t.length-1;++e){const r=t[e],o=t[e+1];if(lineLine2(s.x,s.y,i.x,i.y,r.x,r.y,o.x,o.y))return!0}}return!1}(e,t,this._modules.camera.getZoom())}isElementInView(e,{margin:t=0}={}){const{width:s,height:i}=this._modules.camera.getSize(),r={minX:-t,minY:-t,maxX:s+t,maxY:i+t};return e.isNode?this.isNodeInRectangle(e,r):this.isEdgeInRectangle(e,r)}isNodeInRectangle(e,t){return function isNodeInRectangle(e,t,s){const i=e.getPositionOnScreen(),r=Number(e.getAttribute("radius"))*s,o=i.x-r,a=i.y-r,l=i.x+r,d=i.y+r;return l>=t.minX&&o<=t.maxX&&d>=t.minY&&a<=t.maxY}(e,t,this._modules.camera.getZoom())}isNodeInPolygon(e,t){const s=e.getPositionOnScreen();return isPointInPolygon(s.x,s.y,t)}isEdgeInRectangle(e,t){return function isEdgeInRectangle(e,t,s){const i=getEdgePoints(e,s);for(let e=0;e<i.length-1;++e){const s=i[e],r=i[e+1];if(lineAABB(s.x,s.y,r.x,r.y,t.minX,t.minY,t.maxX,t.maxY))return!0}return!1}(e,t,this._modules.camera.getZoom())}},La=pe&&"undefined"!=typeof navigator&&"msLaunchUri"in navigator&&_e&&!("documentMode"in document);var Ia=class extends Ds{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=e=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(e.preventDefault(),e.stopPropagation(),this._applyMouseWheelZoom(e))},this._onMouseMove=e=>{if(!this._isEnabled()||!this._setXY(e))return;const t=this._modules.position.x,s=this._modules.position.y,i=t-this._px,r=s-this._py;0===i&&0===r||(this._skipNextMove?this._skipNextMove=!1:distance(t,s,this._pressX,this._pressY)>=6&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:t,y:s,dx:i,dy:r,domEvent:this._evt})))},this._onDocumentMouseMove=e=>{if(!this._isEnabled()||!this._setXY(e))return;const t=this._modules.position.x,s=this._modules.position.y,i=this._bounds,r=t-this._px,o=s-this._py;(t<0||t>i.width||s<0||s>i.height)&&this._modules.events.fire("documentMouseMove",{x:t,y:s,dx:r,dy:o,domEvent:this._evt})},this._onMouseUp=e=>{if(!this._isEnabled()||!this._setXY(e))return;const t=this._modules.position.x,s=this._modules.position.y,i=this._button,r=this._evt;this._buttons[i]=!1,1===this._clickCounter[this._button]?this._modules.events.fire("clickInternal",{button:i,x:t,y:s,domEvent:r}):this._clickCounter[i]>1&&(this._modules.events.fire("doubleclickInternal",{button:i,x:t,y:s,domEvent:r}),this._resetClickCounter(i)),this._modules.events.fire("mouseupInternal",{button:i,x:t,y:s,domEvent:r})},this._onDocumentMouseup=e=>{if(!this._isEnabled()||!this._setXY(e))return;const t=this._modules.position.x,s=this._modules.position.y,i=this._button;this._buttons[i]=!1;const r=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:i,x:t,y:s,domEvent:this._evt}),r.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),r.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=e=>{if(!this._isEnabled()||!this._setXY(e))return;const t=this._modules.position.x,s=this._modules.position.y,i=this._button,r=this._modules.dom;this._skipNextMove=!0,this._pressX=t,this._pressY=s,this._lastMouseDownTarget=e.target,r.focus(),this._buttons[i]=!0,this._clickCounter[i]+=1;const o=i;this._dbclickTimer=r.setTimeout((()=>{this._resetClickCounter(o,0)}),this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:i,x:t,y:s,domEvent:this._evt}),r.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),r.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=e=>{if(!this._isEnabled()||!this._setXY(e))return;e.preventDefault();const{x:t,y:s}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:t,y:s})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then((()=>this._initializeListeners()))}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(e,value=0){e?this._clickCounter[e]=value:(this._clickCounter.left=value,this._clickCounter.middle=value,this._clickCounter.right=value),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(e){const t=this._domElt.getBoundingClientRect();return this._bounds=t,!!t&&(this._evt=e,this._button=Ge[e.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=e.clientX-t.left,this._modules.position.y=e.clientY-t.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(e){var t;this._setXY(e)&&this._modules.events.fire("mousewheelInternal",{delta:(t=e,La?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Re():t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0),x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){const e=this._domElt,t=this._modules.dom;xe&&this._modules.dom.addElementEventListener(document,"contextmenu",(e=>{this._lastMouseDownTarget&&e.target!==this._lastMouseDownTarget&&e.preventDefault()})),t.addElementEventListener(e,"contextmenu",(e=>{this._setXY(e),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&e.preventDefault()}),!1);const s="onwheel"in e?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll";t.addElementEventListener(e,s,this._onMouseWheel),t.addElementEventListener(e,"mousemove",this._onMouseMove),t.addElementEventListener(e,"mouseleave",(t=>{if(!this._isEnabled())return;this._modules.dom.blur();const s=e.getBoundingClientRect();t.clientX>=s.left+1&&t.clientX<=s.right-1&&t.clientY>=s.top+1&&t.clientY<=s.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})})),t.addElementEventListener(e,"mousedown",this._onMouseDown),t.addElementEventListener(e,"mouseup",this._onMouseUp),t.addElementEventListener(e,"dragover",(e=>{e.preventDefault()})),t.addElementEventListener(e,"drop",this._onDrop)}},Na=500,Pa=class extends Ds{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(e,t,s,i)=>{this._modules.dom.addElementEventListener(e,t,s,i)},this._addWinEvent=(e,t,s,i)=>{this._modules.dom.addDirectWindowEventListener(t,s,i)},this._removeWinEvent=(e,t,s)=>{this._modules.dom.removeDirectWindowEventListener(t,s)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then((()=>{this._initialize(this)}))}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(e,t,s){if(Ms){if("touchstart"===t)return function addPointerStart(e,t,s){const onStart=e=>{isMousePointer(e)||(isTouchPointer(e)&&e.preventDefault(),wrapAndHandle(e,s))};return e(t,Ls,onStart,!1),onStart}(this._addEvent,e,s);if("touchmove"===t)return function addPointerMove(e,t,s){const onMove=e=>{isMousePointer(e)&&0===e.buttons||wrapAndHandle(e,s)};return e(t,Is,onMove,!1),onMove}(this._addWinEvent,e,s);if("touchend"===t)return function addPointerEnd(e,t,s){const onUp=e=>wrapAndHandle(e,s);return e(t,Ns,onUp,!1),e(t,Ps,onUp,!1),onUp}(this._addWinEvent,e,s);if("touchcancel"===t)return function addPointerCancel(e,t,s){const onCancel=e=>{isTouchPointer(e)&&e.preventDefault(),wrapAndHandle(e,s)};return e(t,Ps,onCancel,!1),onCancel}(this._addWinEvent,e,s)}return this._modules.dom.addElementEventListener(e,t,s)}_initialize(e){let t=0,s=0,i=0,r=0,o=!1,a="left",l=0,d=!1,h=!1,u=0,c=null,m=null;const update=()=>{this._modules.position.x=t,this._modules.position.y=s,this._pressed=o},computeGesture=(e,i)=>{const r=this._domElt.getBoundingClientRect();if(!r||null==e.touches)return null;const[o,a]=e.touches,l=o.clientX-r.left,d=o.clientY-r.top,h=a.clientX-r.left,c=a.clientY-r.top,m=(l+h)/2,p=(d+c)/2,y=m-t,x=p-s,b=distance(l,d,h,c),v=this._modules.settings.get("interactions.zoom.speed")||da,E=getSmoothScale(b,v),k=lineAngle(l,d,h,c),L={dx:y,dy:x,rotation:k-u,scale:E};return((e,i,r,o)=>{u=i,t=r,s=o,update()})(0,k,m,p),L},progressGesture=e=>{if(e.touches&&2===e.touches.length&&h){const i=computeGesture(e);if(i){const{dx:e,dy:r,rotation:o,scale:l}=i;this._modules.events.fire("touchProgressGesture",{dx:e,dy:r,rotation:o,scale:l,x:t,y:s,domEvent:c,button:a})}}},setXY=e=>{if(a=Ge[e.button],!e.touches)return!1;if(1!==e.touches.length)return o=!1,e.touches.length>1&&this._modules.events.fire("touchUp",{x:t,y:s,domEvent:c,button:a}),!1;const l=this._domElt.getBoundingClientRect();return l&&(i=t,r=s,t=e.touches[0].clientX-l.left|0,s=e.touches[0].clientY-l.top|0,o=!0,c=e,update()),!0},resetTapCounter=()=>{l=0,this._modules.dom.clearTimeout(m)},onTouchEnd=e=>{if(e.preventDefault(),!e.touches)return;if(2!==e.touches.length&&h&&(h=!1,this._modules.events.fire("touchEndGesture",{domEvent:c})),setXY(e),0===e.touches.length){const e={x:t,y:s,domEvent:c,button:a};1===l&&this._modules.events.fire("touchTap",e),l>1&&(this._modules.events.fire("touchDoubleTap",e),resetTapCounter()),this._modules.events.fire("touchUp",e)}const i=getDocument().documentElement;removePointerListener(this._removeWinEvent,i,"touchmove",this._onMove),removePointerListener(this._removeWinEvent,i,"touchend",this._onEnd)},move3=e=>{progressGesture(e),d?d=!1:(resetTapCounter(),setXY(e)&&this._modules.events.fire("touchMove",{x:t,y:s,dx:t-i,dy:s-r,domEvent:c,button:a}))};this._listen(this._domElt,"touchstart",(e=>{if(!e.touches)return;2!==e.touches.length||h||computeGesture(e)&&(h=!0,this._modules.events.fire("touchStartGesture",{domEvent:c})),setXY(e)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:t,y:s,domEvent:c,button:a}),l+=1,m=this._modules.dom.setTimeout(resetTapCounter,Na),d=!0);const i=getDocument().documentElement;this._onMove=this._listen(i,"touchmove",move3),this._onEnd=this._listen(i,"touchend",onTouchEnd)}))}},Fa=["x","y","radius"],za=-1e7,Da=class extends Ds{constructor(){super(...arguments),this._visibleGroups=new Set,this._visualGroupsLayers=new Map,this._groupsToHide=[],this._paddingMap=new Map,this._shouldUpdateGroups=!1,this._onGroupingRun=({metaNodes:e,padding:t})=>{isNaN(+t)?e._indexes.forEach(((e,s)=>this._paddingMap.set(e,t[s]))):e._indexes.forEach((e=>this._paddingMap.set(e,t))),this._shouldUpdateGroups=!0},this._onRemoveNodes=({nodes:e})=>{e.forEach((e=>this.removeVisibleGroup(e)))},this._onSetMultipleAttributes=({elements:e,values:t,options:s})=>{if(this._recursiveGuard||!this._visibleGroups.size)return;const i=e.toList().map(((e,s)=>({group:e,translation:t.constructor===Array?{x:t[s]&&t[s].x||0,y:t[s]&&t[s].y||0}:{x:t.x||0,y:t.y||0},isGroup:e.isNode&&this._visibleGroups.has(e._index)}))).filter((({isGroup:e})=>e));i.length&&(this._recursiveGuard=!0,i.forEach((({group:e,translation:t})=>this.animateChildren(e,s,t))),this._recursiveGuard=!1)},this._updateVisualGroups=(e,t,s)=>{const i=s.nodes.getUpdatedElementsList().filter((e=>e)),r=e.nodes.outputFlexArrays,o=e.nodes.inputFlexArrays,a=this._visibleGroups;if(0===i.size||0===a.size&&!this._groupsToHide.length)return e.nodes.toUpdate.clear(),e.edges.toUpdate.clear(),r.radius.reset(),r.x.reset(),r.y.reset(),void(e.nodes.formattedOutput&&(e.nodes.formattedOutput.attributes=[]));const l=s.nodes.getUpdatedAttributes();for(;this._groupsToHide.length>0;){const e=this._groupsToHide.pop();r.radius.set(e,void 0),r.x.set(e,void 0),r.y.set(e,void 0)}if(l.has("x")||l.has("y")||l.has("radius")||this._shouldUpdateGroups){this._shouldUpdateGroups=!1;const t=this._getAllSubNodes(i);let l=this._getAllMetaNodes(i);const d=e.nodes.toUpdate,h=e.edges.toUpdate,u=this._subNodeOffsetX,c=this._subNodeOffsetY;e.nodes.formattedOutput&&e.nodes.output&&(e.nodes.formattedOutput.attributes=Fa,e.nodes.output.attributes=Fa);const m=new Set;i.forEach((e=>{const t=e._index;r.x.set(t,void 0),r.y.set(t,void 0),m.add(t)})),t.forEach((e=>{if(!o)return;const t=e.getMetaNode(),s=e._index;let i=o.x.get(s),p=o.y.get(s);if(t&&a.has(t._index)){const o=u.get(s),a=c.get(s),y=r.x.get(t._index),x=r.y.get(t._index),b=i-y,v=p-x;if(o===za||a===za)return u.set(s,b),c.set(s,v),void(l.includes(t)||(l=l.concat(t.toList())));d.addIndex(s),h.add(e.getAdjacentEdges()),m.has(s)||o===b&&a===v||(i=y+o,p=x+a,r.x.set(s,i),r.y.set(s,p)),u.set(s,i-y),c.set(s,p-x)}})),l.forEach((e=>{const t=e.getSubNodes();if(!t)return;const s=r.x.getMultiple(t._indexes),i=r.y.getMultiple(t._indexes),o=r.radius.getMultiple(t._indexes),a=ss.fromValues(s,i,o),[l,m,p]=a.width===a.height&&a.width===a.maxScaledSize?[a.cx,a.cy,a.maxScaledSize]:minDisk(s,i,o),y=this._paddingMap.get(e._index)||0;t.forEach(((e,t)=>{u.set(e._index,s[t]-l),c.set(e._index,i[t]-m)})),r.x.set(e._index,l),r.y.set(e._index,m),r.radius.set(e._index,p+y),d.addIndex(e._index),h.add(e.getAdjacentEdges())})),s.nodes.addUpdatedAttribute("radius"),s.nodes.addUpdatedAttribute("x"),s.nodes.addUpdatedAttribute("y"),s.nodes.redrawElements(l)}}}onMounted(){this._subNodesList=this._modules.graph.createNodeAttribute({storage:"any",default:null},!1),this._subEdgesList=this._modules.graph.createEdgeAttribute({storage:"any",default:null},!1),this._metaNodeList=this._modules.graph.createNodeAttribute({storage:"any",default:null},!1),this._metaEdgeList=this._modules.graph.createEdgeAttribute({storage:"any",default:null},!1),this._subNodeOffsetX=this._modules.graph.createNodeAttribute({storage:"float",default:za},!1),this._subNodeOffsetY=this._modules.graph.createNodeAttribute({storage:"float",default:za},!1),this._recursiveGuard=!1,this._modules.events.register(["groupingRun"]),this._modules.events.on("setMultipleAttributes",this._onSetMultipleAttributes).on("groupingRun",this._onGroupingRun).on("removeNodes",this._onRemoveNodes),this._groupAttributeLayer=this._modules.graphics.addAttributeLayer({name:"internal(_compound)",priority:7,nodeSelector:e=>this._visibleGroups.has(e._index),edgeSelector:e=>e.isVirtual(),nodeAttributes:{layer:e=>this._visualGroupsLayers.get(e._index)},nodeOutput:{attributes:["layer"]},nodeDependencies:{self:{data:!1,attributes:["radius"],hover:!0},adjacentNodes:{attributes:"all"},adjacentEdges:{attributes:"all"}}}),this._topologyLayer=this._modules.graphics.addAttributeLayer({name:"internal(position-forcer)",priority:6.9,nodeDependencies:{self:{attributes:["x","y","radius"]},adjacentNodes:{attributes:"all"}},onBeforeUpdate:this._updateVisualGroups,nodeOutput:{attributes:["x","y","radius","layer"]}})}animateChildren(e,t,s){0===s.x&&0===s.y||e.getSubNodes().forEach((e=>{const i=this._subNodeOffsetX.get(e._index),r=this._subNodeOffsetY.get(e._index),o={x:s.x+i,y:s.y+r};e.setAttributes(o,t),e.getSubNodes()&&this.animateChildren(e,t,o)}))}resetOffsets(){this._recursiveGuard=!0;const e=this._modules.graph.getNodes(),t=this._topologyLayer.getFlexArrays().nodes;e.setAttribute("x",t.x.getMultiple(e._indexes)),e.setAttribute("y",t.y.getMultiple(e._indexes)),t.x.reset(),t.y.reset(),this._recursiveGuard=!1}addVisibleGroup(e,t){this._visualGroupsLayers.set(e._index,t),this._visibleGroups.add(e._index)}getNodeDepth(e){return this._visualGroupsLayers.get(e._index)||0}removeVisibleGroup(e){const t=e._index;this._visibleGroups.delete(t)&&(this._groupsToHide.push(t),this._visualGroupsLayers.delete(t))}_getAllSubNodes(e){const t=Array.from(e._indexes),s=[],i=this._visibleGroups,r=this._subNodesList;for(;0!==t.length;){const e=t.pop();if(null!=e&&i.has(e)){const i=r.get(e),o=Array.from(i._indexes);s.push.apply(s,o),t.unshift.apply(t,o)}}return this._modules.graph.nodeList(new Uint32Array(s))}_getAllMetaNodes(e){const t=Array.from(e._indexes),s=this._visibleGroups,i=this._metaNodeList,r=[],o=new Set;for(;0!==t.length;){const e=t.pop();if(null!=e){const a=i.get(e);null!==a&&!o.has(a._index)&&s.has(a._index)&&(o.add(a._index),r.push(a._index),t.unshift(a._index))}}return this._modules.graph.nodeList(new Uint32Array(r))}isVisibleGroup(e){return this._visibleGroups.has(e._index)}getSubNodeOffset(e){return{x:this._subNodeOffsetX.get(e._index),y:this._subNodeOffsetY.get(e._index)}}_fetchSubEltsList(e){return e?this._subNodesList:this._subEdgesList}_fetchMetaEltList(e){return e?this._metaNodeList:this._metaEdgeList}setSubElements(e,t){this._fetchSubEltsList(e.isNode).setMultiple(e._indexes,t)}setMetaElement(e,t){this._fetchMetaEltList(e.isNode).setMultiple(e._indexes,t)}getSubElements(e){return this._fetchSubEltsList(e.isNode).getMultiple(e._indexes)}getMetaElement(e){return this._fetchMetaEltList(e.isNode).getMultiple(e._indexes)}},Ra=class extends Ds{constructor(){super(...arguments),this._list=[],this._idCounter=0,this._mustRefresh=!1,this._safeGuard=!1,this._preventFiringEvents=!1,this._afterCurrentUpdate=Promise.resolve(),this._destroyed=!1,this._update=()=>{let e=Promise.resolve();this._modules.captor.setDetectionEnabled(!1);const t=this._list.filter((({shouldDo:e})=>e)),s=this._list.filter((({enabled:e,shouldUndo:t})=>e||t));let i,r,o=!1;if(s.length===t.length+1&&areTransformationListEqual(s,t,t.length)){const e=s.pop();i=e?[e]:[],r=[],o=!0}else if(t.length===s.length+1&&areTransformationListEqual(s,t,s.length)){i=[];const e=t.pop();r=e?[e]:[],o=!0}else i=s,r=t,o=!1;return e=e.then((()=>this._resolveTransformations(i,r,o))).then((()=>this._modules.captor.setDetectionEnabled(!0))).then((()=>{i.filter((({shouldUndo:e})=>e)).forEach((e=>{e.shouldUndo=!1,e.enabled=!1})),r.forEach((e=>{e.shouldDo=!0,e.enabled=!0}))})),e}}onMounted(){this._modules.classes.createClass({name:Zs,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this._modules.classes.createClass({name:Qs,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._nodeTransformationIdList=this._modules.graph.createNodeAttribute({storage:16,default:0},!1),this._edgeTransformationIdList=this._modules.graph.createEdgeAttribute({storage:16,default:0},!1),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"]),this._modules.events.on("clearGraph",(()=>{this._list.forEach((e=>e.resetContext()))})),this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges"],(({virtual:e})=>{e||this._afterCurrentUpdate.then((()=>this.refresh(!0)))})).on("requestElementsToDelete",(e=>{e.virtual||(e.elementsToRemove=this._getSubElements(e.elementsToRemove),e.elementsToRemove.size&&this._resolveTransformations(this._list,[],!1))})).on(["updateNodeData","updateEdgeData"],(()=>{this._modules.settings.get("transformations.updateOnDataChange")&&!this._safeGuard&&this.refresh(!0)}))}refresh(e=!1){return this._list.length?(this._mustRefresh||this._safeGuard||(this._preventFiringEvents=!0,this._mustRefresh=!0,this._safeGuard=!0,this._afterCurrentUpdate=this._afterCurrentUpdate.then((()=>this._update())).then((()=>(this._modules.dom.refresh(),this._modules.dom.afterNextFrame()))).then((()=>(this._modules.dom.refresh(),this._mustRefresh=!1,this._safeGuard=!1,this._list.forEach((t=>{if(t.getError())return t.cleanup(),t.resetContext(),t.reject();t.resolve(),this._preventFiringEvents=!e,this._fireEvent("transformationRefresh",{target:t}),this._preventFiringEvents=!1})),Promise.resolve())))),this._afterCurrentUpdate):Promise.resolve()}getById(e){return this._list.find((t=>t.getId()===e))}_fireEvent(e,t){this._preventFiringEvents||this._destroyed||this._modules.events.fire(e,t)}_getSubElements(e){return e.reduce(((e,t)=>{if(void 0===t)return e;const s=this._modules.grouping.getSubElements(t)[0];return s?e.concat(this._getSubElements(s)):e.concat(t)}),e.slice(0,0))}_assignTransformationIds(e,t,s){null!==t&&this._nodeTransformationIdList.setMultiple(t._indexes,e),null!==s&&this._edgeTransformationIdList.setMultiple(s._indexes,e)}_resolveTransformations(e,t,s){if(s||(e.forEach((e=>e.setDuration(0))),t.forEach((e=>e.setDuration(0)))),this._destroyed)return Promise.resolve();const i=this._modules.selection.getSelectedNodes().getId(),r=this._modules.selection.getSelectedEdges().getId();let o=Promise.resolve();return e.slice().reverse().forEach((e=>{null!==e.getContext()&&(o=o.then((()=>e.undo())))})),t.forEach((e=>{o=o.then((()=>e.run())).catch((t=>(e.setError(t),!0))).then((t=>{if(!0===t)return Promise.resolve();const s=t;return this._assignTransformationIds(e.getId(),s.virtualNodes,s.virtualEdges),e.setContext(s),Promise.resolve()}))})),o=o.then((()=>{this._destroyed||(this._modules.graph.getNodes(i).setSelected(!0),this._modules.graph.getEdges(r).setSelected(!0))})),o}getList(){return this._list}clear(){const e=this._list.slice();return e.forEach((e=>{e.shouldUndo=!0,e.shouldDo=!1,e.setRemovalDuration(0)})),this.refresh().then((()=>(this._list=this._list.filter((t=>!e.includes(t))),Promise.resolve()))).then((()=>Promise.all(e.slice().reverse().map((e=>e.cleanup()))))).then((()=>{e.forEach((e=>{this._fireEvent("transformationDestroyed",{target:e})}))}))}_get(e,t=!0){const s=this._list.find((t=>t.getId()===e));if(!s){if(t)throw new Error("calling a method on a destroyed transformation");return null}return s}enable(e,t){return this._afterCurrentUpdate.then((()=>(e.shouldDo=!0,e.shouldUndo=e.enabled,e.setDuration(t),this.refresh()))).then((()=>{this._preventFiringEvents||this._fireEvent("transformationEnabled",{target:e})}))}disable(e,t){return this._afterCurrentUpdate.then((()=>(e.shouldUndo=!0,e.shouldDo=!1,e.setRemovalDuration(t),this.refresh()))).then((()=>{this._preventFiringEvents||this._fireEvent("transformationDisabled",{target:e})}))}remove(e,t){return this._afterCurrentUpdate.then((()=>(e.setRemovalDuration(t),e.shouldUndo=!0,e.shouldDo=!1,this.refresh().then((()=>{e.cleanup(),this._list.splice(e.getIndex(),1)}))))).then((()=>{this._fireEvent("transformationDestroyed",{target:e})}))}setIndex(e,t){if(!e)return this._afterCurrentUpdate;let s,i;return this._preventFiringEvents=!0,this._afterCurrentUpdate.then((()=>{const r=e.getIndex(),o=Math.min(r,t);return s=this._list.slice(o).filter((e=>e.isEnabled())),i=s.map((e=>[e.getDuration(),e.getRemovalDuration()])),s.forEach((e=>e.disable(0))),this.refresh()})).then((()=>(this._list.splice(e.getIndex(),1),this._list.splice(clamp(t,0,this._list.length),0,e),s.forEach(((e,t)=>{e.enable(0)})),this.refresh()))).then((()=>(s.forEach(((e,t)=>{e.setDuration(i[t][0]),e.setRemovalDuration(i[t][1])})),this._afterCurrentUpdate))).then((()=>{this._preventFiringEvents=!1,this._fireEvent("transformationSetIndex",{target:e,index:t})}))}setOptions(e,t){return e._setOptions(t),e.setDuration(t.duration),e.enabled===t.enabled&&e.enabled?this.refresh(!0):t.enabled?this.enable(e,t.duration):this.disable(e,t.duration)}getIndex(e){for(let t=0;t<this._list.length;t++)if(this._list[t]===e)return t;return-1}add(e){return this._list.push(e),e.initialize({ogma:this._ogma,id:++this._idCounter}),this.refresh().then((()=>e.isEnabled()?this._fireEvent("transformationEnabled",{target:e}):this._fireEvent("transformationDisabled",{target:e}))),e}whenApplied(){return this._modules.dom.afterNextFrame().then((()=>this._afterCurrentUpdate))}isEnabled(e){const t=this._get(e);return t&&t.enabled||!1}_getElementTransformationId(e){return(e.isNode?this._nodeTransformationIdList:this._edgeTransformationIdList).get(e._index)}isElementVirtual(e){return 0!==this._modules.graph.getAttribute(e.isNode,"virtual").get(e._index)}getElementTransformation(e){return this._get(this._getElementTransformationId(e),!1)}destroy(){this._destroyed=!0}};function areTransformationListEqual(e,t,s){for(let i=0;i<s;++i)if(e[i].getId()!==t[i].getId())return!1;return!0}var Oa={layer:2,outline:!0,outerStroke:{color:lo,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:ho,minVisibleSize:0}},Ba={layer:2,color:lo,text:{backgroundColor:ho,minVisibleSize:0},stroke:{color:lo,width:0}},ja=class extends Ds{onMounted(){this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:qs,isBuiltin:!0,nodeAttributes:Oa}),this._selectedClass=this._modules.classes.createClass({name:Hs,isBuiltin:!0,nodeAttributes:Oa,edgeAttributes:Ba}),this._modules.events.on(`nodeClassAdded_${Hs}`,(e=>{this._modules.events.fire("nodesSelected",e)})),this._modules.events.on(`edgeClassAdded_${Hs}`,(e=>{this._modules.events.fire("edgesSelected",e)})),this._modules.events.on(`nodeClassRemoved_${Hs}`,(e=>{this._modules.events.fire("nodesUnselected",e)})),this._modules.events.on(`edgeClassRemoved_${Hs}`,(e=>{this._modules.events.fire("edgesUnselected",e)})),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:e})=>{const t=!!this._modules.settings.get("interactions.selection.enabled");return"left"===e&&t},handler:({target:e})=>{if(e){const t=this._modules.settings.get("interactions.selection.multiSelectionKey"),s=t&&this._modules.keyboard.isPressed(t);if(e.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),s)e.hasClass(Hs)?e.removeClass(Hs):e.addClass(Hs);else{(e.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter((t=>t!==e)).removeClass(Hs),e.hasClass(Hs)||e.addClass(Hs)}}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});const refreshNodesHighlight=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(qs)};this._modules.events.on("beforeRemoveEdges",(({edges:e})=>e.setSelected(!1))).on("excludedStateChange",(({elements:e,value})=>{value||e.setSelected(!1)})).on(`edgeClassAdded_${Hs}`,refreshNodesHighlight).on(`edgeClassRemoved_${Hs}`,refreshNodesHighlight)}setNodeAttributes(e,t){this._selectedClass.update({nodeAttributes:e,fullOverwrite:t}),this._selectionExtremityHighlightedClass.update({nodeAttributes:e,fullOverwrite:t}),this._updateExtremityHighlightLayer()}setEdgeAttributes(e,t){this._selectedClass.update({edgeAttributes:e,fullOverwrite:t}),this._updateExtremityHighlightLayer()}_updateExtremityHighlightLayer(){const e=this._selectedClass.getDefinition().edgeAttributes,t=e?e.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:t},fullOverwrite:!1})}setActive(e,t){if(isArray(t)){const s=[],i=[];e.toList().forEach(((e,r)=>{(t[r]?s:i).push(e.getId())})),0!==s.length&&this._modules.graph.getElements(e.isNode,s).addClass(Hs),0!==i.length&&this._modules.graph.getElements(e.isNode,i).removeClass(Hs)}else e.size&&e[t?"addClass":"removeClass"](Hs)}areActive(e){return e.hasClass(Hs)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter((e=>!e.hasClass(Hs)))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter((e=>!e.hasClass(Hs)))}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},Va=class extends Ds{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","newFrame"],(()=>{this._delayedCalls.forEach((e=>e.reset()))}))}_nextTimeIdle(e){const t=new Ua(this._modules.dom,this._idIdle,e);return this._delayedCalls.push(t),t.whenDone().then((()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(t),1)}))}debounceIdle(e,t=0){let s=!1,i=[];const trigger=()=>{const t=i;s=!1,i=[],e(),t.forEach((e=>e()))};return()=>new Promise((e=>{i.push(e),s||(s=!0,this._nextTimeIdle(t).then(trigger))}))}},Ua=class{constructor(e,t,s){this._timeout=null,this._done=!1,this._dom=e,this._promise=new Promise((e=>this._resolve=e)),this._isIdle=t,this._delay=s,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout((()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()}),this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},Ga={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},Wa={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},Ha=class extends Ds{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:e,edges:t,nodeAttributes:s,edgeAttributes:i})=>{this._onElementsAttributeChange(e,s),this._onElementsAttributeChange(t,i,!1)},this._refreshPulses=()=>{const{nodes:e,edges:t}=this._hasPulses.getElements();if(0!==e.size||0!==t.size){const s=this._engine.getCurrentTime();this._refreshElementsPulses(e,s),this._refreshElementsPulses(t,s),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("newFrame",this._refreshPulses).on("beforeRemoveEdges",(({edges:e})=>{this._removePulses(e)})).on("beforeRemoveNodes",(({nodes:e})=>{this._removePulses(e)})).on("excludedStateChange",(({elements:e,value})=>{value&&(this._hasPulses.removeElements(e),this._removePulses(e))})).on("clearGraph",(()=>this._hasPulses.clear())),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new ts(this._modules.graph)}_onElementsAttributeChange(e,t,s=!0){if(!t.includes("pulse.enabled"))return;const{valid:i,invalid:r}=splitElements(this._modules.graph,e,(e=>e.getAttribute("pulse.enabled")&&e.isVisible()));this._hasPulses.removeElements(r),this._hasPulses.addElements(i);const o=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let e=0;e<i.size;e++)o.get(i._indexes[e])>0||o.set(i._indexes[e],-2);this._removePulses(r)}_removePulses(e){const t=e.isNode?this._nodePulses:this._edgePulses,s=e.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let i=0;i<e._indexes.length;i++){const r=e._indexes[i],o=t.get(r);if(o){for(let e=0;e<o.length;e++){const t=o[e];this._modules.graphics.releaseGraphicsEngineBlockId(t.blockId)}t.set(r,null);const e=s.get(r);e&&(e.resolve(),s.delete(r))}}}_refreshElementsPulses(e,t){const s=e.isNode,i=s?this._nodePulses:this._edgePulses,r=s?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,o=s?"_createNodePulseBlock":"_createEdgePulseBlock",a=s?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,l=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let s=0;s<e._indexes.length;s++){const d=e._indexes[s];let h=i.get(d);h||(h=[],i.set(d,h));for(let e=0;e<h.length;e++){const{startTime:s,duration:i,blockId:r}=h[e];t>=s+i&&(this._modules.graphics.releaseGraphicsEngineBlockId(r),h.splice(e--,1))}const u=h[h.length-1];if(u&&t<u.startTime+a.get(d))continue;const c=r.get(d),m=l.get(d);if(m<1&&-2!==m)continue;h.push({blockId:this[o](d,t,c),startTime:t,duration:c});const p=-2===m?-2:m-1;l.set(d,p)}}_createNodePulseBlock(e,t,s){const i=this._nodeFlexArrays,r=i.color.get(e),o=i.layer.get(e),a=i.x.get(e),l=i.y.get(e),d=i.radius.get(e),h="scaled"===i.scalingMethod.get(e),u=i.pulse.startRatio.get(e),c=i.pulse.endRatio.get(e),m=i.pulse.width.get(e),p=2*d*u,y=2*d*c,x=layerToDepth(o).nodeBody,b=i.pulse.startColor.get(e),v=i.pulse.endColor.get(e),E=this._modules.graphics.allocateGraphicsEngineBlockId(),k=this._group.reset(1,!0,x),L=k.nextAndReset(),D=inheritColor(b,r),B=inheritColor(v,r);return L.end.shape="circle",L.end.pieceId=en,L.end.x1=a,L.end.y1=l,L.end.x2=a,L.end.y2=l,L.end.rectWidthOrSourceRadiusScaled=h?y:0,L.end.rectHeightOrTargetRadiusScaled=h?y:0,L.end.rectWidthOrSourceRadiusFixed=h?0:y,L.end.rectHeightOrTargetRadiusFixed=h?0:y,L.end.strokeWidthFixed=m,L.end.strokeColor=B,L.start.shape="circle",L.start.pieceId=en,L.start.x1=a,L.start.y1=l,L.start.x2=a,L.start.y2=l,L.start.rectWidthOrSourceRadiusScaled=h?p:0,L.start.rectHeightOrTargetRadiusScaled=h?p:0,L.start.rectWidthOrSourceRadiusFixed=h?0:p,L.start.rectHeightOrTargetRadiusFixed=h?0:p,L.start.strokeWidthFixed=m,L.start.strokeColor=D,L.animation.duration=s,L.animation.beginTime=t,this._engine.storeGroup(E,k),E}_createEdgePulseBlock(e,t,s){const i=this._edgeFlexArrays,r=this._nodeFlexArrays,o=i.pulse.startRatio.get(e),a=i.pulse.endRatio.get(e),l=i.pulse.startColor.get(e),d=i.pulse.endColor.get(e),h=layerToDepth(i.layer.get(e)).edgeBody,u=this._edgeSourceList.get(e),c=this._edgeTargetList.get(e),m=i.curvature.get(e),p=0!==m,y=this._modules.graphics.allocateGraphicsEngineBlockId(),x=this._group.reset(p?3:1,!0,h),b=x.nextAndReset(),v={isSelfLoop:u===c,curvature:m,sourceX:r.x.get(u),sourceY:r.y.get(u),targetX:r.x.get(c),targetY:r.y.get(c),sourceRadius:r.radius.get(u),targetRadius:r.radius.get(c),isSourceRadiusScaled:"scaled"===r.scalingMethod.get(u),isTargetRadiusScaled:"scaled"===r.scalingMethod.get(c),width:i.width.get(e),isWidthScaled:"scaled"===i.scalingMethod.get(e),strokeWidth:i.pulse.width.get(e)};return prepareEdgePulse(b.start,v),prepareEdgePulse(b.end,v),b.start.strokeColor=l,b.end.strokeColor=d,b.start.thicknessOrFontSizeScaled*=o,b.start.thicknessOrFontSizeFixed*=o,b.end.thicknessOrFontSizeScaled*=a,b.end.thicknessOrFontSizeFixed*=a,b.animation.duration=s,b.animation.beginTime=t,this._engine.storeGroup(y,x),y}pulse(e,t){const s=e.isNode,i=__spreadValues(__spreadValues(__spreadValues({},s?Ga:Wa),s?this._nodePulseTheme:this._edgePulseTheme),t),r=i.number,o=i.interval,a=i.duration,l=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,d=(r-1)*o+a;let h;i.enabled=!0,delete i.number,e.setAttributes({pulse:i}),l.setMultiple(e._indexes,r),this._modules.dom.setTimeout((()=>{e.isList?e.filter(idenitity).setAttribute("pulse.enabled",!1):e.setAttribute("pulse.enabled",!1),l.setMultiple(e._indexes,-1)}),d);const u=new Promise((t=>{h=()=>t(e)})),c=e.isNode?this._nodePromiseMap:this._edgePromiseMap;return e.isList?e._indexes.forEach((e=>{this._setPromise(e,c,u,h)})):this._setPromise(e._index,c,u,h),u}_setPromise(e,t,s,i){t.has(e)&&t.get(e).resolve(),t.set(e,{promise:s,resolve:i})}setTheme(e,t){this._nodePulseTheme=e,this._edgePulseTheme=t}};function prepareEdgePulse(e,{sourceX:t,sourceY:s,targetX:i,targetY:r,isSourceRadiusScaled:o,isTargetRadiusScaled:a,targetRadius:l,sourceRadius:d,isWidthScaled:h,width:u,strokeWidth:c,curvature:m,isSelfLoop:p}){e.pieceId=tn,e.shape="line",e.x1=t,e.y1=s,e.x2=i,e.y2=r,e.rectWidthOrSourceRadiusScaled=o?d:0,e.rectWidthOrSourceRadiusFixed=o?0:d,e.rectHeightOrTargetRadiusScaled=a?l:0,e.rectHeightOrTargetRadiusFixed=a?0:l,e.thicknessOrFontSizeScaled=h?u:0,e.thicknessOrFontSizeFixed=h?0:u,e.strokeWidthFixed=c,e.curvature=m,e.isSelfLoop=p}var qa={duration:0,easing:"linear",callback:noop,resolve:noop,startAfter:0},Xa=0,$a=class extends Ds{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(0===this._animationList.length)return;const e=getCurrentTime(),t=[];for(let s=0;s<this._animationList.length;++s){const i=this._animationList[s],r=(e-i.creationDate)/i.duration,o=i.startAfter;let a=i.easing(r);if(r>=1)i.func(1),i.done=!0,i.resolve(void 0),this._animationList.splice(s,1),s-=1,t.push(i.callback);else if(a>=o){a=(a-o)*(1/(1-o)),i.func(a)}}for(let e=0;e<t.length;e++)t[e](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(e,t){const{duration:s,easing:i,callback:r,startAfter:o,resolve:a}=getOptions(t,qa);if(s<=0)return e(1),r(),a(void 0),null;const l={func:e,easing:"function"==typeof i?i:ta[i],duration:s,callback:r,resolve:a,startAfter:o,creationDate:getCurrentTime(),done:!1,id:++Xa};return this._animationList.push(l),this._modules.dom.refresh(),l}cancel(e){const t=this._animationList.indexOf(e);-1!==t&&(e.func(1),this._animationList.splice(t,1),e.done=!0,e.resolve(void 0))}};function noCache(e){return e+(-1===e.indexOf("?")?"?":"&")+"noCache="+Date.now()}var Ya={tileLayers:(e,t,s,i,r)=>{const o=s._getMapPanePos(),a=e.getContainer();if(!a)throw new Error(`Trying to access the container of ${e} but it does not exist.`);const l=i.DomUtil.getPosition(a);s.removeLayer(e),e.options.crossOrigin="anonymous";const d=[],h=[];return e.on("tileload",(({tile:e})=>{const{x:t,y:s}=i.DomUtil.getPosition(e);d.push(e),h.push({x:t-l.x+o.x,y:s-l.y+o.y})})),s.addLayer(e),new Promise((s=>{e.once("load",(()=>{const i=e.getTileSize();d.forEach(((e,s)=>{const{x:r,y:o}=h[s];t.drawImage(e,r,o,i.x,i.y)})),s()}))}))},imageOverlays:(e,t,s,i,r)=>new Promise((i=>{s.removeLayer(e),e.setUrl(noCache(e.getUrl())),e.options.crossOrigin="anonymous",e.once("load",(()=>{const r=e.getBounds(),o=s.latLngToContainerPoint(r.getNorthWest()),a=s.latLngToContainerPoint(r.getSouthEast()),l=a.x-o.x,d=a.y-o.y;t.drawImage(e._image,o.x,o.y,l,d),i()})),s.addLayer(e)})),vectorLayers:(e,t,s,i,r,o)=>new Promise((a=>{const l=e.options.renderer;s.removeLayer(e),e.options.renderer=o,s.addLayer(e),o._updatePaths();const d=s._getMapPanePos(),h=o._container,u=i.DomUtil.getPosition(h);t.drawImage(o._container,u.x+d.x,u.y+d.y,h.width/r,h.height/r),s.removeLayer(e),e.options.renderer=l,s.addLayer(e),a()})),markers:(e,t,s,i,r)=>new Promise((i=>{const o=s.getPixelBounds().min,a=s.project(e.getLatLng(),s.getZoom()),l=/^data:/.test(e._icon.src),d=l?e._icon.src:noCache(e._icon.src),h=new Image,u=e.options.icon;if(u){const e=u.options;let s=e.iconSize||[24,24];const c=a.subtract(o);let m=e.iconAnchor||[0,0];Array.isArray(s)||(s=[s.x,s.y]),Array.isArray(m)||(m=[m.x,m.y]);const p=Math.round(c.x-(s[0]-m[0])*r),y=Math.round(c.y-m[1]*r);h.crossOrigin="";const onLoad=()=>{t.drawImage(h,p,y,s[0]*r,s[1]*r),i()};h.onload=onLoad,h.src=d,l&&onLoad()}})),vectorMap:(e,t,s,i)=>{const r=s._getMapPanePos(),o=e.getMapboxMap(),a=e.getCanvas(),l=e.getSize().round(),d=i.DomUtil.getPosition(e.getContainer()),h=d.x+r.x,u=d.y+r.y;return new Promise((e=>{function renderAndResolve(){t.drawImage(a,h,u,l.x,l.y),e()}if(o.loaded())return renderAndResolve();o.once("idle",renderAndResolve)}))}};function computeOffsetAndCameraToGeo(e,t,s,i){const r=e.filter((e=>e.isVisible())),o=0===r.size,{mapX:a,mapY:l}=r.reduce(((e,t)=>{const{latitude:s,longitude:r}=t.getGeoCoordinates(),{x:o,y:a}=i(s,r);return e.mapX.push(o),e.mapY.push(a),e}),{mapX:[],mapY:[]}),d=r.getAttribute("x"),h=r.getAttribute("y"),u=r.getAttribute("radius").map(Number),c=new ss({xValues:d,yValues:h,scaledSizeValues:u}),m=new ss({xValues:a,yValues:l});o&&(c.cx=c.cy=0,c.width=c.height=0),isFinite(m.width)&&isFinite(m.height)||(m.cx=m.cy=0,m.width=m.height=0);let p=m.cx-c.cx,y=m.cy-c.cy;const x=o?1:Math.max(m.width,m.height)/Math.max(c.width,c.height),[b,v]=u.reduce(((e,t)=>(e[0]=Math.min(e[0],t*x),e[1]=Math.max(e[1],t*x),e)),[1/0,0]);m.pad(v),m.minScaledSize=b,m.maxScaledSize=v;const E=s.computeConfigForBounds(m),k=t.zoom/function normalizeZoom(e){return Math.pow(2,Math.ceil(Math.log2(e)))}(E.zoom);p+=(c.cx-t.x)*k,y+=(c.cy-t.y)*k;const L=c.cx+p,D=c.cy+y;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:e=>Number(e.getAttribute("radius"))*k,x:e=>(e.getAttribute("x")+p-L)*k+L,y:e=>(e.getAttribute("y")+y-D)*k+D},edgeAttributes:{width:e=>Number(e.getAttribute("width"))*k}},camera:__spreadValues({zoom:t.zoom/k,x:(t.x+p-L)*k+L,y:(t.y+y-D)*k+D,angle:0},t.getSize())}}var Za={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},Qa={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},Ka={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},Ja=class extends Ds{onMounted(){this._brand=null}set(e,t){let{position:s,horizontalMargin:i,verticalMargin:r,className:o}=__spreadValues(__spreadValues({},Ka),t);Za[s]||(s=Ka.position),this.remove();const a=document.createElement("div");return a.innerHTML=e,a.style.position="absolute",setMargin(a,s,i,r),a.style.padding="0px 0px 0px 0px",a.style.zIndex="10",o&&a.setAttribute("class",o),this._brand=a,this._modules.dom.setLayer("brand",this._brand),a}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function setMargin(e,t,s,i){const r=void 0===s?"":s+"px",o=void 0===i?"":i+"px";e.style[Za[t]]=r,e.style[Qa[t]]=o}var el={},tl=class extends Ds{constructor(){super(...arguments),this._enabled=!1,this._settings=__spreadValues({},mi),this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=()=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){const e=this._x-this._modules.camera.x,t=this._y-this._modules.camera.y;if(e||t){this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));const e=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),t=ogmaToMapZoom(this._modules.camera.zoom),s=this.L.latLng(e.latitude,e.longitude);this._map._move(s,t,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout((()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(s,t,{pinch:!0})._moveEnd(!0)}),this._updateRate)}}},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:e,dx:t,dy:s})=>{if(this._enabled){const i=e.map((e=>{const{x:i,y:r}=e.getAttributes(["x","y"]);return this._fromPointToLatLng(i+t-this._nodeDragOffsetX,r+s-this._nodeDragOffsetY)}));return this._nodeDragOffsetX=t,this._nodeDragOffsetY=s,e.setGeoCoordinates(i)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);const{lat:e,lng:t}=this._map.getCenter(),s=this._fromLatLngToPoint(e,t);this._x=s.x,this._y=s.y;const i=function mapToOgmaZoom(e){return 2**(e-1)}(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:i,x:s.x,y:s.y},{ignoreZoomLimits:!0}).then((()=>this._adjustMinvisibleSizes()))}}onMounted(){this._filters=this._modules.filters,this._modules.events.register(["geoEnabled","geoDisabled","geoLoaded","geoReady"]),canGeoBeEnabled()&&(this.L=smartRequire("L")||smartRequire("leaflet"),this.L&&function declareOgmaOverlay(e){e.TileLayer.prototype.getUrl=function(){return this._url},e.ImageOverlay.prototype.getUrl=function(){return this._url};const t="leaflet-zoom-animated";e.OgmaOverlay||(e.OgmaOverlay=e.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(t){const{container:s}=t;e.Util.setOptions(this,t),this._container=s},setLocked:function(value){return this._locked=value,this},onAdd:function(s){this._map=s,this.getPane().appendChild(this._container),this._wgsOrigin=e.latLng([0,0]),this._wgsInitialShift=s.project(this._wgsOrigin,this._initialZoom),e.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(e.DomUtil.addClass(this._container,t),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){const t=this.options.padding,s=this._map.getSize(),i=this._map.containerPointToLayerPoint(s.multiplyBy(-t));this._bounds=new e.Bounds(i,i.add(s.multiplyBy(1+2*t))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(t){this._updateBounds(),this._redraw(this._bounds.min,t),this._positionTimer=e.Util.requestAnimFrame((()=>{this._container&&e.DomUtil.setPosition(this._container,this._bounds.min)}))},_redraw(e,t){this.options.onUpdate()},_updateTransform(t,s){if(this._locked)return;const i=this._map.getZoomScale(s,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,s),a=r.multiplyBy(-i).add(o).subtract(this._map._getNewPixelOrigin(t,s));e.Browser.any3d?e.DomUtil.setTransform(this._container,a,i):e.DomUtil.setPosition(this._container,a)},_onZoom(e){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(e){this._update(e)},_onAnimZoom({center:e,zoom:t}){this._updateTransform(e,t)},bringToFront(){e.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){e.DomUtil.removeClass(this._container,t);const s=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach((e=>s.style[e]=null)),e.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ci,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:di,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:hi,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",(e=>this._refreshOrAddNodes(e.nodes,!0))).on("updateNodeData",(e=>{this._onDataChange(e.changes)})).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],(()=>this._setMapDragging(!0))).on("move",this._onCameraUpdate).on("viewChanged",this._onCameraUpdate)}_onDataChange(e){const t=propertyPathToString(this.latitudePath),s=propertyPathToString(this.longitudePath),i=e.filter((({property:e})=>e&&"string"!=typeof e?e.find((e=>t.startsWith(e)||s.startsWith(e))):null===e||t.startsWith(e)||s.startsWith(e)));if(i.length){const e=function filterChangedNodes(e){return e.reduce(((e,{nodes:t,newValues:s})=>{if(!t)return e;const i=t.filter(((e,t)=>null!=s[t]));return e?e.concat(i):i}),null)}(i);null!==e&&this._refreshOrAddNodes(e,!1)}}_refreshOrAddNodes(e,t){t&&this._updatePrevNodesCoordinates(e),this._updateNodesCoordinates(e),this._enabled&&(this._cacheOriginalTextStyles(e,null),this._filter._refresh())}_updatePrevNodesCoordinates(e){copyNodeAttributes(this._modules.graph,e,di,ui),copyNodeAttributes(this._modules.graph,e,hi,ci)}_restorePrevNodesCoordinates(e){copyNodeAttributes(this._modules.graph,e,ui,di),copyNodeAttributes(this._modules.graph,e,ci,hi)}_updateNodesCoordinates(e){!function updateNodesInternalCoordinates(e,t,s){const{longitudePath:i,latitudePath:r,wrapCoordinates:o}=s,[a,l]=e.getAttributes(!0,[di,hi]),d=t._indexes,h=t.getId(),u=d.length,c=t.getData(r),m=t.getData(i);for(let e=0;e<u;e++){let t=m[e],s=c[e];const i=d[e],r=h[e];null!=s&&null!=t&&(checkLng(r,t),checkLat(r,s),o&&(t%=180,s=clamp(+s,-gi,gi)),l.set(i,t),a.set(i,s))}}(this._modules.graph,e,this._settings)}_createMapTileLayer(e,t){if(e&&!isObject(e))return e;const s=e,i=s.wms?this.L.tileLayer.wms:this.L.tileLayer,r=function getCorrectAttribution(e,t){return null==t&&e.url===mi.tiles.url?'Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>':null}(s,t)||"";return i(s.url,__spreadValues({attribution:r},e))}_setupTileLayer(e,t,s){const i=this._createMapTileLayer(e,t);return i.once("load",(()=>{this._modules.events.fire("geoLoaded")})),i.addTo(this._map),setTileLayerOpacity(i,s),i}_onSettingsChanged(e,t){const s=e.wrapCoordinates!==t.wrapCoordinates,i=e.latitudePath!==t.latitudePath||e.longitudePath!==t.longitudePath;if(s||i){let e=Promise.resolve();this._enabled&&this._filter&&(e=e.then((()=>this._filter.refresh()))),e.then((()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all"))))}this._enabled&&(function hasTileLayerChanged(e,t){return e.attribution!==t.attribution||e.tiles!==t.tiles}(e,t)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(t.tiles,t.attribution,t.opacity)),e.sizeRatio!==t.sizeRatio&&this._updateSizes(),e.maxZoomLevel!==t.maxZoomLevel&&this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,t.maxZoomLevel)}),e.disableNodeDragging!==t.disableNodeDragging&&this._setDragging(!t.disableNodeDragging),e.attributionOptions!==t.attributionOptions&&this._setAttributionOptions(t.attributionOptions,t.attribution),setTileLayerOpacity(this._tileLayer,t.opacity))}_setMapDragging(e){if(this._map){const t=e?"enable":"disable";this._map.dragging[t]()}}_fromLatLngToPoint(e,t){return this._map.options.crs.latLngToPoint(this.L.latLng(e,t),1)}_fromPointToLatLng(e,t){const{lat:s,lng:i}=this._map.options.crs.pointToLatLng(this.L.point({x:e,y:t}),1);return{latitude:s,longitude:i}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(e){return this.setEnabled(!0,e)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?__spreadProps(__spreadValues({},this._settings),{tiles:isObject(this._settings.tiles)?__spreadValues({},this._settings.tiles):this._settings.tiles}):__spreadValues({},mi)}setOptions(e){if(!this._enabled||this._transition)return;!function validateOptions(e={},t){const{tileUrlSubdomains:s,tileUrlTemplate:i,attribution:r,attributionOptions:o,latitudePath:a,longitudePath:l,sizeRatio:d,tiles:h}=e;if(null!=i&&"string"!=typeof i)throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(null!=s&&"string"!=typeof s)throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(null!=h){if(!(isObject(h)||h instanceof t.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");const e=h;if(null!=e.url&&"string"!=typeof e.url)throw new TypeError("Geo mode: tiles.url must be a string");if(null!=e.subdomains&&"string"!=typeof e.subdomains)throw new TypeError("Geo mode: tiles.subdomains must be a string");if(e.tms&&"boolean"!=typeof e.tms)throw new TypeError("Geo mode: tiles.tms must be a boolean");if(e.wms&&"boolean"!=typeof e.wms)throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(null!=r&&"string"!=typeof r)throw new TypeError("Geo mode: Map attribution must be a string");if(null!=o&&!isObject(o))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(null!=a&&"string"!=typeof a&&!Array.isArray(a))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(null!=l&&"string"!=typeof l&&!Array.isArray(l))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(null!=d&&(!isFinite(d)||d<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}(e,this.L);const t=this._settings;this._settings=__spreadProps(__spreadValues(__spreadValues(__spreadValues({},mi),t),e),{tiles:normalizeTilesOptions(mi,e)}),this._onSettingsChanged(t,this._settings)}disable(e){return this.setEnabled(!1,e)}isEnabled(){return this._enabled}toggle(e={}){return this.setEnabled(!this._enabled,e)}getContainerCoords(e){return e.getGeoCoordinates().map((({latitude:e,longitude:t})=>this._map.latLngToContainerPoint([e,t])))}getContainerCoord(e){const{latitude:t,longitude:s}=e.getGeoCoordinates();return this._map.latLngToContainerPoint([t||0,s||0])}setEnabled(value,e){if(!canGeoBeEnabled())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||value===this._enabled)return Promise.resolve();const t=this._modules.settings;this._enabled||(this._prevSettings=t.get(),this._nodeDraggingSetting=!!t.get("interactions.drag.enabled")),this._enabled=value,this.setOptions(e),this._transition=!0;const s=this._settings;return value?this._show().then((()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!s.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes()))):this._restoreTextStyle().then((()=>this._hide())).then((()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)})).then((()=>this._ogma.view.afterNextFrame()))}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(e,t){t&&(this._edgesOriginalTextStyle=getEdgesVisibleSizes(t,this._edgesOriginalTextStyle)),e&&(this._nodesOriginalTextStyle=function getNodesVisibleSizes(e,t){return e.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach((({text:s,radius:i},r)=>{t[e.get(r).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:s.minVisibleSize,size:Math.max(1,Number(i))}})),t}(e,this._nodesOriginalTextStyle))}_registerTextStyle(e,t){this._cacheOriginalTextStyles(e,t);const{nodeAttributes:s,edgeAttributes:i}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=i||null,this._hoverNodesOriginalTextStyle=s||null,this._modules.hover.updateEdgeAttributes({text:{size:e=>(this._edgesOriginalTextStyle[e.getId()]||el)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:e=>(this._nodesOriginalTextStyle[e.getId()]||el)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([restoreVisibleSizes(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then((()=>(this._edgesOriginalTextStyle=getEdgesVisibleSizes(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={},Promise.resolve())))}_setDragging(e,t=!1){this._modules.settings.update({interactions:{drag:{enabled:e,applyResult:t}}})}_setAttributionOptions(e,t){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),isObject(e)){this._attribution.setPrefix(""),e.position=e.position||"bottom-right";const t=e.position.replace("-","");this._attribution.setPosition(t);const s=this._attribution.getContainer();s&&(e.className&&this.L.DomUtil.addClass(s,e.className),setMargin(s,e.position||"bottom-right",e.horizontalMargin,e.verticalMargin))}null!=t&&this._attribution.addAttribution(t)}}_nodeIsVisible(e){return function nodeIsVisibleInGeo(e,{longitudePath:t,latitudePath:s,wrapCoordinates:i},r){const o=e.getData(t),a=e.getData(s);return null!=o&&null!=a&&(!(!i&&!r)||Math.abs(a)<=gi&&Math.abs(o)<=180)}(e,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){const e=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);e[3]=0,this._modules.settings.update({backgroundColor:componentsToRGBA(e),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(e){const t=this.L.latLngBounds(function calculateNodesBounds(e){const t=[[1/0,1/0],[-1/0,-1/0]];return e.getGeoCoordinates().reduce(((e,{latitude:t,longitude:s})=>{const[i,r]=e;return i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],s),r[0]=Math.max(r[0],t),r[1]=Math.max(r[1],s),e}),t)}(e));return{center:e.size>0?t.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(t))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=function createMapContainer(e){const t=getDocument().createElement("div");t.className="ogma-geo-container",setElementSize(t,"100%","100%");const s=e||pi;return s.insertBefore(t,s.firstChild),t}(this._modules.dom.getContainer());const e=__spreadProps(__spreadValues({},_i),{minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel});this._hasCustomProjection()&&(e.crs=this._settings.crs,e.worldCopyJump=!1,e.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,e),this._hasCustomProjection()||this._map.setMaxBounds(this.L.latLngBounds([[gi,-180],[-gi,180]])),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(e){let t=this._tileLayer.options.maxZoom;return void 0===t&&(t=1/0),Math.min(e,t)}_show(){let e;return this._filter?e=this.filter.enable(0):(this._filter=this._filters.addNodeFilter({criteria:e=>this._nodeIsVisible(e)}),e=this._filter.whenApplied()),e.then((()=>{this._initMap();const e=this._map,t=this._modules.graph.getNodes(),s=this._modules.graph.getEdges(),{center:i,zoom:r}=this.getGraphPosition(t),{offset:o,newCameraView:a}=this._transformToGeo();return this._modules.camera.setView(a,{ignoreZoomLimits:!0}).then((()=>(this._updatePrevNodesCoordinates(t),e.setView(i,r,{animate:!1}),this._modules.graphics.animate({nodes:t,edges:s},(()=>{this._projection=this._createFinalPositionLayer()}),!0,this._settings.duration)))).then((()=>o.destroy()))}))}updateProjection(){var e;null==(e=this._projection)||e.update()}_hasCustomProjection(){return null!=this._settings.crs}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution,this._settings.opacity)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([adjustMinVisibleSize(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);const e=this._map;e.removeLayer(this._layer);const t=this._modules.dom.getContainer(),s=this._modules.graphics.getDomElement();t&&t.appendChild(s),e.getContainer().style.zIndex="0";const i=this._modules.graph.getNodes("all"),r=this._modules.graph.getEdges("all"),{offset:o,newCameraView:a}=this._transformToGraph();return this._modules.camera.setView(a||{}).then((()=>Promise.all([fadeElement(e.getContainer(),1,0,this._settings.duration/2).then((()=>this._destroyMapSync())),this._modules.graphics.animate({nodes:i,edges:r},(()=>o&&o.destroy()),!0,this._settings.duration)]))).then((()=>(this._map=null,this._filter.disable(0))))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;const e=this._mapContainer.parentNode;e&&e.removeChild(this._mapContainer)}}_transformToGeo(){const e=this._modules.graph.getNodes(),{offsetChanges:t,camera:s}=computeOffsetAndCameraToGeo(e,this._modules.camera,this._modules.locate,((e,t)=>this._fromLatLngToPoint(e,t)));return{offset:this._addGraphAttributesLayer(t),newCameraView:s}}_addGraphAttributesLayer(e){return this._modules.graphics.addAttributeLayer(__spreadValues({priority:6,nodeSelector:e=>e.isVisible(),edgeSelector:e=>e.isVisible()},e))}_transformToGraph(){const e=this._modules.graph.getNodes("all"),{offsetChanges:t,camera:s}=function computeOffsetAndCameraToGraph(e,t,s,i){const r=e.getAttributes(["x","y","radius"]),o=e.getBoundingBox(),a=0===e.size,l=e.reduce(((e,{_index:t},s)=>(e[t]=s,e)),{});i();const d=e.getAttribute("x"),h=e.getAttribute("y"),u=e.getAttribute("radius").map(Number),c=new ss({xValues:d,yValues:h,scaledSizeValues:u.map((e=>2*e))});a&&(o.reset(),c.reset());let m=c.cx-o.cx,p=c.cy-o.cy,y=0,x=0;const b=s.computeConfigForBounds(c),v=t.zoom/b.zoom;let E,k;return isNaN(o.cx)||isNaN(o.cy)?(o.cx=t.x,o.cy=t.y,E=b.x,k=b.y):(m+=(o.cx-t.x)*v,p+=(o.cy-t.y)*v,y=o.cx+m,x=o.cy+p,E=(t.x+m-y)*v+y,k=(t.y+p-x)*v+x),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:e=>(r[l[e._index]].x+m-y)*v+y,y:e=>(r[l[e._index]].y+p-x)*v+x}},camera:__spreadValues({zoom:b.zoom,x:E,y:k,angle:0},t.getSize())}}(e,this._modules.camera,this._modules.locate,(()=>{this._projection&&(this._projection.destroy(),this._projection=null)}));return{offset:this._addGraphAttributesLayer(t),newCameraView:s}}getPointFromLatLng(e){const{latitude:t,longitude:s}=e.getGeoCoordinates();return null==t?e.getAttributes(["x","y"]):this._fromLatLngToPoint(t,s)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:e=>Number(e.getAttribute("radius"))*this._settings.sizeRatio,x:e=>this.getPointFromLatLng(e).x,y:e=>this.getPointFromLatLng(e).y},edgeAttributes:{scalingMethod:"fixed",width:e=>Number(e.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(e,t){return this._enabled?this.setView(e,t,ogmaToMapZoom(this._modules.camera.getZoom())):Promise.resolve()}setZoom(e){return this._enabled&&this._map?(e=this._clampZoom(e),this._map.setZoom(e),new Promise((t=>{const s=this._map;if(s.getZoom()===e)return t(void 0);s.once("moveend zoomend",t)})).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(e,t,s){if(!this._enabled||!this._map)return Promise.resolve();const i=this._map;s=this._clampZoom(s);const r=this.L.latLng([e,t]);return i.setView(r,s,{animate:!1,reset:!0}),new Promise((e=>{if(i.getZoom()===s&&i.getCenter().equals(r))return e(void 0);i.once("moveend zoomend",e)})).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;const e=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:e.lat,longitude:e.lng}}getCenter(){if(!this._enabled||!this._map)return;const e=this._map.getCenter();return{latitude:e.lat,longitude:e.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;const e=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());const t=this._modules.graph.getNodeAttribute(di).getMultiple(e._indexes),s=this._modules.graph.getNodeAttribute(hi).getMultiple(e._indexes);e.setData(this._settings.latitudePath,t),e.setData(this._settings.longitudePath,s),this._projection.update()}getUnprojectedCoordinates(e){this._projection&&this._projection.destroy();const t=e.getPosition();return this._projection=this._createFinalPositionLayer(),t}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(e){if(!this._map)return Promise.reject("Map is not ready");const{pixelRatio:t,width:s,height:i,zoom:r,x:o,y:a}=e,l=s*t,d=i*t,h=createCanvas(l,d),u=h.getContext("2d"),c=this._map;if(!u)throw new Error(`Unable to get 2d context from  ${h}`);const m=this.getView(),p=__spreadValues({zoom:Math.round(ogmaToMapZoom(r*t))},this._fromPointToLatLng(o,a)),y=new this.L.Canvas;c.addLayer(y);const{vectorMap:x,tileLayers:b,vectorLayers:v,imageOverlays:E,markers:k}=function getLayerExporters(e,t,s,i,r,o){const a={vectorMap:[],tileLayers:[],vectorLayers:[],imageOverlays:[],markers:[]};return t.eachLayer((l=>{if(l!==e){const e=function getLayerType(e,t){return e instanceof t.TileLayer?"tileLayers":e instanceof t.ImageOverlay?"imageOverlays":e instanceof t.Path?"vectorLayers":e instanceof t.Marker?"markers":"MapboxGL"in t&&e instanceof t.MapboxGL?"vectorMap":void 0}(l,i);if(e&&e in a){const d=Ya[e];a[e].push((()=>d(l,s,t,i,r,o)))}}})),a}(this._layer,c,u,this.L,t,y),L=c.options.zoomSnap;return Promise.resolve().then((()=>(setElementSize(this._mapContainer,l+"px",d+"px"),c.invalidateSize({animate:!1}),this.setView(p.latitude,p.longitude,p.zoom)))).then((()=>promiseQueue([...x,...b,...E,...v,...k]))).then((()=>{setElementSize(this._mapContainer,"100%","100%"),c.invalidateSize({animate:!1}),c.options.zoomSnap=L,this.setView(m.latitude,m.longitude,m.zoom)})).then((()=>new Promise((e=>this.L.Util.requestAnimFrame(e))))).then((()=>c.removeLayer(y))).then((()=>h))}},sl=class extends Ds{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,(value=>{this._context.edgesAlwaysCurvy=value,this._attributeLayer.updateAll()})),this._modules.settings.register("directedEdges",!1,(value=>{this._context.directedEdges=value,this._attributeLayer.updateAll()}))}computeCurvature(e,t="visible",s){const{edgesAlwaysCurvy:i,directedEdges:r}=this._context,o=e.getSource()===e.getTarget();let a=e.getParallelEdges({filter:t});s&&(a=a.filter((e=>s(e))));const l=a.indexOf(e);if(-1===l)return 0;let d;if(o)d=(l+1)*Math.max(+e.getAttribute("width")||0,1);else{const t=e.getSource(),s=a.size;if(1===s&&!i)return 0;if(r){let e=0;for(let s=0;s<l;++s)a.get(s).getSource()===t&&(e+=1);d=e+1}else{const e=t!==a.get(0).getSource();d=s%2!=1||i?(1+(l/2|0))*(l%2==0?1:-1)*(e?-1:1):0===l?0:((l+1)/2|0)*(l%2==0?1:-1)*(e?-1:1)}}return d}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:2,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:e=>this.computeCurvature(e)}})}},il="worker_start",nl="worker_update",rl="worker_stop",ol=class extends is{constructor(e,t){super(),this._complete=!1,this._destroyed=!1,this._data=null,this._onStart=noop,this._onStop=noop,this._setIdle=noop,this._onPause=noop,this.timer={start:0,steps:0},this._modules=t,this.configure(e)}configure({configure:e=idenitity,update:t=noop,context:s=noop,stop:i=noop,isRunning:r=falseFn,onStart:o=noop,onStop:a=noop,onPause:l=noop,setIdle:d=noop}){this._configure=e,this._update=t,this._createContext=s,this._isRunning=r,this._stop=i,this._onStart=o,this._onStop=a,this._setIdle=d,this._onPause=l}setData(e){this._data=e}getData(){return this._data}start(e){return this._complete=!1,this._onStart(),this.fire(il,{target:this}),this.send(this._configure(e,this._modules)),this}stop(e){return this._complete||(this._onStop(),this.send({type:rl}),this._complete=!0),this}pause(){this._onPause()}setIdle(e){this._setIdle(e)}isBusy(){return!this._complete}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this.stop(),delete this._modules))}},al=/^function\s*\(/,ll=/^\(|^\w+\s?=>/;function toString(e){const t=e.toString();return 0===t.indexOf("function")||ll.test(t)?t:`function ${t}`}var dl=class extends ol{constructor(e,t){super(e,t);const s=toString(this._createContext),i=toString(this._update),r=toString(this._isRunning),o=toString(this._stop),a=`\n      ${function importDependencies(e={}){const t=Object.keys(e),s=[];for(let i=0,r=t.length;i<r;i++){const r=t[i],o=e[r];if("function"!=typeof o)throw new Error(`Asynchronous worker: dependency "${r}" is not found`);{const e=getFunctionName(o);e?(s.push(serializeFunction(o,r)),e!==r&&s.push(`var ${r} = ${e};`)):s.push(`var ${r} = ${serializeFunction(o,r)};`)}}return s.join("\n")}(e.imports)}\n      const __CONTEXT = (${s})();\n      const __UPDATE_FUNC = ${i} ;\n      const __IS_RUNNING_FUNC = ${r};\n      const __STOP_FN = ${o};\n      let result;\n\n      self.addEventListener("message", function (evt) {\n        if (evt.data && evt.data.type === '${rl}') {\n          __STOP_FN(__CONTEXT);\n          return self.postMessage({ result, isRunning: false });\n        }\n        result = __UPDATE_FUNC(evt.data, __CONTEXT);\n        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);\n\n        self.postMessage({ result, isRunning });\n      });\n    `;this._worker=createWorker(a),this._worker.addEventListener("message",(e=>{t.dom.isDestroyed()||this.onWorkerMessage(e)}))}onWorkerMessage(e){const t=e.data.isRunning,s=e.data.result,i={data:void 0};return this.fire(nl,{worker:this,workerMessage:s,modules:this._modules,data:i,isRunning:t}),t?this.send(i.data):(this.fire(rl,{worker:this,result:s,modules:this._modules}),this.stop(s))}destroy(){super.destroy(),this._worker.terminate()}send(e){return this._complete||this._worker.postMessage(formatWorkerMessage(e)),this}};function serializeFunction(e,t){const s=e.toString();if(al.test(s)){return`function ${e.name||t} ${s.substring(s.indexOf("("))}`}if(ll.test(s)){return`const ${e.name||t} = ${s.toString()}`}return s}function getFunctionName(e){const t=e.toString();return e.name?e.name:al.test(t)?null:t.substring(9,t.indexOf("(")).trim()}var hl=class extends ol{constructor(e,t){super(e,t),this._context=this._createContext()}sync(e){if(e&&e.type===rl)return this._stop(this._context);const t=this._update(e,this._context),s=this._isRunning(this._context,e),i={data:void 0};return this.fire(nl,{worker:this,workerMessage:t,modules:this._modules,data:i,isRunning:s}),s?this.send(i.data):(this.fire(rl,{worker:this,result:t,modules:this._modules}),this.stop(t))}send(e){return this._complete||this._modules.dom.setTimeout((()=>this.sync(e)),0),this}},ul=class extends Ds{constructor(){super(...arguments),this._pool={}}create(e,t){const s=t&&Ft,i=this._modules,r=`${e.name||"worker"}-${s?"async":"sync"}`;let o=this._pool[r];o||(o=this._pool[r]=[]);let a=o.find((e=>!e.isBusy()));return a?a.configure(e):(a=s?new dl(e,i):new hl(e,i),this._pool[r].push(a)),a.on(rl,(()=>{a.clearEvents(),this._pool[r].length<2||(a.destroy(),this._pool[r]=this._pool[r].filter((e=>e!==a)))})),a}start(e,t){return e.start(t)}run(e,t,s){const i=this.create(e,s);return this.start(i,t)}destroy(){for(const e in this._pool)this._pool[e].forEach((e=>e.destroy())),delete this._pool[e]}};function ensureGraphItems(e,t={},s=!0){s||(t.edges=void 0);const i=function ensureNodes(e,t,s,i=e.getNodes()){if(!t)return s?e.nodeList():i.filter((e=>null===e.getMetaNode()));if(!(t instanceof xi)){if(Array.isArray(t)&&t.length>0)return e.getNodes(t);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return t}(e,t.nodes,t.edges),r=function ensureEdges(e,t,s=e.getEdges()){if(!t)return s;if(!(t instanceof li)){if(Array.isArray(t)&&t.length>0)return e.getEdges(t);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return t}(e,t.edges,function getRelatedEdges(e){if(!e.size)return;const t=new Set(e.getId());return e.getAdjacentEdges().filter((e=>e.getExtremities().getId().every((e=>t.has(e)))))}(i));return __spreadProps(__spreadValues({},t),{nodes:i.concat(r.getExtremities()).dedupe(),edges:r})}var cl=500,gl=!0,ml=!0,_l=!1,pl=class extends Ds{constructor(){super(...arguments),this._running=[],this._textsHidden=!1,this.onInteractionStart=()=>{this.setWorkersIdle(!0)},this.onViewChanged=()=>{this.setWorkersIdle(!1)},this.onVisibilityChange=()=>{getDocument().hidden?this.setWorkersIdle(!0):this.setWorkersIdle(!1)},this._onWorkerUpdate=(e,t,s,i,r,o)=>{const{duration:a,onSync:l,onUpdate:d,dryRun:h,locate:u}=o;if(l&&this._modules.dom.setTimeout((()=>l(s,this._modules,i)),a),r){const l=r(s,this._modules,i);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:t,positions:l}),d&&d(s,l,i);const c=this._assignNodePositions(l,a,h);i||(u&&l&&this._animateCamera(l,u,o.duration),c.then((()=>e.fire("taskComplete",l))))}else i||e.fire("taskComplete",s)},this._onWorkerComplete=(e,t,s,i,r,o,a)=>{for(let t=0;t<this._running.length;t++){if(this._running[t]===e){this._running.splice(t,1);break}}i.onStop&&t&&i.onStop(r,t,this._modules);const l=this._modules.graph.nodeList(new Uint32Array(a.indexes)),d=r.dryRun&&t?s:this.collectNodesData(l),h=l.getId(),u={before:getPositionsFromData(a),current:getPositionsFromData(d)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:u,ids:h}),this._modules.dom.setTimeout((()=>{r.onEnd&&r.onEnd(t),r.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),o({name:i.name,positions:u,ids:h})}))},this._onWorkerStart=(e,t,s)=>{t.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);const i=this._modules.graph.getNodes(t.nodes),r=this.collectNodesData(i),o=r.ids;s.setData(r),this._modules.events.fire("layoutStart",{type:"layoutStart",name:e.name,ids:o,worker:s})}}onMounted(){this._layouts={},this.timers=new Map,this._modules.events.register(["layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",(()=>this.stop())).on(["dragStart","zoomStart"],this.onInteractionStart).on(["dragEnd","viewChanged"],this.onViewChanged),this._modules.dom.addDocumentEventListener("visibilitychange",this.onVisibilityChange)}setWorkersIdle(e){this._running.forEach((t=>t.setIdle(e)))}register(e){if(this._layouts[e.name])throw new Error(`Layout ${e.name} already exists`);this._layouts[e.name]=e}getAvailableLayouts(){return Object.keys(this._layouts)}start(e,t={}){const s=this._layouts[e],i=ensureGraphItems(this._modules.graph,t,-1===["radial","grid"].indexOf(e));return new Promise((r=>{if(!s)throw new Error(`layout ${e} does not exist`);i.duration="number"==typeof i.duration?i.duration:cl;const o=s.onSync;i.skipTextDrawing=void 0===i.skipTextDrawing?!!gl:!!i.skipTextDrawing;let a=i.locate||_l;a&&"boolean"==typeof a&&(a={}),i.locate=a;const l={name:e,update:s.update,isRunning:s.isRunning,configure:s.configure,context:s.context,imports:s.imports,stop:s.stop,setIdle:s.setIdle};this._modules.graphics.forceAttributesComputation();const d=void 0===i.useWebWorker?!!ml:!!i.useWebWorker,h=this._modules.workers.create(l,d);h.on(il,(()=>{s.onStart&&s.onStart(t),this._onWorkerStart(s,i,h)})).on(nl,(({workerMessage:t,isRunning:s})=>{const r=t.lastUpdate||-1/0,a=getCurrentTime();s&&(!i.continuous||a-r<16)||(t.lastUpdate=a,this._onWorkerUpdate(h,e,t,s,o,i))})).on(rl,(({result:e})=>{h.once("taskComplete",(t=>{this._onWorkerComplete(h,e,t,s,i,r,h.getData())}))})),this._modules.workers.start(h,i),this._running.push(h)}))}_animateCamera(e,t,s){if(0===e.indexes.length)return Promise.resolve();const i=this._modules.locate.layoutDataBoundingBox(e),r=this._modules.locate.computeConfigForBounds(i,t);return this._modules.camera.setView(r,{duration:s,easing:t.easing,ignoreZoomLimits:!0})}stop(){for(;0!==this._running.length;){const e=this._running.pop();e.stop(),e.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return 0!==this._running.length}_assignNodePositions(e,t,s){if(!e||s){const t=e?new Uint32Array(e.indexes):void 0,s=this._modules.graph.nodeList(t);return Promise.resolve(s)}const{indexes:i,x:r,y:o}=e,a=this._modules.graph.nodeList(new Uint32Array(i)),l=getPositionsFromData(e);for(let e=0;e<l.length;e++)l[e]={x:r[e],y:o[e]};return a.setAttributes(l,t)}collectNodesData(e){const t=e._indexes,s=this._modules.graph.getNodeAttribute("x").getMultiple(t),i=this._modules.graph.getNodeAttribute("y").getMultiple(t);return{ids:e.getId(),indexes:t,x:s,y:i}}};function getPositionsFromData({x:e,y:t,indexes:s}){const i=s.length,r=new Array(i);for(let s=0;s<i;s++)r[s]={x:e[s],y:t[s]};return r}var fl=class{constructor(e,t,{path:s,filter:i,unwindArrays:r}){this._module=e,this._isNode=t,this._path=s||[],this._filter=i,this._unwindArrays=r,this._onUpdateHandlers=[],this._triggerUpdate=e=>{for(let t=0;t<this._onUpdateHandlers.length;++t)this._onUpdateHandlers[t](e)},this._info=e.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(e){this._onUpdateHandlers.push(e)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},yl=class{constructor(e,t,{path:s,filter:i,unwindArrays:r}){this._module=e,this._isNode=t,this._path=s,this._filter=i,this._unwindArrays=r,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(e){return this._onAddHandlers.push(e),this}onPropertyRemoved(e){return this._onRemoveHandlers.push(e),this}onPropertyUpdated(e){return this._onUpdateHandlers.push(e),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(e){const t=this._properties[e];return t?t.info:null}destroy(){forEach(this._properties,(({handler:e},t)=>{const s=this._path.concat([t]);this._module.unwatchPropertyInformation(this._isNode,s,e,this._filter,this._unwindArrays)})),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];const e=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(e,1)}updateSubPropertiesToWatch(e,t){if(e!==this._isNode)return;const s=t.getData(this._path);for(let e=0;e<s.length;e++){const t=s[e];if(isRawObject(t)){const e=Object.keys(t);for(let t=0;t<e.length;t++)this._addSubPropertyToWatch(e[t])}}}_addSubPropertyToWatch(e){if(!this._properties[e]){const t=this._path.concat([e]),handler=()=>this._triggerPropertyUpdate(e),s=this._unwindArrays,i=this._isNode,r=this._filter,o=this._module.watchPropertyInformation(i,t,handler,r,s);this._properties[e]={handler,info:o},this._triggerPropertyUpdate(e)}}_triggerPropertyUpdate(e){const{info:t}=this._properties[e],s=this._propertyList.indexOf(e),i=-1!==s,r="undefined"!==t.getType();!i&&r?(this._propertyList.push(e),this._triggerHandlers("_onAddHandlers",e,t),this._triggerHandlers("_onUpdateHandlers",e,t)):i&&!r?(this._propertyList.splice(s,1),this._triggerHandlers("_onUpdateHandlers",e,t),this._triggerHandlers("_onRemoveHandlers",e,t)):i&&r&&this._triggerHandlers("_onUpdateHandlers",e,t)}_triggerHandlers(e,t,s){const i=this[e];for(let e=0,r=i.length;e<r;e++)i[e](t,s)}},xl=class{constructor(){}setWatcher(e){this._watcher=e}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){const e=this._watcher.boundaries;return e?{min:e.min,max:e.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(value){return this._watcher.values.get(value)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}};function isNotANumber(e){return"number"==typeof e&&isNaN(e)}var bl=class{constructor(){this._keys=[],this._values=[]}set(e,value){const t=this._getIndex(e);return-1===t?(this._keys.push(e.slice()),this._values.push(value),!0):(this._values[t]=value,!1)}get(e){const t=this._getIndex(e);return-1===t?void 0:this._values[t]}has(e){return-1!==this._getIndex(e)}delete(e){const t=this._getIndex(e);return-1!==t&&(this._keys.splice(t,1),this._values.splice(t,1),!0)}keys(){return this._keys.map((e=>e.slice()))}values(){return this._values.slice()}_getIndex(e){for(let t=0;t<this._keys.length;t++){const s=this._keys[t];if(s.length===e.length){let i=!0;for(let t=0;t<e.length;t++){const r=s[t],o=e[t];if(!(r===o||isNotANumber(r)&&isNotANumber(o))){i=!1;break}}if(i)return t}}return-1}get size(){return this._keys.length}},vl=class{constructor(){this._map=new Map,this._arrays=new bl}clear(){return this._arrays=new bl,this._map.clear()}delete(e){return isArray(e)?this._arrays.delete(e):this._map.delete(e)}get(e){return isArray(e)?this._arrays.get(e):this._map.get(e)}set(e,value){return isArray(e)?this._arrays.set(e,value):this._map.set(e,value),this}keys(){return[...mapKeys(this._map),...this._arrays.keys()]}values(){return[...mapValues(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}};function isNumber2(value){return"number"==typeof value&&isFinite(value)}var Al=class extends Ds{constructor(){super(...arguments),this._onExcludedStateChange=({elements:e,value})=>{const t=!value;for(let s=0,i=this._propertyWatchers.length;s<i;s++){const i=this._propertyWatchers[s];i.isNode===e.isNode&&"visible"===i.filter&&(t?addValues(i,e.getData(i.property)):removeValues(i,e.getData(i.property)),triggerWatcher(i))}},this._onDataChange=({isNode:e,changes:t})=>{for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],r=i.property,o="all"===i.filter;if(i.isNode===e)for(let e=0;e<t.length;++e){const s=t[e],a=getModifiedSubProperty(s.property||[],r);if(a){const e=s.nodes||s.edges,t=[],r=[];if(e)for(let i=0;i<e.size;++i){const l=e.get(i);(o||l.isVisible())&&(t.push(getProperty(s.newValues[i],a)),r.push(getProperty(s.previousValues[i],a)))}t.length&&(addValues(i,t),removeValues(i,r),triggerWatcher(i))}}}for(let e=0,s=this._objectPropertyWatchers.length;e<s;e++){const s=this._objectPropertyWatchers[e],i=s.path;for(let e=0;e<t.length;++e){const{property:r,nodes:o,edges:a}=t[e],l=o||a;if(l){const e=l.isNode;(!r||r.length<=i.length+1&&i.every(((e,t)=>e===r[t])))&&s.updateSubPropertiesToWatch(e,l)}}}},this._onElementsAdded=e=>{const t=e.nodes||e.edges;for(let e=0;e<this._propertyWatchers.length;++e){const s=this._propertyWatchers[e];if(s.isNode===t.isNode){const e=t.getData(s.property);e.length&&(addValues(s,e),triggerWatcher(s))}}for(let e=0;e<this._objectPropertyWatchers.length;e++)this._objectPropertyWatchers[e].updateSubPropertiesToWatch(t.isNode,t)},this._onElementsRemoved=e=>{const t=e.nodes||e.edges;for(let e=0;e<this._propertyWatchers.length;++e){const s=this._propertyWatchers[e],i="all"===s.filter;if(s.isNode===t.isNode&&i){const e=t.getData(s.property);e.length&&(removeValues(s,e),triggerWatcher(s))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach((e=>{e.numbers=0,e.any=0,e.total=0,e.boundaries=null,e.values.clear()}))}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(e){return this._watchObjectProperty(!0,formatOptions2(e))}watchEdgeObjectProperty(e){return this._watchObjectProperty(!1,formatOptions2(e))}watchNodeNonObjectProperty(e){return this._watchNonObjectProperty(!0,formatOptions2(e))}watchEdgeNonObjectProperty(e){return this._watchNonObjectProperty(!1,formatOptions2(e))}watchPropertyInformation(e,t,s,i,r){const o=this._findWatcher(e,t,i,r)||this._createWatcher(e,t,i,r);return s&&o.onChange.push(s),o.info}unwatchPropertyInformation(e,t,s,i,r){const o=this._findWatcher(e,t,i,r);if(!o)return;const a=o.onChange,l=a.indexOf(s);if(-1!==l&&(a.splice(l,1),0===a.length)){const e=this._propertyWatchers.indexOf(o);this._propertyWatchers.splice(e,1)}}_watchObjectProperty(e,t){const s=new yl(this,e,t);return this._objectPropertyWatchers.push(s),s.updateSubPropertiesToWatch(e,this._modules.graph[e?"getNodes":"getEdges"](t.filter)),s}_watchNonObjectProperty(e,t){return new fl(this,e,t)}_findWatcher(e,t,s,i){for(let r=0;r<this._propertyWatchers.length;++r){const o=this._propertyWatchers[r];if(o.isNode===e&&o.filter===s&&o.unwindArrays===i&&checkPropertyEquality(o.property,t))return o}return null}_createWatcher(e,t,s,i){const r={isNode:e,property:t,numbers:0,any:0,total:0,values:new vl,boundaries:null,onChange:[],filter:s,unwindArrays:i,info:new xl};return r.info.setWatcher(r),addValues(r,this._modules.graph[e?"getNodes":"getEdges"](s).getData(t)),this._propertyWatchers.push(r),r}};function wrapperToPropertyPath(value){return null==value?[]:toPropertyPath(value)}function triggerWatcher(e){for(let t=0;t<e.onChange.length;++t)e.onChange[t](e.info)}function checkPropertyEquality(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}function getModifiedSubProperty(e,t){if(e.length>t.length)return null;let s=0;for(;s<e.length;++s)if(e[s]!==t[s])return null;return t.slice(s)}function addValues(e,t,s){const i=e.values,r=!s&&e.unwindArrays;for(let o=0;o<t.length;++o){const value=t[o];if(s||void 0===value||(e.total+=1),r&&Array.isArray(value))addValues(e,value,!0);else{const t=i.get(value);t?i.set(value,t+1):(i.set(value,1),isNumber2(value)?(e.boundaries?value<e.boundaries.min?e.boundaries.min=value:value>e.boundaries.max&&(e.boundaries.max=value):e.boundaries={min:value,max:value},e.numbers+=1):void 0!==value&&(e.any+=1))}}}function removeValues(e,t,s){const i=e.values,r=!s&&e.unwindArrays,o=e.boundaries;let a=!1;for(let l=0;l<t.length;++l){const value=t[l];if(s||void 0===value||(e.total-=1),r&&Array.isArray(value))a=a||removeValues(e,value,!0);else{const t=i.get(value);t>1?i.set(value,t-1):(i.delete(value),isNumber2(value)?(e.numbers-=1,!o||o.min!==value&&o.max!==value||(a=!0)):void 0!==value&&(e.any-=1))}}return!s&&a&&(e.boundaries=function computeBoundaries(e){let t=null,s=null;for(let i=0;i<e.length;++i){const value=e[i];isNumber2(value)&&((null==t||value<t)&&(t=value),(null==s||value>s)&&(s=value))}return null==t||null==s?null:{min:t,max:s}}(i.keys())),a}function formatOptions2(e){return"object"!=typeof e||null===e||Array.isArray(e)?{path:wrapperToPropertyPath(e),filter:"visible",unwindArrays:!1}:{path:wrapperToPropertyPath(e.path),filter:(value=e.filter||"visible","all"===value?"all":"visible"),unwindArrays:!!e.unwindArrays};var value}var Sl=class extends Ds{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:e,y:t}){return void 0!==e&&void 0!==t?this._modules.dom.afterNextFrame().then((()=>{const s=e-this.x,i=t-this.y;return this._modules.events.fire("virtualMove",{x:e,y:t,dx:s,dy:i}),this._later()})):Promise.resolve()}down({x:e,y:t,button:s="left"}={}){return this.move({x:e,y:t}).then((()=>(this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:s}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:s}),this._later())))}up({x:e,y:t,button:s="left"}={}){return this.move({x:e,y:t}).then((()=>(this._modules.events.fire("virtualUp",{x:e,y:t,button:s}),this._later())))}click({x:e,y:t,button:s="left"}={}){return this.move({x:e,y:t}).then((()=>(this._modules.events.fire("virtualClick",{x:e,y:t,button:s}),this._later())))}rightClick({x:e,y:t,button:s="right"}={}){return this.move({x:e,y:t}).then((()=>(this._modules.events.fire("virtualClick",{x:e,y:t,button:s}),this._later())))}doubleclick({x:e,y:t,button:s="left"}={}){return this.move({x:e,y:t}).then((()=>(this._modules.events.fire("virtualDoubleClick",{x:e,y:t,button:s}),this._later())))}drag(e,t){return this.down(e).then((()=>this.move(t))).then((()=>this.up(t)))}wheel({x:e,y:t,delta:s}){return this.move({x:e,y:t}).then((()=>(this._modules.events.fire("virtualWheel",{x:e,y:t,delta:s}),this._later())))}};function drawLine(e,t,s,i,r,o){const a=Re(),l=o.graphToScreenCoordinates(e),d=o.graphToScreenCoordinates(t);r.beginPath(),r.moveTo(l.x*a,l.y*a),r.lineTo(d.x*a,d.y*a),r.strokeStyle=i,r.lineWidth=s,r.stroke()}function getClosestItem(e,t,s,i){let r,o,a,l=0,d=e.length-1;for(;l<d&&l>-1;)if(r=(l+d)/2|0,o=Math.abs(t[e[r]]-s),a=Math.abs(t[e[r+1]]-s),a<o)l=r+1;else if(a>o)d=r;else{const i=Math.abs(t[e[l]]-s),o=Math.abs(t[e[d]]-s);if(i<o)d=r;else{if(!(i>o))return d;l=r+1}}return i?d:e[d]}function findNeighboursToAlign(e,t,s,i,r,o,a){let l,d,h,u,c,m;for(let p=0,y=e.length;p<y;p++)for(let x=0;x<y;x++){if(p===x)continue;let y=e[p],b=e[x];x<p&&(u=b,b=y,y=u);const v=t[y],E=t[b],k=o.get(y),L=o.get(b);if(v+k<i-r&&E-L>i+r&&Math.abs(Math.abs(v+k-(i-r))-Math.abs(E-L-(i+r)))<=a)return l=y,d=s,h=b,m=v+k+Math.abs(E-L-(v+k))/2,c=[v+k,m-r,m+r,E-L],{a:l,b:d,c:h,current:s,target:m,points:c};if(v+k<i-r&&E+L<i-r&&Math.abs(Math.abs(v+k-(E-L))-Math.abs(Math.max(v+k,E+L)-(i-r)))<=a)return l=y,d=b,h=s,m=E+k+Math.abs(Math.abs(v+k-(E-L)))+r,c=[v+k,E-L,E+L,m-r],{a:l,b:d,c:h,current:s,target:m,points:c};if(v-k>i+r&&E-L>i+r&&Math.abs(Math.abs(v+k-(E-L))-Math.abs(Math.min(v-k,E-L)-(i+r)))<=a)return l=s,d=y,h=b,m=v-k-Math.abs(Math.abs(v+k-(E-L)))-r,c=[m+r,v-k,v+k,E-L],{a:l,b:d,c:h,current:s,target:m,points:c}}return null}var El={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},wl=class extends Ds{constructor(){super(...arguments),this._options=deepCopy(El),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:e})=>{1===e.size&&(this._node=e.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=deepCopy(El),this._enabled=!1}enable(e){this._enabled||(this._options=getOptions(e,El),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height)}),{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(e,t,s,i)=>this._onBeforeDrag(t,s,i)}))}disable(){this._enabled&&(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(e,t,s){if(this._node){const e=s[0];this._layer.refresh((t=>{this._scan(t,e)})),this._node.setAttributes(e)}}_cacheViewportData(){const e=this._modules.camera,t=e.screenToGraphCoordinates({x:0,y:0}),s=e.screenToGraphCoordinates({x:e.width,y:e.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(t.x,t.y,s.x,s.y),null==this._node)return;const i=this._node._index,r=Array.from(this._nodes._indexes);r.splice(r.indexOf(i),1);const o=this._modules.graph.getNodeAttribute("radius"),a=this._modules.graph.getNodeAttribute("x"),l=this._modules.graph.getNodeAttribute("y"),d=a.buffer(),h=l.buffer(),u=insertSortAsc(r.slice(),a),c=insertSortAsc(r.slice(),l),m={},p={},y={},x={};this._gridResolution=Number(this._node.getAttribute("radius"));const b=this._gridResolution;for(let e=0,t=r.length;e<t;e++){const t=u[e],s=c[e],i=d[t]/b|0,r=h[s]/b|0;m[i]||(m[i]=[]),p[r]||(p[r]=[]),m[i].push(t),p[r].push(s),y[t]=x[s]=e}this._nodesByX=u,this._nodesByY=c,this._xGrid=m,this._yGrid=p,this._xList=a,this._yList=l,this._X=d,this._Y=h,this._R=o}_scan(e,t){if(null==this._node)return;const s=this._node._index,i=t.x,r=t.y,o=this._r,a=this._options,l=this._xList,d=this._yList,h=this._R,u=this._X,c=this._Y,m=this._modules.camera.zoom,p=Math.min(o,this._options.tolerance/m),y=2*o*a.sideSnapDistanceFactor,x=a.guidelineWidth,b=a.guidelineColor;let v,E,k,L,D,B,H,X,Y=s,Z=s,oe=null,de=!1,he=!1;if(Y=getClosestItem(this._nodesByX,u,i),Z=getClosestItem(this._nodesByY,c,r),Math.abs(u[Y]-i)>a.centerSnapDistance&&(Y=s),Math.abs(c[Z]-r)>a.centerSnapDistance&&(Z=s),this._xsnap=0,Y!==s){v=this._vguideline.start,E=this._vguideline.end,X=Y,k=u[X],L=c[X],oe=h.get(X),H=Math.abs(i-k);const t=Math.abs(i-o-(k-oe)),s=Math.abs(i+o-(k+oe));if(H<Math.max(o,oe)){L<r?(v.y=L-oe,E.y=r+o):(v.y=L+oe,E.y=r-o);const e=Math.min(t,H,s);e===H?(v.x=E.x=k,E.y=r,v.y=L,this._xsnap=1):Math.abs(r-L)<oe+o+y&&(e===t?(v.x=E.x=k-oe,this._xsnap=2):(v.x=E.x=k+oe,this._xsnap=3)),e<p&&(de=!0)}0!==this._xsnap&&drawLine(v,E,x,b,e,this._modules.camera)}if(this._ysnap=0,Z!==s){v=this._hguideline.start,E=this._hguideline.end,X=Z,k=u[X],L=c[X],oe=h.get(X),H=Math.abs(r-L);const t=Math.abs(r-o-(L-oe)),s=Math.abs(r+o-(L+oe));if(H<Math.max(o,oe)){k<i?(v.x=k-oe,E.x=i+o):(v.x=k+oe,E.x=i-o);const e=Math.min(t,H,s);e===H?(v.y=E.y=L,E.x=i,v.x=k,this._ysnap=1):Math.abs(i-k)<oe+o+y&&(e===t?(v.y=E.y=L-oe,this._ysnap=4):(v.y=E.y=L+oe,this._ysnap=5)),e<p&&(he=!0)}0!==this._ysnap&&drawLine(v,E,x,b,e,this._modules.camera)}if(null!=oe&&a.preferredDistance.enabled){const t=a.preferredDistance.ratio,l=Math.min(a.preferredDistance.tolerance/m,o),d=Math.max(o,oe);if(Y===s||0!==this._xsnap&&de){if(Z!==s&&(0===this._ysnap||!he)&&(X=Z,k=u[X],L=c[X],oe=h.get(X),B=Math.abs(r-L)-(o+oe)*(1+t),B<=l&&B>=-l)){const s=r<L?-1:1;v=this._hguideline.start,E=this._hguideline.end,v.x=k-d,E.x=k+d,v.y=E.y=L,drawLine(v,E,x,b,e,this._modules.camera),v.x=i-d,E.x=i+d,v.y=E.y=L+s*(1+t)*(o+oe),drawLine(v,E,x,b,e,this._modules.camera),this._ysnap=1,he=!0}}else if(X=Y,k=u[X],L=c[X],oe=h.get(X),D=Math.abs(i-k)-(o+oe)*(1+t),D<=l&&D>=-l){const s=i<k?-1:1;v=this._vguideline.start,E=this._vguideline.end,v.x=E.x=k+s*(1+t)*(o+oe),v.y=L-d,E.y=L+d,v.x=E.x=k,drawLine(v,E,x,b,e,this._modules.camera),v.y=r-d,E.y=r+d,v.x=E.x=k+s*(1+t)*(o+oe),drawLine(v,E,x,b,e,this._modules.camera),this._xsnap=1,de=!0}}if(a.neighbours.enabled){const a=this._gridResolution,m=i/a|0,y=r/a|0,x=this._xGrid,b=this._yGrid,v=[],E=[].concat(b[y-1]||v,b[y]||v,b[y+1]||v),k=[].concat(x[m-1]||v,x[m]||v,x[m+1]||v);let L;E.length>1&&(insertSortAsc(E,l),L=findNeighboursToAlign(E,u,s,i,o,h,p),L&&(this._drawNeighbourGuidelines(e,L,t,!1),de=!1)),k.length>1&&!L&&(insertSortAsc(k,d),L=findNeighboursToAlign(k,c,s,r,o,h,p),L&&(this._drawNeighbourGuidelines(e,L,t,!0),he=!1))}(de||he)&&this._snap(t,!de,!he)}_drawNeighbourGuidelines(e,{a:t,b:s,c:i,points:r,target:o},a,l){const d={x:0,y:0},h={x:0,y:0},u=this._R,c=this._X,m=this._Y;let[p,y,x]=u.getMultiple([t,s,i]);const{offset:b,lineWidth:v,lineColor:E}=this._options.neighbours;let k,L;l?(a.y=o,p=-p,y=-y,x=-x,k=h.x=d.x=Math.min(c[t]+p,c[s]+y,c[i]+x)-b,L=c):(a.x=o,k=h.y=d.y=Math.max(m[t]+p,m[s]+y,m[i]+x)+b,L=m);const D=l?"y":"x",B=l?"x":"y";d[D]=r[0],h[D]=r[1],drawLine(d,h,v,E,e,this._modules.camera),d[D]=r[2],h[D]=r[3],drawLine(d,h,v,E,e,this._modules.camera),d[D]=r[0],d[B]=k-b/2,h[D]=r[0],d[B]=L[t]+p,drawLine(d,h,v,E,e,this._modules.camera),d[D]=r[1],d[B]=k-b/2,h[D]=r[1],d[B]=L[s]+y,drawLine(d,h,v,E,e,this._modules.camera),d[D]=r[2],d[B]=k-b/2,h[D]=r[2],d[B]=L[s]+y,drawLine(d,h,v,E,e,this._modules.camera),d[D]=r[3],d[B]=k-b/2,h[D]=r[3],d[B]=L[i]+x,drawLine(d,h,v,E,e,this._modules.camera)}_snap(e,t,s){const i=this._xsnap,r=this._ysnap;let o;t||0===i||(o=this._vguideline.end,e.x=2===i?o.x+this._r:3===i?o.x-this._r:o.x),s||0===r||(o=this._hguideline.end,e.y=4===r?o.y+this._r:5===r?o.y-this._r:o.y)}},Tl=class{constructor(e,t,s){this._module=e,this._id=t,this._whenApplied=s.then((()=>this))}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(e){return this._module.setRuleIndex(this._id,e)}update(e){return this._module.updateRule(this._id,e)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},Cl=class extends Ds{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule","refreshStyleRule"])}_get(e){for(let t=0;t<this._rules.length;++t){const s=this._rules[t];if(s.id===e)return s.index=t,s}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let e=0;e<this._rules.length;++e){const t=3+.001*e;this._rules[e].attributeLayer.update({priority:t})}}addRule(e={}){const t=this._idCounter++,s=this._modules.graphics.addAttributeLayer(__spreadValues({name:`rule(${t})`},extractRuleDefinition(e))),i=this._modules.dom.afterNextFrame(),r=new Tl(this,t,i),o={id:t,attributeLayer:s,wrapper:r};return this._rules.push(o),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:o,options:e,id:o.id}),r}getRuleIndex(e){const t=this._get(e);return null==t.index?null:t.index}setRuleIndex(e,t){const s=this._get(e),i=clamp(t,0,this._rules.length-1);return this._rules.splice(s.index,1),this._rules.splice(i,0,s),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(e,t){const s=this._get(e),i=Object.assign({fullOverwrite:t.fullOverwrite},extractRuleDefinition(t));return s.attributeLayer.update(i),this._modules.events.fire("updateStyleRule",{rule:s,options:t}),this._modules.dom.afterNextFrame()}getRuleDefinition(e){return extractRuleDefinition(this._get(e).attributeLayer.getDefinition())}destroyRule(e){const t=this._get(e);return this._modules.events.fire("removeStyleRule",{rule:t,id:t.id}),t.attributeLayer.destroy(),this._rules.splice(t.index,1),this._modules.dom.afterNextFrame()}refreshRule(e){const t=this._get(e);return t.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:t,id:e}),this._modules.dom.afterNextFrame()}refreshAllRules(){for(const e of this._rules)e.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:e,id:e.id});return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map((e=>e.wrapper))}};function extractRuleDefinition(e){return{nodeAttributes:e.nodeAttributes,edgeAttributes:e.edgeAttributes,nodeSelector:e.nodeSelector,edgeSelector:e.edgeSelector,nodeDependencies:e.nodeDependencies,edgeDependencies:e.edgeDependencies,nodeOutput:e.nodeOutput,edgeOutput:e.edgeOutput}}var kl,Ml={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:e})=>e.setSelected(!0),bothExtremities:!1},Ll=class extends Ds{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new ss,this._onStart=({x:e,y:t})=>{this._bbox.reset(),this.savePoint(e,t,!1)},this._onStop=()=>{const{minX:e,minY:t,maxX:s,maxY:i}=this._bbox,{nodes:r,edges:o}=this._modules.spatial.queryProjected(e,t,s,i),a={},l=r.filter((e=>{const t=e.isVisible(),s=e.getAttribute("detectable"),i=t&&s&&this._modules.locate.isNodeInPolygon(e,this._points);return a[e._index]=i,i}));let d=o.filter((e=>{const t=e.isVisible(),s=e.getAttribute("detectable");return t&&s&&this._modules.locate.isEdgeInPolygon(e,this._points)}));this._options.bothExtremities&&(d=this.filterByExtremities(d,a)),this._layer.clear(),this._points=[],this.disable(),this._options.callback({nodes:l,edges:d})}}onMounted(){this._options=deepCopy(Ml),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:e,y:t})=>this.savePoint(e,t,!0),onStop:this._onStop})}enable(e={}){var t;return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=getOptions(e,Ml),this._layer=this._modules.layers.addCanvasLayer(noop,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=(null==(t=this._layer.element.parentElement)?void 0:t.style.cursor)||"",applyCursorStyle(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),applyCursorStyle(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(e,t,s){const i=Re(),r=this._options,o=this._points;if(this._bbox.addPoint(e,t),o.push({x:e,y:t}),s){const e=o[0];this._layer.refresh((t=>{t.lineWidth=r.strokeWidth,t.lineJoin="bevel",t.strokeStyle=r.strokeColor,t.fillStyle=r.fillColor,t.beginPath(),t.moveTo(e.x*i,e.y*i);for(let e=1;e<o.length;++e){const s=o[e];t.lineTo(s.x*i,s.y*i)}t.stroke(),r.fillColor&&t.fill()}))}}filterByExtremities(e,t){const s=this._modules.graph.getEdgeAttribute("source"),i=this._modules.graph.getEdgeAttribute("target");return e.filter((e=>{const r=e._index,o=s.get(r),a=i.get(r);return t[o]&&t[a]}))}},Il={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:e,edges:t})=>{e.size?e.setSelected(!0):t.setSelected(!0)},bothExtremities:!1},Nl=class extends Ll{constructor(){super(...arguments),this._onStart=({x:e,y:t})=>{var s;this._rectangle.reset(),this._start={x:e,y:t},null==(s=this._layer)||s.refresh((e=>{e.fillStyle=this._options.fillColor,e.strokeStyle=this._options.strokeColor,e.lineWidth=this._options.strokeWidth}))},this._onStop=()=>{var e;const t=this._modules.captor.getCursorPosition(),s=this._formatRectangle(t),{nodes:i,edges:r}=this._modules.spatial.queryProjected(s.minX,s.minY,s.maxX,s.maxY),o={},a=i.filter((e=>{const t=e.isVisible(),i=e.getAttribute("detectable"),r=t&&i&&this._modules.locate.isNodeInRectangle(e,s);return o[e._index]=r,r}));let l=r.filter((e=>{const t=e.isVisible(),i=e.getAttribute("detectable");return t&&i&&this._modules.locate.isEdgeInRectangle(e,s)}));this._options.bothExtremities&&(l=this.filterByExtremities(l,o)),null==(e=this._layer)||e.clear(),this.disable(),this._options.callback({nodes:a,edges:l})}}onMounted(){this._options=deepCopy(Il),this._enabled=!1,this._rectangle=new ss,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:e,y:t})=>this._refreshRectangle({x:e,y:t}),onStop:this._onStop})}enable(e){return super.enable(getOptions(e,Il))}_formatRectangle(e){const t=this._start.x,s=this._start.y,i=e.x,r=e.y,o=Math.abs(t-i),a=Math.abs(s-r),l=t<i?t:i,d=s<r?s:r;return this._rectangle.reset().addPoint(l,d).addPoint(l+o,d+a)}_refreshRectangle(e){var t;const{minX:s,minY:i,width:r,height:o}=this._formatRectangle(e),a=Re();null==(t=this._layer)||t.refresh((e=>{e.strokeRect(s*a,i*a,r*a,o*a),this._options.fillColor&&e.fillRect(s*a,i*a,r*a,o*a)}))}},Pl=0,Fl=0,zl=-1;function setCurrent(e,t,s,i){Pl=e,kl=s,Fl=t?1:0,zl=i}var getTraverseFunction=(e,t,s,i)=>r=>{const{rects:o,bboxes:a,intersects:l,indexToLayer:d,indexToRemoveNodeText:h,indexToRemoveEdgeText:u}=i;if(a[6*r+5]===Pl&&a[6*r+4]===s)return!1;const c=5*r,m=getOBBPoints(o[c],o[c+1],o[c+2],o[c+3],o[c+4]);if(polygonsIntersect(kl,m)){if(i.realIntersection=!0,zl<=0&&l.push(kl,m),!(t||d[a[6*r+5]]<zl))return!0;e.remove(r),i.realIntersection=!1,a[6*r+4]===Fl?h[a[6*r+5]]=!0:u[a[6*r+5]]=!0}return!1};function drawAABB(e,t,s="#22ff00"){return drawPolygon([[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]].map((e=>({x:e[0],y:e[1]}))),t,s)}function drawPolygon(e,t,s="#ff0000"){t.strokeStyle=s,t.beginPath();for(let s=0,i=e.length;s<i;s++)0===s?t.moveTo(e[s].x,e[s].y):t.lineTo(e[s].x,e[s].y);t.closePath(),t.stroke()}var Dl={x1:0,y1:0,x2:0,y2:0},Rl={x:0,y:0},Ol={x:0,y:0},Bl=Math.PI/2;var jl={left:-1,right:1,top:0,bottom:0,center:0},Vl={left:0,right:0,top:-1,bottom:1,center:0},Ul={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},Gl={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},getNTextBounds=(e,t,s,i,r,o,a)=>{const{lines:l,data:d}=((e,t,s)=>{const i=getLinesInfo(t,s.get(e));return i||{lines:0,data:[" "],maxLength:1}})(e,t,i);let h=s(d[0],r,o,a).width;for(let e=1;e<l;e++)h=Math.max(h,s(d[e],r,o,a).width);return[h,l*a*1]},getNTextDisplacement=(e,t,s)=>{const i=t.text.content,r=t.radius,o=t.text.scaling,a=t.text.position,l=t.text.padding,d=t.text.scale,h=t.text.size,u=t.text.style,c=t.text.font,m=t.text.maxLineLength,p=t.text.margin,y=i.get(e),x=r.get(e),b=!o.get(e),v=a.get(e),E=l.get(e),k=d.get(e),L=1*(b?h.get(e):k*x*2),D=u.get(e),B=c.get(e),H=E+p.get(e),X=jl[v],Y=Vl[v],[Z,oe]=getNTextBounds(e,`${y}`,s,m,B,D,L);return[Ul[v]*Z,Gl[v]*oe,X*H,Y*H,X*x,Y*x,Z,oe,Z/2,oe/2]};var Wl=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce(((e,t)=>(e.add(t),e)),new Set),Hl=class extends Ds{constructor(e,t){super(e),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=throttle((({startZoom:e,endZoom:t})=>{this._enabled&&t<e&&this._updateLabels(this._modules.camera.clone({zoom:t}))}),80),this._onAttributesChanged=e=>{if([...e.edgeAttributes,...e.nodeAttributes].some((e=>Wl.has(e)))){const t=e.nodes._indexes;for(let e=0;e<t.length;e++)this._textDisplacementUpdate[t[e]]=!0;this._update()}},this._onItemsAdded=e=>{const t=e.nodes||e.edges;(this._enabled||this._forceEnabled)&&this._modules.settings.get("texts.preventOverlap")&&this._modules.graphics.setTextHidden(t,!0)},this._onToggle=e=>(e?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=e=>{e?this._modules.layers.whenReady((()=>{this._layer=this._modules.layers.addCanvasLayer((e=>{e.lineWidth=1/this._modules.camera.getZoom(),function renderDebug2(e,t,s,i,r){for(let s=0,i=t.length;s<i;s+=6)drawAABB(t.slice(s,s+4),e,"#aaaaaa");for(let t=0;t<s.length;t+=5)drawPolygon(getOBBPoints(s[t],s[t+1],s[t+2],s[t+3],s[t+4]),e,"green");const o=[r.root];let a=r.root;for(;a=o.pop();)a.leaf||o.push.apply(o,a.children),drawAABB(r.getNodeBounds(a),e,"rgba(0,0,0,0.2)"),a=o.pop();i.forEach((t=>drawPolygon(t,e,"red")))}(e,this._textBBoxes,this._rects,this._intersects,this._quadtree)}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()})):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(e,t,s,i)=>this._engine.measureText(e,t,s,i),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new Ts((e=>{const t=6*e;return this._textBBoxes.slice(t,t+6)}),1),t.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(200),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy","topDown");const e=this._output;this._nodeTraversal=getTraverseFunction(this._quadtree,!1,1,e),this._edgeTraversal=getTraverseFunction(this._quadtree,!1,0,e),this._modules.events.on(["addNodes","addEdges"],this._onItemsAdded).on("layoutEnd",(()=>this._updateLabels())).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",(({element:e})=>{if(e)return this._enable();this._disable()})).on("zoomStart",this._onZoomStart).on("viewExportStart",(({preventOverlap:e,camera:t})=>{e&&this.forceUpdate(t)})).on("viewExportEnd",(()=>{this.forceUpdate()})).on("geoEnabled",(()=>this._geoEnabled=!0)).on("geoDisabled",(()=>this._geoEnabled=!1))}getTextsBoundingBox(e,t){e||t?this._updateLabels(this._modules.camera,e?Array.from(e._indexes):[],t?Array.from(t._indexes):[]):this._updateLabels();const s=this._rects,i=new ss;for(let e=0;e<s.length;e+=5){const t=s[e],r=s[e+1],o=s[e+2],a=s[e+3],l=s[e+4],[d,h,u,c]=getAABB(t,r,o,a,l);i.addPoint(d,h).addPoint(u,c)}return i}setRate(e){this._updateDebounced=this._modules.sync.debounceIdle((e=>this._updateLabels(e)),e)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(e=this._modules.camera){this._updateLabels(e)}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(e=this._modules.camera,t,s){if(!this._modules.settings.get("texts.preventOverlap"))return;const i=this._modules.graphics.getNodeAttributes(),r=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];const o=e.getAngle(),a=e.getProjectedScreenBounds(.15),l="bottomUp"===this._modules.settings.get("texts.removalStrategy"),d={angle:o,zoom:e.zoom,screen:a,sin:Math.sin(o),cos:Math.cos(o)};this._resetOutput();const h=this._output;if(!t||!s){const e=this._modules.spatial.queryRaw(a[0],a[1],a[2],a[3]);t=e.nodes,s=e.edges}const u=this._quadtree.clear().cover(a[0],a[1],a[2],a[3]);if(t.length+s.length===0)return;const c=this._modules.captor.getPointedElement();let m=null,p=null;null!==c&&(c.isNode?m=c._index:p=c._index);for(const e of t)!this._textDisplacementUpdate[e]&&this._textDisplacement[e]||(this._textDisplacement[e]=getNTextDisplacement(e,i,this._measureText),this._textDisplacementUpdate[e]=!1);!function fillNodeTexts(e,t,s,i,r,o,a,l,d){const h=a.remove.nodes,u=a.remove.edges,c=a.redraw.nodes,m=s.angle,p=s.zoom,y=s.sin,x=s.cos,b=i.x,v=i.y,E=i.radius,k=i.layer,L=i.scalingMethod,D=i.text.content,B=i.text.scaling,H=i.text.minVisibleSize,X=i.animationDuration,Y=i.textHidden,Z=i.excluded;a.indexToLayer={},a.indexToQuadIndex={},a.indexToRemoveNodeText={},a.indexToRemoveEdgeText={},a.indexToRedrawNodeText={},a.byLayer=[];const{indexToLayer:oe,indexToRedrawNodeText:de,indexToRemoveNodeText:he,indexToRemoveEdgeText:ce,indexToQuadIndex:me,byLayer:_e}=a;for(let t=0;t<e.length;t++){const s=e[t],i=k.get(s)- -1;(_e[i]=_e[i]||[]).push(s),oe[s]=i}if(null!==l){const e=_e.length;for(let t=oe[l]+1;t<=e;t++)(_e[t]=_e[t]||[]).unshift(l);oe[l]=e}let pe;const ye=[0,0,0,0],xe=[0,0,0,0,0],{bboxes:be,rects:ve}=a,tryToInsert=(e,s=-1)=>{const i=X.get(e);let l=D.get(e);if(null===l||""===l||0!==i)return!1;let h=E.get(e);const u=H.get(e);if(1===Z.get(e))return he[e]=!0,!1;if(2*h*p<u)return 0===Y.get(e)&&(he[e]=!0),!1;"fixed"===L.get(e)&&(h/=p);const c=b.get(e),k=v.get(e);"number"==typeof l&&(l=l.toString());let[oe,ce,_e,Se,Ee,we,Ce,ke,Me,Le]=r(e);const Ie=!B.get(e),Ne=Ie?p:1,Pe="fixed"===L.get(e)?p:1;Ie?(_e+=Me,Se+=Le,Me/=p,Le/=p,Ce/=p,ke/=p):(_e+=Me*p,Se+=Le*p),oe=oe/Ne+_e/p+Ee/Pe,ce=ce/Ne+Se/p+we/Pe,getAABB(c-Me,k-Le,Ce,ke,-m,y,-x,ye),xe[0]=c-Me,xe[1]=k-Le,xe[2]=Ce,xe[3]=ke,xe[4]=m;const Fe=x*oe-y*ce,ze=y*oe+x*ce;if(ye[0]+=Fe,ye[1]+=ze,ye[2]+=Fe,ye[3]+=ze,xe[0]+=Fe,xe[1]+=ze,a.realIntersection=!1,setCurrent(e,!0,getOBBPoints(xe[0],xe[1],xe[2],xe[3],xe[4]),s),t.traverse(ye[0],ye[1],ye[2],ye[3],d),a.realIntersection&&!o)return he[e]=!0,!1;de[e]=!0,he[e]=!1,s<=0?(pe=be.length/6,me[e]=pe,be.push(ye[0],ye[1],ye[2],ye[3],1,e),t.insert(pe,ye[0],ye[1],ye[2],ye[3]),ve.push(xe[0],xe[1],xe[2],xe[3],xe[4])):t.insert(me[e],ye[0],ye[1],ye[2],ye[3])};for(const t of e)tryToInsert(t);let Se=!0;for(let e=0;e<_e.length;e++){const t=_e[e];if(t)if(Se)Se=!1;else for(const s of t)tryToInsert(s,e)}for(let t=0;t<e.length;t++){const s=e[t];he[s]?h.push(s):de[s]&&c.push(s),ce[s]&&u.push(s)}return a}(t,u,d,i,(e=>this._textDisplacement[e]),l,h,m,this._nodeTraversal),function fillEdgeTexts(e,t,s,i,r,o,a,l,d,h,u){const c=l.remove.nodes,m=l.remove.edges,p=l.redraw.edges,y=s.angle,x=s.zoom,b=r.x,v=r.y,E=r.radius,k=Math.PI,{source:L,target:D,scalingMethod:B}=i,H=i.width,X=i.curvature,Y=i.layer,Z=i.text.content,oe=i.text.scaling,de=i.text.size,he=i.text.font,ce=i.text.style,me=i.text.scale,_e=i.text.maxLineLength,pe=i.text.margin,ye=i.text.minVisibleSize,xe=i.text.padding,be=i.animationDuration,ve=i.text.adjustAngle,Se=i.text.position;l.indexToLayer={},l.indexToQuadIndex={},l.indexToRemoveNodeText={},l.indexToRemoveEdgeText={},l.indexToRedrawEdgeText={},l.byLayer=[];const{byLayer:Ee,indexToLayer:we,indexToQuadIndex:Ce,indexToRedrawEdgeText:ke,indexToRemoveNodeText:Me,indexToRemoveEdgeText:Le}=l;for(let t=0;t<e.length;t++){const s=e[t],i=Y.get(s)- -1;for(let e=1;e<=i;e++)(Ee[e]=Ee[e]||[]).push(s);we[s]=i}if(null!==d){const e=Ee.length;for(let t=we[d]+1;t<=e;t++)(Ee[t]=Ee[t]||[]).unshift(d);we[d]=e}const Ie=[0,0,0,0],Ne=[0,0,0,0,0],{bboxes:Pe,rects:Fe}=l,tryToInsert=(e,s=-1)=>{const r=be.get(e);let d=Z?Z.get(e):"";if(null===d||""===d||r)return!1;const c=L.get(e),m=D.get(e);let p=H.get(e);const Y=X.get(e),Ee=ye.get(e);if(p*x<Ee)return Le[e]=!0,!1;"fixed"===B.get(e)&&(p/=x);let we=(b.get(c)+b.get(m))/2,ze=(v.get(c)+v.get(m))/2;d=d?d.toString():"";const De=!oe.get(e),Re=me.get(e)*(De?1:x),Oe=he.get(e),Be=1*(De?de.get(e):Re*p),je=ce.get(e),Ve=_e.get(e),Ue=Se.get(e)===an;let Ge=+Ue*pe.get(e)+i.text.padding.get(e);const We=b.get(c),He=v.get(c),qe=b.get(m),Xe=v.get(m),$e=E.get(c),Ye=E.get(m);let Ze;const Qe=c===m;if(Qe)Ze=k/4-y,getSelfLoopControlPoints(We,He,Y,$e,0,Dl),getPointOnBezierCurve(.5,We,He,qe,Xe,Dl.x1,Dl.y1,Dl.x2,Dl.y2,Ol),we=Ol.x,ze=Ol.y,Ge/=-x;else{if(We===qe&&He===Xe)return!1;Ze=lineAngle(We,He,qe,Xe)-y,0!==Y&&(Ze=lineAngle(We,He,qe,Xe)-y,getQuadraticCurveControlPoint(We,He,qe,Xe,Y,Rl),getPointOnQuadraticCurve(.5,We,He,qe,Xe,Rl.x,Rl.y,Ol),we=Ol.x,ze=Ol.y)}const Ke=Ge+0,Je=getLinesInfo(d,Ve);if(!Je)return!1;const{lines:rt,data:gt}=Je;let yt=1*o(gt[0],Oe,je,Be).width;for(let e=1;e<rt;e++)yt=Math.max(yt,1*o(gt[e],Oe,je,Be).width);const At=rt*Be,St=yt/x/2,Et=At/x/2,Tt=Math.abs(formatAngle(Ze))<Bl?1:-1;let Ct=Ue?Qe?At/x+p/2+Ge:Tt*(Ke/x+p/2+Et):0;if(!Qe&&0===Y&&ve.get(e)){const t=xe.get(e);distance(We,He,qe,Xe)*x-($e+Ye)*(u?1:x)<yt+2*t+1&&(Ct*=Tt,Ze=0)}if(Ne[0]=we-St,Ne[1]=ze-Et,Ne[2]=we+St,Ne[3]=ze+Et,Ne[4]=Ze+y,moveAABB(Ne,-(Ze+y),-Ct,Ne),Ne[2]=Ne[2]-Ne[0],Ne[3]=Ne[3]-Ne[1],Ze=k-Ze-y,getAABB(we-St,ze-Et,2*St,2*Et,Ze,void 0,void 0,Ie),moveAABB(Ie,Ze,Ct,Ie),l.realIntersection=!1,setCurrent(e,!1,getOBBPoints(Ne[0],Ne[1],Ne[2],Ne[3],Ne[4]),s),t.traverse(Ie[0],Ie[1],Ie[2],Ie[3],h),l.realIntersection&&!a)return Le[e]=!0,!1;if(ke[e]=!0,Me[e]=!1,s<=0){const s=Pe.length/6;Ce[e]=s,Pe.push(Ie[0],Ie[1],Ie[2],Ie[3],0,e),t.insert(s,Ie[0],Ie[1],Ie[2],Ie[3]),Fe.push(Ne[0],Ne[1],Ne[2],Ne[3],Ne[4])}else t.insert(Ce[e],Ie[0],Ie[1],Ie[2],Ie[3])};for(const t of e)tryToInsert(t);let ze=!0;for(let e=0;e<Ee.length;e++){const t=Ee[e];if(t)if(ze)ze=!1;else for(const s of t)tryToInsert(s,e)}for(let t=0;t<e.length;t++){const s=e[t];Me[s]?c.push(s):ke[s]&&p.push(s),Le[s]&&m.push(s)}return l}(s,u,d,r,i,this._measureText,l,h,p,this._edgeTraversal,this._geoEnabled),this._clearOverlaps(h),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(e){const t=this._modules.graph.nodeList,s=this._modules.graph.edgeList,i=this._modules.graphics,r=t(new Uint32Array(e.remove.nodes)),o=s(new Uint32Array(e.remove.edges)),a=t(new Uint32Array(e.redraw.nodes)),l=s(new Uint32Array(e.redraw.edges));i.setTextHidden(r,!0),i.setTextHidden(o,!0),i.setTextHidden(a,!1),i.setTextHidden(l,!1),this._modules.events.fire("labelCollisionsRemoved",e)}_resetOutput(){const e=this._output;e.remove.nodes=[],e.remove.edges=[],e.redraw.nodes=[],e.redraw.edges=[],e.rects=this._rects,e.bboxes=this._textBBoxes,e.intersects=this._intersects,e.realIntersection=!1,e.indexToLayer={},e.byLayer=[],e.indexToRedrawEdgeText={},e.indexToRemoveEdgeText={},e.indexToRedrawNodeText={},e.indexToRemoveNodeText={},e.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},ql=class extends Ds{constructor(){super(...arguments),this._onStartInteractionEvent=(e,t)=>{if(this._current)return;const s=this._interactionsByStartEvent[t];let i;for(const t of s){t.check(e)&&(!i||t.priority>=i.priority)&&(i=t)}i&&this._startInteraction(i,e)},this._onProgressInteractionEvent=(e,t)=>{this._current&&this._current.progressEventName===t&&this._current.onProgress&&this._current.onProgress(e)},this._onStopInteractionEvent=(e,t)=>{this._current&&this._current.stopEventName===t&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(e,t){e.onStart&&e.onStart(t),e.onStop&&(this._current=e,e.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(e){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(e),this._current=void 0}_forceStartInteraction(e,t){this._current&&this._stopCurrentInteraction(t),this._startInteraction(e,t)}_createWrapper(e){return{start:t=>this._forceStartInteraction(e,t)}}_addInteraction(e,t){const s=this._interactionsByStartEvent[e];return s?s.push(t):(this._interactionsByStartEvent[e]=[t],this._modules.events.on(e,this._onStartInteractionEvent)),this._createWrapper(t)}_createProgressiveInteraction(e,t,s,i){const r={priority:formatPriority(i.priority),check:i.check||falseFn,onStart:i.onStart||noop,onProgress:i.onProgress||noop,onStop:i.onStop||noop,disableDetection:!!i.disableDetection,progressEventName:t,stopEventName:s};return this._boundProgressEvents[t]||(this._boundProgressEvents[t]=!0,this._modules.events.on(t,this._onProgressInteractionEvent)),this._boundStopEvents[s]||(this._boundStopEvents[s]=!0,this._modules.events.on(s,this._onStopInteractionEvent)),this._addInteraction(e,r)}_createNonProgressiveInteraction(e,t){return this._addInteraction(e,{priority:formatPriority(t.priority),check:t.check||falseFn,onStart:t.handler||noop,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(e){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",e)}onGesture(e){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",e)}onClick(e){return this._createNonProgressiveInteraction("click",e)}onDoubleClick(e){return this._createNonProgressiveInteraction("doubleclick",e)}onHover(e){return this._createNonProgressiveInteraction("mouseover",e)}onUnhover(e){return this._createNonProgressiveInteraction("mouseout",e)}onMouseWheel(e){return this._createNonProgressiveInteraction("mousewheel",e)}onMouseDown(e){return this._createNonProgressiveInteraction("mousedown",e)}onMouseUp(e){return this._createNonProgressiveInteraction("mouseup",e)}onMouseMove(e){return this._createNonProgressiveInteraction("mousemove",e)}};function formatPriority(e){return"string"==typeof e?ii.indexOf(e):"number"!=typeof e||isNaN(e)?0:e}var Xl=["virtualUp","mouseupInternal","touchUp"],$l=["virtualDown","mousedownInternal","touchDown"],Yl=["virtualMove","mousemoveInternal","touchMove"],Zl=["virtualClick","clickInternal","touchTap"],Ql=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],Kl=["virtualWheel","mousewheelInternal"],Jl=class extends Ds{constructor(){super(...arguments),this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.nodeBadges",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",2).register("detect.enableSpatialIndex",!0).register("detect.spatialIndexMarginRatio",20),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(Yl,((e,t)=>{this._onMove(__spreadProps(__spreadValues({},e),{source:getSource(t)}))})).on($l,(({domEvent:e,x:t,y:s,button:i="left"},r)=>{this._onDown({domEvent:e,x:t,y:s,button:i,source:getSource(r)})})).on(Xl,(({domEvent:e,x:t,y:s,button:i="left"},r)=>{this._onUp({domEvent:e,x:t,y:s,button:i,source:getSource(r)})})).on(Zl,(({domEvent:e,x:t,y:s,button:i="left"},r)=>{this._onClick({domEvent:e,x:t,y:s,button:i,source:getSource(r)})})).on(Ql,(({domEvent:e,x:t,y:s,button:i="left"},r)=>{this._onDoubleClick({domEvent:e,x:t,y:s,button:i,source:getSource(r)})})).on(Kl,(({domEvent:e,x:t,y:s,delta:i})=>{this._onWheel({domEvent:e,x:t,y:s,delta:i,source:"mouse"})})).on("touchStartGesture",(e=>this._modules.events.fire("gestureStart",e))).on("touchProgressGesture",(e=>this._modules.events.fire("gestureProgress",e))).on("touchEndGesture",(e=>this._modules.events.fire("gestureEnd",e))).on("documentMouseMove",(({domEvent:e,x:t,y:s},i)=>{this._onDocumentMove({domEvent:e,x:t,y:s,source:getSource(i)})})).on("documentMouseUp",(({domEvent:e,x:t,y:s,button:i="left"},r)=>{this._onDocumentUp({domEvent:e,x:t,y:s,source:getSource(r),button:i})}))}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y,!1,!1),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(e){return this._buttons[e].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(value){this._disabledCounter=Math.max(0,this._disabledCounter+(value?-1:1))}_resetCurrent(e,t){for(const s in this._buttons){const i=this._buttons[s];i.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:e,y:t,button:s,target:this._draggedElt}),i.isPressed=!1,i.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:e,y:t,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:e,x:t,y:s,source:i}){let{dx:r,dy:o}=this._setPointerPosition(t,s);this._modules.events.fire("mousemove",{domEvent:e,x:t,y:s,dx:r,dy:o,source:i});for(const a in this._buttons){const l=this._buttons[a];if(l.isPressed)if(l.isDragging){const l=this._getStoredDXY();r+=l.dx,o+=l.dy,this._modules.events.fire("dragProgress",{domEvent:e,x:t,y:s,dx:r,dy:o,button:a,source:i,target:this._draggedElt})}else l.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:e,x:t,y:s,source:i,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(r,o),this._modules.events.fire("dragStart",{domEvent:e,x:t,y:s,button:a,source:i,target:this._draggedElt})}e&&!this._modules.graphics.getDomElement().contains(e.target)||this._detectElement(t,s,!1,!1),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:e,x:t,y:s,source:i,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:e,x:t,y:s,source:i,target:this._hoveredElt})))}_onDocumentMove({domEvent:e,x:t,y:s,source:i}){for(const r in this._buttons){const{isDragging:o}=this._buttons[r];if(o){const{dx:o,dy:a}=this._setPointerPosition(t,s);this._modules.events.fire("dragProgress",{domEvent:e,x:t,y:s,dx:o,dy:a,button:r,source:i,target:this._draggedElt})}}}_onDocumentUp({domEvent:e,x:t,y:s,source:i,button:r}){if(null!=r&&this._buttons[r].isDragging){this._modules.events.fire("dragEnd",{domEvent:e,x:t,y:s,button:r,source:i,target:this._draggedElt});const o=this._buttons[r];o.isDragging=!1,o.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:e,x:t,y:s,button:i,source:r}){if(null==i)return;this._detectElement(t,s,!1,!1),this._elt!==this._hoveredElt&&this._resetCurrent(t,s);const o=this._buttons[i];this._hoveredElt=this._elt,o.isPressed=!0,this._elt&&e&&(e.stopPropagation(),e.preventDefault()),this._modules.events.fire("mousedown",{domEvent:e,x:t,y:s,button:i,source:r,target:this._hoveredElt})}_onDoubleClick({domEvent:e,x:t,y:s,button:i,source:r}){null!=i&&(isDuplicateMouseEvent(e,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:e,x:t,y:s,button:i,source:r,target:this._hoveredElt}))}_onUp({domEvent:e,x:t,y:s,button:i,source:r}){if(null==i)return;const o=this._buttons[i];o.isPressed&&(o.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:e,x:t,y:s,button:i,source:r,target:this._draggedElt}),o.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),o.isPressed=!1,this._detectElement(t,s,!1,!1),this._modules.events.fire("mouseup",{domEvent:e,x:t,y:s,button:i,source:r,target:this._elt}),this.isAnyButtonPressed()||this._hover||"touch"===r||(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:e,x:t,y:s,source:r,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:e,x:t,y:s,button:i,source:r}){isDuplicateMouseEvent(e,"click")||this._modules.events.fire("click",{domEvent:e,x:t,y:s,button:i,source:r,target:this._hoveredElt})}_onWheel({domEvent:e,x:t,y:s,delta:i,source:r}){this._modules.position.x=t,this._modules.position.y=s,this._modules.events.fire("mousewheel",{domEvent:e,x:t,y:s,delta:i,source:r,target:this._hoveredElt})}_storeDXY(e,t){this._accDx=e,this._accDy=t}_getStoredDXY(){const e=this._accDx,t=this._accDy;return this._accDx=0,this._accDy=0,{dx:e,dy:t}}_setPointerPosition(e,t){const s=e-this._prevX,i=t-this._prevY;return this._modules.position.x=e,this._modules.position.y=t,this._prevX=e,this._prevY=t,this._accDx=0,this._accDy=0,{dx:s,dy:i}}_detectElement(e,t,s,i){this._elt=this.detectElementAt(e,t,s,i)}detectElementAt(e,t,s,i){if(0!==this._disabledCounter)return null;const r=this._modules.settings,o=r.get("detect.enableSpatialIndex"),a=r.get("detect.nodeErrorMargin")||0,l=r.get("detect.edgeErrorMargin")||0;let d=r.get("detect.nodes"),h=r.get("detect.edges");i&&(d=!0,h=!0);let u=null,c=[],m=[];if(!s&&o&&(d||h)){const s=r.get("detect.spatialIndexMarginRatio"),i=Math.max(a*s,l*s),o=this._modules.spatial.queryRawProjected(e-i,t-i,e+i,t+i);c=o.nodes,m=o.edges}let p=null,y=null;if(d&&(p=this._modules.graphics.detectNode(e,t,!!r.get("detect.nodeBadges"),!!r.get("detect.nodeTexts"),a,c)),h&&(m.length<100||!p)&&(y=this._modules.graphics.detectEdge(e,t,!!r.get("detect.edgeTexts"),l,m)),p&&y){const e=this._modules.graphics.getAttributesManager().getFlexArrays();u=e.nodes.current.layer.get(p._index)>=e.edges.current.layer.get(y._index)?p:y}else p?u=p:y&&(u=y);return u}};function getSource(e){return 0===e.indexOf("touch")?"touch":"mouse"}var ed=!1,td={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function isDuplicateMouseEvent(e,t){if(e)return e.type===td[t].trigger&&(ed=!0),e.type===td[t].duplicate&&ed?(ed=!1,!0):void 0}var sd=class extends Ds{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:e,button:t})=>{const s="left"===t,i=this._modules.settings.get("interactions.drag.enabled"),r=null!==e&&e.isNode&&!0===e.getAttribute("draggable");return!!(s&&i&&r)},this._onDragStart=({x:e,y:t,target:s})=>{s&&(s.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter((e=>e.getAttribute("draggable"))):this._dragged=s.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=deepCopy(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:e,y:t}),this._dragged.addClass(Xs),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;const{x:e,y:t}=this._modules.captor.getCursorInformation(),s=this._dragged._indexes,i=this._modules.camera.screenToGraphCoordinates({x:e,y:t}),r=i.x-this._startDrag.x,o=i.y-this._startDrag.y;for(let e=0;e<s.length;++e){const t=this._start[e],s=this._end[e];s.x=t.x+r,s.y=t.y+o}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,e,t,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:r,dy:o})},this._onDragEnd=()=>{this._dragged&&(this._dragged.removeClass(Xs),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:Xs,isBuiltin:!0,nodeAttributes:{layer:3}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0).register("interactions.drag.cursor","move").register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},id={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},nd=class extends Ds{constructor(){super(...arguments),this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter((e=>e!==this._startNode&&!e.isVirtual())),this._movedEdges.setExcluded(!0);const e=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:e,node:e,edge:e}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();const e=this._getPointedNode();e&&this._movedEdges.forEach((t=>{t.getTarget()===this._startNode?t.setTarget(e):t.setSource(e)})),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;const e=this._modules.selection.getSelectedEdges();this._nodesToHighlight=e.getExtremities().dedupe().filter((e=>!e.isVirtual())),this._rewirableClass.clearEdges(),this._rewirableClass.add(e),this._refreshCanvas()},this._shouldInteractionStart=({target:e})=>{if(!this._enabled||!e||!e.isNode||!this._hoverHandle||e.isVirtual())return!1;const t=e.getAdjacentEdges().filter((e=>e.isSelected()));return!!t.size&&(this._movedEdges=t,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=e,!0)},this._refreshCanvas=()=>{this._enabled&&this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;const e=this._options.radius,t=this._nodesToHighlight.toArray(),s=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let i=0;i<t.length;i++){const{x:r,y:o}=t[i].getPosition();if(distance(r,o,s.x,s.y)<e)return void this._enableCursorOnHover()}this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:$s,isBuiltin:!0,edgeAttributes:{layer:4}}),this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",(()=>{this._grabHandle&&this._refreshCanvas()})).on("nodesDragProgress",this._refreshCanvas).on("mousedown",(()=>{this._hoverHandle&&(this._grabHandle=!0)})).on("mouseup",(()=>this._grabHandle=!1)).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:e,y:t})=>{this._x=e,this._y=t},onStop:this._onDragEnd})}enable(e){this._enabled||(this._options=__spreadValues(__spreadValues({},id),e),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((e=>{if(!this._enabled||!this._nodesToHighlight)return;const t=this._modules.captor.getCursorPosition(),s=this._getPointedNode(),i=this._options.color,r=this._options.radius,o=2*r;if(this._displayMovedEdges(e),e.fillStyle=i,e.strokeStyle=i,this._nodesToHighlight.forEach((t=>{const{x:s,y:i}=t.getPosition();e.fillRect(s-r,i-r,o,o)})),this._movedEdges){const i=s?s.getPosition():t;e.fillRect(i.x-r,i.y-r,o,o)}}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){this._enabled&&(this._interaction.stop&&this._interaction.stop(),this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1)}enabled(){return this._enabled}_restoreSettings(){this._prevSettings&&(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){this._hoverHandle&&!this._grabHandle&&(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(e){if(!this._movedEdges)return;const t=this._x,s=this._y,i=this._modules.camera.screenToGraphCoordinates({x:t,y:s});this._movedEdges.forEach(((t,s)=>{const r=this._edgeColors[s],o=t.getSource(),a=t.getTarget(),l=this._getPointedNode(),d=a===this._startNode?o:a,h=Number(t.getAttribute("width")),u=d.getPosition(),c=l?l.getPosition():i;e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(c.x,c.y),e.strokeStyle=r,e.lineWidth=h,e.stroke()}))}_getPointedNode(){const e=this._modules.captor.getPointedElement();return e&&e.isNode&&!e.isVirtual()?e:null}},od={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},ad=class extends Ds{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{this._enabled&&(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:e,y:t})=>{this._modules.dom.setTimeout((()=>this._detectBoundingBoxes(e,t)))}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:e,y:t})=>{this._x=e,this._y=t,this._nodeBeingResized=this._pointedNode},onProgress:({x:e,y:t})=>{this._x=e,this._y=t,this._displayHandles()},onStop:()=>{this._nodesToHighlight&&this._nodesToHighlight.forEach(((e,t)=>{const s=this._additionalRadiuses[t]/this._modules.camera.zoom;e.setAttributes({radius:Number(e.getAttribute("radius"))+s,x:e.getPosition().x+s,y:e.getPosition().y-s})})),this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on("nodesSelected",this._onSelectionChange),this._modules.events.on("nodesUnselected",this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(e,t){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;const s=this._options.handleSize/2,i=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight(((r,o,a)=>{const l=o.x+a-s-i,d=o.x+a+s+i,h=o.y-a-s-i,u=o.y-a+s+i;e>=l&&e<=d&&t>=h&&t<=u&&(this._pointedNode=r)})),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(e){this._nodesToHighlight&&this._nodesToHighlight.forEach((t=>{const s=t.getPositionOnScreen(),i=this._getTotalRadius(t);e(t,s,i)}))}_displayHandles(){this._enabled&&this._nodesToHighlight&&this._layer.refresh()}_displayNodePreview(e,t,s,i,r,o){if(r*=1/this._modules.camera.getZoom(),e.beginPath(),1===o.length)e.arc(s,i,r,0,2*Math.PI);else for(let t=0;t<o.length;++t){const a=o[t],l=s+a.x*r,d=i+a.y*r;0===t?e.moveTo(l,d):e.lineTo(l,d)}e.fillStyle=this._options.previewColor,e.fill()}_getTotalRadius(e,t=!0){return Number(e.getAttribute("radius"))*(this._modules.camera.zoom*(t?1:0))+Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(e,t,s){const i=this._modules.spatial.getNodesInScreenByDistance(t).filter((e=>!e.isSelected())).slice(0,this._options.nbNodesToSnapTo),r=this._getTotalRadius(t),o=r+s,a=this._options.snappingRatio,l=o/r,d=Math.round(getBaseLog(l,a));let h=r*Math.pow(a,d),u=null;if(i.forEach((e=>{const t=this._getTotalRadius(e);Math.abs(t-o)<=Math.abs(h-o)&&(h=t,u=e)})),u){e.save(),e.strokeStyle=this._options.sizeIndicatorColor,e.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();const s=u.getAttribute("radius");this._displaySizeIndicator(e,t,h),i.filter((e=>e.getAttribute("radius")===s)).forEach((t=>this._displaySizeIndicator(e,t))),e.restore()}return h-r}_displaySizeIndicator(e,t,s){s=s||void 0;const i=this._modules.camera.getZoom(),r=t.getPosition(),o=this._getTotalRadius(t),a=(s||o)/i,l=(s?s-o:0)/i,d=l+(-this._options.sizeIndicatorOffset-(s?Number(t.getAttribute("innerStroke.width"))+Number(t.getAttribute("outerStroke.width")):0))/i,h=r.x-a+d|0,u=r.y-a-l|0,c=r.y+a-l|0,m=this._options.sizeIndicatorWidth/i;e.beginPath(),e.moveTo(h-m,u),e.lineTo(h+m,u),e.moveTo(h,u),e.lineTo(h,c),e.moveTo(h-m,c),e.lineTo(h+m,c),e.stroke()}enable(e){this._enabled||(this._options=__spreadValues(__spreadValues({},od),e),this._layer=this._modules.layers.addCanvasLayer((e=>{const t=Re(),s=this._modules.camera.getZoom(),{color:i,lineWidth:r}=this._options;let o=this._options.handleSize,a=0;if(this._nodeBeingResized){const e=this._getTotalRadius(this._nodeBeingResized),t=this._nodeBeingResized.getPositionOnScreen();a=Math.max(this._x-(t.x+e),-(this._y-(t.y-e)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach((l=>{const d=l.getPosition();let h=this._getTotalRadius(l),u=0;if(this._nodeBeingResized){u=a;const i=-h+Number(l.getAttribute("innerStroke.width"))+Number(l.getAttribute("outerStroke.width"))+r/2+1;u=u<i?i:this._snap(e,l,u),this._additionalRadiuses.push(u);const o=l.getAttribute("shape"),c=this._engine.getShapePoints(o),m=d.x+u/s,p=d.y-u/s,y=h+u;this._displayNodePreview(e,t,m,p,y,c)}e.strokeStyle=i,e.fillStyle=i,e.lineWidth=r/s,h/=s,u/=s,o/=s*t,e.strokeRect(d.x-h,d.y-h-2*u,2*(u+h),2*(u+h)),e.fillRect(d.x+h+2*u-o/2,d.y-h-2*u-o/2,o,o)}))}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){this._enabled&&(this._modules.events.off(this._displayHandlesHandler),this._modules.events.off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options=__spreadValues({},od),this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},ld={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:trueFn,onNodeCreated:noop,onEdgeCreated:noop,createNode:idenitity,createEdge:idenitity,onComplete:noop},dd=class extends Ds{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=layerToDepth(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:e,button:t="left"})=>this._enabled&&"left"===t&&e&&e.isNode&&!e.isVirtual(),onStart:({target:e})=>this._onStart(e),onProgress:({x:e,y:t})=>this._onMove(e,t),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",(()=>this.disable()))}_onStart(e){e&&(this._cursorEnabled=!0,this._startNode=e,this._startPos=e.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(e,t){null!==this._startNode&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:e,y:t}),this._drawLine())}_onStop(){if(null===this._startNode)return;const{condition:e,onNodeCreated:t,onEdgeCreated:s,createEdge:i,createNode:r,onComplete:o,createNodes:a}=this._options;let l=this._modules.captor.getPointedElement(),d=null,h=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!l&&a){const e=r({attributes:{x:this._endPos.x,y:this._endPos.y}});l=this._modules.graph.addNode(e),h=l,t&&t(h)}if(l&&!l.isVirtual()&&(h||!e||e(this._startNode,l))){const e=i({source:this._startNode.getId(),target:l.getId()});d=this._modules.graph.addEdge(e),s&&s(d)}o&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:l,edge:d}),o(this._startNode,l,d||void 0)),this.disable()}_drawLine(){this._group.reset(1,!1,this._depth);const e=this._group.nextAndReset().end;e.pieceId=tn,e.shape="line",e.x1=this._startPos.x,e.y1=this._startPos.y,e.x2=this._endPos.x,e.y2=this._endPos.y,e.fillColor=this._options.strokeColor,e.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(e.dashLength=3,e.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(e={}){return this._enabled||(this._options=__spreadValues(__spreadValues({},ld),e),this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},hd=["top","bottom","left","right","cssDefined"],ud={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},cd={position:"top",autoAdjust:!0,delay:100},gd={hover:{node:({target:e})=>e&&e.isNode,edge:({target:e})=>e&&!e.isNode},click:{left:{node:({target:e,button:t})=>"left"===t&&e&&e.isNode,edge:({target:e,button:t})=>"left"===t&&e&&!e.isNode,background:({target:e,button:t})=>"left"===t&&!e},right:{node:({target:e,button:t})=>"right"===t&&e&&e.isNode,edge:({target:e,button:t})=>"right"===t&&e&&!e.isNode,background:({target:e,button:t})=>"right"===t&&!e}},doubleclick:{left:{node:({target:e,button:t})=>"left"===t&&e&&e.isNode,edge:({target:e,button:t})=>"left"===t&&e&&!e.isNode,background:({target:e,button:t})=>"left"===t&&!e},right:{node:({target:e,button:t})=>"right"===t&&e&&e.isNode,edge:({target:e,button:t})=>"right"===t&&e&&!e.isNode,background:({target:e,button:t})=>"right"===t&&!e}}},md=class extends Ds{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],(()=>{this._isHover||this._hideTooltip(!1)})).on("mouseout",(()=>{this._isHover&&this._hideTooltip(!1)})).on("clearGraph",(()=>this._hideTooltip(!1))),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(e,{position:t="top",autoAdjust:s=!0,className:i,x:r=0,y:o=0}={}){this._showTooltip(e,{position:t,autoAdjust:s,className:i},{x:r,y:o})}setHandler(e,t,s){const i=__spreadValues(__spreadValues({},cd),s);i.position&&-1===hd.indexOf(i.position)&&(i.position="top"),this._handlers[e]={handler:t,condition:getProperty(gd,e),settings:i}}_hideTooltip(e){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),e&&(this._currentHandlerName=null),this._tooltip){const e=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:e})}}_createInteraction(e,t=!1){return{priority:"tooltip",check:s=>{const i=makeHandlerName(e,s),r=this._handlers[i];return(!t||!this._modules.connectNodes.enabled())&&(!(!r||!r.condition(s))||!(t||!this._currentHandlerName||this._isHover)&&null!==this._tooltip)},handler:s=>{const{target:i,x:r,y:o}=s;this._hideTooltip(!1),this._isHover=t,this._elt=i,this._x=r,this._y=o,this._currentHandlerName=makeHandlerName(e,s),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);const e=this._handlers[this._currentHandlerName];if(!e)return;const{settings:t,handler:s}=e,i=this._elt;if(i){const e=i.isNode?"node":"edge";if(-1===this._currentHandlerName.indexOf(e))return}const r=s(i);Promise.resolve(r).then((e=>{this._schedule((()=>this._showTooltip(e,t)),t.delay)}))}_schedule(e,t){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout((()=>{this._timeout=null,e()}),t)}_showTooltip(e,t,s){this._hideTooltip(!1);const{position:i,className:r,autoAdjust:o}=t;let a=this._x,l=this._y,d=this._elt;const h=this._modules.dom.getDimensions();let u=0,c=0;if(s&&(a=s.x,l=s.y,d=null),"string"==typeof e)this._tooltip=function createElement2(e){return _e?document.createElement(e):createDummyDomElement()}("div"),this._tooltip.innerHTML=e;else{if(!isHTMLElement(e))throw new Error(`invalid tooltip ${e}, expected HTML string or HTML element`);this._tooltip=e}const m=this._tooltip;if(r&&this._tooltip.classList.add(r),"cssDefined"!==i&&(m.style.position="absolute"),m.style.zIndex=1e4.toString(),this._modules.dom.appendElement(m),d&&d.isNode){const e=d,t=e.getPositionOnScreen(),s=Number(e.getAttribute("radius"))*("fixed"===e.getAttribute("scalingMethod")?1:this._modules.camera.getZoom())+Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width"));a=t.x,l=t.y,u=s,c=s}const p=m.offsetWidth/2,y=m.offsetHeight/2;if(u+=p,c+=y,i&&"cssDefined"!==i){const e=ud[i];let t=e.x,s=e.y;if(o){const r=a+u*e.x,o=l+c*e.y;(r-p<0||r+p>=h.width)&&("left"===i||"right"===i?t*=-1:t=r-p<0?(p-r+1)/u:(h.width-(r+p)-1)/u),(o-y<0||o+y>=h.height)&&("top"===i||"bottom"===i?s*=-1:s=o-y<0?(y-o+1)/c:(h.height-(o+y)-1)/c)}m.style.left=a+u*t-p+"px",m.style.top=l+c*s-y+"px"}this._modules.events.fire("tooltipShow",{tooltip:m})}};function makeHandlerName(e,{button:t,target:s}){return`${e}${t?`.${t}`:""}.${null!==s?s.isNode?"node":"edge":"background"}`}var _d={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},pd=Object.keys(_d).reduce(((e,t)=>{const s=_d[t];return e[s]||(e[s]=[]),e[s].push(t),e}),{}),fd=class extends Ds{constructor(){super(...arguments),this._onBlur=()=>this.resetKeys(),this._onKeyUp=e=>{const t=e.keyCode||e.which;this._pressed[t]=!1,this._modules.events.fire("keyup",{domEvent:e,key:_d[t],code:t})},this._onKeyDown=e=>{const t=e.keyCode||e.which,s=this._binds[t];if(!this._pressed[t]){if(this._pressed[t]=!0,s)for(const t of s){t.keys.every((e=>e.some((e=>this._pressed[e]))))&&t.handler({domEvent:e})}this._modules.events.fire("keydown",{domEvent:e,key:_d[t],code:t})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=getCurrentTime(),this._modules.events.onAnyEvent((()=>{const e=getCurrentTime();e-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=e}))}setIdleTimeout(e){if(!isFinite(e)||e<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=e}resetKeys(){for(let e=0;e<this._pressed.length;e++)this._pressed[e]&&(this._pressed[e]=!1,this._modules.events.fire("keyup",{key:_d[e],code:e}))}onKeyPress(e,t){let s=[];if("number"==typeof e)s=[e];else if("string"==typeof e)s=e.split(" ");else{if(!Array.isArray(e))throw new TypeError(`${e} is not a number, string or array`);s=e}if(0===s.length)throw new Error("the array should contain at least one element");const i=s.map((e=>{if("number"==typeof e)return[e];if("string"==typeof e){const t=pd[e];if(!t)throw new Error(`${e} is not a valid key identifier`);return t}throw new TypeError(`${e} is not a valid key identifier`)})),r=i.pop(),o={keys:i,handler:t};r&&r.forEach((e=>{this._binds[e]||(this._binds[e]=[]),this._binds[e].push(o)}))}isPressed(e){if("number"==typeof e)return this._pressed[e];if("string"==typeof e){const t=pd[e];if(t)return t.some((e=>this._pressed[e]))}return!1}},yd=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],xd=Math.PI,bd=2*Math.PI,vd=Math.cos(xd/2-bd/5),Ad=Math.cos(xd/2-bd/5*2),Sd=Math.cos(xd/2-bd/5*3),Ed=Math.cos(xd/2-bd/5*4),wd=Math.sin(-xd/2+bd/5),Td=Math.sin(-xd/2+bd/5*2),Cd=Math.sin(-xd/2+bd/5*3),kd=Math.sin(-xd/2+bd/5*4),Md=1.6,Ld=3,Id=.9,Nd=.31,Pd=1/3,Fd=[8,3],zd=[3,3],Dd={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:e=>e[e.length-1]},Rd=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function isNumber3(e){return Array.isArray(e)?e.reduce(((e,t)=>e&&isNumber3(t)),!0):"undefined"===e||!isNaN(Number(e))}function getMin(e){return Array.isArray(e)?e.reduce(((e,t)=>Math.min(e,getMin(t))),1/0):"number"==typeof(e=Number(e))?isNaN(e)?1/0:+e:1/0}function getMax(e){return Array.isArray(e)?e.reduce(((e,t)=>Math.max(e,getMax(t))),-1/0):"number"==typeof(e=Number(e))?isNaN(e)?-1/0:+e:-1/0}function numberToText(e){const t=["K","M","B","T","P","E","Z","Y"];if(e>9999){let s=0;for(;s<t.length&&e>999;)e/=1e3,s++;return(roundForDigits(e,3)+t[s-1]).toString()}return roundForDigits(e,4).toString()}function roundForDigits(e,t=3){const s=4===t?10:1;return e<10?Math.round(100*e*s)/(100*s):e<100?Math.round(10*e*s)/(10*s):e<1e3?Math.round(e*s)/s:Math.round(e)}function initialOffsetY(e){return e.innerMargin+(e.titleFontSize+e.fontSize)*Md}var SORT_WIDGETS_BY_TITLE=(e,t)=>e.isNode!==t.isNode?e.isNode?-1:1:e.title<=t.title?-1:1,SORT_WIDGETS_FUNC=(e,t)=>e.height-t.height,SORT_BY_HEIGHT=(e,t)=>e.isNode!==t.isNode?e.isNode?-1:1:t.height-e.height,SORT_BY_TITLE=(e,t)=>e.isNode!==t.isNode?e.isNode?-1:1:e.content[0].title<=t.content[0].title?-1:1;function drawWidget(e,t,s){const i=t.getContext("2d"),{x:r,y:o,height:a,isNode:l,styleProperty:d,title:h,mapping:u,iconFont:c,iconFontStyle:m}=s;!function drawBackground(e,t,s,i,r){return function drawRoundRect(e,t,s,i,r,o,a,l,d){e.setLineDash([]),e.beginPath(),e.moveTo(t+o,s),e.lineTo(t+i-o,s),e.quadraticCurveTo(t+i,s,t+i,s+o),e.lineTo(t+i,s+r-o),e.quadraticCurveTo(t+i,s+r,t+i-o,s+r),e.lineTo(t+o,s+r),e.quadraticCurveTo(t,s+r,t,s+r-o),e.lineTo(t,s+o),e.quadraticCurveTo(t,s,t+o,s),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle=l,e.lineWidth=d,e.stroke()}(e,s,i,t.widgetWidth,r,t.borderRadius,t.backgroundColor,t.borderColor,t.borderWidth)}(i,e,r,o,a),function drawTitle(e,t,s,i,r){setFont(e,t.fontFamily,t.titleFontSize,t.titleFontColor,t.titleTextAlign);const o="center"===t.titleTextAlign,a=t.widgetWidth-2*t.innerMargin,l=e.measureText(s).width,d=i+(o?t.widgetWidth/2:t.innerMargin),h=r+t.titleFontSize/2+t.innerMargin;if(l>a){const e=a/l,t=(s.length*e|0)-2;s=s.substr(0,t)+""}e.fillText(s,d,h)}(i,e,h,r,o);const p=e.fontSize*Md,y=e.fontSize/2*Md*Id,x=e.fontSize*Ld,b=e.fontSize,v=function textOffsetX(e,t){const s=t?1:Ld;return e.fontSize*s}(e,l);let E=o+initialOffsetY(e);const k=r+e.innerMargin+v/2,L=r+2*e.innerMargin+v,D=getValues(u),B=isNumber3(D),H=e.fontColor,X=e.shapeColor,Y=Object.keys(u);if(B&&(Y.sort(((e,t)=>computeMin(u[t])-computeMin(u[e]))),"radius"===d||"width"===d)){const t=getMin(D),s=getMax(D);return(l?drawNodeQuantitativeIndicator:drawEdgeQuantitativeIndicator)(e,i,r,E,t,(t+s)/2,s,X)}Y.forEach((t=>{const s=u[t];"color"===d&&(l?drawCircle(i,k,E,y,t):function drawLine2(e,t,s,i,r,o){e.fillStyle=o,e.fillRect(t-i/2,s-r/2,i,r)}(i,k,E,x,b,t)),"shape"===d&&(l?function drawNodeShape(e,t,s,i,r,o){switch(e.fillStyle=o,r){case"square":return e.fillRect(t-i,s-i,2*i,2*i);case"circle":return drawCircle(e,t,s,i,o);case"cross":return function drawCross(e,t,s,i){e.fillRect(t-i,s-i*Nd,2*i,2*i*Nd),e.fillRect(t-i*Nd,s-i,2*i*Nd,2*i)}(e,t,s,i);case"diamond":return function drawDiamond(e,t,s,i){return e.beginPath(),e.moveTo(t-i,s),e.lineTo(t,s-i),e.lineTo(t+i,s),e.lineTo(t,s+i),e.fill()}(e,t,s,i);case"equilateral":return function drawEquilateral(e,t,s,i){e.beginPath(),e.moveTo(t,s-i),e.lineTo(t+vd*i,s+wd*i),e.lineTo(t+Ad*i,s+Td*i),e.lineTo(t+Sd*i,s+Cd*i),e.lineTo(t+Ed*i,s+kd*i),e.fill()}(e,t,s,i);case"star":return function drawStar(e,t,s,i){e.beginPath(),e.moveTo(t,s-i),e.lineTo(t+Ad*i,s+Td*i),e.lineTo(t+Ed*i,s+kd*i),e.lineTo(t+vd*i,s+wd*i),e.lineTo(t+Sd*i,s+Cd*i),e.fill()}(e,t,s,i)}}(i,k,E,y,t,X):function drawEdgeShape(e,t,s,i,r,o,a){e.fillStyle=a,"line"===o&&e.fillRect(t-i/2,s-r/4,i,r/2);if("arrow"===o)return function drawArrow(e,t,s,i,r){e.fillRect(t-i/2,s-r/4,i*(1-Pd),r/2),e.beginPath(),e.moveTo(t+i*(1-Pd-.5),s-r/2),e.lineTo(t+i*(1-Pd-.5),s+r/2),e.lineTo(t+i/2,s),e.fill()}(e,t,s,i,r);if("dashed"===o||"dotted"===o)return function drawDashedDotted(e,t,s,i,r,o,a){e.beginPath(),e.moveTo(t-i/2,s),e.lineTo(t+i/2,s),e.strokeStyle=o,e.lineWidth=r/2,e.setLineDash("dashed"===a?Fd:zd),e.stroke()}(e,t,s,i,r,a,o);if("tapered"===o)return function drawTapered(e,t,s,i,r){e.beginPath(),e.moveTo(t-i/2,s-r/2),e.lineTo(t-i/2,s+r/2),e.lineTo(t+i/2,s),e.fill()}(e,t,s,i,r)}(i,k,E,x,b,t,X)),"icon.content"===d&&function drawIcon(e,t,s,i,r,o,a,l){setFont(e,r,2*o,a,"center",l),e.fillText(i,t,s)}(i,k,E,t,c,y,H,m),"image"!==d&&"image.url"!==d||function drawImage(e,t,s,i,r){if("undefined"==typeof Image)return;e._imgStore||(e._imgStore={});let o=e._imgStore[r];if(o)return e.drawImage(o,t-i,s-i,2*i,2*i);o=new Image,o.src=r,o.onload=()=>{e.drawImage(o,t-i,s-i,2*i,2*i)},e._imgStore[r]=o}(i,k,E,y,t),function drawInformativeText(e,t,s,i,r,o){let a=r.join();if(o)if(1===r.length)a=numberToText(r[0]);else{const e=computeMin(r),t=computeMax(r);a=`${numberToText(e)} - ${numberToText(t)}`}setFont(e,t.fontFamily,t.fontSize,t.fontColor),e.fillText(a,s,i)}(i,e,L,E,s,B),E+=p}))}function drawCircleSizeIndicator(e,t,s,i,r,o){e.beginPath(),e.arc(t,s,i,0,bd),e.strokeStyle=r,e.lineWidth=o,e.stroke()}function setFont(e,t,s,i,r="left",o="normal"){e.textAlign=r,e.textBaseline="middle",e.fillStyle=i,e.font=`${o} ${s}px "${t}"`}function drawCircle(e,t,s,i,r){e.beginPath(),e.arc(t,s,i,0,2*xd),e.fillStyle=r,e.fill()}function drawNodeQuantitativeIndicator(e,t,s,i,r,o,a,l){const d=.7*e.fontSize,h=3*d,u=(d+h)/2,c=s+e.innerMargin+h,m=c+h+e.innerMargin,p=i+2*h-.5*e.innerMargin,y=e.circleStrokeWidth;for(const e of[d,u,h])drawCircleSizeIndicator(t,c,p-e,e,l,y);setFont(t,e.fontFamily,e.fontSize,e.fontColor,"left"),t.fillText(numberToText(r),m,p+d-2*d),t.fillText(numberToText(o),m,p+d-2*u),t.fillText(numberToText(a),m,p+d-2*h)}function drawEdgeQuantitativeIndicator(e,t,s,i,r,o,a,l){const d=(e.widgetWidth-2*e.innerMargin)/3,h=e.fontSize,u=i-e.innerMargin/2,c=u+2*h,m=s+e.innerMargin;t.fillStyle=l,t.fillRect(m,u-h/2,d+1,h),t.fillRect(m+d,u-h/3,d+1,h/1.5),t.fillRect(m+2*d,u-h/6,d,h/3),setFont(t,e.fontFamily,e.fontSize,e.fontColor,"center"),t.fillText(numberToText(a),m+.5*d,c),t.fillText(numberToText(o),m+1.5*d,c),t.fillText(numberToText(r),m+2.5*d,c)}function computeWidgetHeight(e,t,s,i){const r=i.outerMargin+initialOffsetY(i),o=i.fontSize*Md,a=r-.8*i.innerMargin;return"radius"===t||"width"===t?a+o*(s?3:2):a+Object.keys(e).length*o}function drawWidgetList(e,t,s){const i={width:t.width,height:t.height};let r=!1;return!!(i.width&&i.height&&s)&&(r="top"===e.position||"bottom"===e.position?function computeHorizontalLayout(e,t,s,i){s=s.slice();const r=t.widgetWidth+t.outerMargin,o=Math.floor((e.width-t.outerMargin)/r),a=e.height-t.outerMargin,l=new Array(Math.min(o,s.length)),d=s.length;let h=0,u=0,c=0,m=0;for(let e=0;e<d;++e){const t=s[e];t.isNode?(h+=1,u+=t.height):(c+=1,m+=t.height)}const p=u+m,y=u/p,x=m/p;let b=Math.round(y*o);const v=Math.round(x*o);b>h?b=h:v>c&&(b=o-c);if(0===o)return!1;for(let e=0;e<l.length;e++)l[e]={content:[],height:0,isNode:e<b};for(let e=0;e<d;++e){const e=largestWidgetIndex(s);addWidgetToColumns(s[e],l,t),s.splice(e,1)}l.every((({content:e})=>1===e.length))?l.sort(SORT_BY_TITLE):l.sort(SORT_BY_HEIGHT);let E=t.outerMargin;for(let s=0;s<l.length;++s){const o=l[s];if(o.height>a)return!1;o.content.sort(SORT_WIDGETS_FUNC);let d=0;for(let s=0;s<o.content.length;++s){const r=o.content[s];r.x=E,r.y=i?e.height-d-r.height-t.outerMargin:d+t.outerMargin,d+=r.height+t.outerMargin}E+=r}return!0}(i,e,s,"bottom"===e.position):function computeVerticalLayout(e,t,s,i){const r=t.widgetWidth+t.outerMargin,o=Math.floor((e.width-t.outerMargin)/r),a=e.height;let l=t.outerMargin,d=i?t.outerMargin:e.width-r,h=1;s=s.slice().sort(SORT_WIDGETS_BY_TITLE);for(let e=0;e<s.length;++e){const o=s[e];if(l+o.height>a){if(l===t.outerMargin)return!1;l=t.outerMargin,h+=1,i?d+=r:d-=r}o.x=d,o.y=l,l+=o.height}return h<=o}(i,e,s,"left"===e.position),r&&s.forEach((s=>drawWidget(e,t,s))),r)}function addWidgetToColumns(e,t,s){let i=null;for(let s=0;s<t.length;++s){const r=t[s];r.isNode!==e.isNode&&1!==t.length||!(null===i||r.height<t[i].height)||(i=s)}if(null!=i){const r=t[i];r.content.push(e),r.height+=e.height+s.outerMargin}}function largestWidgetIndex(e){let t=0;for(let s=1;s<e.length;++s)e[s].height>e[t].height&&(t=s);return t}var Od=class extends Ds{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("newFrame",(()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()})).on(["resize","reloadFonts"],(()=>{this._mustRefresh=!0}))}enable(e={}){const t=this._settings;return this._settings=__spreadValues(__spreadValues({},Dd),e),this._mustRefresh=!this._enabled||!this._sameOptions(t,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((e=>{this._drawOnCanvas(this._settings,e.canvas,Re());const t=this._promises;this._promises=[],t.forEach((e=>e())),this._mustRefresh=!1}),{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise((e=>this._promises.push(e)))}_formatSettings(e,t){const s=__spreadValues(__spreadValues({},Dd),e);return Rd.forEach((e=>s[e]*=t)),s}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings=__spreadValues({},Dd),this._promises=[]}getOptions(){return this._enabled?__spreadValues({},this._settings):__spreadValues({},Dd)}getCurrentOptions(){return this._settings}_sameOptions(e,t){return e===t||Object.keys(e).reduce(((s,i)=>s&&e[i]===t[i]),!0)}_drawOnCanvas(e,t,s){const i=this._formatSettings(e,s);drawWidgetList(i,t,this._computeWidgetList(i))}exportOnCanvas(e,t,s){return this._drawOnCanvas(t,e,s)}export(e={}){const{width:t,height:s}=__spreadValues(__spreadValues({},this._modules.camera.getSize()),e),i=Re(),r=createCanvas(t*i,s*i);return this._drawOnCanvas(e,r,i),Promise.resolve().then((()=>r))}_computeWidgetList(e){const t=[];return yd.forEach((({name:s,isNode:i})=>{const r=this._computeWidget(e,s,i);r&&t.push(r)})),t}_computeWidget(e,t,s){const i=this._computePropertyMapping(e,t,s);if(i){if("icon.content"!==t)return i;const e=this._getRulesForAttribute(s,"icon.font"),r=this._getRulesForAttribute(s,"icon.style");let o=null,a=null;if(e.length||(o="Arial",a="normal"),"string"==typeof e[0]&&(o=e[0],a=r[0]),o&&a)return i.iconFont=o,i.iconFontStyle=a,i}return null}_computePropertyMapping(e,t,s){const[i]=this._getRulesForAttribute(s,t),r=i&&i.mapping,o=r&&r.getValues(s);if(r&&o){const i=r.getField(),a={};return forEach(o,((e,t)=>{void 0!==e&&"undefined"!==t&&(a[e]=a[e]||[],a[e].push(t))})),0===Object.keys(a).length?null:{isNode:s,title:e.titleFunction(i,t),styleProperty:t,dataProperty:i,mapping:a,height:computeWidgetHeight(a,t,s,e)}}return null}_getRulesForAttribute(e,t){return this._modules.styleRules.getRuleList().map((s=>{const i=s.getDefinition();return getProperty(e?i.nodeAttributes:i.edgeAttributes,t)})).filter(idenitity).sort(((e,t)=>e.mapping&&t.mapping?0:e.mapping?-1:1))}},Bd={layer:3,outerStroke:{color:"red",width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:uo,minVisibleSize:0}},jd={layer:3,color:"red",text:{backgroundColor:uo,minVisibleSize:0}},Vd=150,Ud="quadradicOut",Gd=class extends Ds{constructor(){super(...arguments),this._delay=16,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({updatesPositions:e})=>{e&&this._hovered&&this._modules.graphics.isMoving(this._hovered)&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();const e=this._modules.captor.getPointedElement();e&&this._hover(e)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}_setAnimationOptions(e){this._animationOptions={duration:void 0!==(null==e?void 0:e.duration)?e.duration:Vd,easing:void 0!==(null==e?void 0:e.easing)?e.easing:Ud},null==e||delete e.duration,null==e||delete e.easing}setRate(e){return this._delay=e,this}replaceNullColor(e,t){e&&null===getProperty(e,t)&&setProperty(e,t,this._modules.settings.get("backgroundColor"))}updateNodeAttributes(e,t){this._setAnimationOptions(e),this.replaceNullColor(e,"text.backgroundColor"),this._hoverClass.update({nodeAttributes:e,fullOverwrite:t}),this._hoverExtremityHighlightedClass.update({nodeAttributes:e,fullOverwrite:t}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(e,t){this.replaceNullColor(e,"text.backgroundColor"),this.replaceNullColor(e,"text.secondary.backgroundColor"),this._setAnimationOptions(e),this._hoverClass.update({edgeAttributes:e,fullOverwrite:t}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._setAnimationOptions(null),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:Ws,isBuiltin:!0,nodeAttributes:Bd}),this._hoverClass=this._modules.classes.createClass({name:Gs,isBuiltin:!0,nodeAttributes:Bd,edgeAttributes:jd}),this._modules.events.on("mouseover",(({target:e})=>e&&this._hover(e))).on("mouseout",(({target:e})=>e&&this._unhover(e))).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",((value,e)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(value))})),this._modules.settings.register("cursor.edge","pointer",((value,e)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(value))})),this._modules.settings.register("nodeHover",!0,(value=>{!value&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)})),this._modules.settings.register("edgeHover",!0,(value=>{value||!this._hovered||this._hovered.isNode||this._unhover(this._hovered)}))}_updateExtremityHighlightLayer(){const e=this._hoverClass.getDefinition().edgeAttributes,t=e?e.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:t},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(e){const t=e.isNode?"nodeHover":"edgeHover";this._modules.settings.get(t)&&e&&(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout((()=>{this._setElementHighlight(!0,e),this._timeout=null}),this._delay))}_unhover(e){this._removeTimeout(),this._hovered===e&&(this._setElementHighlight(!1,e),this._hoverExtremityHighlightedClass.clearNodes(),this._hovered=null)}_setElementHighlight(e,t){const s=this._modules.settings.get(t.isNode?"cursor.node":"cursor.edge");if(e?(this._modules.graphics.addCursorStyle(s),t.addClass(Gs,this._animationOptions),this._hovered=t):(this._modules.graphics.removeCursorStyle(s),t.removeClass(Gs,this._animationOptions)),t.isNode){const s=this._modules.graph.getAttribute(t.isNode,"textHidden"),i=t._index;e&&(this._hoveredTextHidden=0!==s.get(i));const value=!e&&this._hoveredTextHidden;s.set(i,value)}else this._hoverExtremityHighlightedClass.clearNodes(),e&&t.getExtremities().addClass(Ws,this._animationOptions)}},Wd=class extends Ds{constructor(){super(...arguments),this.x=0,this.y=0}},Hd=class{constructor(e,t){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=t,this._field=e,this._assignedRules=[]}getValue(e,t){const s=e.isNode,i=s?this._nodeMapping:this._edgeMapping;i.valid||(i.values=this._computeMapping(s),i.valid=!0);const r=e.getData(this._field);return Array.isArray(r)?"color"===t?r.map((e=>i.values[e])):i.values[r[0]]:i.values[r]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(e){return e?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(e){return this._assignedRules.find((t=>t===e))}getAssignedRules(){return this._assignedRules.slice()}assignTo(e){this.isAssignedTo(e)||this._assignedRules.push(e)}unAssignTo(e){this._assignedRules=this._assignedRules.filter((t=>t!==e))}};function getDataValueList(e,t,s){const i=(t?e.getNodes():e.getEdges()).getData(s),r={};return i.forEach((value=>{if(!Array.isArray(value))return r[value]=1;value.forEach((e=>r[e]=1))})),"undefined"in r&&delete r[void 0],Object.keys(r).sort()}function createQualitativeMapping(e,t,s,i){const{values:r={},fallback:o}=s,a=getDataValueList(e,i,t),l={};let d=0;for(let e=0;e<a.length;++e){const value=a[e];value in r?l[value]=r[value]:(l[value]=o[d],d=(d+1)%o.length)}return l}function createQuantitativeMapping(e,t,s,i){const{fallback:r,stops:o={},values:a,reverse:l}=s,d=getDataValueList(e,i,t);let h=1/0,u=-1/0;for(let e=0;e<d.length;e++){const value=+d[e];isNumber2(value)&&(h=Math.min(h,value),u=Math.max(u,value),d[e]=value)}const c={};if(!isFinite(h)){for(let e=0;e<d.length;e++)c[d[e]]=r;return c}const m=function createSlices(e,{nbSlices:t,minValue:s,maxValue:i}){if(Array.isArray(e))return e.slice();const{min:r=s,max:o=i}=e,a=(o-r)/t,l=[];for(let e=1;e<t;++e)l.push(r+a*e);return l}(o,{nbSlices:Array.isArray(a)?a.length:a.nbSlices,minValue:h,maxValue:u}),p=function generateOutput(e,t){if(Array.isArray(e))return e;const{min:s,max:i}=e,r=t.length+1,o=(i-s)/t.length,a=[];for(let e=0;e<r;e++)a.push(s+e*o);return a}(a,m);l&&p.reverse();for(let e=0;e<d.length;++e){const value=d[e];if(isFinite(value)){let e=0;for(;e<m.length&&m[e]<=value;)e+=1;c[value]=p[e]}else c[value]=r}return c}var qd=class extends Ds{constructor(){super(...arguments),this._mappingList=[]}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],(({rule:e,options:t})=>{[...getValues(t.nodeAttributes||{}),...getValues(t.edgeAttributes||{})].forEach((t=>{t&&this._recursiveGetMapping(t).forEach((t=>t.assignTo(e.id)))}))})).on("removeStyleRule",(({rule:e})=>{this._mappingList.forEach((t=>t.unAssignTo(e.id)))})).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],(()=>{this._mappingList.forEach((e=>{const t=e.getAssignedRules();e.markAsInvalid(),t.forEach((e=>this._modules.styleRules.refreshRule(e)))})),this._modules.legend.refresh()}))}_recursiveGetMapping(e,t=[]){if(!e)return t;if(e.mapping)return t.push(e.mapping),t;if("object"!=typeof e)return t;const s=getValues(e).map((e=>this._recursiveGetMapping(e)));return t.concat(...s)}createMapping({field:e,values:t={},fallback:s}={field:""}){if(e=toPropertyPath(e),Array.isArray(s)?0===s.length&&(s=[void 0]):s=[s],!isRawObject(t))throw new Error('"mapping" should be an object');return this._createMappingFunction(createQualitativeMapping,e,{values:t,fallback:s})}createSlices({field:e,fallback:t,stops:s={},values:i,reverse:r=!1}={field:"",values:[]}){if(e=toPropertyPath(e),Array.isArray(i)||i.nbSlices||(i.nbSlices=7),Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction(createQuantitativeMapping,e,{fallback:t,stops:s,values:i,reverse:r})}_createMappingFunction(e,t,s){const i=new Hd(t,(i=>e(this._modules.graph,t,s,i)));this._mappingList.push(i);const func=(e,t,s)=>i.getValue(e,s);return func.mapping=i,func}createTemplate(e){if("string"!=typeof e)throw new TypeError('"template" should be a string');const t=[];let s=0,i=!1;for(;!i;){let r=-1;const o=e.indexOf("{{",s);-1!==o&&(r=e.indexOf("}}",o+2)),-1!==r?(t.push(e.substring(s,o)),t.push(e.substring(o+2,r)),s=r+2):(t.push(e.slice(s)),i=!0)}return function(e){let s=t[0];for(let i=1;i<t.length;i+=2)s+=e.getData(t[i]),s+=t[i+1];return s}}},Xd=class{constructor({duration:e,enabled:t}){this._duration=e||0,this._removalDuration=e||0,this.enabled=!1,this.shouldUndo=!1,this.destroyed=!1,this.shouldDo=!1!==t,this.shouldAnimate=this.shouldDo,this._error=null,this._whenApplied=new Promise(((e,t)=>{this._resolveFunction=e,this._rejectFunction=t}))}getDuration(){return this._duration}getAnimationDuration(e=!0){return this.shouldAnimate?e?this._duration:this._removalDuration:0}setDuration(e){void 0!==e&&(this._duration=e)}getRemovalDuration(){return this._removalDuration}setRemovalDuration(e){void 0!==e&&(this._removalDuration=e)}getContext(){return this._context}setContext(e){this._context=e}getError(){return this._error}setError(e){this._error=e}getOgma(){return this._ogma}resolve(){this._resolveFunction(this)}reject(){const e=this._error;return this._error=null,this._rejectFunction(e)}getName(){throw new Error("type not set")}getId(){return this._id}whenApplied(){return this._whenApplied}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}initialize({id:e,ogma:t}){this._id=e,this._ogma=t,this.resetContext()}enable(e){return this._ogma.modules.transformations.enable(this,e||0)}disable(e){return this._ogma.modules.transformations.disable(this,e||0)}toggle(e){return this.enabled?this.disable(e):this.enable(e)}getIndex(){return this._ogma.modules.transformations.getIndex(this)}setIndex(e){return this._ogma.modules.transformations.setIndex(this,e).then((()=>this))}setOptions(e){return this._ogma.modules.transformations.setOptions(this,__spreadValues({duration:this._duration,enabled:this.enabled},e)).then((()=>this))}_setOptions(e){this._duration=void 0===e.duration?this._duration:e.duration}destroy(e){return this.destroyed=!0,this._ogma.modules.transformations.remove(this,e||0)}refresh(){return this._ogma.view.afterNextFrame().then((()=>this._refresh()))}_refresh(){return this._ogma.modules.transformations.refresh(!0)}resetContext(){this._context={virtualNodes:this._ogma.nodeList(),virtualEdges:this._ogma.edgeList()}}run(){throw new Error("run function not implemented")}cleanup(){throw new Error("cleanup function not implemented")}undo(){throw new Error("undo function not implemented")}onClearGraph(){this.resetContext()}},$d=class extends Xd{constructor(e){super(e),this._getNodesToFilter=e.getNodesToFilter,this._getEdgesToFilter=e.getEdgesToFilter}run(){const e=this._ogma,t=this.getAnimationDuration(),s=this._getNodesToFilter(e),i=this._getEdgesToFilter(e,s);return Promise.all([s.addClass(Qs,t),i.addClass(Qs,t)]).then((()=>(s.setExcluded(!0),i.setExcluded(!0),__spreadProps(__spreadValues({},this._context),{nodes:s,edges:i}))))}undo(){const e=this.getAnimationDuration(),{nodes:t,edges:s}=this._context;return t.setExcluded(!1),s.setExcluded(!1),t.addClass(Qs),s.addClass(Qs),Promise.all([t.removeClass(Qs,e),s.removeClass(Qs,e)])}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{nodes:this._ogma.nodeList(),edges:this._ogma.edgeList()})}cleanup(){return Promise.resolve()}get context(){return this._context}},Yd=class extends $d{constructor(e){super(__spreadProps(__spreadValues({},e),{getNodesToFilter:e=>e.createNodeList(),getEdgesToFilter:t=>t.getEdges().filter((t=>!e.criteria||!e.criteria(t)))}))}getName(){return"edge-filter"}_setOptions(e){super._setOptions(e),this._getEdgesToFilter=t=>t.getEdges().filter((t=>!e.criteria||!e.criteria(t)))}},Zd=class extends $d{constructor(e){const t=e.criteria;super(__spreadProps(__spreadValues({},e),{getNodesToFilter:e=>e.getNodes().filter((e=>!t||!t(e))),getEdgesToFilter:(e,t)=>t.getAdjacentEdges()}))}getName(){return"node-filter"}_setOptions(e){super._setOptions(e);const t=e.criteria;this._getNodesToFilter=e=>e.getNodes().filter((e=>!t||!t(e)))}},Qd=class extends Ds{addNodeFilter(e){return"object"!=typeof e&&(e={criteria:e,enabled:!0,duration:0}),this._modules.transformations.add(new Zd(e))}addEdgeFilter(e){return"object"!=typeof e&&(e={criteria:e,enabled:!0,duration:0}),this._modules.transformations.add(new Yd(e))}},stopPropagation=e=>e.stopPropagation(),appendDomChild=(e,t)=>{t.style.position="absolute",t.style.left="0",t.style.top="0",e.appendChild(t)},Kd=class extends Ds{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(e,t,s,i)=>{const r=i&&i.pixelRatio?i.pixelRatio:Re(),{zoom:o,x:a,y:l,width:d,height:h}=i||this._modules.camera.getView();if(void 0===o||void 0===a||void 0===l||void 0===d||void 0===h)return null;const u=r*o;s.noClear||e.clearRect(0,0,d*r,h*r),s.isStatic||(e.save(),e.translate(d*r/2,h*r/2),e.rotate(i?-(i.angle||0):-this._modules.camera.getAngle()),e.translate(-a*u,-l*u),e.scale(u,u)),t(e),s.isStatic||e.restore()},this.createCanvas=(e,t)=>{const{width:s,height:i}=this._modules.camera.getSize(),r=t.canvas||createCanvas(s,i),o=t.ctx||r.getContext("2d"),_render=(s=e)=>{o&&this.render(o,s,t)},_resize=()=>{const{width:e,height:t}=this._modules.camera.getSize(),s=Re();r.width=e*s,r.height=t*s,r.style.width=`${e}px`,r.style.height=`${t}px`,_render()};let a,l;if(t.isStatic)this._modules.dom.addDirectWindowEventListener("resize",_resize),a=()=>{this._modules.dom.removeDirectWindowEventListener("resize",_resize)};else{let e=this._modules.camera.getCenter(),t=this._modules.camera.getZoom(),s=!1;const i=0;let o;const d=500,startTransformation=()=>{s||(_render(),s=!0,e=this._modules.camera.getCenter(),t=this._modules.camera.getZoom())},updateTransformation=()=>{s||startTransformation();const{x:i,y:o}=this._modules.camera.getCenter(),a=i-e.x,l=o-e.y,d=-a*t,h=-l*t,u=this._modules.camera.getZoom()/t,c=-this._modules.camera.getAngle();r.style.transform=`\n          scale(${u})\n          rotate(${-c}rad)\n          translateX(${d}px)\n          translateY(${h}px)\n          rotate(${c}rad)\n        `.replace(/\n/g,"")};l=()=>!s||(_render(),s=!1,r.style.transform="scale(1) translateX(0px) translateY(0px)",!1);const onDragStart=e=>{o&&clearTimeout(o),startTransformation()},onZoomStart=e=>{Date.now()<i&&o&&clearTimeout(o),o=setTimeout(l,e.duration+d),startTransformation()};this._modules.events.on("dragStart",onDragStart).on("zoomStart",onZoomStart).on("dragEnd",l).on(["viewChanged","zoom","rotate","move","animate"],updateTransformation),this._modules.dom.addDirectWindowEventListener("resize",l),this._modules.dom.addDirectWindowEventListener("resize",_resize),this._modules.events.on("resize",_resize),a=()=>{this._modules.events.off(_resize).off(onDragStart).off(onZoomStart).off(l).off(updateTransformation),this._modules.dom.removeDirectWindowEventListener("resize",l),this._modules.dom.removeDirectWindowEventListener("resize",_resize)}}return r.style.touchAction="none",r.style.pointerEvents="none",_resize(),{element:r,removeListeners:a,refresh:e=>{l&&!l()||_render(e)},clear:()=>null==o?void 0:o.clearRect(0,0,r.width,r.height)}},this.createSVG=e=>{const{element:t}=e;t.style["pointer-events"]="none";const redraw=()=>{e.draw(e.element)},updateTransformation=e=>{let{zoom:s,x:i,y:r,width:o,height:a}=e||this._modules.camera.getView();if(o=Math.floor(o),a=Math.floor(a),void 0===s||void 0===i||void 0===r||void 0===o||void 0===a)return null;const l=o/2/s,d=a/2/s,h=-this._modules.camera.getAngle(),u=i-l,c=r-d,m=o/s,p=a/s;t.style.width=`${o}px`,t.style.height=`${a}px`,t.setAttribute("width",`${o}`),t.setAttribute("height",`${a}`),t.setAttribute("viewBox",`${u} ${c} ${m} ${p}`),t.setAttribute("transform",`rotate(${180*h/Math.PI})`)};this._modules.events.on(["viewChanged","zoom","rotate","move","animate"],(()=>updateTransformation()));return t.addEventListener("mousemove",stopPropagation),updateTransformation(),redraw(),{element:t,removeListeners:()=>{this._modules.events.off(updateTransformation)},updateTransformation,refresh:redraw}},this._createOverlay=e=>{const updateTransformation=()=>{const{element:t,position:s}=e,{zoom:i,x:r,y:o,width:a,height:l}=this._modules.camera.getView();if(void 0===i||void 0===r||void 0===o||void 0===a||void 0===l)return null;const d=i,h=a/2,u=l/2,c=-this._modules.camera.getAngle(),m=(s.x-r)*d,p=(s.y-o)*d;t.style.transformOrigin="top left",t.style.transform=`translate(${h}px, ${u}px) rotate(${c}rad) translate(${m}px, ${p}px) ${e.scaled?`scale(${d}, ${d})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate"],updateTransformation);const{element:t,size:s}=e;return s&&(t.style.width=`${s.width}`,t.style.height=`${s.height}`),t.addEventListener("mousemove",stopPropagation),updateTransformation(),{element:t,removeListeners:()=>{this._modules.events.off(updateTransformation)},updateTransformation}},this.addLayer=(e,t="layer",s=this._elements.length)=>{const i="string"==typeof e?createElement(e):e;this._elements.push(i);const r={element:i};return r.type=t,r.getLevel=()=>this._elements.indexOf(i),r.moveTo=e=>(this._elements.splice(e,0,this._elements.splice(r.getLevel(),1)[0]),this._updateDom(this._elements),r),r.moveUp=()=>r.moveTo(r.getLevel()+1),r.moveDown=()=>r.moveTo(r.getLevel()-1),r.moveToTop=()=>r.moveTo(this._elements.length-1),r.moveToBottom=()=>r.moveTo(0),r.destroy=()=>this._removeLayer(r),r.hide=()=>(r.element&&(r.element.style.visibility="hidden"),r),r.show=()=>(r.element&&(r.element.style.visibility="visible"),r),r.isHidden=()=>"hidden"===r.element.style.visibility,r.setOpacity=e=>(r.element&&(r.element.style.opacity=e.toString()),r),r.getOpacity=()=>parseFloat(r.element.style.opacity||"1"),r.setPosition=e=>{if(r.element){const t=r.element.style;t.left=`${e.x}px`,t.top=`${e.y}px`}return r},r.setSize=e=>{if(r.element&&e){const{width:t,height:s}=e,i=r.element.style;i.width=`${t}px`,i.height=`${s}px`}return r},r.moveTo(s),this._layers.push(r),r},this.addCanvasLayer=(e,t={isStatic:!1,noClear:!1},s=this._elements.length)=>{const i=this.createCanvas(e,t),{element:r,removeListeners:o,refresh:a,clear:l}=i,d=this.addLayer(r,"canvas",s);return r.classList.add("ogma-canvas-layer"),d.destroy=()=>this._removeLayer(d,o),d.refresh=a,d.clear=l,d.draw=e,d.options=t,d},this.addOverlay=(e,t=this._elements.length)=>{"string"==typeof e.element&&(e.element=createElement(e.element)),e.scaled=void 0===e.scaled||e.scaled;const s=this._createOverlay(e),{element:i,removeListeners:r,updateTransformation:o}=s,a=this.addLayer(i,"overlay",t);return a._onViewChange=o,a._onDestroy=r,a.destroy=()=>this._removeLayer(a,r),a.setPosition=t=>(e.position=t,o(),a),e.size&&a.setSize(e.size),a},this.addSVGLayer=(e,t=this._elements.length)=>{const s=this.createSVG(e),{element:i,refresh:r,removeListeners:o,updateTransformation:a}=s,l=this.addLayer(i,"svg",t);return l._onViewChange=a,l._onDestroy=o,l.destroy=()=>this._removeLayer(l,o),l.refresh=r,l}}canvasToImage(e,t){const s=document.createElement("canvas");s.width=t.width,s.height=t.height;const i=s.getContext("2d");this.render(i,e.draw,__spreadProps(__spreadValues({},e.options),{noClear:!0}),__spreadProps(__spreadValues({},t),{pixelRatio:1}));const r=document.createElementNS("http://www.w3.org/2000/svg","image");return r.setAttribute("href",s.toDataURL("image/png")),r.setAttribute("width",s.width),r.setAttribute("height",s.height),r}exportPNG(e,t,s){const i=e.getContext("2d");let r=Promise.resolve();return t.forEach((e=>{r=r.then((()=>"canvas"===e.type?(this.render(i,e.draw,__spreadProps(__spreadValues({},e.options),{noClear:!0}),s),Promise.resolve()):(e._onViewChange&&e._onViewChange(s),((e,t)=>{const s=document.createElement("img");return new Promise((i=>{s.addEventListener("load",(()=>{t.drawImage(s,0,0,t.canvas.width,t.canvas.height),i(t)}));const r=`data:image/svg+xml;base64,${btoa((new XMLSerializer).serializeToString(e))}`;s.src=r}))})(e.element,i))))})),r}exportSVG(e,t,s,i){let r=Promise.resolve();return t.forEach((t=>{r=r.then((()=>"canvas"===t.type?Promise.resolve(this.canvasToImage(t,s)):(t._onViewChange&&t._onViewChange(s),t.element.cloneNode(!0)))).then((t=>i?e.insertBefore(t,e.querySelector(".ogma-nodes").parentNode||e.firstChild):e.appendChild(t)))})),r}export(e){const t=this._layers.sort(((e,t)=>e.getLevel()-t.getLevel())).filter((e=>"canvas"===e.type||"svg"===e.type)),s=this.ogmaLayer?this.ogmaLayer.getLevel():0,i=e.below?t.filter((e=>e.getLevel()<s)):t.filter((e=>e.getLevel()>s));return e.canvas?this.exportPNG(e.canvas,i,e.view):this.exportSVG(e.svg,i,e.view,e.below)}onMounted(){const e=this._modules.graphics.getDomElement();var t;this._updateDom=(t=e,e=>{for(;t.firstChild;)t.removeChild(t.firstChild);for(let s=0;s<e.length;++s)appendDomChild(t,e[s])});const s=e.firstChild;s&&(this.ogmaLayer=this.addLayer(s)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach((e=>e())),this.readyCallbacks=[])}whenReady(e){this.readyCallbacks.push(e),this.ogmaLayer&&this.runCallbacks()}_removeLayer(e,t){return e.element&&e.element.parentNode&&(this._elements.splice(e.getLevel(),1),t&&t(),e.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter((t=>t!==e)),e}destroy(){this._elements=[]}},Jd=class extends Ds{onMounted(){const e=this._modules.graph;this._nodeList=e.getNodeAttribute("object"),this._edgeList=e.getEdgeAttribute("object"),this._sourceList=e.getEdgeAttribute("source"),this._targetList=e.getEdgeAttribute("target"),this._excludedList=e.getEdgeAttribute("excluded"),this._virtualList=e.getEdgeAttribute("virtual")}shortestPath(e={source:void 0,target:void 0}){const{source:t,target:s,directed:i=!1,edges:r=this._ogma.getEdges(),nodes:o=this._ogma.getNodes(),edgeCostFunction:a=(()=>1),heuristicFunction:l=(()=>0)}=e,d=r.reduce(((e,t)=>(e[t._index]=!0,e)),{}),h=o.reduce(((e,t)=>(e[t._index]=!0,e)),{}),u=this._modules.graph.getNode(t),c=this._modules.graph.getNode(s);if(!u)throw new Error("the source is not a node");if(!c)throw new Error("the target is not a node");const m=u._index,p=c._index;h[m]=!0,h[p]=!0;let y=null;if(m===p)y={nodes:u.toList(),edges:this._modules.graph.edgeList()};else{const e=this._modules.graph.getNodeMaxIndex()+1,t=new Int32Array(e),s=new Float32Array(e),r=new Float32Array(e),o=new Set,x=new es(r);for(s.fill(1/0),r.fill(1/0),t.fill(-1),x.add(m),s[m]=0,r[m]=l(u,c);!x.isEmpty();){const e=x.removeMin();if(e===p){y=this._constructPath(t,m,p);break}o.add(e);const u=this._modules.graph.getAdjacentDirections(e);if(u)for(let m=0;m<u.length;++m){const p=u[m],y=this._modules.graph.getEdgeIndexesInDirection(p);let b=-1,v=0,E=-1;for(let t=0;t<y.length;++t){const s=y[t],r=this._sourceList.get(s),o=this._targetList.get(s);if(r===o)continue;if(!h[r]||!h[o])continue;if(i&&e!==r)continue;if(!d[s])continue;const l=a(this._edgeList.get(s));(-1===b||l<v)&&(b=s,v=l,E=r===e?o:r)}if(-1!==E||o.has(E)){const i=s[e]+v;if(!x.has(E)||i<s[E]){const o=this._nodeList.get(e);t[E]=b,s[E]=i,r[E]=i+l(o,c),x.add(E)}}}}}return Promise.resolve(y)}_constructPath(e,t,s){const i=[s],r=[];let o=s;for(;o!==t;){const t=e[o],s=this._sourceList.get(t),a=this._targetList.get(t);o=o===s?a:s,i.push(o),r.push(t)}return i.reverse(),r.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(i)),edges:this._modules.graph.edgeList(new Uint32Array(r))}}detectCycle(e,t){const s=t.getSource(),i=t.getTarget(),r=detectCyclesDirected(e._indexes,s._indexes,i._indexes);return r?this._modules.graph.nodeList(new Uint32Array(r)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(e,t){const s=t.getSource(),i=t.getTarget();return new ks(e._indexes,s._indexes,i._indexes).getCycles().map((e=>this._modules.graph.nodeList(new Uint32Array(e))))}minimumSpanningTree(e,t,s){const i=this._modules.graph;e=i.getNodes(e),t=i.getEdges(t);const r=new Set;e.forEach((e=>r.add(e._index)));const o=i.getConnectedComponents(e,{filter:e=>r.has(e),internalIndexes:!0}),a={};o.forEach(((e,t)=>e.forEach((e=>a[e]=t))));const l=[];return t.forEach((e=>{const t=a[e.getSource()._index];void 0!==t&&(void 0===l[t]&&(l[t]=[]),l[t].push(e._index))})),o.map(((e,t)=>{const r=kruskal_default(e,l[t]||[],(e=>i.edge(e).getSource()._index),(e=>i.edge(e).getTarget()._index),s?e=>s(i.edge(e)):void 0);return{nodes:i.nodeList(new Uint32Array(e)),edges:i.edgeList(new Uint32Array(r))}}))}bfs({root:e,onNode:t,onEdge:s=noop,directed:i=!1}){const r=this._modules.graph,o=[e],a=new Set,l={direction:i?"out":"both"};for(;o.length;){const e=o.pop();if(a.has(e._index))continue;if(!0===t(e))return;a.add(e._index);r.getAdjacentEdges(e,l).forEach((t=>{if(!1===s(t))return;const i=t.getSource()===e?t.getTarget():t.getSource();o.unshift(i)}))}}dfs({root:e,onNode:t,onEdge:s=noop,directed:i=!1}){const r=this._modules.graph,o=[e],a=new Set,l={direction:i?"out":"both"};for(;o.length;){const e=o.pop();if(a.has(e._index))continue;if(!0===t(e))return;a.add(e._index);r.getAdjacentEdges(e,l).forEach((t=>{if(!1===s(t))return;const i=t.getSource()===e?t.getTarget():t.getSource();o.push(i)}))}}betweenness({nodes:e,edges:t,directed:s,normalized:i}){const r=this._ogma.getNodes().subtract(e),o=this._ogma.getEdges().subtract(t).concat(r.fastGetAdjacentElements().edges).dedupe();return betweennes({adjacency:e.map((e=>{const t=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,e.toList()._indexes,{direction:s?"out":"both"})).subtract(o).dedupe();return{id:e._index,adj:t.map((t=>t.getSource()._index===e._index?t.getTarget()._index:t.getSource()._index))}})),directed:s,normalized:i})}},validateTraversalInput=(e,t)=>{if(!e)throw new Error("Traversal options are required");if("function"!=typeof e.onNode)throw new Error("onNode callback is required");if(e.root=t.getNode(e.root),!e.root)throw new Error(`Root node '${e.root}' does not exist`);return e},eh=class extends p{constructor(){super(...arguments),this.shortestPath=e=>this._ogma.modules.algorithms.shortestPath(e),this.hasCycle=e=>{const{nodes:t,edges:s}=e||{nodes:void 0,edges:void 0};return null!==this.detectCycle({nodes:t,edges:s})},this.getAllSimpleCycles=e=>{let{nodes:t,edges:s}=e||{nodes:void 0,edges:void 0};return t||(t=this._ogma.getNodes()),s||(s=t.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(t,s)},this.detectCycle=e=>{let{nodes:t,edges:s}=e||{nodes:void 0,edges:void 0};t||(t=this._ogma.getNodes()),s||(s=t.getAdjacentEdges({bothExtremities:!0}));const i=this._ogma.modules.algorithms.detectCycle(t,s);return i.size?i:null},this.minimumSpanningTree=e=>{const{nodes:t,edges:s,edgeCostFunction:i}=e||__spreadProps(__spreadValues({},{nodes:void 0,edges:void 0}),{edgeCostFunction:void 0});return this._ogma.modules.algorithms.minimumSpanningTree(t,s,i)},this.dfs=e=>this._ogma.modules.algorithms.dfs(validateTraversalInput(e,this._ogma.modules.graph)),this.bfs=e=>this._ogma.modules.algorithms.bfs(validateTraversalInput(e,this._ogma.modules.graph)),this.betweenness=(e={})=>(e={nodes:e.nodes||this._ogma.getNodes(),edges:e.edges||this._ogma.getEdges(),directed:void 0!==e.directed&&e.directed,normalized:void 0===e.normalized||e.normalized},this._ogma.modules.algorithms.betweenness(e)),this.getMinimumEnclosingCircle=e=>{if(!e||0===e.size)throw new Error("getMinimumEnclosingCircle: no nodes provided");const t=e.getAttribute("x"),s=e.getAttribute("y"),i=e.getAttribute("radius"),[r,o,a]=minDisk(t,s,i);return{x:r,y:o,radius:a}},this.circlePack=({nodes:e,margin:t=0,origin:s={x:0,y:0},duration:i=0,easing:r="linear",sort:o})=>{if(!e||0===e.size)throw new Error("circlePack: no nodes provided");let a=e.map(((e,s)=>({index:s,radius:+e.getAttribute("radius")+t,id:e.getId()})));if(o)if("asc"===o)a=a.sort(((e,t)=>t.radius-e.radius));else if("desc"===o)a=a.sort(((e,t)=>e.radius-t.radius));else{if("function"!=typeof o)throw new Error("circlePack: invalid sort option");a=a.sort(((t,s)=>o(e.get(t.index),e.get(s.index))))}if(s&&(!isFinite(s.x)||!isFinite(s.y)))throw new Error("circlePack: invalid origin");const l=circlePack(a,s.x,s.y).reduce(((e,{index:t,x:s,y:i})=>(e[t]={x:s,y:i},e)),new Array(e.size));return e.setAttributes(l,{duration:i,easing:r})}}};var th=class extends p{constructor(){super(...arguments),this.enable=e=>this._ogma.modules.geo.enable(e),this.disable=e=>this._ogma.modules.geo.disable(e),this.setOptions=e=>this._ogma.modules.geo.setOptions(e),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=e=>this._ogma.modules.geo.setZoom(e),this.setView=(e,t,s)=>this._ogma.modules.geo.setView(e,t,s),this.setCenter=(e,t)=>this._ogma.modules.geo.setCenter(e,t),this.toggle=e=>this._ogma.modules.geo.toggle(e),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=e=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(e))}},sh=class extends p{constructor(){super(...arguments),this.isKeyPressed=e=>this._ogma.modules.keyboard.isPressed(e),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},ih=class extends p{addLayer(e,t){return this._ogma.modules.layers.addLayer(e,"layer",t)}addCanvasLayer(e,t,s){return this._ogma.modules.layers.addCanvasLayer(e,t,s)}addOverlay(e,t){if(!e.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(e,t)}addSVGLayer(e,t){return e.element||(e.element=document.createElementNS("http://www.w3.org/2000/svg","svg")),e.draw||(e.draw=()=>{}),this._ogma.modules.layers.addSVGLayer(e,t)}},nh={name:"concentric",configure:function(e,{graph:t,data:s}){if(void 0===e.centralNode)throw new Error('concentric layout: missing parameter "centralNode"');const i=__spreadProps(__spreadValues({},e),{centralNode:function getCentralNode(e,t){return t instanceof yi?t:e.getNode(t)}(t,e.centralNode)}),{centralNode:r,nodes:o}=i,a=t.getNode(r);if(void 0===a)throw new Error('concentric layout: "centralNode" parameter is not valid');const l=a._index,{x:d,y:h}=a.getPosition(),u=o.getAttribute("layoutable"),c=t.getNodes(o)._indexes,m=Array.from(c.filter(((e,t)=>u[t])));-1===m.indexOf(l)&&m.push(l);const p=t.getNodeAttribute("radius").getMultiple(c),y=function getSortingAttributes(e,t,s,i){if(t)return"random"===t?"random":"radius"===t?i.slice():"degree"===t?s.getDegree():e.getProperty(s,t)}(s,i.sortBy,o,p),x=m.reduce(((e,t,s)=>(e[t]=s,e)),{}),b=m.map(((e,t)=>t)),v=new Set(e.edges.getExtremities()._indexes),E=m.map((e=>t.topology.getAdjacentElements(!0,new Uint32Array([e])).filter((e=>v.has(e))).map((e=>x[e]))));return{sourceNodeIndex:m.indexOf(l),centerX:"number"==typeof i.centerX?i.centerX:d,centerY:"number"==typeof i.centerY?i.centerY:h,list:m,indexes:b,size:m.length,totalSize:m.length,attributes:{adjacentNodes:E,size:p},sortAttr:y,clockwise:void 0===i.clockwise||i.clockwise,circleHopRatio:i.circleHopRatio||5,allowOverlap:!!i.allowOverlap}},context:function(){return{dijkstra:function(e,t,s,i,r){const o=Math.pow(2,31)-1,a=new Int32Array(i),l=new Int32Array(i),d=new Int8Array(i);a.fill(o),l.fill(-1);for(let e=0;e<i;++e){const s=t[e];void 0!==s&&(a[s]=o,l[s]=-1)}a[r]=0;let h=0;for(;-1!==h;){let i=o;h=-1;for(let e=0;e<s;++e){const s=t[e],r=a[s];!d[s]&&r<i&&(i=r,h=s,d[s]=1)}if(h>-1){const t=e[h],s=i+1;t.forEach((e=>{const t=a[e];s<t&&(a[e]=s,l[e]=h)}))}}return a},determinePropertyType:function(e,t,s){return t.some((t=>"number"!==e[t]))?"string":"number"}}},update:function(e,t){const{attributes:s,indexes:i,size:r}=e,{sourceNodeIndex:o,centerX:a,centerY:l,sortAttr:d}=e,h=s.adjacentNodes,u=s.size,c=new Array(e.totalSize),m=new Array(e.totalSize),p=t.dijkstra(h,i,e.size,e.totalSize,o);let y=0;const x={};for(let e=0;e<r;e++){const t=u[i[e]];t>y&&(y=t)}const b=y*e.circleHopRatio;let v=0,E=0;const k=Math.PI/9;for(let e=0;e<r;e++){const t=i[e],s=p[t];let r=x[s];r||(r=[],x[s]=r),r.push(t)}const L=function getSortFunction(e,t,s){if("random"===e)return function(){return Math.random()-.5};if(e){return"number"===s.determinePropertyType(e,t,t.length)?function(t,s){return e[t]-e[s]}:function(t,s){return e[t]<e[s]?-1:1}}}(d,i,t),D="random"===d||d;return Object.keys(x).sort(((e,t)=>parseInt(e)-parseInt(t))).forEach(((t,s)=>{const i=x[t],r=i.length;let o=0,d=E;const h=2*Math.PI/r;if(0!==s&&!e.allowOverlap){const e=2*Math.PI*v;let t=0;o+=i.reduce(((e,t)=>e+u[t]),0),t=2*o*Math.SQRT2,t>e&&(v+=t/(2*Math.PI)-v)}D&&(i.sort(L),e.clockwise||i.reverse());for(let t=0;t<r;t++){const s=i[t];c[s]=Math.cos(d)*v+a,m[s]=Math.sin(d)*v+l;const p=u[s];d+=h*(e.allowOverlap?1:p/o*r)}v+=b,E+=k})),{x:c,y:m,indexes:e.list}},isRunning:function(){return!1},onSync:function({indexes:e,x:t,y:s}){return{indexes:e,x:t,y:s}}},rh=Object.defineProperty,oh=Object.defineProperties,ah=Object.getOwnPropertyDescriptors,lh=Object.getOwnPropertySymbols,dh=Object.prototype.hasOwnProperty,hh=Object.prototype.propertyIsEnumerable,uh=Math.pow,__defNormalProp2=(e,t,value)=>t in e?rh(e,t,{enumerable:!0,configurable:!0,writable:!0,value}):e[t]=value,__spreadValues2=(e,t)=>{for(var s in t||(t={}))dh.call(t,s)&&__defNormalProp2(e,s,t[s]);if(lh)for(var s of lh(t))hh.call(t,s)&&__defNormalProp2(e,s,t[s]);return e},__name=(e,value)=>rh(e,"name",{value,configurable:!0}),__export2=(e,t)=>{for(var s in t)rh(e,s,{get:t[s],enumerable:!0})},ch={};__export2(ch,{default:()=>attraction,initialize:()=>_h});var gh=class{constructor(e){let t=Mash();this.c=1,this.s0=t(" "),this.s1=t(" "),this.s2=t(" "),this.s0-=t(String(e)),this.s0<0&&(this.s0+=1),this.s1-=t(String(e)),this.s1<0&&(this.s1+=1),this.s2-=t(e),this.s2<0&&(this.s2+=1),t=null}next(){return()=>{const e=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=0|e)}}nextDouble(){const e=this.next();return()=>e()+11102230246251565e-32*(2097152*e()|0)}nextInt32(){const e=this.next();return()=>4294967296*e()|0}};function Mash(){let e=4022871197;return t=>{t=t.toString();for(let s=0;s<t.length;s++){e+=t.charCodeAt(s);let i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=4294967296*i}return 2.3283064365386963e-10*(e>>>0)}}function impl(e){return new gh(e.toString()).next()}__name(gh,"Alea"),__name(Mash,"Mash"),__name(impl,"impl");var mh=impl(42);function setSeed(e){mh=impl(e)}function randomize(){return 1e-6*(mh()-.5)}function attraction(e,t,{sources:s,targets:i,X:r,Y:o,R:a,fx:l,fy:d,degrees:h,weights:u},{edgeStrength:c,edgeLength:m}){for(let p=0;p<t.length;p++){const y=t[p],x=s[y],b=i[y],v=1,E=h[x]+v,k=h[b]+v,L=c*u[y];let D=r[b]+l[b]-r[x]-l[x]||randomize(),B=o[b]+d[b]-o[x]-d[x]||randomize();const H=D*D+B*B,X=Math.sqrt(H),Y=m+a[x]+a[b];if(X<=Y)continue;const Z=Y-X,oe=1/Math.min(E,k),de=Math.min(1,e*L*(Z*Z/H)*oe);D*=de,B*=de;const he=k/(k+E);l[x]+=D*he,d[x]+=B*he,l[b]-=D*(1-he),d[b]-=B*(1-he)}}__name(setSeed,"setSeed"),__name(randomize,"randomize"),__name(attraction,"attraction");var _h=__name(((e,{edgeIds:t,sources:s,targets:i,degrees:r,weights:o})=>{for(let a=0;a<e.length;a++){const{source:l,target:d,weight:h=1}=e[a];s[a]=l,i[a]=d,o[a]=h,r[l]++,r[d]++,t[a]=a,o[a]=void 0===h?1:h}}),"initialize");attraction.initialize=_h;var ph={};function shuffle(e){for(let t=e.length-1;t>=0;t--){let s=Math.floor(Math.random()*(t+1));s=Math.max(Math.min(s,t),0);const i=e[t];e[t]=e[s],e[s]=i}return e}__export2(ph,{default:()=>repulsion,initialize:()=>Oh}),__name(shuffle,"shuffle");var fh=__name((e=>e.x),"getX"),yh=__name((e=>e.y),"getY"),xh=__name((e=>e.r),"getR");function med(e,t=fh,s=yh,i=xh){const r=shuffle(e.slice()),o=r.length;let a,l=[],d=0;for(;d<o;){const e=r[d];a&&containsWeak(a,t(e),s(e),i(e))?d++:(l=extend(l,e,t,s,i),a=enclose(l,t,s,i),d=0)}return a}function extend(e,t,s,i,r){const o=s(t),a=i(t),l=r(t),d={x:o,y:a,r:l};if(containsWeakAll(d,e,s,i,r))return[t];for(let h=0;h<e.length;++h){const u=e[h],c=s(u),m=i(u),p=r(u);if(!contains(d,c,m,p)&&containsWeakAll(from2(c,m,p,o,a,l),e,s,i,r))return[e[h],t]}for(let d=0;d<e.length-1;d++)for(let h=d+1;h<e.length;h++){const u=e[d],c=e[h],m=s(u),p=i(u),y=r(u),x=s(c),b=i(c),v=r(c);if(!contains(from2(m,p,y,x,b,v),o,a,l)&&!contains(from2(m,p,y,o,a,l),x,b,v)&&!contains(from2(x,b,v,o,a,l),m,p,y)&&containsWeakAll(from3(m,p,y,x,b,v,o,a,l),e,s,i,r))return[e[d],e[h],t]}throw new Error}function contains(e,t,s,i){const r=e.r-i,o=t-e.x,a=s-e.y;return r>=0&&r*r>o*o+a*a}function containsWeak(e,t,s,i){const r=e.r-i+1e-6,o=t-e.x,a=s-e.y;return r>0&&r*r>o*o+a*a}function containsWeakAll(e,t,s,i,r){for(let o=0;o<t.length;++o){const a=t[o];if(!containsWeak(e,s(a),i(a),r(a)))return!1}return!0}function enclose(e,t,s,i){return 1===e.length?from1(t(e[0]),s(e[0]),i(e[0])):2===e.length?from2(t(e[0]),s(e[0]),i(e[0]),t(e[1]),s(e[1]),i(e[1])):from3(t(e[0]),s(e[0]),i(e[0]),t(e[1]),s(e[1]),i(e[1]),t(e[2]),s(e[2]),i(e[2]))}function from1(e,t,s){return{x:e,y:t,r:s}}function from2(e,t,s,i,r,o){const a=i-e,l=r-t,d=o-s,h=Math.sqrt(a*a+l*l);return{x:(e+i+a/h*d)/2,y:(t+r+l/h*d)/2,r:(h+s+o)/2}}function from3(e,t,s,i,r,o,a,l,d){const h=e-i,u=e-a,c=t-r,m=t-l,p=o-s,y=d-s,x=e*e+t*t-s*s,b=x-i*i-r*r+o*o,v=x-a*a-l*l+d*d,E=u*c-h*m,k=(c*v-m*b)/(2*E)-e,L=(m*p-c*y)/E,D=(u*b-h*v)/(2*E)-t,B=(h*y-u*p)/E,H=L*L+B*B-1,X=2*(s+k*L+D*B),Y=k*k+D*D-s*s,Z=-(H?(X+Math.sqrt(X*X-4*H*Y))/(2*H):Y/X);return{x:e+k+L*Z,y:t+D+B*Z,r:Z}}__name(med,"med"),__name(extend,"extend"),__name(contains,"contains"),__name(containsWeak,"containsWeak"),__name(containsWeakAll,"containsWeakAll"),__name(enclose,"enclose"),__name(from1,"from1"),__name(from2,"from2"),__name(from3,"from3");var bh=[0,1],vh=[0,2];for(let e=4;e<65535;e<<=2)for(let t=0,s=bh.length;t<s;t++)bh.push(bh[t]|e),vh.push((bh[t]|e)<<1);function morton2(e,t){return(vh[255&t]|bh[255&e])+65536*(vh[t>>8&255]|bh[e>>8&255])+4294967296*(vh[t>>16&255]|bh[e>>16&255])}function hilbert(e,t){let s=e^t,i=65535^s,r=65535^(e|t),o=e&(65535^t),a=s|i>>1,l=s>>1^s,d=r>>1^i&o>>1^r,h=s&r>>1^o>>1^o;s=a,i=l,r=d,o=h,a=s&s>>2^i&i>>2,l=s&i>>2^i&(s^i)>>2,d^=s&r>>2^i&o>>2,h^=i&r>>2^(s^i)&o>>2,s=a,i=l,r=d,o=h,a=s&s>>4^i&i>>4,l=s&i>>4^i&(s^i)>>4,d^=s&r>>4^i&o>>4,h^=i&r>>4^(s^i)&o>>4,s=a,i=l,r=d,o=h,d^=s&r>>8^i&o>>8,h^=i&r>>8^(s^i)&o>>8,s=d^d>>1,i=h^h>>1;let u=e^t,c=i|65535^(u|s);return u=16711935&(u|u<<8),u=252645135&(u|u<<4),u=858993459&(u|u<<2),u=1431655765&(u|u<<1),c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),(c<<1|u)>>>0}__name(morton2,"morton"),__name(hilbert,"hilbert");var Ah=new Uint32Array(1024);function radixSort(e,t){const s=new Uint32Array(t.length);for(let e=0;e<1024;e++)Ah[e]=0;const i=255;for(let e=0;e<t.length;e++){const s=t[e];Ah[s&i]++,Ah[256+(s>>8&i)]++,Ah[512+(s>>16&i)]++,Ah[768+(s>>24&i)]++}for(let e=0;e<4;e++){let t=0,s=0;const i=256*e;for(let e=0;e<256;e++)t=Ah[e+i],Ah[e+i]=s,s+=t}for(let e=0;e<t.length;e++){const r=t[e];s[Ah[r&i]++]=e}for(let r=0;r<t.length;r++){const o=s[r],a=t[o];e[Ah[256+(a>>8&i)]++]=o}for(let r=0;r<t.length;r++){const o=e[r],a=t[o];s[Ah[512+(a>>16&i)]++]=o}for(let r=0;r<t.length;r++){const o=s[r],a=t[o];e[Ah[768+(a>>24&i)]++]=o}}__name(radixSort,"radixSort");var Sh=class{constructor(e,t,s,i){this.left=null,this.right=null,this.data=null,this.code=e,this.data=t,this.left=s,this.right=i}};function buildIterative(e,t,s,i,r){const o=new Sh(null,null,null,null),a=[o],l=[i,r];for(;0!==a.length;){const i=l.pop(),r=l.pop(),o=a.pop();if(i-r==0)o.code=s[r],o.data=e[t[r]];else{const e=findSplit(t,s,r,i);o.code=e,r<=e&&(o.left=new Sh(null,null,null,null),a.push(o.left),l.push(r,e)),i>e&&(o.right=new Sh(null,null,null,null),a.push(o.right),l.push(e+1,i))}}return o}function buildIterativeBuckets(e,t,s,i,r,o){const a=new Sh(null,null,null,null),l=[a],d=[i,r];for(;0!==l.length;){const i=d.pop(),r=d.pop(),a=l.pop();if(i-r<o){const o=new Array(i-r+1);for(let s=r,a=0;s<=i;s++,a++)o[a]=e[t[s]];a.code=s[r],a.data=o}else{const e=findSplit(t,s,r,i);a.code=e,r<=e&&(a.left=new Sh(null,null,null,null),l.push(a.left),d.push(r,e)),i>e&&(a.right=new Sh(null,null,null,null),l.push(a.right),d.push(e+1,i))}}return a}__name(Sh,"Node"),__name(buildIterative,"buildIterative"),__name(buildIterativeBuckets,"buildIterativeBuckets");var Eh=Math.clz32||__name((function clz(e){let t=1<<31;for(let s=0;s<31;s+=1){if(t&e)return s;t>>>=1}return 32}),"clz");function findSplit(e,t,s,i){const r=t[e[s]],o=t[e[i]];if(r===o)return s;const a=Eh(r^o);let l,d,h,u=s,c=i-s;do{c=c+1>>1,l=u+c,l<i&&(d=t[e[l]],h=Eh(r^d),h>a&&(u=l))}while(c>1);return u}__name(findSplit,"findSplit");var wh,Th,Ch,kh,Mh,Lh,Ih,Nh,Ph,Fh=class{constructor(e,{getX:t,getY:s,bucketSize:i=0,sfc:r=1}={}){this.bucketSize=0,this._root=null;const o=e.length,a=new Uint32Array(o);let l=1/0,d=1/0,h=-1/0,u=-1/0;this._x=t,this._y=s;const c=1===r?hilbert:morton2;this._project=c;const m=new Uint32Array(o);for(let i=0;i<o;i++){const r=e[i],o=t(r),a=s(r);o<l&&(l=o),a<d&&(d=a),o>h&&(h=o),a>u&&(u=a),m[i]=i}this._minX=l,this._minY=d,this._maxX=h,this._maxY=u;const p=65535/Math.max(h-l,1),y=65535/Math.max(u-d,1);this._hw=p,this._hh=y;for(let i=0;i<o;i++){const r=e[i];a[i]=c(p*(t(r)-l),y*(s(r)-d))}radixSort(m,a),this._root=0===i?buildIterative(e,m,a,0,o-1):buildIterativeBuckets(e,m,a,0,o-1,i),this.bucketSize=i}get root(){return this._root}inOrder(e,t){let s=this._root;const i=[];let r=!1;for(;!r;)if(s)i.push(s),s=s.left;else if(0!==i.length){if(s=i.pop(),e.call(t,s))break;s=s.right}else r=!0;return this}preOrder(e,t){const s=[this._root];for(;0!==s.length;){const i=s.pop();e.call(t,i)||(i.right&&s.push(i.right),i.left&&s.push(i.left))}return this}postOrder(e,t){const s=[];let i,r=this._root;do{for(;r;)r.right&&s.push(r.right),s.push(r),r=r.left;r=s.pop(),i=s.length-1,r.right&&s[i]===r.right?(s[i]=r,r=r.right):(e.call(t,r),r=null)}while(0!==s.length);return this}map(e,t){const s=[];return this.inOrder((i=>{s.push(e.call(t,i))})),s}height(){return treeHeight(this._root)}toString(e=(e=>e.code.toString())){const t=[];return row(this._root,"",!0,(e=>t.push(e)),e),t.join("")}size(){let e=0;return this.preOrder((()=>{e++})),e}destroy(){return this._root=null,this}};function treeHeight(e){return e?1+Math.max(treeHeight(e.left),treeHeight(e.right)):0}function row(e,t,s,i,r){if(e){i(t+(s?"^-- ":"|-- ")+r(e)+"\n");const o=t+(s?"    ":"|   ");e.left&&row(e.left,o,!1,i,r),e.right&&row(e.right,o,!0,i,r)}}__name(Fh,"BVH"),__name(treeHeight,"treeHeight"),__name(row,"row");var zh=0;function repulsion(e,t,s,{X:i,Y:r,R:o,bucketSize:a}){zh=e,null===s&&(s=new Fh(t,{getX:Ch,getY:kh,bucketSize:a})).postOrder(wh);const l=t.length;for(let e=0;e<l;e++)Lh=t[e],Ih=i[Lh],Nh=r[Lh],Ph=o[Lh],s.preOrder(Th);return s}__name(repulsion,"repulsion");var Dh=__name((({fx:e,fy:t,X:s,Y:i,R:r,masses:o,bucketSize:a},{charge:l,theta:d})=>h=>{let u=0,c=0;let m=Ih-h.cx||randomize(),p=Nh-h.cy||randomize(),y=m*m+p*p,x=Ph+h.r;const b=h.data;if(null!==b){if(b===Lh)return!1;if(0!==a){const a=b;for(let d=0;d<a.length;d++){const h=a[d];h!==Lh&&(m=Ih-s[h]||randomize(),p=Nh-i[h]||randomize(),y=m*m+p*p,x=Ph+r[h],y<1&&(y=Math.sqrt(1*y)),u=l*o[h],c=zh*u/y,e[Lh]+=m*c,t[Lh]+=p*c)}}else y<1&&(y=Math.sqrt(1*y)),u=l*h.mass,c=zh*u/y,e[Lh]+=m*c,t[Lh]+=p*c}else{const s=x/d;if(y>s*s)return y<1&&(y=Math.sqrt(1*y)),u=l*h.mass,c=zh*u/y,e[Lh]+=m*c,t[Lh]+=p*c,!0}}),"getApplyForce"),Rh=__name((({X:e,Y:t,R:s,masses:i,bucketSize:r})=>o=>{let a,l,d=0,h=0,u=0,c=0;const m=o.data;if(null!==m)if(0!==r){const e=m,t=med(e,Ch,kh,Mh);d=t.x,h=t.y,u=t.r;for(let t=0;t<e.length;t++)c+=i[e[t]]}else l=m,d=e[l],h=t[l],u=s[l],c=i[l];else if(o.left&&o.right){const e=o.left.cx,t=o.left.cy,s=o.right.cx,i=o.right.cy,r=o.left.r,a=o.right.r,l=s-e,m=i-t,p=a-r,y=Math.sqrt(l*l+m*m);d=(e+s+l/y*p)/2,h=(t+i+m/y*p)/2,u=(y+r+a)/2,c=o.left.mass+o.right.mass}else a=o.left||o.right,d=a.cx,h=a.cy,u=a.r,c=a.mass;o.cx=d,o.cy=h,o.r=u,o.mass=c}),"getAccumulateBodies"),Oh=__name(((e,t,s)=>{const i=e.length,{X:r,Y:o,R:a,degrees:l,pinned:d,masses:h,nodeIds:u}=t,{scaling:c,defaultRadius:m,bucketSize:p}=s;t.bucketSize=void 0===p?Math.floor(Math.log(i)):p;let y=1/0,x=1/0,b=-1/0,v=-1/0;const E=Math.PI*(3-Math.sqrt(5));let k=0;for(let t=0;t<e.length;t++){const s=e[t];let{x:i,y:p,r:L}=s;const{mass:D}=s;if(isNaN(i)||isNaN(p)){const e=5*Math.sqrt(t),s=t*E;i=e*Math.cos(s),p=e*Math.sin(s)}L=L||m,r[t]=i,o[t]=p,a[t]=L,d[t]=s.pinned?1:0,h[t]=void 0===D?(1+l[t])*c:D,u[t]=t,L>k&&(k=L),i<y&&(y=i),p<x&&(x=p),i>b&&(b=i),p>v&&(v=p)}if(e.length>1&&(b-y<2*k||v-x<2*k)){const e=(y+b)/2,t=(x+v)/2;for(let s=0;s<i;s++)if(!d[s]){const i=5*Math.sqrt(s),a=s*E,l=e+i*Math.cos(a),d=t+i*Math.sin(a);r[s]=l,o[s]=d,l<y&&(y=l),d<x&&(x=d),l>b&&(b=l),d>v&&(v=d)}}Ch=__name((e=>r[e]),"getX"),kh=__name((e=>o[e]),"getY"),Mh=__name((e=>a[e]),"getR"),wh=Rh(t),Th=Dh(t,s)}),"initialize");repulsion.initialize=Oh;var Bh,jh,Vh,Uh,Gh,Wh,Hh,qh,Xh;function collisionForce(e,t,s,{X:i,Y:r,R:o,fx:a,fy:l,bucketSize:d},{elasticity:h}){if(0===h)return s;s||(s=new Fh(t,{getX:Bh,getY:jh,bucketSize:d})).postOrder(Uh);for(let e=0;e<t.length;e++)Wh=t[e],Hh=i[Wh]+a[Wh],qh=r[Wh]+l[Wh],Xh=o[Wh],s.preOrder(Gh);return s}__export2({},{default:()=>collisionForce}),__name(collisionForce,"collisionForce");var $h=__name((({X:e,Y:t,R:s,bucketSize:i})=>r=>{let o,a,l,d;const h=r.data;if(null!==h)if(0!==i){const e=med(h,Bh,jh,Vh);o=e.x,a=e.y,l=e.r}else{const i=h;o=e[i],a=t[i],l=s[i]}else if(r.left&&r.right){const e=r.left.cx,t=r.left.cy,s=r.right.cx,i=r.right.cy,d=r.left.r,h=r.right.r,u=s-e,c=i-t,m=h-d,p=Math.sqrt(u*u+c*c);o=(e+s+u/p*m)/2,a=(t+i+c/p*m)/2,l=(p+d+h)/2}else d=r.left||r.right,d&&(o=d.cx,a=d.cy,l=d.r);r.cx=o,r.cy=a,r.r=l}),"getMeasureBodies"),Yh=__name((({X:e,Y:t,R:s,fx:i,fy:r,bucketSize:o},{elasticity:a,margin:l})=>d=>{const h=d.data;if(null===h){const e=d.cx-Hh,t=d.cy-qh,s=d.r+Xh;return e*e+t*t>s*s}if(0!==o){const o=h;for(let d=0;d<o.length;d++){const h=o[d];if(h>Wh){const o=s[h];let d=Hh-e[h]-i[h],u=qh-t[h]-r[h];const c=Xh+o+l;let m=d*d+u*u;if(m<c*c){0===d&&(d=randomize(),m+=d*d),0===u&&(u=randomize(),m+=u*u);const e=Math.sqrt(m),t=(c-e)*a/e,s=o/c;i[Wh]+=d*t*s,r[Wh]+=u*t*s,i[h]-=d*t*(1-s),r[h]-=u*t*(1-s)}}}}else{const o=d.data;if(o>Wh){const d=s[o];let h=Hh-e[o],u=qh-t[o];const c=Xh+d+l;let m=h*h+u*u;if(m<c*c){0===h&&(h=randomize(),m+=h*h),0===u&&(u=randomize(),m+=u*u);const e=Math.sqrt(m),t=(c-e)*a/e,s=d/c;i[Wh]+=h*t*s,r[Wh]+=u*t*s,i[o]-=h*t*(1-s),r[o]-=u*t*(1-s)}}}}),"getApplyForce");collisionForce.initialize=(e,t,s)=>{const{X:i,Y:r,R:o}=t;Bh=__name((e=>i[e]),"getX"),jh=__name((e=>r[e]),"getY"),Vh=__name((e=>o[e]),"getR"),Uh=$h(t),Gh=Yh(t,s)};var Zh={};function center(e,t,{X:s,Y:i,fx:r,fy:o},{gravity:a,cx:l,cy:d}){let h=0,u=0;const c=t.length;for(let e=0;e<c;e++)h+=s[e],u+=i[e];h=h/c-l,u=u/c-d;for(let h=0;h<c;h++){const u=t[h],c=l-s[u]||randomize(),m=d-i[u]||randomize(),p=a*e;r[u]+=c*p,o[u]+=m*p}}__export2(Zh,{default:()=>center,initialize:()=>Qh}),__name(center,"center");var Qh=__name(((e,t,s)=>{const{X:i,Y:r}=t;let o=s.cx,a=s.cy;const l=e.length;if(void 0===o||void 0===a){o=a=0;for(let e=0;e<l;e++)o+=i[e],a+=r[e];o/=l,a/=l}s.cx=o,s.cy=a}),"initialize");center.initialize=Qh;function repulsion2(e,t,{masses:s,X:i,Y:r,fx:o,fy:a},{charge:l}){const d=t.length;let h,u,c,m,p,y,x,b,v;for(let E=0;E<d;E++){h=t[E];for(let k=E+1;k<d;k++)if(E!==k){if(u=t[k],h===u)continue;c=i[h]-i[u]||randomize(),m=r[h]-r[u]||randomize(),p=c*c+m*m,p<1&&(p=Math.sqrt(1*p)),y=l*s[u],x=e*y/p,b=l*s[h],v=e*b/p,o[h]+=c*x,a[h]+=m*x,o[u]-=c*v,a[u]-=m*v}}}__export2({},{default:()=>repulsion2}),__name(repulsion2,"repulsion"),repulsion2.initialize=()=>{};function repulsion3(e,t,{masses:s,X:i,Y:r,R:o,fx:a,fy:l},{friction:d,charge:h}){const u=t.length;for(let c=0;c<u;c++)for(let m=c+1;m<u;m++)if(c!==m){const u=t[c],p=t[m],y=o[u],x=o[p],b=i[u]-i[p]||randomize(),v=r[u]-r[p]||randomize();let E=b*b+v*v,k=+h;E>=(y+x)*(y+x)?k*=s[u]*s[p]:E=d*((y+x)*(y+x));const L=k/E,D=e*b*L,B=e*v*L;a[u]+=D,l[u]+=B,a[p]-=D,l[p]-=B}}function topology_default(e,t,s){initTopology(e,t,s),decomposition(s)}function initTopology(e,t,{sources:s,targets:i,degrees:r,nodeIds:o,edgeIds:a}){const l={};for(let t=0;t<e.length;t++)l[t]=o[t]=t;for(let e=0;e<t.length;e++){const{source:o,target:d}=t[e],h=l[o],u=l[d];a[e]=e,s[e]=h,i[e]=u,r[h]++,r[u]++}}function decomposition({nodeIds:e,edgeIds:t,sources:s,targets:i,degrees:r,layer:o,layers:a,component:l,components:d,cluster:h,parent:u}){let c=0,m=1;const p=new Uint32Array(e.length);for(let t=0;t<e.length;t++)p[t]=r[t];const y=new Array(e.length);for(let e=0;e<t.length;e++){const r=t[e],o=s[r],a=i[r];y[o]=y[o]||[],y[a]=y[a]||[],y[o].push(a),y[a].push(o)}const x=new Uint8Array(e.length),b=new Uint8Array(e.length);u.fill(-1);let v=0;for(let t=0;t<e.length;t++)if(0===x[t]){const e=[t];for(;0!==e.length;){const t=e.pop();0===x[t]&&(e.push.apply(e,y[t]),x[t]=1,l[t]=v)}v++}const E=new Array(e.length);for(let t=0;t<e.length;t++)o[t]=0,E[t]=t;for(;0!==E.length;){const e=[],t=[];for(let s=0;s<E.length;s++)p[E[s]]<=c&&(e.push(s),t.push(E[s]));for(let e=0;e<t.length;e++){const s=t[e];b[s]=c,o[s]=m;const i=y[s];if(i)for(let e=0;e<i.length;e++)p[i[e]]--}for(let e=0;e<t.length;e++){const s=t[e],i=y[s];if(i)for(let e=0;e<i.length;e++){const t=i[e],r=o[t];if(void 0===r||r>m){u[s]=t;break}}}e.reverse();for(let t=0;t<e.length;t++)E.splice(e[t],1);if(m+=1,E.length>0){let e=1/0;for(let t=0;t<E.length;t++){const s=p[E[t]];s<e&&(e=s)}e>=c+1&&(c=e,m=1)}}x.fill(0);for(let t=0;t<e.length;t++){const s=e[t],i=o[s];if(-1===u[s]||o[u[s]]===i){const e=[s];for(x.fill(0);0!==e.length;){const t=e.pop();if(x[t])continue;if(o[t]>i){u[s]=t;break}const r=y[t];x[t]=1,r&&e.push.apply(e,r)}}}for(let t=0;t<e.length;t++){const s=e[t],i=l[s];d[i]=d[i]||[],d[i].push(s);const r=o[s]-1;a[r]=a[r]||[],a[r].push(s),h[s]=u[s]}}__export2({},{default:()=>repulsion3}),__name(repulsion3,"repulsion"),repulsion3.initialize=()=>{},__name(topology_default,"default"),__name(initTopology,"initTopology"),__name(decomposition,"decomposition");var Kh=class{constructor(e,t=!0){this.bucketSize=0;const s=e.nodes.length,i=e.edges.length;setSeed(s+i),this.X=new Array(s),this.Y=new Array(s),this.R=new Array(s),this.fx=new Float32Array(s),this.fy=new Float32Array(s),this.vx=new Float32Array(s),this.vy=new Float32Array(s),this.pinned=new Uint8Array(s),this.masses=new Float32Array(s),this.weights=new Float32Array(i),this.lengths=new Float32Array(i),this.sources=new Uint32Array(i),this.targets=new Uint32Array(i),this.degrees=new Uint32Array(s),this.layer=new Uint32Array(s),this.parent=new Int32Array(s),this.cluster=new Int32Array(s),this.component=new Uint32Array(s),this.components=[],this.layers=[],this.nodeIds=new Array(s),this.edgeIds=new Array(i),t&&topology_default(e.nodes,e.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}};function potpack(e){let t=0,s=0;for(const i of e)t+=i.w*i.h,s=Math.max(s,i.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let r=0,o=0;for(const t of e)for(let e=i.length-1;e>=0;e--){const s=i[e];if(!(t.w>s.w||t.h>s.h)){if(t.x=s.x,t.y=s.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===s.w&&t.h===s.h){const t=i.pop();e<i.length&&(i[e]=t)}else t.h===s.h?(s.x+=t.w,s.w-=t.w):t.w===s.w?(s.y+=t.h,s.h-=t.h):(i.push({x:s.x+t.w,y:s.y,w:s.w-t.w,h:t.h}),s.y+=t.h,s.h-=t.h);break}}}function boxpack(e,t=1){return potpack(e.map((e=>(e.w+=e.maxr+t,e.h+=e.maxr+t,e))).sort(((e,t)=>e.w*e.h-t.w*t.h)))}function spiralpack(e,t=20,s,i,r){for(const o of e){const{x:e,y:a,r:l}=med(o.ids,(e=>s[e]),(e=>i[e]),(e=>r[e]));o.cx=e,o.cy=a,o.radius=l+t}const o=e.slice().sort(((e,t)=>e.radius-t.radius)),a=o.map((e=>({x:e.cx,y:e.cy,r:e.radius}))),l=o.pop();let d=3*Math.PI/2,h=l.radius;const u=2*Math.PI,{cx:c,cy:m}=l,p=[l];for(;0!==o.length;){const e=o[o.length-1],t=h+e.radius,s=c+Math.cos(d)*t,i=m+Math.sin(d)*t;p.some((t=>{const r=t.cx-s,o=t.cy-i;return Math.sqrt(r*r+o*o)<t.radius+e.radius}))?h+=1:(e.x=s-e.w/2,e.y=i-e.h/2,e.cx=s,e.cy=i,a[o.length-1].x=s,a[o.length-1].y=i,p.push(o.pop()),d+=(2*e.radius+1)/t*1%u)}}__name(Kh,"LayoutData"),__name(potpack,"potpack"),__name(boxpack,"boxpack"),__name(spiralpack,"spiralpack");var Jh=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(e,t,s,i){this.ids.push(e),t-i<this.xmin&&(this.xmin=t-i),s-i<this.ymin&&(this.ymin=s-i),t+i>this.xmax&&(this.xmax=t+i),s+i>this.ymax&&(this.ymax=s+i),i>this.maxr&&(this.maxr=i),this.mx+=i*t,this.my+=i*s,this.m+=i}measure(e=0){return this.w=this.xmax-this.xmin+2*e,this.h=this.ymax-this.ymin+2*e,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function unorderedPair(e,t){return e<t?e*t+Math.pow(t-e-1,2)/4:e*t+Math.pow(e-t-1,2)/4}function orderedPair2(e,t){return(e+t)*(e+t+1)/2+t}function alignSiblings({edgeIds:e,sources:t,targets:s,pinned:i,degrees:r,X:o,Y:a,R:l},d=0,h=.5){const u={},c={};for(const i of e){const e=t[i],r=s[i];e!==r&&(u[e]=u[e]||{},u[r]=u[r]||{},u[e][r]=!0,u[r][e]=!0)}Object.keys(u).forEach((e=>{const t=Number(e),s=Object.keys(u[Number(t)]);if(2===s.length){const[e,r]=s,o=unorderedPair(Number(e),Number(r));o in c||(c[o]=[Number(r),Number(e)]),i[t]||c[o].push(t)}})),Object.keys(c).forEach((e=>{const[t,s,...i]=c[Number(e)];if(i.length<3)return;const u=o[t],m=a[t],p=o[s],y=a[s],x=r[t],b=.25+.5*x/(x+r[s]);let v=u+(p-u)*b,E=m+(y-m)*b,k=-(y-m),L=p-u;const D=Math.sqrt(Math.pow(u-p,2)+Math.pow(m-y,2));k=-2*k/D,L=-2*L/D;const B=Math.acos(k/Math.sqrt(k*k+L*L));d>0&&(B<d||B>Math.PI-d&&B<=Math.PI?(k=2*Math.cos(Math.PI-d),L=2*Math.sin(Math.PI-d)):(B>2*Math.PI-d||B>=Math.PI&&B<Math.PI+d)&&(k=2*Math.cos(d),L=2*Math.sin(d)));let H=0,X=1;i.sort(((e,t)=>l[t]-l[e]));let Y=0,Z=0;const oe=Math.max(l[i[0]],l[i[1]])/2;i.length%2==1&&(H=1,v-=k*oe,E-=L*oe);const de=1+h;for(let e=0;e<i.length;e++){const t=(H+e)%2,s=i[e],r=e>=2?l[s]:oe,d=(t?Y:Z)+r;o[s]=v+k*X*d,a[s]=E+L*X*d,t?Y+=r*de:Z+=r*de,X=-X}}))}function groupAndMeasure(e,t,s,i){let r=0;const o=[];for(const a of i){const i=new Jh;for(const r of a)i.add(r,e[r],t[r],s[r]);o.push(i.measure()),a.length>o[r].ids.length&&(r=o.length-1)}return{boxes:o,biggest:r}}function postprocessing(e,t,{X:s,Y:i,R:r,components:o,pinned:a,degrees:l,sources:d,targets:h,edgeIds:u},{update:c,onUpdate:m,placement:p,placementOffset:y,alignSiblings:x,siblingsMinAngle:b,siblingsOffset:v}){if(x&&(alignSiblings({X:s,Y:i,R:r,degrees:l,pinned:a,sources:d,targets:h,edgeIds:u},b,v),c(e,s,i)),p){const{boxes:t,biggest:a}=groupAndMeasure(s,i,r,o);if("spiral"===p)spiralpack(t,y,s,i,r);else{if("box"!==p)return;boxpack(t,y)}const l=t[a].xmin-t[a].x,d=t[a].ymin-t[a].y;for(const e of t){const{xmin:t,ymin:r,x:o,y:a,ids:h}=e,u=t-o-l,c=r-a-d;for(const e of h)s[e]-=u,i[e]-=c}c(e,s,i),m()}}__name(Jh,"Component"),__name(unorderedPair,"unorderedPair"),__name(orderedPair2,"orderedPair"),__name(alignSiblings,"alignSiblings"),__name(groupAndMeasure,"groupAndMeasure"),__name(postprocessing,"postprocessing");var eu=0,tu="undefined"==typeof window,su="undefined"!=typeof performance&&performance.now?performance:Date,iu=tu?e=>{const t=su.now(),s=Math.max(0,16-(t-eu)),i=setTimeout((()=>e(t+s)),s);return eu=t+s,i}:window.requestAnimationFrame,nu=tu?e=>clearTimeout(e):window.cancelAnimationFrame;function defaultUpdate(e,t,s){for(let i=0;i<e.length;i++){const r=e[i];r.x=t[i],r.y=s[i]}}__name(defaultUpdate,"defaultUpdate");var ru=__name((e=>{}),"noop"),ou={movementRatio:7e-8,surfaceRatio:.0025},au=class{constructor(e={}){this.onUpdate=ru,this.update=defaultUpdate,this.nextTick=iu,this.cancelTick=nu,this.onEnd=ru,this.charge=10,this.maxIterations=300,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=1,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=300,this.scaling=1,this.defaultRadius=1,this.autoStop=ou,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in e?e.autoStop&&("boolean"==typeof e.autoStop?e.autoStop=ou:e.autoStop=__spreadValues2(__spreadValues2({},e.autoStop),ou)):e.steps;for(const t in e)void 0!==e[t]&&(this[t]=e[t])}};__name(au,"Settings");var lu=class{constructor(e){this.promise=new Promise(e)}then(e){return this.promise.then(e)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};__name(lu,"SimulationPromise");var du={5126:"uniform1f",35664:"uniform2fv",35665:"uniform3fv",35666:"uniform4fv",5124:"uniform1i",35667:"uniform2iv",35668:"uniform3iv",35669:"uniform4iv",35674:"uniformMatrix2fv",35675:"uniformMatrix3fv",35676:"uniformMatrix4fv",35678:"uniform1i",36298:"uniform1i",36306:"uniform1i",35680:"uniform1i"},hu=__name(((e,t,s)=>{const i=e.createShader(t);if(null===i)throw new Error("Cannot create WebGL shader.");return e.shaderSource(i,s),e.compileShader(i),i}),"createShader"),uu=__name(((e,t,s)=>{const i=e.createProgram();if(null===i)throw new Error("Cannot create WebGL program.");if(e.attachShader(i,t),e.attachShader(i,s),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const t=e.getProgramInfoLog(i);throw e.deleteProgram(i),new Error(`Could not link WebGL program: \n${t}`)}return i}),"createProgram"),cu=__name(((e,{size:t,data:s,type:i,internalFormat:r=e.RGBA32F,format:o=e.RGBA})=>{const a=e.createTexture();if(!a)throw new Error("Cannot create WebGL texture.");const[l,d]=t;return e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,r,l,d,0,o,i,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),{size:t,data:s,type:i,format:o,handle:a}}),"createTexture"),gu=__name(((e,t)=>{const s=e.createFramebuffer();if(!s)throw new Error("Cannot create WebGL frame buffer.");e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER);if(i!==e.FRAMEBUFFER_COMPLETE)switch(i){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Framebuffer: Attachment is NOT complete.");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Framebuffer: No valid attachment.");case e.FRAMEBUFFER_UNSUPPORTED:throw new Error("Framebuffer: Attachment types are not supported.");default:throw new Error(`Framebuffer: Unknown reason (status: ${i}).`)}return{buffer:s,handle:t}}),"createFramebuffer"),mu=__name(((e,t,s)=>{e.useProgram(t);const i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){const r=e.getActiveUniform(t,o);if(!r)throw new Error(`Cannot get GL active uniform ${o}.`);const{name:a,size:l,type:d}=r,h=e.getUniformLocation(t,a);if(!h)throw new Error(`Cannot get GL uniform location ${a}.`);i[a]={size:l,data:s[a],type:d,location:h}}return i}),"createUniforms");function bindUniforms(e,t,s){let i=0;return Object.entries(t).forEach((([t,{location:r,type:o,data:a}])=>{let l=void 0!==s[t]?s[t]:a;o!==e.SAMPLER_2D&&o!==e.INT_SAMPLER_2D&&o!==e.UNSIGNED_INT_SAMPLER_2D||(e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,l),l=i,i++),e[du[o]](r,l)}))}__name(bindUniforms,"bindUniforms");var _u=__name(((e,t,s)=>Object.entries(s).reduce(((s,[i,r])=>{const o=e.createBuffer(),a=e.getAttribLocation(t,i);return e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),s[i]={data:r,buffer:o,location:a},s}),{})),"createAttributeLocs"),pu=__name(((e,{N:t,bodyTexture:s,nodeTexture:i,topologyTexture:r,propertyTexture:o},{charge:a,center:l,gravity:d,inertia:h,steps:u,edgeStrength:c,edgeLength:m,elasticity:p,margin:y,onStart:x,onStop:b,onTick:v,maxDisplacement:E,batch:k})=>{let L=-1,D=0;const B=__name((()=>{L>-1||(x(D),_e())}),"start"),H=__name((()=>{-1!==L&&(cancelAnimationFrame(L),L=-1,b(D),D=0)}),"stop"),X=cu(e,{type:e.FLOAT,size:s.size,data:new Float32Array(s.data.buffer.slice(0)),format:e.RGBA,internalFormat:e.RGBA32F}),Y=hu(e,e.VERTEX_SHADER,"#version 300 es\n#define GLSLIFY 1\nin vec2 position;void main(){gl_Position=vec4(position,0.0f,1.0f);}"),Z=hu(e,e.FRAGMENT_SHADER,"#version 300 es\nprecision lowp float;precision lowp sampler2D;precision lowp usampler2D;\n#define GLSLIFY 1\nuniform float charge;uniform vec2 center;uniform float gravity;uniform float edgeStrength;uniform float edgeLength;uniform float elasticity;uniform float margin;uniform float alpha;uniform float inertia;uniform float maxDisplacementSq;uniform int N;uniform sampler2D body;uniform usampler2D node;uniform usampler2D topology;uniform sampler2D property;const float PAIR_ATTRACTION_COEFFICIENT=2.0;out vec4 outColor;float randomSeedShift=1.0;float slide=1.0;float randomSeed1=90.0909;float randomSeed2=3.14159;float nrand(vec2 n){float result=fract(sin(dot((n.xy+1.0)*vec2(randomSeed1*slide,randomSeed2*randomSeedShift),vec2(12.9898,78.233)))*43758.5453);randomSeedShift=result;if(randomSeedShift>0.5){slide+=0.00009;}else{slide+=0.0009;}return result;}void main(){ivec2 bodySize=textureSize(body,0);ivec2 topologySize=textureSize(topology,0);ivec2 targetMatrixCoord=ivec2(gl_FragCoord.xy);int targetIndex=bodySize.x*targetMatrixCoord.y+targetMatrixCoord.x;if(targetIndex>=N)return;vec3 targetProperty=texelFetch(property,targetMatrixCoord,0).xyz;if(targetProperty.z>0.f)return;vec4 targetBody=texelFetch(body,targetMatrixCoord,0).xyzw;vec2 targetPosition=targetBody.xy;vec2 targetVelocity=targetBody.zw;ivec4 targetNode=ivec4(texelFetch(node,targetMatrixCoord,0).xyzw);float targetDegree=float(targetNode.z)+1.f;ivec2 sourceMatrixCoord=ivec2(0);for(int sourceIndex=0;sourceIndex<N;sourceIndex++){if(sourceIndex==targetIndex)continue;vec2 diff=texelFetch(body,sourceMatrixCoord,0).xy-targetPosition;float distSq=dot(diff,diff);if(distSq<1e-2){diff.x=1e-9*(nrand(vec2(sourceMatrixCoord))-.5);diff.y=1e-9*(nrand(vec2(sourceMatrixCoord))-.5);distSq=1e-2;}if(elasticity>0.&&alpha<0.2){vec3 sourceProperty=texelFetch(property,sourceMatrixCoord,0).xyz;float targetDelta=max(targetProperty.y+sourceProperty.y+margin,1e-2);if(distSq<targetDelta*targetDelta){float dist=sqrt(distSq);targetVelocity-=((targetDelta-dist)*elasticity)*sourceProperty.y/targetDelta*diff/dist;}}float sourceDegree=float(texelFetch(node,sourceMatrixCoord,0).z)+1.f;targetVelocity-=alpha*charge*PAIR_ATTRACTION_COEFFICIENT*sourceDegree*targetDegree*diff/distSq/targetProperty.x;sourceMatrixCoord.x+=1;if(sourceMatrixCoord.x>=bodySize.x){sourceMatrixCoord.x=0;sourceMatrixCoord.y+=1;}}sourceMatrixCoord=ivec2(0);for(int sourceIndex=0;sourceIndex<targetNode.z;sourceIndex++){sourceMatrixCoord=ivec2(texelFetch(topology,targetNode.xy,0).xy);vec2 diff=texelFetch(body,sourceMatrixCoord,0).xy-targetPosition;diff*=1.f-(edgeLength+targetProperty.y+texelFetch(property,sourceMatrixCoord,0).y)/(length(diff)+1e-4f);float sourceDegree=float(texelFetch(node,sourceMatrixCoord,0).z)+1.f;float K=alpha*edgeStrength*targetDegree*sourceDegree/(min(targetDegree,sourceDegree)*(sourceDegree+targetDegree));targetVelocity+=min(1.,K)*diff/targetProperty.x;targetNode.x+=1;if(targetNode.x>=topologySize.x){targetNode.x=0;targetNode.y+=1;}}targetVelocity=inertia*(targetVelocity-alpha*gravity*(targetPosition-center));float velSq=dot(targetVelocity,targetVelocity);if(velSq>maxDisplacementSq)targetVelocity*=sqrt(maxDisplacementSq/velSq);outColor=vec4(targetPosition+targetVelocity,targetVelocity);}"),oe=uu(e,Y,Z),de=[X,s].map((({handle:t})=>gu(e,t))),he=_u(e,oe,{position:new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1])}),ce=de.map(((u,x)=>{const b=0===x?s:X;return mu(e,oe,{alpha:1,inertia:h,maxDisplacementSq:uh(E,2),charge:a,center:l,gravity:d,edgeStrength:c,edgeLength:m,elasticity:p,margin:y,N:t,body:b.handle,node:i.handle,topology:r.handle,property:o.handle})}));e.viewport(0,0,s.size[0],s.size[1]);const me=__name((()=>{for(let t=0;t<de.length;t++)e.bindFramebuffer(e.FRAMEBUFFER,de[t].buffer),e.viewport(0,0,s.size[0],s.size[1]),e.bindBuffer(e.ARRAY_BUFFER,he.position.buffer),e.enableVertexAttribArray(he.position.location),e.vertexAttribPointer(he.location,2,e.FLOAT,!1,0,0),e.useProgram(oe),bindUniforms(e,ce[t],{alpha:D<u-20?1-uh(D/(u-20),Math.exp(2)):.01}),e.drawArrays(e.TRIANGLES,0,6);v(D),D++}),"step"),_e=__name((()=>{for(let e=0;e<Math.max(1,k);e++)me();L=requestAnimationFrame(_e),D>=u&&H()}),"frame");return{start:B,step:me,stop:H}}),"simulation"),fu=pu,yu=__name((e=>Math.ceil(Math.sqrt(e))),"computeNodeMatrixSize"),xu=__name((e=>Math.ceil(Math.sqrt(2*e))),"computeTopologyMatrixSize"),bu=__name(((e,t,s,i)=>{const r=yu(t),o=new Float32Array(4*uh(r,2));for(let e=0;e<t;e++){const t=4*e;o[t]=s[e],o[t+1]=i[e]}return cu(e,{size:[r,r],data:o,type:e.FLOAT,format:e.RGBA,internalFormat:e.RGBA32F})}),"createBodyTexture"),vu=__name(((e,t,s,i)=>{const r=yu(t),o=xu(s),a=new Uint32Array(3*uh(r,2));let l=0;for(let e=0;e<t;e++){const t=3*e,s=l,r=Math.floor(s/o),d=s%o;a[t]=d,a[t+1]=r,a[t+2]=i[e],l+=i[e]}return cu(e,{size:[r,r],data:a,type:e.UNSIGNED_INT,format:e.RGB_INTEGER,internalFormat:e.RGB32UI})}),"createNodeTexture"),Au=__name(((e,t,s,i,r)=>{const o=yu(t),a=xu(s),l=new Uint32Array(2*uh(a,2)),d=new Map;for(let e=0;e<t;e++)d.set(e,[]);i.forEach(((e,t)=>{d.get(e).push(r[t]),d.get(r[t]).push(e)}));let h=0;for(let e=0;e<t;e++)for(const t of d.get(e)||[]){const e=Math.floor(t/o),s=t%o;l[h]=s,l[h+1]=e,h+=2}return cu(e,{size:[a,a],data:l,type:e.UNSIGNED_INT,format:e.RG_INTEGER,internalFormat:e.RG32UI})}),"createTopologyTexture"),Su=__name(((e,t,s,i,r)=>{const o=yu(t),a=new Float32Array(4*uh(o,2));for(let e=0;e<t;e++){const t=4*e;a[t]=s[e],a[t+1]=i[e],a[t+2]=r[e],a[t+3]=0}return cu(e,{size:[o,o],data:a,type:e.FLOAT,format:e.RGBA,internalFormat:e.RGBA32F})}),"createPropertyTexture");function gpuLayout(e,t,s={}){var i;let r,o;t.getExtension("OES_texture_float_linear")&&t.getExtension("EXT_color_buffer_float")||null==(i=t.getExtension("WEBGL_lose_context"))||i.loseContext();const a=__name(((e={nodes:[],edges:[]})=>(r=e.nodes,o=e.edges,setSeed(orderedPair2(r.length,o.length)),new Kh(e,!1))),"setGraph"),l=__name(((e={})=>new au(e)),"setOptions");let d,h=a(e),u=l(s),c=!1;return ch.initialize(o,h),ph.initialize(r,h,u),Zh.initialize(r,h,u),{setOptions:(e={})=>(u=l(e),this),setGraph:e=>(h=a(e),ch.initialize(o,h),ph.initialize(r,h,u),Zh.initialize(r,h,u),this),start(){const e=r.length;0===e&&u.onEnd(0);const s=o.length,i=bu(t,e,new Float32Array(h.X),new Float32Array(h.Y)),a=new Float32Array(i.size[0]*i.size[1]*4),l=__name((()=>{t.readPixels(0,0,i.size[0],i.size[1],t.RGBA,t.FLOAT,a);for(let t=0;t<e;t++){const e=r[t];if(e.pinned)return;e.x=h.X[t]=a[4*t],e.y=h.Y[t]=a[4*t+1]}}),"updateNodes");var m,p;return d=fu(t,{N:e,E:s,bodyTexture:i,nodeTexture:vu(t,e,s,h.degrees),topologyTexture:Au(t,e,s,h.sources,h.targets),propertyTexture:Su(t,e,h.masses,new Float32Array(h.R.map((e=>e||1))),h.pinned)},(m=__spreadValues2({},u),p={center:[u.cx,u.cy],onStart:()=>{},onStop:e=>{c||postprocessing(r,0,h,u),c=!0,l(),u.onEnd(e)},onTick:e=>u.onUpdate(e)},oh(m,ah(p)))),d.start(),this},iterations:()=>1,data:()=>h,stop(){return d&&d.stop(),this},step(e=1){return d&&d.step(),this}}}
/**
  * @preserve
  * @linkurious/force-layout@0.6.7
  * Ogma general-purpose force-directed layout
  */
function forceWrapper(){var force=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=Math.pow,__defNormalProp3=(t,s,value)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value}):t[s]=value,__spreadValues3=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&__defNormalProp3(e,s,t[s]);if(i)for(var s of i(t))o.call(t,s)&&__defNormalProp3(e,s,t[s]);return e},__name2=(t,value)=>e(t,"name",{value,configurable:!0}),l={};((t,s)=>{for(var i in s)e(t,i,{get:s[i],enumerable:!0})})(l,{IntegratorType:()=>Ne,default:()=>force2});var d=class{constructor(e){let t=Mash2();this.c=1,this.s0=t(" "),this.s1=t(" "),this.s2=t(" "),this.s0-=t(String(e)),this.s0<0&&(this.s0+=1),this.s1-=t(String(e)),this.s1<0&&(this.s1+=1),this.s2-=t(e),this.s2<0&&(this.s2+=1),t=null}next(){return()=>{const e=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=0|e)}}nextDouble(){const e=this.next();return()=>e()+11102230246251565e-32*(2097152*e()|0)}nextInt32(){const e=this.next();return()=>4294967296*e()|0}};function Mash2(){let e=4022871197;return t=>{t=t.toString();for(let s=0;s<t.length;s++){e+=t.charCodeAt(s);let i=.02519603282416938*e;e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=4294967296*i}return 2.3283064365386963e-10*(e>>>0)}}function impl2(e){return new d(e.toString()).next()}__name2(d,"Alea"),__name2(Mash2,"Mash"),__name2(impl2,"impl");var h=impl2(42);function setSeed2(e){h=impl2(e)}function randomize2(){return 1e-6*(h()-.5)}function shuffle2(e){for(let t=e.length-1;t>=0;t--){let s=Math.floor(Math.random()*(t+1));s=Math.max(Math.min(s,t),0);const i=e[t];e[t]=e[s],e[s]=i}return e}__name2(setSeed2,"setSeed"),__name2(randomize2,"randomize"),__name2(shuffle2,"shuffle");var u=__name2((e=>e.x),"getX"),c=__name2((e=>e.y),"getY"),m=__name2((e=>e.r),"getR");function med2(e,t=u,s=c,i=m){const r=shuffle2(e.slice()),o=r.length;let a,l=[],d=0;for(;d<o;){const e=r[d];a&&containsWeak2(a,t(e),s(e),i(e))?d++:(l=extend2(l,e,t,s,i),a=enclose2(l,t,s,i),d=0)}return a}function extend2(e,t,s,i,r){const o=s(t),a=i(t),l=r(t),d={x:o,y:a,r:l};if(containsWeakAll2(d,e,s,i,r))return[t];for(let h=0;h<e.length;++h){const u=e[h],c=s(u),m=i(u),p=r(u);if(!contains2(d,c,m,p)&&containsWeakAll2(from22(c,m,p,o,a,l),e,s,i,r))return[e[h],t]}for(let d=0;d<e.length-1;d++)for(let h=d+1;h<e.length;h++){const u=e[d],c=e[h],m=s(u),p=i(u),y=r(u),x=s(c),b=i(c),v=r(c);if(!contains2(from22(m,p,y,x,b,v),o,a,l)&&!contains2(from22(m,p,y,o,a,l),x,b,v)&&!contains2(from22(x,b,v,o,a,l),m,p,y)&&containsWeakAll2(from32(m,p,y,x,b,v,o,a,l),e,s,i,r))return[e[d],e[h],t]}throw new Error}function contains2(e,t,s,i){const r=e.r-i,o=t-e.x,a=s-e.y;return r>=0&&r*r>o*o+a*a}function containsWeak2(e,t,s,i){const r=e.r-i+1e-6,o=t-e.x,a=s-e.y;return r>0&&r*r>o*o+a*a}function containsWeakAll2(e,t,s,i,r){for(let o=0;o<t.length;++o){const a=t[o];if(!containsWeak2(e,s(a),i(a),r(a)))return!1}return!0}function enclose2(e,t,s,i){return 1===e.length?from12(t(e[0]),s(e[0]),i(e[0])):2===e.length?from22(t(e[0]),s(e[0]),i(e[0]),t(e[1]),s(e[1]),i(e[1])):from32(t(e[0]),s(e[0]),i(e[0]),t(e[1]),s(e[1]),i(e[1]),t(e[2]),s(e[2]),i(e[2]))}function from12(e,t,s){return{x:e,y:t,r:s}}function from22(e,t,s,i,r,o){const a=i-e,l=r-t,d=o-s,h=Math.sqrt(a*a+l*l);return{x:(e+i+a/h*d)/2,y:(t+r+l/h*d)/2,r:(h+s+o)/2}}function from32(e,t,s,i,r,o,a,l,d){const h=e-i,u=e-a,c=t-r,m=t-l,p=o-s,y=d-s,x=e*e+t*t-s*s,b=x-i*i-r*r+o*o,v=x-a*a-l*l+d*d,E=u*c-h*m,k=(c*v-m*b)/(2*E)-e,L=(m*p-c*y)/E,D=(u*b-h*v)/(2*E)-t,B=(h*y-u*p)/E,H=L*L+B*B-1,X=2*(s+k*L+D*B),Y=k*k+D*D-s*s,Z=-(H?(X+Math.sqrt(X*X-4*H*Y))/(2*H):Y/X);return{x:e+k+L*Z,y:t+D+B*Z,r:Z}}__name2(med2,"med"),__name2(extend2,"extend"),__name2(contains2,"contains"),__name2(containsWeak2,"containsWeak"),__name2(containsWeakAll2,"containsWeakAll"),__name2(enclose2,"enclose"),__name2(from12,"from1"),__name2(from22,"from2"),__name2(from32,"from3");var p=[0,1],y=[0,2];for(let e=4;e<65535;e<<=2)for(let t=0,s=p.length;t<s;t++)p.push(p[t]|e),y.push((p[t]|e)<<1);function morton3(e,t){return(y[255&t]|p[255&e])+65536*(y[t>>8&255]|p[e>>8&255])+4294967296*(y[t>>16&255]|p[e>>16&255])}function hilbert2(e,t){let s=e^t,i=65535^s,r=65535^(e|t),o=e&(65535^t),a=s|i>>1,l=s>>1^s,d=r>>1^i&o>>1^r,h=s&r>>1^o>>1^o;s=a,i=l,r=d,o=h,a=s&s>>2^i&i>>2,l=s&i>>2^i&(s^i)>>2,d^=s&r>>2^i&o>>2,h^=i&r>>2^(s^i)&o>>2,s=a,i=l,r=d,o=h,a=s&s>>4^i&i>>4,l=s&i>>4^i&(s^i)>>4,d^=s&r>>4^i&o>>4,h^=i&r>>4^(s^i)&o>>4,s=a,i=l,r=d,o=h,d^=s&r>>8^i&o>>8,h^=i&r>>8^(s^i)&o>>8,s=d^d>>1,i=h^h>>1;let u=e^t,c=i|65535^(u|s);return u=16711935&(u|u<<8),u=252645135&(u|u<<4),u=858993459&(u|u<<2),u=1431655765&(u|u<<1),c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),(c<<1|u)>>>0}__name2(morton3,"morton"),__name2(hilbert2,"hilbert");var x=new Uint32Array(1024);function radixSort2(e,t){const s=new Uint32Array(t.length);for(let e=0;e<1024;e++)x[e]=0;const i=255;for(let e=0;e<t.length;e++){const s=t[e];x[s&i]++,x[256+(s>>8&i)]++,x[512+(s>>16&i)]++,x[768+(s>>24&i)]++}for(let e=0;e<4;e++){let t=0,s=0;const i=256*e;for(let e=0;e<256;e++)t=x[e+i],x[e+i]=s,s+=t}for(let e=0;e<t.length;e++){const r=t[e];s[x[r&i]++]=e}for(let r=0;r<t.length;r++){const o=s[r],a=t[o];e[x[256+(a>>8&i)]++]=o}for(let r=0;r<t.length;r++){const o=e[r],a=t[o];s[x[512+(a>>16&i)]++]=o}for(let r=0;r<t.length;r++){const o=s[r],a=t[o];e[x[768+(a>>24&i)]++]=o}}__name2(radixSort2,"radixSort");var b=class{constructor(e,t,s,i){this.left=null,this.right=null,this.data=null,this.code=e,this.data=t,this.left=s,this.right=i}};function buildIterative2(e,t,s,i,r){const o=new b(null,null,null,null),a=[o],l=[i,r];for(;0!==a.length;){const i=l.pop(),r=l.pop(),o=a.pop();if(i-r==0)o.code=s[r],o.data=e[t[r]];else{const e=findSplit2(t,s,r,i);o.code=e,r<=e&&(o.left=new b(null,null,null,null),a.push(o.left),l.push(r,e)),i>e&&(o.right=new b(null,null,null,null),a.push(o.right),l.push(e+1,i))}}return o}function buildIterativeBuckets2(e,t,s,i,r,o){const a=new b(null,null,null,null),l=[a],d=[i,r];for(;0!==l.length;){const i=d.pop(),r=d.pop(),a=l.pop();if(i-r<o){const o=new Array(i-r+1);for(let s=r,a=0;s<=i;s++,a++)o[a]=e[t[s]];a.code=s[r],a.data=o}else{const e=findSplit2(t,s,r,i);a.code=e,r<=e&&(a.left=new b(null,null,null,null),l.push(a.left),d.push(r,e)),i>e&&(a.right=new b(null,null,null,null),l.push(a.right),d.push(e+1,i))}}return a}__name2(b,"Node"),__name2(buildIterative2,"buildIterative"),__name2(buildIterativeBuckets2,"buildIterativeBuckets");var v=Math.clz32||__name2((function clz2(e){let t=1<<31;for(let s=0;s<31;s+=1){if(t&e)return s;t>>>=1}return 32}),"clz");function findSplit2(e,t,s,i){const r=t[e[s]],o=t[e[i]];if(r===o)return s;const a=v(r^o);let l,d,h,u=s,c=i-s;do{c=c+1>>1,l=u+c,l<i&&(d=t[e[l]],h=v(r^d),h>a&&(u=l))}while(c>1);return u}__name2(findSplit2,"findSplit");var E,k,L,D,B,H,X,Y,Z,oe=class{constructor(e,{getX:t,getY:s,bucketSize:i=0,sfc:r=1}={}){this.bucketSize=0,this._root=null;const o=e.length,a=new Uint32Array(o);let l=1/0,d=1/0,h=-1/0,u=-1/0;this._x=t,this._y=s;const c=1===r?hilbert2:morton3;this._project=c;const m=new Uint32Array(o);for(let i=0;i<o;i++){const r=e[i],o=t(r),a=s(r);o<l&&(l=o),a<d&&(d=a),o>h&&(h=o),a>u&&(u=a),m[i]=i}this._minX=l,this._minY=d,this._maxX=h,this._maxY=u;const p=65535/Math.max(h-l,1),y=65535/Math.max(u-d,1);this._hw=p,this._hh=y;for(let i=0;i<o;i++){const r=e[i];a[i]=c(p*(t(r)-l),y*(s(r)-d))}radixSort2(m,a),this._root=0===i?buildIterative2(e,m,a,0,o-1):buildIterativeBuckets2(e,m,a,0,o-1,i),this.bucketSize=i}get root(){return this._root}inOrder(e,t){let s=this._root;const i=[];let r=!1;for(;!r;)if(s)i.push(s),s=s.left;else if(0!==i.length){if(s=i.pop(),e.call(t,s))break;s=s.right}else r=!0;return this}preOrder(e,t){const s=[this._root];for(;0!==s.length;){const i=s.pop();e.call(t,i)||(i.right&&s.push(i.right),i.left&&s.push(i.left))}return this}postOrder(e,t){const s=[];let i,r=this._root;do{for(;r;)r.right&&s.push(r.right),s.push(r),r=r.left;r=s.pop(),i=s.length-1,r.right&&s[i]===r.right?(s[i]=r,r=r.right):(e.call(t,r),r=null)}while(0!==s.length);return this}map(e,t){const s=[];return this.inOrder((i=>{s.push(e.call(t,i))})),s}height(){return treeHeight2(this._root)}toString(e=(e=>e.code.toString())){const t=[];return row2(this._root,"",!0,(e=>t.push(e)),e),t.join("")}size(){let e=0;return this.preOrder((()=>{e++})),e}destroy(){return this._root=null,this}};function treeHeight2(e){return e?1+Math.max(treeHeight2(e.left),treeHeight2(e.right)):0}function row2(e,t,s,i,r){if(e){i(t+(s?"^-- ":"|-- ")+r(e)+"\n");const o=t+(s?"    ":"|   ");e.left&&row2(e.left,o,!1,i,r),e.right&&row2(e.right,o,!0,i,r)}}__name2(oe,"BVH"),__name2(treeHeight2,"treeHeight"),__name2(row2,"row");var de=0;function repulsion4(e,t,s,{X:i,Y:r,R:o,bucketSize:a}){de=e,null===s&&(s=new oe(t,{getX:L,getY:D,bucketSize:a})).postOrder(E);const l=t.length;for(let e=0;e<l;e++)H=t[e],X=i[H],Y=r[H],Z=o[H],s.preOrder(k);return s}__name2(repulsion4,"repulsion");var he=__name2((({fx:e,fy:t,X:s,Y:i,R:r,masses:o,bucketSize:a},{charge:l,theta:d})=>h=>{let u=0,c=0;let m=X-h.cx||randomize2(),p=Y-h.cy||randomize2(),y=m*m+p*p,x=Z+h.r;const b=h.data;if(null!==b){if(b===H)return!1;if(0!==a){const a=b;for(let d=0;d<a.length;d++){const h=a[d];h!==H&&(m=X-s[h]||randomize2(),p=Y-i[h]||randomize2(),y=m*m+p*p,x=Z+r[h],y<1&&(y=Math.sqrt(1*y)),u=l*o[h],c=de*u/y,e[H]+=m*c,t[H]+=p*c)}}else y<1&&(y=Math.sqrt(1*y)),u=l*h.mass,c=de*u/y,e[H]+=m*c,t[H]+=p*c}else{const s=x/d;if(y>s*s)return y<1&&(y=Math.sqrt(1*y)),u=l*h.mass,c=de*u/y,e[H]+=m*c,t[H]+=p*c,!0}}),"getApplyForce"),ce=__name2((({X:e,Y:t,R:s,masses:i,bucketSize:r})=>o=>{let a,l,d=0,h=0,u=0,c=0;const m=o.data;if(null!==m)if(0!==r){const e=m,t=med2(e,L,D,B);d=t.x,h=t.y,u=t.r;for(let t=0;t<e.length;t++)c+=i[e[t]]}else l=m,d=e[l],h=t[l],u=s[l],c=i[l];else if(o.left&&o.right){const e=o.left.cx,t=o.left.cy,s=o.right.cx,i=o.right.cy,r=o.left.r,a=o.right.r,l=s-e,m=i-t,p=a-r,y=Math.sqrt(l*l+m*m);d=(e+s+l/y*p)/2,h=(t+i+m/y*p)/2,u=(y+r+a)/2,c=o.left.mass+o.right.mass}else a=o.left||o.right,d=a.cx,h=a.cy,u=a.r,c=a.mass;o.cx=d,o.cy=h,o.r=u,o.mass=c}),"getAccumulateBodies"),me=__name2(((e,t,s)=>{const i=e.length,{X:r,Y:o,R:a,degrees:l,pinned:d,masses:h,nodeIds:u}=t,{scaling:c,defaultRadius:m,bucketSize:p}=s;t.bucketSize=void 0===p?Math.floor(Math.log(i)):p;let y=1/0,x=1/0,b=-1/0,v=-1/0;const H=Math.PI*(3-Math.sqrt(5));let X=0;for(let t=0;t<e.length;t++){const s=e[t];let{x:i,y:p,r:E}=s;const{mass:k}=s;if(isNaN(i)||isNaN(p)){const e=5*Math.sqrt(t),s=t*H;i=e*Math.cos(s),p=e*Math.sin(s)}E=E||m,r[t]=i,o[t]=p,a[t]=E,d[t]=s.pinned?1:0,h[t]=void 0===k?(1+l[t])*c:k,u[t]=t,E>X&&(X=E),i<y&&(y=i),p<x&&(x=p),i>b&&(b=i),p>v&&(v=p)}if(e.length>1&&(b-y<2*X||v-x<2*X)){const e=(y+b)/2,t=(x+v)/2;for(let s=0;s<i;s++)if(!d[s]){const i=5*Math.sqrt(s),a=s*H,l=e+i*Math.cos(a),d=t+i*Math.sin(a);r[s]=l,o[s]=d,l<y&&(y=l),d<x&&(x=d),l>b&&(b=l),d>v&&(v=d)}}L=__name2((e=>r[e]),"getX"),D=__name2((e=>o[e]),"getY"),B=__name2((e=>a[e]),"getR"),E=ce(t),k=he(t,s)}),"initialize");function repulsion22(e,t,{masses:s,X:i,Y:r,fx:o,fy:a},{charge:l}){const d=t.length;let h,u,c,m,p,y,x,b,v;for(let E=0;E<d;E++){h=t[E];for(let k=E+1;k<d;k++)if(E!==k){if(u=t[k],h===u)continue;c=i[h]-i[u]||randomize2(),m=r[h]-r[u]||randomize2(),p=c*c+m*m,p<1&&(p=Math.sqrt(1*p)),y=l*s[u],x=e*y/p,b=l*s[h],v=e*b/p,o[h]+=c*x,a[h]+=m*x,o[u]-=c*v,a[u]-=m*v}}}function attraction2(e,t,{sources:s,targets:i,X:r,Y:o,R:a,fx:l,fy:d,degrees:h,weights:u},{edgeStrength:c,edgeLength:m}){for(let p=0;p<t.length;p++){const y=t[p],x=s[y],b=i[y],v=1,E=h[x]+v,k=h[b]+v,L=c*u[y];let D=r[b]+l[b]-r[x]-l[x]||randomize2(),B=o[b]+d[b]-o[x]-d[x]||randomize2();const H=D*D+B*B,X=Math.sqrt(H),Y=m+a[x]+a[b];if(X<=Y)continue;const Z=Y-X,oe=1/Math.min(E,k),de=Math.min(1,e*L*(Z*Z/H)*oe);D*=de,B*=de;const he=k/(k+E);l[x]+=D*he,d[x]+=B*he,l[b]-=D*(1-he),d[b]-=B*(1-he)}}repulsion4.initialize=me,__name2(repulsion22,"repulsion"),repulsion22.initialize=()=>{},__name2(attraction2,"attraction");var _e,pe,ye,xe,be,ve,Se,Ee,we,Ce=__name2(((e,{edgeIds:t,sources:s,targets:i,degrees:r,weights:o})=>{for(let a=0;a<e.length;a++){const{source:l,target:d,weight:h=1}=e[a];s[a]=l,i[a]=d,o[a]=h,r[l]++,r[d]++,t[a]=a,o[a]=void 0===h?1:h}}),"initialize");function collisionForce2(e,t,s,{X:i,Y:r,R:o,fx:a,fy:l,bucketSize:d},{elasticity:h}){if(0===h)return s;s||(s=new oe(t,{getX:_e,getY:pe,bucketSize:d})).postOrder(xe);for(let e=0;e<t.length;e++)ve=t[e],Se=i[ve]+a[ve],Ee=r[ve]+l[ve],we=o[ve],s.preOrder(be);return s}attraction2.initialize=Ce,__name2(collisionForce2,"collisionForce");var ke=__name2((({X:e,Y:t,R:s,bucketSize:i})=>r=>{let o,a,l,d;const h=r.data;if(null!==h)if(0!==i){const e=med2(h,_e,pe,ye);o=e.x,a=e.y,l=e.r}else{const i=h;o=e[i],a=t[i],l=s[i]}else if(r.left&&r.right){const e=r.left.cx,t=r.left.cy,s=r.right.cx,i=r.right.cy,d=r.left.r,h=r.right.r,u=s-e,c=i-t,m=h-d,p=Math.sqrt(u*u+c*c);o=(e+s+u/p*m)/2,a=(t+i+c/p*m)/2,l=(p+d+h)/2}else d=r.left||r.right,d&&(o=d.cx,a=d.cy,l=d.r);r.cx=o,r.cy=a,r.r=l}),"getMeasureBodies"),Me=__name2((({X:e,Y:t,R:s,fx:i,fy:r,bucketSize:o},{elasticity:a,margin:l})=>d=>{const h=d.data;if(null===h){const e=d.cx-Se,t=d.cy-Ee,s=d.r+we;return e*e+t*t>s*s}if(0!==o){const o=h;for(let d=0;d<o.length;d++){const h=o[d];if(h>ve){const o=s[h];let d=Se-e[h]-i[h],u=Ee-t[h]-r[h];const c=we+o+l;let m=d*d+u*u;if(m<c*c){0===d&&(d=randomize2(),m+=d*d),0===u&&(u=randomize2(),m+=u*u);const e=Math.sqrt(m),t=(c-e)*a/e,s=o/c;i[ve]+=d*t*s,r[ve]+=u*t*s,i[h]-=d*t*(1-s),r[h]-=u*t*(1-s)}}}}else{const o=d.data;if(o>ve){const d=s[o];let h=Se-e[o],u=Ee-t[o];const c=we+d+l;let m=h*h+u*u;if(m<c*c){0===h&&(h=randomize2(),m+=h*h),0===u&&(u=randomize2(),m+=u*u);const e=Math.sqrt(m),t=(c-e)*a/e,s=d/c;i[ve]+=h*t*s,r[ve]+=u*t*s,i[o]-=h*t*(1-s),r[o]-=u*t*(1-s)}}}}),"getApplyForce");function center2(e,t,{X:s,Y:i,fx:r,fy:o},{gravity:a,cx:l,cy:d}){let h=0,u=0;const c=t.length;for(let e=0;e<c;e++)h+=s[e],u+=i[e];h=h/c-l,u=u/c-d;for(let h=0;h<c;h++){const u=t[h],c=l-s[u]||randomize2(),m=d-i[u]||randomize2(),p=a*e;r[u]+=c*p,o[u]+=m*p}}collisionForce2.initialize=(e,t,s)=>{const{X:i,Y:r,R:o}=t;_e=__name2((e=>i[e]),"getX"),pe=__name2((e=>r[e]),"getY"),ye=__name2((e=>o[e]),"getR"),xe=ke(t),be=Me(t,s)},__name2(center2,"center");var Le=__name2(((e,t,s)=>{const{X:i,Y:r}=t;let o=s.cx,a=s.cy;const l=e.length;if(void 0===o||void 0===a){o=a=0;for(let e=0;e<l;e++)o+=i[e],a+=r[e];o/=l,a/=l}s.cx=o,s.cy=a}),"initialize");function potpack2(e){let t=0,s=0;for(const i of e)t+=i.w*i.h,s=Math.max(s,i.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let r=0,o=0;for(const t of e)for(let e=i.length-1;e>=0;e--){const s=i[e];if(!(t.w>s.w||t.h>s.h)){if(t.x=s.x,t.y=s.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===s.w&&t.h===s.h){const t=i.pop();e<i.length&&(i[e]=t)}else t.h===s.h?(s.x+=t.w,s.w-=t.w):t.w===s.w?(s.y+=t.h,s.h-=t.h):(i.push({x:s.x+t.w,y:s.y,w:s.w-t.w,h:t.h}),s.y+=t.h,s.h-=t.h);break}}}function boxpack2(e,t=1){return potpack2(e.map((e=>(e.w+=e.maxr+t,e.h+=e.maxr+t,e))).sort(((e,t)=>e.w*e.h-t.w*t.h)))}function spiralpack2(e,t=20,s,i,r){for(const o of e){const{x:e,y:a,r:l}=med2(o.ids,(e=>s[e]),(e=>i[e]),(e=>r[e]));o.cx=e,o.cy=a,o.radius=l+t}const o=e.slice().sort(((e,t)=>e.radius-t.radius)),a=o.map((e=>({x:e.cx,y:e.cy,r:e.radius}))),l=o.pop();let d=3*Math.PI/2,h=l.radius;const u=2*Math.PI,{cx:c,cy:m}=l,p=[l];for(;0!==o.length;){const e=o[o.length-1],t=h+e.radius,s=c+Math.cos(d)*t,i=m+Math.sin(d)*t;p.some((t=>{const r=t.cx-s,o=t.cy-i;return Math.sqrt(r*r+o*o)<t.radius+e.radius}))?h+=1:(e.x=s-e.w/2,e.y=i-e.h/2,e.cx=s,e.cy=i,a[o.length-1].x=s,a[o.length-1].y=i,p.push(o.pop()),d+=(2*e.radius+1)/t*1%u)}}center2.initialize=Le,__name2(potpack2,"potpack"),__name2(boxpack2,"boxpack"),__name2(spiralpack2,"spiralpack");var Ie=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(e,t,s,i){this.ids.push(e),t-i<this.xmin&&(this.xmin=t-i),s-i<this.ymin&&(this.ymin=s-i),t+i>this.xmax&&(this.xmax=t+i),s+i>this.ymax&&(this.ymax=s+i),i>this.maxr&&(this.maxr=i),this.mx+=i*t,this.my+=i*s,this.m+=i}measure(e=0){return this.w=this.xmax-this.xmin+2*e,this.h=this.ymax-this.ymin+2*e,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function unorderedPair2(e,t){return e<t?e*t+Math.pow(t-e-1,2)/4:e*t+Math.pow(e-t-1,2)/4}function orderedPair3(e,t){return(e+t)*(e+t+1)/2+t}function alignSiblings2({edgeIds:e,sources:t,targets:s,pinned:i,degrees:r,X:o,Y:a,R:l},d=0,h=.5){const u={},c={};for(const i of e){const e=t[i],r=s[i];e!==r&&(u[e]=u[e]||{},u[r]=u[r]||{},u[e][r]=!0,u[r][e]=!0)}Object.keys(u).forEach((e=>{const t=Number(e),s=Object.keys(u[Number(t)]);if(2===s.length){const[e,r]=s,o=unorderedPair2(Number(e),Number(r));o in c||(c[o]=[Number(r),Number(e)]),i[t]||c[o].push(t)}})),Object.keys(c).forEach((e=>{const[t,s,...i]=c[Number(e)];if(i.length<3)return;const u=o[t],m=a[t],p=o[s],y=a[s],x=r[t],b=.25+.5*x/(x+r[s]);let v=u+(p-u)*b,E=m+(y-m)*b,k=-(y-m),L=p-u;const D=Math.sqrt(Math.pow(u-p,2)+Math.pow(m-y,2));k=-2*k/D,L=-2*L/D;const B=Math.acos(k/Math.sqrt(k*k+L*L));d>0&&(B<d||B>Math.PI-d&&B<=Math.PI?(k=2*Math.cos(Math.PI-d),L=2*Math.sin(Math.PI-d)):(B>2*Math.PI-d||B>=Math.PI&&B<Math.PI+d)&&(k=2*Math.cos(d),L=2*Math.sin(d)));let H=0,X=1;i.sort(((e,t)=>l[t]-l[e]));let Y=0,Z=0;const oe=Math.max(l[i[0]],l[i[1]])/2;i.length%2==1&&(H=1,v-=k*oe,E-=L*oe);const de=1+h;for(let e=0;e<i.length;e++){const t=(H+e)%2,s=i[e],r=e>=2?l[s]:oe,d=(t?Y:Z)+r;o[s]=v+k*X*d,a[s]=E+L*X*d,t?Y+=r*de:Z+=r*de,X=-X}}))}function groupAndMeasure2(e,t,s,i){let r=0;const o=[];for(const a of i){const i=new Ie;for(const r of a)i.add(r,e[r],t[r],s[r]);o.push(i.measure()),a.length>o[r].ids.length&&(r=o.length-1)}return{boxes:o,biggest:r}}function postprocessing2(e,t,{X:s,Y:i,R:r,components:o,pinned:a,degrees:l,sources:d,targets:h,edgeIds:u},{update:c,onUpdate:m,placement:p,placementOffset:y,alignSiblings:x,siblingsMinAngle:b,siblingsOffset:v}){if(x&&(alignSiblings2({X:s,Y:i,R:r,degrees:l,pinned:a,sources:d,targets:h,edgeIds:u},b,v),c(e,s,i)),p){const{boxes:t,biggest:a}=groupAndMeasure2(s,i,r,o);if("spiral"===p)spiralpack2(t,y,s,i,r);else{if("box"!==p)return;boxpack2(t,y)}const l=t[a].xmin-t[a].x,d=t[a].ymin-t[a].y;for(const e of t){const{xmin:t,ymin:r,x:o,y:a,ids:h}=e,u=t-o-l,c=r-a-d;for(const e of h)s[e]-=u,i[e]-=c}c(e,s,i),m()}}function singleLevel(e,t,{X:s,Y:i,nodeIds:r,edgeIds:o,layers:a,movements:l,movementsPrev:d,surfaces:h,surfacesPrev:u},c,m,p){const{nextTick:y,cancelTick:x,batch:b,steps:v,minMovement:E,update:k,onUpdate:L,autoStop:D}=c;let B=0,H=1;let X,Y=1-Math.pow(.05,1/v),Z=!1;const oe=__name2((()=>{Z=!0,x(X),L(),p(B)}),"stop");let de=!1;const he=__name2((()=>{H+=(.001-H)*Y;const t=m(H,r,o),c=a.length;let p=!1,x=!1;if(D){p=x=!0;const{movementRatio:e,surfaceRatio:t}=D;for(let s=0;s<c;s++)p&&Math.abs(1-h[s]/u[s])>t&&(p=!1),x&&Math.abs(l[s]-d[s])>e&&(x=!1)}p&&x&&!de&&(Y=1-Math.pow(.001,1/Math.max(10,B)),de=!0);const ce=Z||H<.05||0!==t&&t<=E;if(B%b==0&&(k(e,s,i),L()),++B>=v||ce)return oe();for(let e=0;e<c;e++)d[e]=l[e],u[e]=h[e];X=y(he)}),"simulationStep");return{done:!1,start(){return X=setTimeout(he),this},stop(){return oe(),this},get iterations(){return B}}}function multiLevel(e,t,{X:s,Y:i,R:r,degrees:o,nodeIds:a,edgeIds:l,layers:d,layer:u,cluster:c,masses:m,weights:p,sources:y,targets:x},{cx:b,cy:v,nextTick:E,cancelTick:k,update:L,onUpdate:D,batch:B,maxIterations:H,steps:X,minMovement:Y},Z,oe){const de=d.slice();let he,ce=0;function stop(){k(he),L(e,s,i),D(),oe(ce)}__name2(stop,"stop");const me={};for(let e=0;e<t.length;e++)me[Number(t[e].id)||e]=e;const _e=new Map;for(let e=0;e<l.length;e++){const t=l[e];_e.set(orderedPair3(y[t],x[t]),t)}for(let e=0;e<d.length;e++){const s=d[e],i=e;for(let e=0;e<s.length;e++){const t=s[e],i=c[t];-1!==i&&(m[i]+=m[t])}for(let e=0;e<t.length;e++){const s=t[e],r=Number(s.id)||e,o=s.source,a=s.target,l=p[me[r]];if(u[o]===i&&u[a]===i){const e=c[o],t=c[a];if(e!==t){const s=_e.get(orderedPair3(e,t));void 0!==s&&(p[s]+=l)}}}}a.length=0,l.length=0;let pe=1;const ye=1-Math.pow(.1,1/X/2),xe=(pe-.1)/X;let be,ve,Se=.5;function simulationStep(){pe+=(0-pe)*ye;const d=Z(pe,a,l);let u=pe<=Se||d<Y;if(0===ce||u){const e=de.pop();if(e){be&&(ve=be.reduce(((e,t)=>Math.max(e,b-s[t],v-i[t])),0)),a.push.apply(a,e);for(let t=0;t<e.length;t++){const a=e[t],l=c[a];if(-1!==l){const e=o[a]>1?2:1,t=r[l]+r[a];m[l]-=m[a],s[a]=s[l]+e*t*(2*h()-1),i[a]=i[l]+e*t*(2*h()-1)}else be&&(s[a]=b+2*ve*(1-2*h()),i[a]=v+2*ve*(1-2*h()))}be=e;const d=a.reduce(((e,t)=>(e[t]=!0,e)),{});l.length=0;for(let e=0;e<t.length;e++){const{source:s,target:i,id:r}=t[e];d[s]&&d[i]&&l.push(me[Number(r)])}u=!1,0===de.length?(pe=.2,Se=.1):(pe=.1+2*xe,Se=.1)}}ce%B==0&&(L(e,s,i),D()),++ce>=Infinity||u?stop():he=E(simulationStep)}return __name2(simulationStep,"simulationStep"),{done:!1,start(){return he=setTimeout(simulationStep),this},stop(){return stop(),this},get iterations(){return ce}}}function euler(e,t,{X:s,Y:i,fx:r,fy:o,vx:a,vy:l,masses:d,pinned:h},u){let c=0,m=0;const p=e.length,y=1/8;for(let t=0;t<p;t++){const u=e[t],p=d[u],x=r[u]/p,b=o[u]/p;a[u]+=x*y,l[u]+=b*y;const v=.2*a[u]*y+.5*x*y*y,E=.2*l[u]*y+.5*b*y*y;r[u]=o[u]=0,h[u]||(s[u]+=v,i[u]+=E,c+=Math.abs(v)*p,m+=Math.abs(E)*p)}return(c*c+m*m)/p}function velocityVerlet(e,t,{X:s,Y:i,fx:r,fy:o,pinned:l,layer:d,layers:h,surfaces:u,movements:c},{maxDisplacement:m}){c.fill(0);let p=0;const y=e.length;let x=1/0,b=1/0,v=-1/0,E=-1/0;const k=m*m;for(let a=0;a<y;a++){const h=e[a],u=r[h]*=t,y=o[h]*=t,L=d[h];let D=u,B=y;const H=s[h],X=i[h];if(D*D+B*B>k){const e=Math.sqrt(D*D+B*B)/m;B/=e,D/=e}l[h]||(s[h]+=D,i[h]+=B);const Y=Math.sqrt(D*D+B*B);l[h]||(H<x&&(x=H),X<b&&(b=X),H>x&&(v=H),X>b&&(E=X),c[L-1]+=Y),p+=L*Y}const L=Math.max(v-x,0),D=Math.max(E-b,0);for(let e=0;e<h.length;e++){const t=h[e],r=t.length;let o=1/0,d=1/0,m=-1/0,p=-1/0,y=0;for(let e=0;e<r;e++){const r=t[e];if(l[r])continue;const a=s[r],h=i[r];a<o&&(o=a),h<d&&(d=h),a>m&&(m=a),h>p&&(p=h),y++}const x=m-o,b=p-d,v=Math.max(1,Math.sqrt(a(x,2)+a(b,2)));u[e]=v;const E=0===y?0:c[e]/y,k=L*D||1;c[e]=E>y?E/k:0}return p}function leapfrog(e,t,{X:s,Y:i,fx:r,fy:o,vx:a,vy:l,pinned:d,masses:h},u){const c=e.length;let m=0;for(let u=0;u<c;u++){const c=e[u],p=h[c],y=r[c]/p,x=o[c]/p,b=a[c]+1*y,v=l[c]+1*x;let E=1*b,k=1*v;E>1e4&&(E=.1),k>1e4&&(k=.1),a[c]=t*(b+a[c])/2,l[c]=t*(v+l[c])/2,r[c]=o[c]=0,d[c]||(s[c]+=E,i[c]+=k),m+=.5*(E*E+k*k)}return m}__name2(Ie,"Component"),__name2(unorderedPair2,"unorderedPair"),__name2(orderedPair3,"orderedPair"),__name2(alignSiblings2,"alignSiblings"),__name2(groupAndMeasure2,"groupAndMeasure"),__name2(postprocessing2,"postprocessing"),__name2(singleLevel,"singleLevel"),__name2(multiLevel,"multiLevel"),__name2(euler,"euler"),__name2(velocityVerlet,"velocityVerlet"),__name2(leapfrog,"leapfrog");var Ne=(e=>(e[e.verlet=0]="verlet",e[e.euler=1]="euler",e))(Ne||{}),Pe=0,Fe="undefined"==typeof window,ze="undefined"!=typeof performance&&performance.now?performance:Date,De=Fe?e=>{const t=ze.now(),s=Math.max(0,16-(t-Pe)),i=setTimeout((()=>e(t+s)),s);return Pe=t+s,i}:window.requestAnimationFrame,Re=Fe?e=>clearTimeout(e):window.cancelAnimationFrame;function defaultUpdate2(e,t,s){for(let i=0;i<e.length;i++){const r=e[i];r.x=t[i],r.y=s[i]}}__name2(defaultUpdate2,"defaultUpdate");var Oe=__name2((e=>{}),"noop"),Be={movementRatio:7e-8,surfaceRatio:.0025},je=class{constructor(e={}){this.onUpdate=Oe,this.update=defaultUpdate2,this.nextTick=De,this.cancelTick=Re,this.onEnd=Oe,this.charge=10,this.maxIterations=300,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=1,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=300,this.scaling=1,this.defaultRadius=1,this.autoStop=Be,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in e?e.autoStop&&("boolean"==typeof e.autoStop?e.autoStop=Be:e.autoStop=__spreadValues3(__spreadValues3({},e.autoStop),Be)):e.steps;for(const t in e)void 0!==e[t]&&(this[t]=e[t])}};function topology_default2(e,t,s){initTopology2(e,t,s),decomposition2(s)}function initTopology2(e,t,{sources:s,targets:i,degrees:r,nodeIds:o,edgeIds:a}){const l={};for(let t=0;t<e.length;t++)l[t]=o[t]=t;for(let e=0;e<t.length;e++){const{source:o,target:d}=t[e],h=l[o],u=l[d];a[e]=e,s[e]=h,i[e]=u,r[h]++,r[u]++}}function decomposition2({nodeIds:e,edgeIds:t,sources:s,targets:i,degrees:r,layer:o,layers:a,component:l,components:d,cluster:h,parent:u}){let c=0,m=1;const p=new Uint32Array(e.length);for(let t=0;t<e.length;t++)p[t]=r[t];const y=new Array(e.length);for(let e=0;e<t.length;e++){const r=t[e],o=s[r],a=i[r];y[o]=y[o]||[],y[a]=y[a]||[],y[o].push(a),y[a].push(o)}const x=new Uint8Array(e.length),b=new Uint8Array(e.length);u.fill(-1);let v=0;for(let t=0;t<e.length;t++)if(0===x[t]){const e=[t];for(;0!==e.length;){const t=e.pop();0===x[t]&&(e.push.apply(e,y[t]),x[t]=1,l[t]=v)}v++}const E=new Array(e.length);for(let t=0;t<e.length;t++)o[t]=0,E[t]=t;for(;0!==E.length;){const e=[],t=[];for(let s=0;s<E.length;s++)p[E[s]]<=c&&(e.push(s),t.push(E[s]));for(let e=0;e<t.length;e++){const s=t[e];b[s]=c,o[s]=m;const i=y[s];if(i)for(let e=0;e<i.length;e++)p[i[e]]--}for(let e=0;e<t.length;e++){const s=t[e],i=y[s];if(i)for(let e=0;e<i.length;e++){const t=i[e],r=o[t];if(void 0===r||r>m){u[s]=t;break}}}e.reverse();for(let t=0;t<e.length;t++)E.splice(e[t],1);if(m+=1,E.length>0){let e=1/0;for(let t=0;t<E.length;t++){const s=p[E[t]];s<e&&(e=s)}e>=c+1&&(c=e,m=1)}}x.fill(0);for(let t=0;t<e.length;t++){const s=e[t],i=o[s];if(-1===u[s]||o[u[s]]===i){const e=[s];for(x.fill(0);0!==e.length;){const t=e.pop();if(x[t])continue;if(o[t]>i){u[s]=t;break}const r=y[t];x[t]=1,r&&e.push.apply(e,r)}}}for(let t=0;t<e.length;t++){const s=e[t],i=l[s];d[i]=d[i]||[],d[i].push(s);const r=o[s]-1;a[r]=a[r]||[],a[r].push(s),h[s]=u[s]}}__name2(je,"Settings"),__name2(topology_default2,"default"),__name2(initTopology2,"initTopology"),__name2(decomposition2,"decomposition");var Ve=class{constructor(e,t=!0){this.bucketSize=0;const s=e.nodes.length,i=e.edges.length;setSeed2(s+i),this.X=new Array(s),this.Y=new Array(s),this.R=new Array(s),this.fx=new Float32Array(s),this.fy=new Float32Array(s),this.vx=new Float32Array(s),this.vy=new Float32Array(s),this.pinned=new Uint8Array(s),this.masses=new Float32Array(s),this.weights=new Float32Array(i),this.lengths=new Float32Array(i),this.sources=new Uint32Array(i),this.targets=new Uint32Array(i),this.degrees=new Uint32Array(s),this.layer=new Uint32Array(s),this.parent=new Int32Array(s),this.cluster=new Int32Array(s),this.component=new Uint32Array(s),this.components=[],this.layers=[],this.nodeIds=new Array(s),this.edgeIds=new Array(i),t&&topology_default2(e.nodes,e.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}};__name2(Ve,"LayoutData");var Ue=class{constructor(e){this.promise=new Promise(e)}then(e){return this.promise.then(e)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};__name2(Ue,"SimulationPromise");var Ge,We={euler,verlet:velocityVerlet,leapfrog};function force2(e,t={}){let s,i;const r=__name2(((e={nodes:[],edges:[]})=>(s=e.nodes,i=e.edges,setSeed2(orderedPair3(s.length,i.length)),new Ve(e))),"setGraph"),o=__name2(((e={})=>new je(e)),"setOptions");let a=r(e),l=o(t);attraction2.initialize(i,a),repulsion4.initialize(s,a,l),collisionForce2.initialize(s,a,l),center2.initialize(s,a,l);const d=We[l.integrator]||velocityVerlet;let h=null;const u=__name2(((e,t,s)=>(h&&(h.destroy(),h=null),t.length<=1?0:(l.barnesHutOptimization?h=repulsion4(e,t,h,a):repulsion22(e,t,a,l),attraction2(e,s,a,l),h&&0!==l.elasticity&&collisionForce2(0,t,h,a,l),center2(e,t,a,l),d(t,l.inertia,a,l)))),"step");let c;return{setOptions:(e={})=>(l=o(e),this),setGraph:({nodes:t,edges:s})=>(a=r(e),attraction2.initialize(s,a),repulsion4.initialize(t,a,l),collisionForce2.initialize(t,a,l),center2.initialize(t,a,l),this),start(){return c=(l.multilevel?multiLevel:singleLevel)(s,i,a,l,u,(e=>{c.done||postprocessing2(s,0,a,l),l.onEnd(e),c.done=!0})).start(),this},iterations:()=>c.iterations,data:()=>a,stop(){return c&&c.stop(),this},step(e=1){return u(e,a.nodeIds,a.edgeIds),l.update(s,a.X,a.Y),this}}}return __name2(force2,"force"),force2.run=(e,t)=>{let s;const i=new Ue((i=>{t.onEnd=i,s=force2(e,t).start()}));return i.simulation=s,i.stop=()=>(s.stop(),i),i},Ge=l,((i,o,a,l)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let d of s(o))r.call(i,d)||d===a||e(i,d,{get:()=>o[d],enumerable:!(l=t(o,d))||l.enumerable});return i})(e({},"__esModule",{value:!0}),Ge)})();return force.default.apply(this,arguments)}__name(gpuLayout,"gpuLayout"),gpuLayout.run=(e,t,s)=>{let i;const r=new lu((r=>{s.onEnd=r,i=gpuLayout(e,t,s).start()}));return r.simulation=i,r.stop=()=>(i.stop(),r),r};var Eu={name:"force",imports:{force:forceWrapper},configure(e,{graph:t,events:s}){const i=e.nodes._indexes,r=t.getNodeAttribute("x").getMultiple(i),o=t.getNodeAttribute("y").getMultiple(i),a=t.getNodeAttribute("radius").getMultiple(i),l=t.getNodeAttribute("layoutable").getMultiple(i),d=e.edges,h=[],u=[],c={};void 0===e.edgeStrength&&(e.edgeStrength=.5),null==e.gravity&&(e.gravity=.01),null==e.siblingsOffset&&(e.siblingsOffset=0),null==e.theta&&(e.theta=.62),e.autoStop=!!e.autoStop,e.alignSiblings=!!e.alignSiblings;const m=e.radiusRatio||1.25;for(let t=0;t<e.nodes._indexes.length;t++){const s=e.nodes._indexes[t];c[s]=t,h.push({id:t,x:r[t],y:o[t],r:a[t]*m,pinned:!l[t]})}d.forEach((e=>{const t=c[e.getSource()._index],s=c[e.getTarget()._index];t!==s&&void 0!==t&&void 0!==s&&u.push({source:t,target:s})}));const p=ensureTransferable(__spreadValues({},e));return delete p.nodes,delete p.edges,{graph:{nodes:h,edges:u},options:p,indexes:e.nodes._indexes,done:!1,x:r,y:o,chunkPeriod:250}},update:function(e,t){if(!t.simulation&&e){let s;t.done=!1,t.graph=e.graph,t.options=e.options,t.indexes=e.indexes;let i=!1;if(e.options.gpu){const r=getGlContext("webgl2",{},(()=>{$warn("GPU layout: WebGL context not available. Falling back on CPU."),t.simulation=void 0,t.options.gpu=!1,t.cleanUp&&t.cleanUp(),this._update(e,t)}));r&&(s=r.context,t.cleanUp=r.cleanUp),i=!!s}let r=Date.now();i||(e.options.nextTick=e=>Date.now()-r<=t.chunkPeriod?e():(r=Date.now(),setTimeout(e,0))),e.options.update=(e,s,i)=>{t.x=s,t.y=i},e.options.onEnd=()=>{t.done=!0,t.simulation=void 0,t.cleanUp&&t.cleanUp()},e.options.bucketSize=0,e.options.batch=16;const o=i&&s?gpuLayout(e.graph,s,e.options).start():forceWrapper(e.graph,e.options).start(),{X:a,Y:l}=o.data();t.simulation=o,t.x=a,t.y=l}return{graph:t.graph,indexes:t.indexes,x:t.x,y:t.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(e){e.done=!0,e.simulation&&(e.simulation.stop(),delete e.simulation)},isRunning:function(e){return!e.done||(e.done=!1,!1)},onSync:function({indexes:e,x:t,y:s}){return{indexes:e,x:t,y:s}}};var wu=10;function closestPointOnConvexHull(e,t,s){let i,r,o=1/0;for(let s=0,a=t.length;s<a;s++){const l=t[s],d=t[(s+1)%a],h=distToSegmentSquared(e[0],e[1],l[0],l[1],d[0],d[1]);h<o&&(o=h,i=l,r=d)}return function perpPoint(e,t,s,i,r,o,a){const l=getClosestPointOnSegment(e,t,s,i,r,o);let d=-(i-o),h=s-r;const u=Math.sqrt(d*d+h*h);return d/=u,h/=u,[l.x-a*d,l.y-a*h]}(e[0],e[1],i[0],i[1],r[0],r[1],s)}function placeNodeGroup(e,t,s){const{duration:i=0,margin:r=5,referenceNodes:o,nodes:a}=t,{ids:l,subgraphPositions:d,radii:h}=function filterSubgraphPositionsAndRadii(e,t,s,i){const r=[],o=[],a=[];return e.forEach(((e,l)=>{i[l]&&(r.push(e),o.push(t[l]),a.push(s[l]))})),{ids:r,subgraphPositions:o,radii:a}}(a.getId(),s,a.getAttribute("radius"),a.getAttribute("layoutable")),u=e.getNodes(l);let c=o;!c||c instanceof xi||(c=e.getNodes(c));const m=c||u.inverse(),p=m.getPosition().map((e=>[e.x,e.y])),y=u.getBoundingBox(),x=m.getBoundingBox();x.pad(x.maxScaledSize);const b={layoutName:"incremental",ids:u.getId(),positions:{before:d,current:d}};if(!u.size)return Promise.resolve(b);const v=minDisk(d.map((e=>e.x)),d.map((e=>e.y)),h),[E,k]=v,L=v[2]+x.maxScaledSize+r;let D,B=0,H=0;if(function pointsInCircle(e,t,s,i){for(let r=0;r<e.length;r++){const[o,a]=e[r],l=Math.abs(o-t),d=Math.abs(a-s);if(l+d<=i)return!0;if(!(l>i||d>i)&&l*l+d*d<=i*i)return!0}return!1}(p,E,k,L))if(m.size<=3){if(circleIntersectsBox(E,k,v[2],x.minX,x.minY,x.maxX,x.maxY)){const e=function massCenterOnBboxProjection(e,t,s){const i=segmentRectangleIntersection(s.cx,s.cy,e,t,s.minX,s.minY,s.maxX,s.maxY);let r,o=1/0,a={x:s.maxX,y:t};for(const s of i)r=distance(e,t,s.x,s.y),r<o&&(o=r,a=s);return a}(E,k,x);D=distance(x.cx,x.cy,e.x,e.y);const t=function pointOnLine(e,t,s,i,r){return{x:e+r*(s-e),y:t+r*(i-t)}}(x.cx,x.cy,e.x,e.y,(D+L)/D);B=t.x-E,H=t.y-k}}else{const e=oe.from(p,(e=>e[0]),(e=>e[1])),t=indexArrayToArray(e.triangles,p),s=p.length>3?indexArrayToArray(e.hull,p):function boundingBoxToPolygon(e){const t=e.bottomLeft(),s=e.topRight();return[[t.x,t.y],[t.x,s.y],[s.x,s.y],[s.x,t.y]]}(x),i=getLargestEmptyCircle(m.getPosition(),wu,L,t,s);let r=closestPointOnConvexHull([E,k],s,L);if(i.length>0){let e=Math.pow(E-r[0],2)+Math.pow(k-r[1],2);for(const t of i)B=E-t[0],H=k-t[1],D=B*B+H*H,D<e&&(e=D,r=t.slice(0,2));B=r[0]-E,H=r[1]-k}else B=r[0]-y.cx,H=r[1]-y.cy}if(B||H){const s=d.map((e=>(e.x+=B,e.y+=H,e)));if(t.locate){"boolean"==typeof t.locate&&(t.locate={});const r=e.modules.locate.layoutDataBoundingBox({x:[...p.map((e=>e[0])),...s.map((e=>e.x))],y:[...p.map((e=>e[1])),...s.map((e=>e.y))],indexes:e.getNodes()._indexes}),o=e.modules.locate.computeConfigForBounds(r,t.locate);e.modules.camera.setView(o,{duration:i,easing:t.locate.easing,ignoreZoomLimits:!0})}return b.positions.current=s,u.setAttributes(s,i).then((()=>b))}return u.setAttributes(d,i).then((()=>b))}function incrementalLayout(e,t,s){const i=ensureGraphItems(t.modules.graph,e);if("boolean"!=typeof i.incremental&&"margin"in i.incremental&&!isFinite(i.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");const r=deepCopy(i);return"boolean"!=typeof i.incremental&&(r.margin=i.incremental.margin,r.referenceNodes=i.incremental.referenceNodes),r.centralNode&&!r.centralNode.getAttribute("layoutable")?function layoutArea(e,t,s){const{nodes:i,duration:r,centralNode:o}=t,a=i,l=a.reduce(((e,t)=>(e[t._index]=!0,e)),{}),d=e.getNodes();if(t.focusOnGroupShape)return s({nodes:a,duration:0}).then((()=>{const t=a.concat(o),i=t.getAttribute("layoutable");return t.setAttributes({layoutable:!1}),s({nodes:e.getNodes(),duration:r}).then((()=>t.setAttributes(i)))}));{const e=deepCopy(t);return delete e.centralNode,e.incremental=!1,e.nodes=d,e.nodeMass=(e,t)=>(t+1)*(l[e._index]?1:2),s(e)}}(t,r,s):function layoutSubgraph(e,t,s){const i=deepCopy(t);return i.duration=0,i.dryRun=!0,i.locate=!1,delete i.incremental,s(i).then((s=>placeNodeGroup(e,t,s.positions.current)))}(t,r,s)}var Tu={name:"forceLink",configure:function(e,{graph:t,camera:s,graphics:i}){const r=e.nodes._indexes,o=e.edges._indexes,a={},l={},d=r.length,h=o.length;let u;var c=t.getObjectList(!0),m=t.getObjectList(!1);(e.nodes||e.edges)&&(delete(e=deepCopy(e)).nodes,delete e.edges);const p=t.getNodeAttribute("innerStroke.width").getMultiple(r),y=t.getNodeAttribute("outerStroke.width").getMultiple(r),x=t.degrees(r),b=t.getNodeAttribute("x").getMultiple(r),v=t.getNodeAttribute("y").getMultiple(r),E=t.getNodeAttribute("radius").getMultiple(r),k=t.nodeList(r).getAttribute("layoutable"),L="function"==typeof e.nodeMass?e.nodeMass:function(e,t,s){return t+1};delete e.nodeMass;const D="function"==typeof e.edgeWeight?e.edgeWeight:function(e){return 1};delete e.edgeWeight,isFinite(e.scalingRatio)||delete e.scalingRatio;const B=r.reduce(((e,t,s)=>(k[s]||(e[t]=!0),e)),{});let H=0,X=0,Y=0;const Z=s.getZoom();for(u=0;u<r.length;++u){const e=r[u],t=b[u],s=v[u],i=E[u]+(p[u]+y[u])/Z;a[e]={id:e,x:t,y:s,degree:x[u],size:i,pinned:!!B[e],mass:L(c.get(e),x[u],u)},Y=Math.max(i,Y)}if(d>1)for(u=0;u<d;u++){const e=a[r[u]];H+=e.x,X+=e.y}H/=d,X/=d;const oe={x:H,y:X},de=t.edgeList(o),he=de.getSource()._indexes,ce=de.getTarget()._indexes;for(u=0;u<h;u++){const e=o[u],t=he[u],s=ce[u];a[t]&&a[s]&&(l[e]={source:t,target:s},l[e].weight=D(m.get(e)))}return{nodes:a,edges:l,maxSize:Y,config:ensureTransferable(e),barycentre:oe}},context:function(){return{chunkPeriod:250}},update:function(e,t){let s;!t.W&&e?(s={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},t.W=s,function init(e,i){const r=function graphToByteArrays(e,t){let i,r,o,a=e.nodes,l=e.edges,d=e.maxSize,h=Object.keys(e.nodes),u=Object.keys(e.edges),c=h.length*s.ppn,m=u.length*s.ppe,p={};const y=Math.pow(10,Math.log(Math.max(d,1))-6),x=y/2,b=Math.random,v=t.randomizeFactor||1;let E;E="locally"===t.randomize?e=>e+b()*v:"globally"===t.randomize?e=>b()*v:e=>e+b()*y-x;const k=new Float32Array(c),L=new Float32Array(m);for(i=r=0,o=h.length;i<o;i++){const e=h[i],t=a[e];let o=t.x,l=t.y;t.pinned||(o=E(o),l=E(l)),p[e]=r,k[r]=o,k[r+1]=l,k[r+2]=0,k[r+3]=0,k[r+4]=0,k[r+5]=0,k[r+6]=t.mass,k[r+7]=1,k[r+8]=t.size,k[r+9]=t.pinned||0,r+=s.ppn}for(i=r=0,o=u.length;i<o;i++){const e=l[u[i]];L[r]=p[e.source],L[r+1]=p[e.target],L[r+2]=e.weight||0,r+=s.ppe}return{nodes:k,edges:L}}(e,i);t.NodeMatrix=r.nodes,t.EdgeMatrix=r.edges,s.nodesLength=t.NodeMatrix.length,s.edgesLength=t.EdgeMatrix.length}(e,e.config),s.settings=function extend2(e,t){for(const s in e)t[s]=e[s];return t}(e.config,s.settings),t.nodes=e.nodes,t.edges=e.edges,t.barycentre=e.barycentre):s=t.W;let i,r=t.NodeMatrix,o=t.EdgeMatrix;const a=0,l=1,d=2,h=3,u=4,c=5,m=6,p=7,y=8,x=9,b=0,v=1,E=2,k=0,L=1,D=2,B=3,H=4,X=5,Y=6,Z=7,oe=8;function pass(){let e,t,de,he,ce,me,_e,pe,ye,xe,be,ve,Se,Ee,we,Ce,ke;for(de=0;de<s.nodesLength;de+=s.ppn)r[de+u]=r[de+d],r[de+c]=r[de+h],r[de+d]=0,r[de+h]=0;if(s.settings.outboundAttractionDistribution){for(ye=0,de=0;de<s.nodesLength;de+=s.ppn)ye+=r[de+m];ye/=s.nodesLength}if(s.settings.barnesHutOptimize){let o,d,h,u,c=1/0,p=-1/0,y=1/0,x=-1/0;for(i=[],de=0;de<s.nodesLength;de+=s.ppn)c=Math.min(c,r[de+a]),p=Math.max(p,r[de+a]),y=Math.min(y,r[de+l]),x=Math.max(x,r[de+l]);const b=p-c,v=x-y;b>v?(y-=(b-v)/2,x=y+b):(c-=(v-b)/2,p=c+v),i[0+k]=-1,i[0+L]=(c+p)/2,i[0+D]=(y+x)/2,i[0+B]=Math.max(p-c,x-y),i[0+H]=-1,i[0+X]=-1,i[0+Y]=0,i[0+Z]=0,i[0+oe]=0,e=1;for(de=0;de<s.nodesLength;de+=s.ppn)for(t=0,h=s.MAX_SUBDIVISION_RETRIES;;){if(!(i[t+X]>=0)){if(i[t+k]<0){i[t+k]=de;break}if(i[t+X]=e*s.ppr,_e=i[t+B]/2,pe=i[t+X],i[pe+k]=-1,i[pe+L]=i[t+L]-_e,i[pe+D]=i[t+D]-_e,i[pe+B]=_e,i[pe+H]=pe+s.ppr,i[pe+X]=-1,i[pe+Y]=0,i[pe+Z]=0,i[pe+oe]=0,pe+=s.ppr,i[pe+k]=-1,i[pe+L]=i[t+L]-_e,i[pe+D]=i[t+D]+_e,i[pe+B]=_e,i[pe+H]=pe+s.ppr,i[pe+X]=-1,i[pe+Y]=0,i[pe+Z]=0,i[pe+oe]=0,pe+=s.ppr,i[pe+k]=-1,i[pe+L]=i[t+L]+_e,i[pe+D]=i[t+D]-_e,i[pe+B]=_e,i[pe+H]=pe+s.ppr,i[pe+X]=-1,i[pe+Y]=0,i[pe+Z]=0,i[pe+oe]=0,pe+=s.ppr,i[pe+k]=-1,i[pe+L]=i[t+L]+_e,i[pe+D]=i[t+D]+_e,i[pe+B]=_e,i[pe+H]=i[t+H],i[pe+X]=-1,i[pe+Y]=0,i[pe+Z]=0,i[pe+oe]=0,e+=4,u=t+k,o=r[i[u]+a]<i[t+L]?r[i[u]+l]<i[t+D]?i[t+X]:i[t+X]+s.ppr:r[i[u]+l]<i[t+D]?i[t+X]+2*s.ppr:i[t+X]+3*s.ppr,i[t+Y]=r[i[u]+m],i[t+Z]=r[i[u]+a],i[t+oe]=r[i[u]+l],i[o+k]=i[t+k],i[t+k]=-1,d=r[de+a]<i[t+L]?r[de+l]<i[t+D]?i[t+X]:i[t+X]+s.ppr:r[de+l]<i[t+D]?i[t+X]+2*s.ppr:i[t+X]+3*s.ppr,o===d){if(h--){t=o;continue}h=s.MAX_SUBDIVISION_RETRIES;break}i[d+k]=de;break}o=r[de+a]<i[t+L]?r[de+l]<i[t+D]?i[t+X]:i[t+X]+s.ppr:r[de+l]<i[t+D]?i[t+X]+2*s.ppr:i[t+X]+3*s.ppr,i[t+Z]=(i[t+Z]*i[t+Y]+r[de+a]*r[de+m])/(i[t+Y]+r[de+m]),i[t+oe]=(i[t+oe]*i[t+Y]+r[de+l]*r[de+m])/(i[t+Y]+r[de+m]),i[t+Y]+=r[de+m],t=o}}if(s.settings.barnesHutOptimize)for(xe=s.settings.scalingRatio,de=0;de<s.nodesLength;de+=s.ppn)for(t=0;;)if(i[t+X]>=0){if(Ce=Math.sqrt((r[de+a]-i[t+Z])*(r[de+a]-i[t+Z])+(r[de+l]-i[t+oe])*(r[de+l]-i[t+oe])),2*i[t+B]/Ce<s.settings.barnesHutTheta){if(be=r[de+a]-i[t+Z],ve=r[de+l]-i[t+oe],s.settings.adjustSizes?Ce>0?(ke=xe*r[de+m]*i[t+Y]/Ce/Ce,r[de+d]+=be*ke,r[de+h]+=ve*ke):Ce<0&&(ke=-xe*r[de+m]*i[t+Y]/Ce,r[de+d]+=be*ke,r[de+h]+=ve*ke):Ce>0&&(ke=xe*r[de+m]*i[t+Y]/Ce/Ce,r[de+d]+=be*ke,r[de+h]+=ve*ke),i[t+H]<0)break;t=i[t+H];continue}t=i[t+X]}else{if(i[t+k]>=0&&i[t+k]!==de&&(be=r[de+a]-r[i[t+0]+a],ve=r[de+l]-r[i[t+0]+l],Ce=Math.sqrt(be*be+ve*ve),s.settings.adjustSizes?Ce>0?(ke=xe*r[de+m]*r[i[t+0]+m]/Ce/Ce,r[de+d]+=be*ke,r[de+h]+=ve*ke):Ce<0&&(ke=-xe*r[de+m]*r[i[t+0]+m]/Ce,r[de+d]+=be*ke,r[de+h]+=ve*ke):Ce>0&&(ke=xe*r[de+m]*r[i[t+0]+m]/Ce/Ce,r[de+d]+=be*ke,r[de+h]+=ve*ke)),i[t+H]<0)break;t=i[t+H]}else for(xe=s.settings.scalingRatio,he=0;he<s.nodesLength;he+=s.ppn)for(ce=0;ce<he;ce+=s.ppn)be=r[he+a]-r[ce+a],ve=r[he+l]-r[ce+l],s.settings.adjustSizes?(Ce=Math.sqrt(be*be+ve*ve)-r[he+y]-r[ce+y],Ce>0?(ke=xe*r[he+m]*r[ce+m]/Ce/Ce,r[he+d]+=be*ke,r[he+h]+=ve*ke,r[ce+d]+=be*ke,r[ce+h]+=ve*ke):Ce<0&&(ke=100*xe*r[he+m]*r[ce+m],r[he+d]+=be*ke,r[he+h]+=ve*ke,r[ce+d]-=be*ke,r[ce+h]-=ve*ke)):(Ce=Math.sqrt(be*be+ve*ve),Ce>0&&(ke=xe*r[he+m]*r[ce+m]/Ce/Ce,r[he+d]+=be*ke,r[he+h]+=ve*ke,r[ce+d]-=be*ke,r[ce+h]-=ve*ke));for(pe=s.settings.gravity/s.settings.scalingRatio,xe=s.settings.scalingRatio,de=0;de<s.nodesLength;de+=s.ppn)ke=0,be=r[de+a],ve=r[de+l],Ce=Math.sqrt(be*be+ve*ve),s.settings.strongGravityMode?Ce>0&&(ke=xe*r[de+m]*pe):Ce>0&&(ke=xe*r[de+m]*pe/Ce),r[de+d]-=be*ke,r[de+h]-=ve*ke;for(xe=1*(s.settings.outboundAttractionDistribution?ye:1),me=0;me<s.edgesLength;me+=s.ppe)he=o[me+b],ce=o[me+v],_e=o[me+E],we=Math.pow(_e,s.settings.edgeWeightInfluence),be=r[he+a]-r[ce+a],ve=r[he+l]-r[ce+l],s.settings.adjustSizes?(Ce=Math.sqrt(be*be+ve*ve)-r[he+y]-r[ce+y],s.settings.linLogMode?s.settings.outboundAttractionDistribution?Ce>0&&(ke=-xe*we*Math.log(1+Ce)/Ce/r[he+m]):Ce>0&&(ke=-xe*we*Math.log(1+Ce)/Ce):s.settings.outboundAttractionDistribution?Ce>0&&(ke=-xe*we/r[he+m]):Ce>0&&(ke=-xe*we)):(Ce=Math.sqrt(be*be+ve*ve),s.settings.linLogMode?s.settings.outboundAttractionDistribution?Ce>0&&(ke=-xe*we*Math.log(1+Ce)/Ce/r[he+m]):Ce>0&&(ke=-xe*we*Math.log(1+Ce)/Ce):s.settings.outboundAttractionDistribution?(Ce=1,ke=-xe*we/r[he+m]):(Ce=1,ke=-xe*we)),Ce>0&&(r[he+d]+=be*ke,r[he+h]+=ve*ke,r[ce+d]-=be*ke,r[ce+h]-=ve*ke);let force,Me,Le,Ie,Ne=0;if(s.settings.adjustSizes)for(de=0;de<s.nodesLength;de+=s.ppn)r[de+x]||(force=Math.sqrt(r[de+d]*r[de+d]+r[de+h]*r[de+h]),force>s.maxForce&&(r[de+d]=r[de+d]*s.maxForce/force,r[de+h]=r[de+h]*s.maxForce/force),Me=r[de+m]*Math.sqrt((r[de+u]-r[de+d])*(r[de+u]-r[de+d])+(r[de+c]-r[de+h])*(r[de+c]-r[de+h])),Le=Math.sqrt((r[de+u]+r[de+d])*(r[de+u]+r[de+d])+(r[de+c]+r[de+h])*(r[de+c]+r[de+h]))/2,Ie=.1*Math.log(1+Le)/(1+Math.sqrt(Me)),Se=r[de+a],Ee=r[de+l],r[de+a]=r[de+a]+r[de+d]*(Ie/s.settings.slowDown),r[de+l]=r[de+l]+r[de+h]*(Ie/s.settings.slowDown),be=r[de+a],ve=r[de+l],Ce=Math.sqrt((be-Se)*(be-Se)+(ve-Ee)*(ve-Ee)),Ne+=Ce);else for(de=0;de<s.nodesLength;de+=s.ppn)r[de+x]||(Me=r[de+m]*Math.sqrt((r[de+u]-r[de+d])*(r[de+u]-r[de+d])+(r[de+c]-r[de+h])*(r[de+c]-r[de+h])),Le=Math.sqrt((r[de+u]+r[de+d])*(r[de+u]+r[de+d])+(r[de+c]+r[de+h])*(r[de+c]+r[de+h]))/2,Ie=r[de+p]*Math.log(1+Le)/(1+Math.sqrt(Me)),r[de+p]=Math.min(1,Math.sqrt(Ie*(r[de+d]*r[de+d]+r[de+h]*r[de+h])/(1+Math.sqrt(Me)))),Se=r[de+a],Ee=r[de+l],r[de+a]=r[de+a]+r[de+d]*(Ie/s.settings.slowDown),r[de+l]=r[de+l]+r[de+h]*(Ie/s.settings.slowDown),be=r[de+a],ve=r[de+l],Ce=Math.sqrt((be-Se)*(be-Se)+(ve-Ee)*(ve-Ee)),Ne+=Ce);if(s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.settings.maxIterations||Ne/s.nodesLength<s.settings.avgDistanceThreshold,s.converged&&s.settings.alignNodeSiblings)){let e,t,i={},d={};for(me=0;me<s.edgesLength;me+=s.ppe)he=o[me+b],ce=o[me+v],he!==ce&&(i[he]=i[he]||{},i[ce]=i[ce]||{},i[he][ce]=!0,i[ce][he]=!0);Object.keys(i).forEach((s=>{var r=~~s;t=Object.keys(i[r]),2==t.length&&(e=t[0]+";"+t[1],e in d||(e=t[1]+";"+t[0],d[e]||(d[e]=[~~t[1],~~t[0]])),d[e].push(r))}));let h,u,c,m,p,y,E,k,L,D,B,H,X,Y,Z,oe=s.settings.nodeSiblingsAngleMin;Object.keys(d).forEach((e=>{if(u=d[e].shift(),c=d[e].shift(),h=d[e].filter((e=>!r[e+x])),1==h.length)return;if(y=r[u+a],E=r[u+l],k=r[c+a],L=r[c+l],m=Object.keys(i[u]).length,p=Object.keys(i[c]).length,D=function scaleRange(value,e,t,s,i){return(i-s)*(value-e)/(t-e)+s}(m/(m+p),0,1,1/4,3/4),H=function getPointOnLineSegment(e,t,s,i,r){return{x:e+(s-e)*r,y:t+(i-t)*r}}(y,E,k,L,D),X=function getNormalVector(e,t,s,i){return{xi:-(i-t),yi:s-e,xiPrime:i-t,yiPrime:-(s-e)}}(y,E,k,L),B=function getDistance(e,t,s,i){const r=s-e,o=i-t;return Math.sqrt(r*r+o*o)}(y,E,k,L),Y=function getNormalizedVector(e,t){return{x:(e.xiPrime-e.xi)/t,y:(e.yiPrime-e.yi)/t}}(X,B),Z=function getVectorAngle(e){return Math.acos(e.x/Math.sqrt(e.x*e.x+e.y*e.y))}(Y),2*oe>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");oe>0&&(Z<oe||Z>Math.PI-oe&&Z<=Math.PI?Y={x:2*Math.cos(Math.PI-oe),y:2*Math.sin(Math.PI-oe)}:(Z>2*Math.PI-oe||Z>=Math.PI&&Z<Math.PI+oe)&&(Y={x:2*Math.cos(oe),y:2*Math.sin(oe)}));let t=0,o=1,b=1;h.length%2==1&&(b=0,t=1);for(let e=0;e<h.length;e++)r[h[e]+a]=H.x+o*Y.x*b*(t||e>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),r[h[e]+l]=H.y+o*Y.y*b*(t||e>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),o=-o,b+=(e+t)%2}))}}function createNodeList(e){const t=Object.keys(e),i={};for(let e=0;e<r.length;e+=s.ppn){const o=t[e/s.ppn];i[o]={id:o,x:r[e+a],y:r[e+l],pinned:r[e+x]}}return i}return function compute(){if(s.settings.autoStop){const e=Date.now();for(;!(s.converged||Date.now()-e>=t.chunkPeriod);)pass()}else{const e=0===s.iterations?s.settings.startingIterations:s.iterations+s.settings.iterationsPerRender;for(;s.iterations!==e;)pass()}return{nodes:createNodeList(t.nodes),barycentre:t.barycentre}}()},isRunning:function(e){return!e.W.settings.autoStop||(!e.W.converged||(e.W=void 0,!1))},stop:function(e){e.W&&(e.W.converged=!0)},onSync:function({nodes:e,barycentre:t},{graph:s}){const i=Object.keys(e),r=i.length;let o,a,l,d,h,u,c,m,p=0,y=0;const x=new Array(r),b=new Array(r),v=new Array(r),E=new Array(r),[k,L]=s.getAttributes(!0,["x","y"]);for(o=0;o<r;o++)a=i[o],l=e[a],m=parseInt(a),x[o]=m,E[o]=l.pinned,l.pinned?(d=k.get(m),h=L.get(m)):(d=l.x,h=l.y),b[o]=d,v[o]=h,p+=d,y+=h;for(u=p/r-t.x,c=y/r-t.y,o=0;o<r;o++)E[o]||(b[o]-=u,v[o]-=c);return{indexes:x,x:b,y:v}}},Cu={name:"grid",configure:function(e,{graph:t,camera:s}){function validate(e){return void 0===e||"number"==typeof e&&isFinite(e)&&e>0}const i=e.sortBy,r=e,o=r.nodes,a=Array.from(o._indexes),l=a.length,{rows:d,cols:h,rowDistance:u,colDistance:c}=function getSafeRowsCols(e,t,s,i,r){if(!validate(t))throw new TypeError('"rows" should be a positive integer');if(!validate(s))throw new TypeError('"cols" should be a positive integer');if(!validate(i))throw new TypeError('"rowDistance" should be a positive number');if(!validate(r))throw new TypeError('"colDistance" should be a positive number');if(t)return{rows:t,cols:Math.ceil(e/t),rowDistance:i,colDistance:r};if(s)return{cols:s,rows:Math.ceil(e/s),rowDistance:i,colDistance:r};const o=Math.ceil(Math.sqrt(e));return{cols:o,rows:Math.ceil(e/o),rowDistance:i,colDistance:r}}(l,r.rows,r.cols,r.colDistance,r.rowDistance),m=function getSortingAttributes(e,t,s,i,r){return"string"!=typeof e?i.map(((e,t)=>t)):"radius"===e?t.getAttribute(!0,"radius").getMultiple(i):"degree"===e?s.getDegree():"random"===e?i.map((()=>Math.random())):s.getData(e).map((value=>value||r))}(i,t,o,a,e.sortFallbackValue),p=o.getAttribute("layoutable"),y=a.reduce(((e,t,s)=>p[s]?(e.push({id:t,attr:m[s]}),e):e),[]),x=o.getBoundingBox(),b=.65*Math.max(x.maxScaledSize,x.maxFixedSize/s.getZoom());let v=x.minX+b,E=x.maxX-b,k=x.minY+b,L=x.maxY-b;return x.width<b*h*2&&(v=x.cx-b*h+b,E=x.cx+b*h-b),x.height<b*d*2&&(k=x.cy-b*d+b,L=x.cy+b*d-b),{sort:!!i,nodes:y,reverse:!!r.reverse,cols:h,rows:d,minX:v,maxX:E,minY:k,maxY:L,rowDistance:u,colDistance:c}},update:function({sort:e,nodes:t,maxX:s,minX:i,maxY:r,minY:o,reverse:a,rows:l,cols:d,rowDistance:h,colDistance:u}){e&&t.sort(((e,t)=>{const s=e.attr,i=t.attr;return s<i?-1:s>i?1:0})),a&&t.reverse();let c=(s-i)/(d-1),m=(r-o)/(l-1);const p=i,y=o;isFinite(c)||(c=0),isFinite(m)||(m=0),void 0!==h&&isFinite(h)&&(c=h),void 0!==u&&isFinite(u)&&(m=u);let x=0,b=0;return t.forEach((e=>{e.x=p+x*c,e.y=y+b*m,x+=1,x===d&&(b+=1,x=0)})),t},onSync:function(e){return{indexes:e.map((({id:e})=>e)),x:e.map((({x:e})=>e)),y:e.map((({y:e})=>e))}}},ku={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,siblingIndex:-1,parentIds:[],children:[],radius:0,ref:null},N=e=>e.data===ku||!1,O=e=>!N(e),Mu=[],q=(e,t)=>({id:e,layer:t,data:ku,children:Mu,ref:void 0,x:0,y:0}),F=(e,t)=>({id:e,layer:-1,data:t,children:[],x:0,y:0}),Lu=class{constructor(e,t,s){this.data=e,this.prev=t,this.next=s}toString(){return this.data}},j=e=>e.reduce(((e,t)=>(e[t]=!0,e)),{});function W(e,t){const s=[e],i=j(s),r=[e];for(;s.length;){const e=s.shift();for(const o of t[e])i[o]||(i[o]=!0,r.push(o),s.push(o))}return r}function P(e){return e.reduce(((e,{source:t,target:s})=>(e[t]=e[t]||[],e[s]=e[s]||[],e[t].push(s),e[s].push(t),e)),{})}function z(e,t){const s=j(t);return e.filter((e=>!(e in s)))}function I(e,t){e.forEach(((e,s)=>{e.forEach(((e,i,r)=>{t(e,i,r,s)}))}))}var _=e=>{let t=Math.floor(e.length/2);return(e=[...e].sort(((e,t)=>e-t))).length%2!=0?e[t]:(e[t-1]+e[t])/2};function G(e,t,s){const i=P(t);let r=Object.keys(i);const o=[];for(;r.length;){const e=W(r[0],i);o.push(e),r=z(r,e)}return s.skipSingletons?o:o.concat(function V(e,t,s){const i=s||P(t||[]);return e.filter((({id:e})=>!(e in i)))}(e,t,i).map((({id:e})=>[e])))}var Iu={down:()=>{},up:e=>e.y=-e.y,left:e=>{const t=e.x;e.x=-e.y,e.y=t},right:e=>{const t=e.x;e.x=e.y,e.y=-t}},S=(e,t)=>isFinite(e)&&e>0?e:t;function K(e,{componentsSeparation:t,layerSeparation:s,packing:i}){const r=s/2,o=[];for(const s of e){const e=s.nodes;if(s.isFake&&void 0!==s.w&&void 0!==s.h){o.push({w:s.w,h:s.h,x:void 0,y:void 0,dag:s});continue}if(1===s.nodes.length){const i=2*e[0].data.radius;o.push({w:i+t,h:i+r,x:void 0,y:void 0,dag:s});continue}const i=e.reduce(((e,{x:t,data:s})=>Math.min(e,t-s.radius||1)),1/0),a=e.reduce(((e,{x:t,data:s})=>Math.max(e,t+s.radius||1)),-1/0),l=e.reduce(((e,{y:t,data:s})=>Math.min(e,t-s.radius||1)),1/0),d=e.reduce(((e,{y:t,data:s})=>Math.max(e,t+s.radius||1)),-1/0),h=(a+i)/2;e.forEach((e=>{e.x-=h})),o.push({w:Math.abs(a-i)+t,h:Math.abs(d-l)+r,minX:i,x:void 0,y:void 0,dag:s})}if("singleline"!==i)!function U(e){let t=0,s=0;for(const i of e)t+=i.w*i.h,s=Math.max(s,i.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let r=0,o=0;for(const t of e)for(let e=i.length-1;e>=0;e--){const s=i[e];if(!(t.w>s.w||t.h>s.h)){if(t.x=s.x,t.y=s.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===s.w&&t.h===s.h){const t=i.pop();e<i.length&&(i[e]=t)}else t.h===s.h?(s.x+=t.w,s.w-=t.w):t.w===s.w?(s.y+=t.h,s.h-=t.h):(i.push({x:s.x+t.w,y:s.y,w:s.w-t.w,h:t.h}),s.y+=t.h,s.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}(o);else{let e=0;for(const t of o)t.x=e,t.y=0,e+=t.w}return o}function Q(e,t={}){const{componentsSeparation:s,layerSeparation:i}=function J(e){return{nodesSeparation:S(e.nodesSeparation,0),componentsSeparation:S(e.componentsSeparation,25),layerSeparation:S(e.layerSeparation,50)}}(t);void 0===t.direction&&(t.direction="down");const r=K(e,{layerSeparation:i,componentsSeparation:s,packing:t.packing});for(const e of r){const{x:s=0,y:i=0,w:r,dag:o}=e;for(const e of o.nodes)e.x+=s+r/2,e.y+=i,Iu[t.direction](e)}}function et(e,t,s){const i=P(t||[]),r=e.filter((({id:e})=>!(e in i))).sort(((e,t)=>t.radius-e.radius)),o=Math.sqrt(r.length);let a=Math.floor(o),l=Math.ceil(o);a*l<r.length&&(a<l?a++:l++);const d=Math.max(1,(e=>e.reduce(((e,{radius:t})=>Math.max(e,2*t)),0))(r)),h=Math.max(s.nodesGridSeparation||0,1),u=d*l+h*(l-1),c=d*a+h*Math.max(a-1,0),m=function tt(e,t){return __spreadValues({nodes:e.map((e=>__spreadProps(__spreadValues({},e),{data:e}))),isFake:!0},t)}(r,{w:u,h:c});return m.nodes.forEach(((e,t)=>{const s=t%l,i=Math.floor(t/l);e.x=u*s/l,e.y=c*i/a})),m}function nt(e){if(!e||!e.length)throw Error("Cannot stratify empty data");for(const t of e){if(!t)throw Error('Node data is "null"');if(null==t.id)throw Error('Node id contains a "null" value')}const t=e.map((e=>F(e.id,e))),s=t.reduce(((e,t)=>{if(e[t.id])throw Error(`The connected component contains id duplicates: ${t.id}`);return e[t.id]=t,e}),{}),i=[];for(const e of t){for(const t of e.data.parentIds){const i=s[t];if(!i)throw Error(`The node ${e.id} has a missing parent id ${t}`);i.children.push(e)}e.data.parentIds.length||i.push(e)}return{isFake:!1,nodes:st(i)}}function st(e){const t={},s=[];for(;e.length;){const i=e.pop();t[i.id]||(s.push(i),t[i.id]=!0,e.push(...i.children))}return s}function it(e){if(e.sort(((e,t)=>e-t)),0===e.length)return 0;const t=Math.floor(e.length/2),s=Math.floor(e.length/2);return(e[t]+e[s])/2}function A(e,t,s){const i={};return t.forEach(((e,t)=>i[e.id]=t)),e.map((e=>(s[e.id]||[]).map((e=>i[e])).sort())).reduce(((e,t,s,i)=>{const r=t.length?t[t.length-1]:-1;for(let t=s+1;t<i.length;t++)e+=i[t].filter((e=>e<r)).length;return e}),0)}function ot(e,t,s,i,r){const o={};for(let i=0;i<e.length;i++)o[e[i].id]=it((t[e[i].id]||[]).map((e=>s[e])))||0;r?e.sort(((e,t)=>{const r=o[e.id]-o[t.id],a=i[e.id]===i[t.id],l=e.data.siblingIndex,d=t.data.siblingIndex;return a&&l>-1&&d>-1?l-d:0===r?s[t.id]-s[e.id]:r})):e.sort(((e,t)=>{const i=o[e.id]-o[t.id];return 0===i?s[t.id]-s[e.id]:i}))}function C({layers:e,topDown:t,topDownAdj:s,bottomUpAdj:i,idToIndex:r,crossings:o,sortSiblings:a}){const l=t?s:i;for(let d=t?0:e.length-1;t?d<e.length:d>=0;t?d++:d--){ot(e[d],l[d]||{},r,i[d],a);const t=d>0?A(e[d-1],e[d],s[d-1]):0,h=d<e.length-1?A(e[d],e[d+1],s[d]):0;h+t<(o[d]||0)+(o[d-1]||0)?(o[d]=h,d>0&&(o[d-1]=t),e[d].forEach(((e,t)=>r[e.id]=t))):e[d].sort(((e,t)=>r[e.id]-r[t.id]))}}function pt(e){if(e.nodes.some((e=>"layer"in e.data&&e.data.layer<0)))throw new Error("Some nodes have negative layering information");return e.nodes.some((e=>e.data&&!isNaN(e.data.layer)&&null!==e.data.layer))||function ct(e){const t={},s={},i={};e.nodes.forEach((e=>{i[e.id]=e}));const n=e=>{if(t[e.id])return s[e.id];t[e.id]=!0;let r=1/0;for(const t of e.children)r=Math.min(r,n(i[t.id])-1);return r===1/0&&(r=0),s[e.id]=r,r};e.nodes.forEach((e=>{0===e.data.parentIds.length&&n(e)}));let r=1/0;e.nodes.forEach((e=>{r=Math.min(r,s[e.id])})),e.nodes.forEach((e=>{s[e.id]-=r,e.layer=s[e.id]}))}(e),function dt(e){e.nodes.forEach((e=>{e.layer=null!=e.data.layer?e.data.layer:e.layer}))}(e),function lt(e){const t={};e.nodes.forEach((e=>{t[e.id]=[...t[e.id]||[],...e.children],e.children.forEach((s=>{t[s.id]=[...t[s.id]||[],e]}))}));const s=[];e.nodes.forEach((e=>{0===e.layer&&s.push(e)}));const i={},r={};for(e.nodes.forEach((e=>{-1!==e.layer&&(r[e.id]=e.layer)}));s.length;){const e=s.shift().id;for(const o of t[e])if(!i[o.id]){if(void 0===r[o.id]){const t=r[e]+1;r[o.id]=t,o.layer=t}i[o.id]=!0,s.push(o)}}}(e),function ft(e){if(e.nodes.some((e=>e.data.sink))){const t=e.nodes.reduce(((e,t)=>Math.max(e,t.layer)),-1/0);e.nodes.forEach((e=>{e.data.sink&&(e.layer=t+1)}))}}(e),function ht(e){if(e.nodes.every((e=>e.layer))){let t=e.nodes.reduce(((e,t)=>Math.min(e,t.layer)),1/0);e.nodes.forEach((e=>e.layer-=t))}}(e),function ut(e){const t=[];e.nodes.forEach((e=>t[e.layer]=0));const s=Array.from(t).reduce(((e,t,s)=>{if(0===s)return e.push(0),e;const i=e[s-1];return void 0!==t?(e.push(i),e):(e.push(i-1),e)}),[]);e.nodes.forEach((e=>e.layer+=s[e.layer]))}(e),e.nodes.forEach((e=>{const{below:t,above:s}=e.children.reduce(((t,s)=>(e.layer>s.layer?t.above.push(s):t.below.push(s),t)),{above:[],below:[]});s.forEach((t=>t.children.push(e))),e.children=t})),function at(e){const t=e.nodes.reduce(((e,t)=>t.data.fixed&&(null===e||e.layer>t.layer)?t:e),null);return t&&e.nodes.forEach((e=>e.ref=t.id)),e}(e)}var Nu=class{constructor(){this.byId={},this.byIndex={},this.length=0}append(e,t){let s;return this.head?(s=new Lu(e,this.tail),this.tail=this.tail.next=s):(s=new Lu(e),this.tail=this.head=s),this.byId[t]=s,this.byIndex[this.length++]=s,s}find(e){let t=this.head;do{if(t.data===e)return t;t=t.next}while(t)}forEach(e){let t=this.head,s=0;do{e(t,s),s++}while(t=t.next)}},Pu=-1,Fu=1e-5,zu=[],Du=class{constructor(e,t,s){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new Nu,this.nodeDistance=t,this.layerDistance=s,this.layers=e;const{breadth:i,virt:r,height:o,nodeToLayer:a,nodeIndexTopDown:l,nodeMap:d,longEdges:h,edges:u}=this;let c=0;I(this.layers,((e,t,s,i)=>{if(l[e.id]=c++,d[e.id]=e,a[e.id]=i,this.nodeList.append(e,e.id),e.children.forEach((t=>{const s=N(t)||N(e);u.push({source:e.id,target:t.id,virtual:s,id:u.length})})),h[e.id])return;const r=[e.id];if(h[e.id]=r,!O(e))for(let t=0;t<e.children.length;t++){const s=e.children[t];if(O(s))continue;let i=s;for(;N(i);)r.push(i.id),h[i.id]=r,i=i.children[0]}}));const m=this.adjacencyList=function $(e){return e.reduce(((e,{source:t,target:s})=>(e[t]=e[t]||[],e[t].push(s),e)),{})}(u);this.N=e.reduce(((e,t)=>e+t.length),0),this.Y=new Float32Array(e.length),this.first=e.map((e=>e[0])),e.forEach(((e,t)=>o[t]=0)),I(this.layers,((e,t,s,a)=>{const l=m[e.id]?m[e.id].length:0;r[e.id]=N(e)&&1===l,this.nodeToLayer[e.id]=a,r[e.id]?i[e.id]=0:(i[e.id]=2*e.data.radius,o[a]=Math.max(o[a]||0,2*e.data.radius))}));const p={},y={};u.forEach((e=>{const t=e.source,s=e.target;p[s]=p[s]||[],p[s].push(t),y[t]=y[t]||[],y[t].push(s)})),Object.values(p).forEach((e=>{e.sort(((e,t)=>this.nodeIndexTopDown[e]-this.nodeIndexTopDown[t]))})),Object.values(y).forEach((e=>{e.sort(((e,t)=>this.nodeIndexTopDown[e]-this.nodeIndexTopDown[t]))})),this.neighbours={prev:p,next:y}}computeMinNodeDistances(){const{layers:e,totalW:t}=this;I(e,(e=>{t[e.id]=0})),I(e,(e=>t[e.data.id]=0)),this.layers.forEach((e=>{t[e[0].id]=0,e.slice(1).forEach(((s,i)=>{const r=e[i],o=s.id;t[o]=t[r.id]+r.data.radius+s.data.radius+this.nodeDistance}))}))}decrossVirtualEdges(){this.layers.forEach((e=>{let t=-1;e.forEach((e=>{if(!this.virt[e.id])return;const s=this.neighbours.next[e.id][0];if(this.virt[s])if(-1!==t&&t>this.nodeIndexTopDown[s]){const t=this.longEdges[e.id];let i=0;for(i=0;i<t.length&&t[i]!==s;i++);const r=t.slice(i);r.forEach((e=>this.longEdges[e]=r));const o=t.slice(0,i);o.forEach((e=>this.longEdges[e]=o))}else t=this.nodeIndexTopDown[s]}))}))}placeLongEdges(){const{X:e,layers:t}=this;I(t,(t=>e[t.id]=0));for(let s=1;s>=-1;s-=2){const i={};let r=0;const o={};I(t,(e=>o[e.id]=0)),o[ku.id]=0;const a=s;t.forEach((e=>{let t=1===a?e[0]:e[e.length-1];o[t.id]||(this.longEdges[t.id].forEach((e=>{o[e]=r})),r++);let s=1===a?0:e.length-1,i=s+a;for(;i>=0&&i<e.length;)t=e[i],o[t.id]||this.longEdges[t.id].forEach((t=>{o[t]=o[e[s].id]})),s=i,i+=a}));const l={};t.forEach((e=>{for(let t=1===a?0:e.length-1;1===a?t<e.length:t>=0;t+=a){const s=e[t],i=o[s.id];l[i]=l[i]||[],l[i].push(s.id)}}));const d={};this.nodeList.forEach((e=>d[e.data.id]=0));for(let e=0;e<r;e++){const t={done:!1,dist:0},r=l[e];for(const e of r)this.sortLongEdges(e,s,d,t,o,i);if(!t.done){const s=this.layers[this.nodeToLayer[l[e][0]]],i=[];s.forEach((e=>{for(const t of this.neighbours.prev[e.id]||zu){const s=Math.abs(d[t]-d[e.id]);i.push(s)}})),0!==i.length&&(t.dist=_(i))}for(const e of r)d[e]-=s*t.dist}I(t,(t=>e[t.id]+=d[t.id]/2))}}sortLongEdges(e,t,s,i,r,o){if(o[e])return!1;let a=!1,l=0;const{nodeToLayer:d,totalW:h}=this,u=this.longEdges[e];u.forEach((e=>o[e]=!0)),u.forEach((e=>{const u=this.nodeList.byIndex[this.nodeIndexTopDown[e]-t];if(!u)return;const c=u.data.id,m=e,p=d[c]===d[m],y=r[c]===r[m];!p||!y||(this.sortLongEdges(c,t,s,i,r,o),(!a||t*(l-s[c])<t*(h[m]-h[c]))&&(a=!0,l=s[c]+h[m]-h[c]))})),u.forEach((e=>{s[e]=l;const o=this.nodeList.byId[e],a=1===t?o.next:o.prev;if(!a)return;const u=a.data.id,c=e,m=d[u]===d[c],p=r[u]!==r[c],y=t*(h[u]-h[c]-s[u]+s[c]);m&&p&&(!i.done||y>i.dist)&&(i.dist=y,i.done=!0)}))}placeNonVirtualNodes(){const e={};I(this.layers,(t=>e[t.id]=-1));const{X:t,totalW:s,virt:i,nodeIndexTopDown:r,mDist:o,nodeList:a}=this,l={};I(this.layers,((e,r,o,a)=>{if(!i[e.id])return void(l[e.id]=!1);let d=this.nodeList.byId[e.id].next;for(;d&&this.nodeToLayer[d.data.id]===a&&!i[d.data.id];)d=d.next;l[e.id]=this.nodeToLayer[d.data.id]===a&&t[d.data.id]-t[e.id]<s[d.data.id]-s[e.id]+Fu})),I(this.layers,(({id:t})=>{l[t]&&-1===e[t]&&this.longEdges[t].forEach((s=>{s!==t&&(e[s]=r[s]<r[t]?1:0)}))})),I(this.layers,(({id:e})=>o[e]=s[e]));for(let s=0;s<2;s++)for(let d=s?this.layers.length-1:0;d>=0&&d<this.layers.length;s?d--:d++){let h=Pu;const u=this.layers[d];if(u.forEach((({id:d},u,c)=>{if(i[d]){if(h===Pu){this.placeSequence(Pu,d,c[0].id,a.byId[d].prev.data.id,s);for(let e=0;e<u;e++){const s=c[e].id;o[s]=o[d]-t[d]+t[s]}}else if(e[h]!==1-s){l[h]||this.placeSequence(h,d,a.byId[h].next.data.id,a.byId[d].prev.data.id,s);const t=1===s?this.neighbours.prev:this.neighbours.next,o=t[h][0],u=t[d][0];if(i[o]&&i[u])for(let t=r[o]+1;t<r[u];t++)e[a.byIndex[t].data.id]=s}h=d}})),h===Pu)this.placeSequence(Pu,Pu,u[0].id,u[u.length-1].id,s),u.forEach((({id:e})=>o[e]=t[e]));else{this.placeSequence(h,Pu,a.byId[h].next.data.id,u[u.length-1].id,s);for(let e=u.length-1;e>=0;e--){const s=u[e].id;if(s===h)break;o[s]=o[h]-t[h]+t[s]}}}}placeSequence(e,t,s,i,r,o=0){const a=this.nodeIndexTopDown[s],l=this.nodeIndexTopDown[i],{X:d,nodeIndexTopDown:h,mDist:u}=this;if(a===l)d[s]=this.placeNode(s,e,t,d[s],r);else if(a<l){const a=Math.floor((h[s]+h[i])/2),l=this.nodeList.byIndex[a],d=l.next.data.id,c=u[d]-u[l.data.id];this.placeSequence(e,t,s,l.data.id,r,o+1),this.placeSequence(e,t,d,i,r,o+1),this.combineSequences(e,t,s,i,d,l.data.id,r,c)}}calculateBends(e,t,s,i,r,o,a,l){let d=0;const h=[],{X:u,mDist:c,neighbours:m}=this,p=this.nodeIndexTopDown[s],y=this.nodeIndexTopDown[i];for(let s=this.nodeList.byId[o],i=this.nodeIndexTopDown[s.data.id];i>=p&&i<=y&&s;s=-1===e?s.prev:s.next,i=s&&this.nodeIndexTopDown[s.data.id]){const i=s.data.id,p=(0===t?m.prev[i]:m.next[i])||zu;let y=0;for(const t of p)if(e*(u[t]-u[i])<Fu)y++;else{y--;const s=u[t]+c[o]-c[i];e*(u[o]-s)>-Fu?d++:(l===Pu||e*(s-u[l]+c[l]-c[o])<Fu)&&e*(s-u[r])<a-Fu&&h.push({value:2,key:s})}const x=u[i]+c[o]-c[i];e*(u[o]-x)>-Fu?d+=y:(l===Pu||e*(x-u[l]+c[l]-c[o])<Fu)&&e*(x-u[r])<a-Fu&&h.push({value:y,key:x})}return l!==Pu&&h.push({value:this.edges.length,key:u[l]-c[l]+c[o]}),h.sort((({key:e},{key:t})=>e-t)),{res:d,bends:h.reduce(((e,t,s)=>{if(s<h.length-1){const i=h[s+1];Math.abs(t.key-i.key)>Fu?t.value>0&&e.push(t):t.value+=i.value}else t.value>0&&e.push(t);return e}),[])}}combineSequences(e,t,s,i,r,o,a,l){const{X:d,mDist:h,nodeIndexTopDown:u}=this;let{res:c,bends:m}=this.calculateBends(-1,a,s,i,r,o,l,e),{res:p,bends:y}=this.calculateBends(1,a,s,i,o,r,l,t);for(m.length>0&&m.reverse();d[r]-d[o]<l-Fu;){let e=0,t=0;if(c<p){const t=m.length;if(t>0){const t=m.pop();e=t.value,d[o]=t.key}(0===t||d[r]-d[o]>l+Fu)&&(d[o]=d[r]-l)}else if(c>p){const e=y.length;if(e>0){const e=y.pop();t=e.value,d[r]=e.key}(0===e||d[r]-d[o]>l+Fu)&&(d[r]=d[o]+l)}else{let s=(l-d[r]+d[o])/2;const i=0===m.length?s+1:d[o]-m[m.length-1].key,a=0===y.length?s+1:y[y.length-1].key-d[r];i<s+Fu&&i<a+Fu&&(e=m.pop().value),a<s+Fu&&a<i+Fu&&(t=y.pop().value),s=Math.min(s,i,a),d[o]-=s,d[r]+=s}c+=e,p+=t}let x,b=this.nodeList.byId[o].prev;for(;b&&u[x=b.data.id]>=u[s]&&d[o]-d[x]<h[o]-h[x];)d[x]=d[o]-h[o]+h[x],b=b.prev;for(b=this.nodeList.byId[r].next;b&&u[x=b.data.id]<=u[i]&&d[r]-d[x]>h[r]-h[x];)d[x]=d[r]-h[r]+h[x],b=b.next}placeNode(e,t,s,i,r){const{X:o,neighbours:a,mDist:l}=this,d=((0===r?a.prev:a.next)[e]||zu).map((e=>o[e]));return 0===d.length?o[e]:(i=_(d),t!==Pu&&(i=Math.max(i,o[t]+l[e]-l[t])),s!==Pu&&(i=Math.min(i,o[s]+l[e]-l[s])),i)}moveLongEdge(e,t,s){const{X:i,virt:r,totalW:o,nodeList:a}=this,{id:l}=e.data;if(s[l]||!r[l])return;const d=this.longEdges[l];if(!d)return;d.forEach((e=>s[e]=!0));const h=d[0],u=d[d.length-1],c=[];t<0?c.push(i[h]<i[u]?i[h]:i[u],i[h]<i[u]?i[u]:i[h]):t>0?c.push(i[h]<i[u]?i[u]:i[h],i[h]<i[u]?i[h]:i[u]):c.push(i[h],i[u]);let m,p=c[0],y=!1;for(;!y&&0!==c.length;)m=c.pop(),y=!0,d.forEach((e=>{const t=this.layers[this.nodeToLayer[e]];if(e!==t[0].id){const t=a.byId[e].prev.data;m-i[t.data.id]<o[e]-o[t.data.id]&&this.moveLongEdge(t,-1,s),y=y&&m-i[t.data.id]>=o[e]-o[t.data.id]-Fu}if(e!==t[t.length-1].id){const t=a.byId[e].next.data;m-i[t.data.id]>o[e]-o[t.data.id]&&this.moveLongEdge(t,1,s),y=y&&m-i[t.data.id]<=o[e]-o[t.data.id]+Fu}}));y||(m=p,d.forEach((e=>{const t=this.layers[this.nodeToLayer[e]];if(e!==t[0].id){const t=a.byId[e].prev.data;m=Math.max(m,i[t.data.id]+o[e]-o[t.data.id])}if(e!==t[t.length-1].id){const t=a.byId[e].next.data;m=Math.min(m,i[t.data.id]+o[e]-o[t.data.id])}}))),d.forEach((e=>i[e]=m))}moveLongEdges(){const e={};this.layers.forEach((t=>{const s=Math.floor(t.length/2);for(let i=s;i<t.length;i++)this.moveLongEdge(t[i],0,e);for(let i=s-1;i>=0;i--)this.moveLongEdge(t[i],0,e)}))}computeY(){const{Y:e,layers:t,height:s}=this;e[0]=0,t.slice(1).forEach(((t,i)=>{e[i+1]=e[i]+s[i+1]+this.layerDistance}))}straightenLongEdge(e,t){const{nodeList:s,longEdges:i,neighbours:r,X:o,Y:a,nodeToLayer:l,totalW:d}=this,h=i[e.id];if(t[e.id]||!r.prev[e.id]||1!==r.prev[e.id].length||!r.next[e.id]||1!==r.next[e.id].length||!(h&&h.length<2))return;t[e.id]=!0;const u=r.prev[e.id][0],c=r.next[e.id][0];if(l[c]===l[u])return;let m=o[u]+(o[c]-o[u])*(a[l[e.id]]-a[l[u]])/(a[l[c]]-a[l[u]]);if(e!==this.first[l[e.id]]){const i=s.byId[e.id].prev.data;if(m-o[i.id]<d[e.id]-d[i.id]-Fu&&this.straightenLongEdge(i,t),m-o[i.id]<d[e.id]-d[i.id]-Fu)return}const p=this.layers[l[e.id]];if(e!==p[p.length-1]){const i=s.byId[e.id].next.data;if(o[i.id]-m<d[i.id]-d[e.id]-Fu&&this.straightenLongEdge(i,t),o[i.id]-m<d[i.id]-d[e.id]-Fu)return}o[e.id]=m}straightenEdges(){const e={};this.layers.forEach((t=>{const s=Math.floor(t.length/2);for(let i=s;i<t.length;i++)this.straightenLongEdge(t[i],e);for(let i=s-1;i>=0;i--)this.straightenLongEdge(t[i],e)}))}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),I(this.layers,((e,t,s,i)=>{e.x=this.X[e.id],e.y=this.Y[i]}))}},xt=(e,{nodeDistance:t,layerDistance:s,nodeLookup:i,customSort:r,sortSiblings:o,shouldDecross:a=!0})=>{pt(e);const l=function vt(e){return e.nodes.reduce(((e,t)=>(e[t.layer]=e[t.layer]||[],e[t.layer].push(t),t.children=t.children.map((s=>{if(s.layer===t.layer+1)return s;let i=s;for(let r=s.layer-1;r>t.layer;r--){const o=q(`${t.id}->${s.id}@${r}`,r);o.children=[i],e[r]=e[r]||[],e[r].push(o),i=o}return i})),e)),[])}(e);return e.nodes.length>1?(((e,t,s)=>{if(!s&&!t)return;const i={},r=e.map((()=>({}))),o=e.map((()=>({})));e.forEach(((e,t)=>{e.forEach(((e,a)=>{i[e.id]=s?e.data.siblingIndex:a,e.children.forEach((s=>{const i=s.layer;i>t?(r[t][e.id]=r[t][e.id]||[],r[t][e.id].push(s.id),o[i][s.id]=o[i][s.id]||[],o[i][s.id].push(e.id)):(r[i][s.id]=r[i][s.id]||[],r[i][s.id].push(e.id),o[t][e.id]=o[t][e.id]||[],o[t][e.id].push(s.id))}))}))})),i[-1]=-1,s&&e.forEach((e=>e.sort(((e,t)=>i[e.id]-i[t.id]))));const a=e.slice(1).map(((t,s)=>A(e[s],t,r[s]))),l=Math.max(...e.map((e=>e.length))),d=[[50,100],[100,10],[1e3,1],[5e3,0]].find((([e])=>l<e))[1];for(let t=0;t<d;t++)C({layers:e,topDown:!0,topDownAdj:r,bottomUpAdj:o,idToIndex:i,crossings:a,sortSiblings:s}),C({layers:e,topDown:!1,topDownAdj:r,bottomUpAdj:o,idToIndex:i,crossings:a,sortSiblings:s})})(l,a,o),r&&l.forEach((e=>{e.sort(((e,t)=>r(i[e.id],i[t.id])))})),((e,t=20,s=50)=>{new Du(e,t,s).run()})(l,t,s)):(e.nodes[0].x=0,e.nodes[0].y=0),function wt(e){e.nodes.forEach((e=>{e.data&&(e.children=e.children.filter(O))}))}(e),e};var T=({id:e,layer:t,sink:s,siblingIndex:i,radius:r,layoutable:o})=>({id:e,layer:void 0!==t?t:void 0,sink:s,siblingIndex:i||0,radius:r||0,fixed:!1===o,parentIds:[],children:[],ref:null});var kt=(e,t={})=>{if(!e||!e.nodes)return e;const s=__spreadProps(__spreadValues({direction:"down",packing:"fit",nodesGridSeparation:1},t),{shouldDecross:!1!==t.shouldDecross}),{components:i,lookup:r}=((e,t={})=>{const s=(e.edges||[]).filter((({source:e,target:t})=>e!==t)),i={},r=new Map;for(const t of e.nodes)i[t.id]=t;const o=function R(e,t,s){const i=t.reduce(((e,t)=>(e[t.source]=e[t.source]||[],e[t.source].push(t),e)),{}),{result:r}=e.reduce((function n(e,t){const{visited:r,stack:o,result:a}=e;if(r[t.id])return e;r[t.id]=o[t.id]=1;const l=i[t.id]||[];for(const t of l)o[t.target]?a.push(t):n(e,s[t.target]);return delete o[t.id],e}),{visited:{},stack:{},result:[]}),o=r.reduce(((e,{source:t,target:s})=>(e[t]=e[t]||{},e[t][s]=1,e)),{});return t.map((e=>{const{source:t,target:s,id:i}=e;return o[t]&&o[t][s]?{id:i,source:s,target:t}:e}))}(e.nodes,s,i).filter((e=>{const t=r.get(e.source);if(!t){const t=new Map;return t.set(e.target,!0),r.set(e.source,t),!0}return!t.get(e.target)&&(t.set(e.target,!0),!0)})),a=G(e.nodes,o,{skipSingletons:"grid"===t.packing}),l=o.reduce(((e,t)=>(e[t.source]||(e[t.source]=T(i[t.source])),e[t.target]||(e[t.target]=T(i[t.target])),e[t.target].children.push(t.source),e[t.target].parentIds.push(t.source),e)),{});return{components:a.map((e=>e.map((e=>l[e]||T(i[e]))))),lookup:i}})(e,s),o=function Lt(e){const t={x:0,y:0};let s=0;for(const i in e)t.x+=e[i].x||0,t.y+=e[i].y||0,s++;return t.x/=s,t.y/=s,t}(r),a=function Dt(e,t,s){const i=[];for(const r of e){const e=nt(r);i.push(e),xt(e,{nodeDistance:s.nodesSeparation,layerDistance:s.layerSeparation,shouldDecross:s.shouldDecross,customSort:s.customSort,sortSiblings:!!s.sortSiblings,nodeLookup:t})}return i}(i,r,s);if("grid"===s.packing){const t=et(e.nodes,e.edges,s);a.push(t)}return Q(a,s),function Mt(e,t,s){const i=function bt(e){const t={x:0,y:0};let s=0;for(const i of e)for(const e of i.nodes)t.x+=e.x||0,t.y+=e.y||0,s++;return t.x/=s,t.y/=s,t}(s),r=e.x-i.x,o=e.y-i.y;for(const e of s)for(const s of e.nodes){const e=t[s.id];!e||s.data&&s.data.fixed||(e.x=s.x+r,e.y=s.y+o)}}(o,r,a),e},Ru={direction:"TB",nodeDistance:5,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer",siblingIndex:""},Ou={name:"hierarchical",imports:{sequential:kt},configure:function(e,{graph:t,data:s}){function ensureNodes2(e,t,s=e.getNodes()){return t?t instanceof xi?t:e.getNodes(t):s}const i=__spreadProps(__spreadValues(__spreadValues({},Ru),e),{nodeList:e.nodes});i.direction=e.direction||Ru.direction,i.layerSeparation=i.levelDistance,i.nodesSeparation=i.nodeDistance,i.componentsSeparation=i.componentDistance,i.gapDistance=i.gapWidth,i.packing=i.arrangeComponents;const r=__spreadValues({},i),o=i.edges,a=i.nodeList;if(-1===["TB","BT","LR","RL"].indexOf(i.direction))throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(-1===["fit","grid","singleLine"].indexOf(i.packing))throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');i.nodesGridSeparation=e.gridDistance||Ru.gridDistance;const l=a.getId(),d=a.getAttribute("layoutable").reduce(((e,value,t)=>(e[l[t]]=value,e)),{}),h=a.getAttributes(["x","y"]).reduce(((e,value,t)=>(e[l[t]]=value,e)),{}),u=a.getAttribute("radius");if("string"!=typeof r.layer)throw new Error("'layer' should be the valid data field name");if(void 0===r.siblingIndex&&(r.siblingIndex=""),"string"!=typeof r.siblingIndex)throw new Error("'siblingIndex' should be the valid data field name");const c=ensureNodes2(t,i.roots,t.nodeList()),m=s.getProperty(i.nodeList,r.layer),p=r.siblingIndex.length?s.getProperty(i.nodeList,r.siblingIndex):[],y=c.map((e=>{let t=-1;return i.nodeList.forEach(((s,i)=>{s===e&&(t=i)})),t}));for(const e of y)m[e]=0;const x=ensureNodes2(t,i.sinks,t.nodeList()).toArray().reduce(((e,t)=>(e[t.getId()]=!0,e)),{}),b=l.map((e=>x[e]));return{nodes:l,edges:o.map((e=>({id:e.getId(),source:e.getSource().getId(),target:e.getTarget().getId()}))),options:ensureTransferable(i),layoutable:d,radiuses:u,siblingIndexes:p,layers:m,sinks:b,coords:h}},context:noop,update:function({nodes:e,edges:t,options:s,layoutable:i,radiuses:r,layers:o,siblingIndexes:a,sinks:l,coords:d}){const h=t.filter((({source:e,target:t})=>e in i&&t in i)),u={nodes:e.map(((e,t)=>({id:e,radius:r[t],layer:o[t],siblingIndex:a[t],sink:l[t],layoutable:i[e],x:d[e].x,y:d[e].y}))),edges:h},{nodes:c}=kt(u,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[s.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[s.direction],layerSeparation:s.layerSeparation,nodesSeparation:s.nodesSeparation,sortSiblings:a.length>0,componentsSeparation:s.componentsSeparation,nodesGridSeparation:s.nodesGridSeparation,evenDistribution:s.evenDistribution});return{positions:c}},isRunning:function(){return!1},onSync:function({positions:e},{graph:t}){return{indexes:e.map((({id:e})=>(t.getNode(e)||{_index:-1})._index)),x:e.map((({x:e})=>e)),y:e.map((({y:e})=>e))}}},ASC=(e,t)=>e-t,Bu={name:"radial",imports:{minHeap,bellmanFord,dijkstra,johnson,distance,circleCircleIntersection,circleSortCompare,weightedStress,distanceStress,constrainedStress,stressMinimizationStep,removeRadialOverlap,linear,calculateRadii},configure(e,{graph:t}){let s=e.nodes;const i=s.size;function validateNumber(e,t){return null!=e&&isFinite(e)?e:t}if(void 0===e.centralNode)throw new Error('radial layout: missing parameter "centralNode"');const r=t.getNode(e.centralNode);if(void 0===r)throw new Error('radial layout: parameter "centralNode" is not valid');e.radiusRatio=validateNumber(e.radiusRatio,Math.SQRT2),e.radiusDelta=validateNumber(e.radiusDelta,0),e.nodeGap=validateNumber(e.nodeGap,10),e.repulsion=i*validateNumber(e.repulsion,1);const o=r.getPosition(),a=validateNumber(e.centerX,o.x),l=validateNumber(e.centerY,o.y),d=r._index;s.includes(r)||(s=s.concat(r.toList()));let h=s._indexes;const u=s.getAttribute("layoutable");h=h.filter(((e,t)=>u[t]||e===d)),h.sort(ASC);const c=h.length,m=function groupByComponents(e,t,s){const i=e.slice().sort(ASC),r=[];for(let e=0,o=t.length;e<o;e++){const o=[],a=t[e];let l=!1;for(let e=0,t=a.length;e<t;e++){const t=a[e];-1!==binaryIndexOf(i,t)&&(t===s&&(l=!0),o.push(t))}0!==o.length&&r[l?"unshift":"push"](o.sort(ASC))}return r}(h,t.getConnectedComponents(s,{internalIndexes:!0}),d),p=t.degrees(h),y=new Float32Array(t.getNodeAttribute("x").getMultiple(h)),x=new Float32Array(t.getNodeAttribute("y").getMultiple(h)),b=t.getNodeAttribute("radius").getMultiple(h),v=t.getEdges()._indexes,E=t.getEdgeAttribute("source").getMultiple(v),k=t.getEdgeAttribute("target").getMultiple(v),L=t.getAdjacencyList({internalIndexes:!0,weight:1,indexes:h});return{centerIndex:d,centerIndexPos:0,cx:a,cy:l,D:null,indexes:h,components:m,normIndexes:null,radii:null,rings:null,x:y,y:x,degree:p,size:c,attributes:{size:b,adjacency:L,weights:k.map((()=>1)),sources:E,targets:k},sortAttr:null,allowOverlap:!!e.allowOverlap,nodeGap:e.nodeGap,radiusRatio:e.radiusRatio,radiusDelta:e.radiusDelta,repulsion:e.repulsion,randomize:!("randomize"in e)||!!e.randomize,renderSteps:!!e.renderSteps,epsilon:validateNumber(e.epsilon,.001),maxSteps:validateNumber(e.maxIterations,100),iterationsPerRender:validateNumber(e.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(e,t,s=8){const i=e.length,r=new Float32Array(i),o=new Float32Array(i);let a=0;for(let s=0,i=e.length;s<i;s++){const i=t[e[s]];i>a&&(a=i)}const l=a*s,d=Math.ceil(Math.sqrt(i)),h=Math.ceil(i/d),u=-Math.floor((h-1)*l/2),c=-Math.floor((d-1)*l/2);for(let e=0;e<d;e++)for(let t=0;t<h;t++)r[e*h+t]=u+t*l,o[e*h+t]=c+e*l;return{x:r,y:o}},connectComponents(e,t,s,i,r,o){let a;function push(e,value){const t=new Uint32Array(e.length+1);return t.set(e),t[e.length]=value,t}for(let l=1;l<e.length;l++){const d=e[l];let h=0,u=0;d.forEach(((e,t)=>{const s=r.get(e);null!=s&&s>h&&(u=t,h=s)})),a=d[u];const c=t[o.get(a)];c.weights=c.weights||[],c.nodes=push(c.nodes,s),c.weights.push(i);const m=t[o.get(s)];m.weights=m.weights||[],m.nodes=push(m.nodes,a),m.weights.push(i)}},correctSubgraphsDistances(e,t,s,i,r){const o=Array.prototype.reduce.call(e[s],((e,t,r)=>(r!==s&&t<i&&t>e&&(e=t),e)),0),a=i-o-1;for(let i=1;i<t.length;i++){const o=t[i];for(let t=0,i=o.length;t<i;t++){const i=r.get(o[t]);null!=i&&(e[s][i]-=a,e[i][s]-=a)}}},initialize(e,t){e.data=t,t.step=0;const s=new Map,i=new Map;t.normIndexes=t.indexes.reduce(((r,o,a)=>(r[a]=a,s.set(o,a),i.set(o,t.degree[a]),e.data&&o===t.centerIndex&&(e.data.centerIndexPos=a),r)),new Uint32Array(t.indexes.length));const r=t.centerIndexPos,o=t.components[0].length;e.connectComponents(t.components,t.attributes.adjacency,t.centerIndex,o,i,s);const a=johnson({sources:t.attributes.sources,targets:t.attributes.targets,weights:t.attributes.weights,indexes:t.indexes,adjacency:t.attributes.adjacency,undirected:!0});e.correctSubgraphsDistances(a,t.components,r,o,s),t.D=a;const l=a[r],d={};for(let e=0,s=t.normIndexes.length;e<s;e++)if(e!==r){const s=l[e];d[s]=d[s]||[],d[s].push(t.normIndexes[e])}t.rings=d,t.radii=calculateRadii(r,t.rings,t.attributes.size,t.nodeGap,t.radiusRatio,t.radiusDelta)},removeOverlaps(e,t){if(!e.data)return;const s=e.data.centerIndexPos,i=t.attributes.size,{rings:r,radii:o}=t,a=t.x[s],l=t.y[s];for(const e in r){const s=r[e];for(let i=0;i<s.length;i++){const r=s[i],d=o[e];let h=t.x[r]-a,u=t.y[r]-l;h+u===0&&(h=Math.sin(r)*Math.random()*.001,u=Math.cos(r)*Math.random()*.001);const c=Math.sqrt(h*h+u*u);if(c-d<0){const e=d/c;t.x[r]=a+h*e,t.y[r]=l+u*e}}}for(const e in r){const s=r[e],o=distance(a,l,t.x[s[0]],t.y[s[0]]);removeRadialOverlap({X:t.x,Y:t.y,sizes:i,indexes:s,center:[a,l],R:o,gap:t.nodeGap,inPlace:!0})}}}),update(e,t){e||(e=t.data);const s=e.indexes,i=e.centerIndex;let r;e.x=e.x||new Float32Array(e.size),e.y=e.y||new Float32Array(e.size),-1===e.step&&t.initialize(t,e);const o=e.repulsion,rd=t=>e.radii&&e.radii[t]||1;if(0===e.step&&e.randomize&&(r=t.gridPlacement(e.indexes,e.attributes.size),e.x=r.x,e.y=r.y),!e.converged){const t=e.maxSteps,s=e.iterationsPerRender;let i=e.step;const a=Math.min(i+s,t),{D:l,x:d,y:h,size:u,centerIndexPos:c,normIndexes:m}=e;for(;i<=a&&!e.converged;){const s=linear(Math.min(i,t)/t);e.step=i++,r=stressMinimizationStep(l,d,h,u,c,o,s,m,rd),e.x=r.x,e.y=r.y,e.prevStress=e.stress,e.stress=constrainedStress(l,d,h,u,c,o,s,m),e.converged=e.converged||Math.abs(e.stress-e.prevStress)<=e.epsilon}}if(e.converged)if(e.overlapRemoved||e.allowOverlap){e.done=!0;const t=e.rings||{};e.rings=Object.keys(t).reduce(((e,i)=>(e[i]=t[i].map((e=>s[e])),e)),{})}else t.removeOverlaps(t,e,i),e.overlapRemoved=!0;return e},isRunning:({data:e})=>!(!e||e.converged&&(e.allowOverlap||e.done))||(e&&(e.step=-1),!1),onSync(e){if(e.renderSteps||e.done)return updateGraph(e)},onEnd:e=>updateGraph(e)};function updateGraph(e){const t=e.x,s=e.y,i=e.indexes.length,r=t[e.centerIndexPos]-e.cx,o=s[e.centerIndexPos]-e.cy;for(let e=0;e<i;e++)t[e]-=r,s[e]-=o;return{indexes:e.indexes,x:t,y:s}}var ju=__spreadProps(__spreadValues({},Ou),{name:"sequential"}),Vu=class extends p{constructor(){super(...arguments),this.watchNodeObjectProperty=e=>this._ogma.modules.watcher.watchNodeObjectProperty(e),this.watchEdgeObjectProperty=e=>this._ogma.modules.watcher.watchEdgeObjectProperty(e),this.watchNodeNonObjectProperty=e=>this._ogma.modules.watcher.watchNodeNonObjectProperty(e),this.watchEdgeNonObjectProperty=e=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(e)}},Uu=class extends p{constructor(){super(...arguments),this.set=(e,t)=>this._ogma.modules.brand.set(e,t),this.remove=()=>{this._ogma.modules.brand.remove()}}},Gu=class extends p{constructor(){super(...arguments),this.enable=e=>(this._ogma.modules.connectNodes.enable(e),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},Wu=class extends p{constructor(){super(...arguments),this.enable=e=>(this._ogma.modules.lasso.enable(e),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},Hu=class extends p{constructor(){super(...arguments),this.enable=e=>this._ogma.modules.legend.enable(e),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=e=>this._ogma.modules.legend.export(e)}},qu=class extends p{constructor(){super(...arguments),this.enable=e=>{this._ogma.modules.rectangleSelect.enable(e)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},Xu=class extends p{constructor(){super(...arguments),this.enable=e=>{this._ogma.modules.resizing.enable(e)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},$u=class extends p{constructor(){super(...arguments),this.enable=e=>{this._ogma.modules.rewiring.enable(e)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},Yu=class extends p{constructor(){super(...arguments),this.enable=(e={})=>{this._ogma.modules.snapping.enable(e)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},Zu=class extends p{constructor(){super(...arguments),this.setZoom=(e,t)=>this._ogma.modules.camera.setZoom(e,t),this.zoomIn=e=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(e),this.zoomOut=e=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(e),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(e,t)=>this._ogma.modules.camera.setCenter(e,t),this.move=(e,t)=>this._ogma.modules.camera.move(e,t),this.moveToBounds=(e,t)=>{if(!(e&&e instanceof ss)){if(!isArray(e)||4!==e.length)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{const[t,s,i,r]=e;e=ss.from({minX:t,minY:s,maxX:i,maxY:r})}}return this._ogma.modules.camera.moveToBounds(e,t)},this.moveTo=(e,t)=>this._ogma.modules.camera.moveTo(e,t),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(e,t)=>this._ogma.modules.camera.setAngle(e,t),this.rotate=(e,t)=>this._ogma.modules.camera.rotate(e,t),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(e,t)=>this._ogma.modules.camera.setView(e,t),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=e=>this._ogma.modules.camera.graphToScreenCoordinates(e),this.screenToGraphCoordinates=e=>this._ogma.modules.camera.screenToGraphCoordinates(e),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=e=>this._ogma.modules.captor.detectElementAt(e.x,e.y,!1,!0),this.getElementsInView=()=>{const{width:e,height:t}=this.get(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:e,y:t});return this._ogma.modules.spatial.query(s.x,s.y,i.x,i.y)},this.getBounds=()=>{const{width:e,height:t}=this.getSize(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:e,y:t});return{cx:(s.x+i.x)/2,cy:(s.y+i.y)/2,width:i.x-s.x,height:i.y-s.y,minX:s.x,minY:s.y,maxX:i.x,maxY:i.y}},this.getElementsInside=(e,t,s,i,r=!0)=>{const{spatial:o,camera:a}=this._ogma.modules;if(r){const r=a.graphToScreenCoordinates({x:e,y:t}),l=a.graphToScreenCoordinates({x:s,y:i});return o.queryProjected(r.x,r.y,l.x,l.y)}return o.queryProjected(e,t,s,i)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=value=>this._ogma.modules.dom.setFullScreen(value),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=e=>{if(!e||isNaN(e.width)||isNaN(e.height))throw new Error("Size must follow the format { width: number, height: number }");if(e.width<0)throw new Error("width must be positive");if(e.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(e),Promise.resolve()},this.locateGraph=e=>this._ogma.modules.locate.locateGraph(e),this.locateRawGraph=(e,t)=>this._ogma.modules.locate.locateRawGraph(e,t),this.getGraphBoundingBox=({withTexts:e=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(e),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=e=>{if(!e)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");const t=e.getAttribute("text");return null==t||""===t?null:e.isNode?this._ogma.modules.labels.getTextsBoundingBox(e.toList()):this._ogma.modules.labels.getTextsBoundingBox(void 0,e.toList())},this.getNodeBadgeAt=(e,t)=>{if(!e)throw new Error("ogma.view.getNodeBadgeAt: node is not defined");return checkBadge(t,e._index,this._ogma.modules.graphics.getAttributesManager(),this._ogma.modules.camera,this._ogma.modules.graphics.getGraphicsEngine())}}};function getCorrectColor(e,t,s){if(null!=e){if(Array.isArray(e))return e[0];if(t&&s){if("source"===e)return getCorrectColor(s.color.get(t.getSource()._index));if("target"===e)return getCorrectColor(s.color.get(t.getTarget()._index))}return e}}function getTextContent(e){return null==e?null:"string"==typeof e||"number"==typeof e?`${e}`:e&&getTextContent(e.content)}function getShapeStyle(e){if(null!=e)return"string"==typeof e?e:e.style||"line"}var Qu=["color","radius","shape","text.content","x","y"],Ku=["color","width","shape.body","text.content"];function toNodeId(e){return e instanceof yi?e.getId():e}function toEdgeId(e){return e instanceof ai?e.getId():e}function nodeCollectionToSelector(e){return e instanceof xi?e.getId():e instanceof yi?[e.getId()]:isArray(e)?e.map(toNodeId):[toNodeId(e)]}function edgeCollectionToSelector(e){return e instanceof li?e.getId():e instanceof ai?[e.getId()]:isArray(e)?e.map(toEdgeId):[toEdgeId(e)]}var Ju="visible";function getGraph(e,t,s,i){const r=function getNodeSelector(e,t){return e?nodeCollectionToSelector(e):"object"==typeof t?nodeCollectionToSelector(t.nodes):t||Ju}(t,i),o=function getEdgeSelector(e,t){return e?edgeCollectionToSelector(e):"object"==typeof t?edgeCollectionToSelector(t.edges):t||Ju}(s,i);return{nodes:e.getNodes(r),edges:e.getEdges(o)}}function toJSON(e,{nodeAttributes:t,edgeAttributes:s,nodes:i,edges:r,filter:o,nodeData:a,edgeData:l}){const d=getGraph(e,i,r,o);return{nodes:d.nodes.toJSON({attributes:t,data:a}),edges:d.edges.toJSON({attributes:s,data:l})}}function toCustomJSON(e,t,{styles:s,nodes:i,edges:r,filter:o,nodeData:a,edgeData:l}){const{nodes:d,edges:h}=function getAttributesToFetch(e){return"all"!==e?{nodes:["x","y"],edges:[]}:{nodes:Qu,edges:Ku}}(s),u=toJSON(e,{nodeAttributes:d,edgeAttributes:h,nodes:i,edges:r,filter:o,nodeData:a,edgeData:l});if("original"===s){const s=function getOriginalAttributes(e,{nodes:t,edges:s}){const i=e.getOriginalAttributes();return{nodes:t.reduce(((e,t)=>(e[t.getId()]={x:i.nodes.x.get(t._index),y:i.nodes.y.get(t._index),color:getCorrectColor(i.nodes.color.get(t._index)),radius:i.nodes.radius.get(t._index),shape:i.nodes.shape.get(t._index),text:{content:i.nodes.text.content.get(t._index)}},e)),{}),edges:s.reduce(((e,t)=>(e[t.getId()]={color:getCorrectColor(i.edges.color.get(t._index)),width:i.edges.width.get(t._index),shape:{type:i.edges.shape.body.get(t._index)},text:{content:i.edges.text&&i.edges.text.content&&i.edges.text.content.get(t._index)}},e)),{})}}(t,getGraph(e,i,r,o));for(const e of u.nodes)null!=e.id&&(e.attributes=s[e.id]);for(const e of u.edges)null!=e.id&&(e.attributes=s[e.id])}return"all"===s&&u.edges.forEach((({source:t,target:s,attributes:i})=>{if(i){const r=e.getNode(t);if("source"===i.color&&r){const e=r.getAttribute("color");i.color=Array.isArray(e)?e[0]:e}const o=e.getNode(s);if("target"===i.color&&o){const e=o.getAttribute("color");i.color=Array.isArray(e)?e[0]:e}}})),function mapAttributeToFinalNames(e){return{nodes:e.nodes.map((({id:e,attributes:t={},data:s})=>{const{color:i,radius:r,shape:o,text:a,x:l,y:d}=t;return{id:e,x:l,y:d,color:getCorrectColor(i),size:r,shape:o,text:getTextContent(a),data:s}})),edges:e.edges.map((({id:e,source:t,target:s,attributes:i={},data:r})=>{const{color:o,width:a,text:l,shape:d}=i;return{id:e,source:t,target:s,color:getCorrectColor(o),size:a,shape:getShapeStyle(d),text:getTextContent(l),data:r}}))}}(u)}function access(e,t){for(let s=0;s<t.length;++s){if(null==e)return;e=e[t[s]]}return e}function assign(e,t,value){for(let s=0;s<t.length-1;++s){const i=t[s];let r=e[i];void 0===r&&(r={},e[i]=r),e=r}e[t[t.length-1]]=value}function safeValue(value,e){return null==value||Array.isArray(value)&&!value.length?e:value}function isString2(e){return"string"==typeof e}function tabsFactory(e,t,s,i,r){const o="edges"===t,a={};return e.forEach(((e,l)=>{const d=r.get(l),h=toArray(safeValue(s(d),t));if(!h.every(isString2))throw Error(`The tab ${t} function returned an invalid value.`);const u=toArray(i(e.data,h));h.forEach(((t,s)=>{const i=safeValue(u[s],{}),r=objToValueList(__spreadValues(__spreadValues({internal___id:e.id},o?{internal___source:e.source,internal___target:e.target}:{}),i)).reduce(((e,{path:t,value})=>(e[t.join(".")]=value,e)),{});a[t]=a[t]||[],a[t].push(r)}))})),a}function fromTabsToRows(e){if(!e.length)return[];const t=function createConsistentHeaderList(e){const t=__spreadValues({},e[0]);for(const s of e)for(const e of Object.keys(s))e in t||(t[e]=void 0);return Object.keys(t)}(e),s=[t];for(const i of e)s.push(t.map((e=>i[e])));return s[0]=s[0].map((e=>e.replace("internal___",""))),s}var ec=/[=+\-@|%]/,sanitize=e=>e.length>0&&ec.test(e[0])?`'${e=e.replace("|","|")}`:e;function toString2(e){return void 0===e?"":e instanceof Date?e.toISOString():sanitize(""+e)}var tc={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:idenitity,edgeData:idenitity,styles:"none"};function csvExport(e,t){const{what:s,dataProperties:i,nodes:r,edges:o,separator:a,textSeparator:l,download:d,nodeData:h,edgeData:u,filename:c,filter:m}=getOptions("string"==typeof t?{what:t}:t,tc),p=toCustomJSON(e.modules.graph,e.modules.individualAttributes,{styles:"none",nodes:r,edges:o,filter:m,nodeData:h,edgeData:u});try{const e=function graphToCsv(e,{what:t,separator:s,textSeparator:i,dataProperties:r}){const o=new RegExp(i,"g");function escape(e){return i+toString2(e).replace(o,`${i}${i}`).replace(/\n/g,"\\n").replace(/\r/g,"")+i}if(i&&'"'!==i&&"'"!==i)throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${i}`);if("nodes"!==t&&"edges"!==t)throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');const a="nodes"===t,l=a?e.nodes:e.edges,d=function elementsDataToRows(e,t,s){const i=new Je;let r=t?1:3;const o=[];for(let a=0;a<e.length;++a){const l=e[a],d=new Array(r);let h=l.data;if(s){const e={};s.forEach((t=>{const s=toPropertyPath(t),value=access(h,s);assign(e,s,value)})),h=e}const u=objToValueList(h);d[0]=l.id,t||(d[1]=l.source,d[2]=l.target);for(let e=0;e<u.length;++e){const{path:t,value}=u[e];t.length&&(i.has(t)?d[i.get(t)]=value:(i.set(t,r),d[r]=value,r++))}o.push(d)}const a=[];return a.push("id"),t||(a.push("source"),a.push("target")),i.keys().forEach((e=>a.push(e[e.length-1]))),o.unshift(a),o.forEach((e=>e.length=r)),o}(l,a,r).map((e=>e.map((value=>escape(value)))));return d.map((e=>e.join(s))).join("\n")}(p,{what:s,separator:a,textSeparator:l,dataProperties:i});return d&&promptDownload(e,c,"text"),Promise.resolve(e)}catch(e){return Promise.reject(e)}}var to255=value=>Math.round(255*value);function typeOf(e,t){if("integer"===t&&"number"==typeof e){if(e%1!=0)return"float"}else if("number"!=typeof e)return"boolean"==typeof e?"boolean":"string";return t}var isGenericObject=value=>"object"==typeof value&&null!==value&&value.constructor===Object;function flatten2(e,t={}){return forEach(e,((value,e)=>{isGenericObject(value)?flatten2(value,t):t[e]=value})),t}var sc={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:e=>e,edgeData:e=>e,filter:"visible"};function gexfExport(e,t={}){const{styles:s,nodes:i,edges:r,download:o,filename:a,creator:l,description:d,filter:h,nodeData:u,edgeData:c}=getOptions(t,sc),m=function graphToGexf(e,t){const s=createDummyXmlDocument(),i={},r={};let o,a=0,l=0;const d=s.createElement("gexf");d.setAttribute("xmlns","http://www.gexf.net/1.2draft"),d.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),d.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),d.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),d.setAttribute("version","1.2");const h=s.createElement("meta");if(h.setAttribute("lastmodifieddate",getDate()),t.creator){const e=s.createElement("creator");o=s.createTextNode(""+t.creator),e.appendChild(o),h.appendChild(e)}if(t.description){const e=s.createElement("description");o=s.createTextNode(""+t.description),e.appendChild(o),h.appendChild(e)}const u=s.createElement("graph");u.setAttribute("mode","static");const c=s.createElement("nodes");e.nodes.forEach((e=>{const t=s.createElement("node");if(t.setAttribute("id",String(e.id)),e.text&&t.setAttribute("label",escapeDOMAttribute(e.text)),isGenericObject(e.data)){const r=flatten2(e.data),o=s.createElement("attvalues");Object.keys(r).forEach((e=>{e in i||(i[e]={id:a,type:"integer"},a++);const t=r[e];i[e].type=typeOf(t,i[e].type);const l=s.createElement("attvalue");l.setAttribute("for",i[e].id),l.setAttribute("value",escapeDOMAttribute(t)),o.appendChild(l)})),t.appendChild(o)}if(e.color){const i=parseColor(e.color);if(i){const e=s.createElement("viz:color");e.setAttribute("r",to255(i[0])),e.setAttribute("g",to255(i[1])),e.setAttribute("b",to255(i[2])),e.setAttribute("a",i[3]),t.appendChild(e)}}const r=s.createElement("viz:position");if(r.setAttribute("x",e.x),r.setAttribute("y",-e.y),t.appendChild(r),e.size){const i=s.createElement("viz:size");i.setAttribute("value",e.size),t.appendChild(i)}c.appendChild(t)}));const m=s.createElement("attributes");m.setAttribute("class","node"),Object.keys(i).forEach((e=>{const t=s.createElement("attribute");t.setAttribute("id",i[e].id),t.setAttribute("title",e),t.setAttribute("type",i[e].type),m.appendChild(t)}));const p=s.createElement("edges");e.edges.forEach((e=>{const t=s.createElement("edge");if(t.setAttribute("id",e.id.toString()),t.setAttribute("source",e.source),t.setAttribute("target",e.target),e.size&&t.setAttribute("weight",e.size),e.text&&t.setAttribute("label",escapeDOMAttribute(e.text)),isGenericObject(e.data)){const i=flatten2(e.data),o=s.createElement("attvalues");Object.keys(i).forEach((e=>{e in r||(r[e]={id:l,type:"integer"},l++);const t=i[e];r[e].type=typeOf(t,r[e].type);const a=s.createElement("attvalue");a.setAttribute("for",r[e].id),a.setAttribute("value",escapeDOMAttribute(t)),o.appendChild(a)})),t.appendChild(o)}if(e.color){const i=parseColor(e.color);if(i){const e=s.createElement("viz:color");e.setAttribute("r",to255(i[0])),e.setAttribute("g",to255(i[1])),e.setAttribute("b",to255(i[2])),e.setAttribute("a",i[3]),t.appendChild(e)}}if(e.size){const i=s.createElement("viz:size");i.setAttribute("value",e.size),t.appendChild(i)}p.appendChild(t)}));const y=s.createElement("attributes");return y.setAttribute("class","edge"),Object.keys(r).forEach((e=>{const t=s.createElement("attribute");t.setAttribute("id",r[e].id),t.setAttribute("title",e),t.setAttribute("type",r[e].type),y.appendChild(t)})),u.appendChild(m),u.appendChild(y),u.appendChild(c),u.appendChild(p),d.appendChild(h),d.appendChild(u),s.appendChild(d),`<?xml version="1.0" encoding="UTF-8"?>${s.serialize()}`}(toCustomJSON(e.modules.graph,e.modules.individualAttributes,{styles:s,nodes:i,edges:r,filter:h,nodeData:u,edgeData:c}),{creator:l,description:d});return o&&promptDownload(m,a,"text"),Promise.resolve(m)}var ic={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:e=>e,edgeData:e=>e,filter:"visible"};function graphmlExport(e,t){const{styles:s,nodes:i,edges:r,download:o,filename:a,graphId:l,directedEdges:d,filter:h,nodeData:u,edgeData:c}=getOptions(t,ic),m=function graphToGraphml(e,t){const s=createXmlDocument();function setRGB(e,t){const s=parseColor(t);s&&(e.r=s[0],e.g=s[1],e.b=s[2])}function createAndAppend(e,t,i,r,force){i=i||{};const o=s.createElement(t);for(const e in i){if(!Object.prototype.hasOwnProperty.call(i,e))continue;const value=i[e];void 0!==value&&o.setAttribute(e,value)}return(void 0!==r||force)&&("[object Object]"===Object.prototype.toString.call(r)&&(r=JSON.stringify(r)),o.appendChild(s.createTextNode(r))),e.appendChild(o),o}const i=["id","source","target"],r=["size","x","y","shape","text","color"],o={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};t.noStyles&&(delete o.color,delete o.r,delete o.g,delete o.b,delete o.a,delete o.shape,r.pop());const a=[],l=[];function processItem2(e,t){const s={id:e.id};r.forEach((i=>{let value=e[i];"y"===i&&value&&(value=-parseFloat(value)),void 0!==value&&(s[("edge"===t?"edge_":"")+i]=value,"color"===i&&setRGB(s,value))}));forEach(e.data||{},((value,e)=>{-1===r.indexOf(e)&&-1===i.indexOf(e)&&(o[e]?o[e].for!==t&&(o[e].for="all"):o[e]={for:t,type:"string"},s[e]=value)})),"edge"===t?(s.source=e.source,s.target=e.target,l.push(s)):a.push(s)}e.nodes.forEach((e=>processItem2(e,"node"))),e.edges.forEach((e=>processItem2(e,"edge")));const d=createAndAppend(s,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});forEach(o,((value,e)=>{"node"!==value.for&&"all"!==value.for||createAndAppend(d,"key",{"attr.name":e,"attr.type":value.type,for:"node",id:e}),"edge"!==value.for&&"all"!==value.for||createAndAppend(d,"key",{"attr.name":e,"attr.type":value.type,for:"edge",id:"edge_"+e})})),createAndAppend(d,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),createAndAppend(d,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});const h=createAndAppend(d,"graph",{edgedefault:t.directedEdges||void 0===t.directedEdges?"directed":"undirected",id:t.graphId?t.graphId:"G","parse.nodes":e.nodes.length,"parse.edges":e.edges.length,"parse.order":"nodesfirst"});function appendShapeNode(e,s){const i=createAndAppend(e,"data",{key:"nodegraphics"}),r=createAndAppend(i,"y:ShapeNode");createAndAppend(r,"y:Geometry",{x:s.x,y:s.y,width:s.size,height:s.size}),t.noStyles||createAndAppend(r,"y:Fill",{color:toHexa(s.color),transparent:!1}),createAndAppend(r,"y:NodeLabel",null,s.text||""),createAndAppend(r,"y:Shape",{type:s.shape})}function appendPolyLineEdge(e,s){const i=createAndAppend(e,"data",{key:"edgegraphics"}),r=createAndAppend(i,"y:PolyLineEdge");createAndAppend(r,"y:LineStyle",{type:s.edge_type,color:t.noStyles?void 0:toHexa(s.edge_color),width:s.edge_size}),createAndAppend(r,"y:EdgeLabel",null,s.edge_label)}a.forEach((e=>{const t=createAndAppend(h,"node",{id:e.id});appendShapeNode(t,e),forEach(e,((value,e)=>{-1===i.indexOf(e)&&createAndAppend(t,"data",{key:e},value,!0)}))})),l.forEach((e=>{const t=createAndAppend(h,"edge",{id:e.id,source:e.source,target:e.target});appendPolyLineEdge(t,e),forEach(e,((value,e)=>{-1===i.indexOf(e)&&createAndAppend(t,"data",{key:e},value,!0)}))}));return`<?xml version="1.0" encoding="UTF-8"?>\n${serializeXMLDocument(s)}`}(toCustomJSON(e.modules.graph,e.modules.individualAttributes,{styles:s,nodes:i,edges:r,filter:h,nodeData:u,edgeData:c}),{graphId:l,directedEdges:d,noStyles:"none"===s});return o&&promptDownload(m,a,"text"),Promise.resolve(m)}var nc={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:idenitity,edgeData:idenitity,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function computeViewForExport(e,t={}){const s=e.view.get(),i="number"==typeof t.margin?t.margin:0,r={pixelRatio:t.pixelRatio||Re(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!0,isBufferDisplayable:falseFn};if(t.width&&t.height?(r.width=t.width,r.height=t.height):(r.width=s.width,r.height=s.height),t.clip)r.zoom=s.zoom,r.x=s.x,r.y=s.y;else{const o=function getGraphBoundingBox(e,t){return e.getBoundingBox().computeForZoom(t).extend(ss.fromValues(e.getAttribute("x"),e.getAttribute("y"),e.map((e=>e.getAttribute("radius")+e.getAttribute("innerStroke.width")+e.getAttribute("outerStroke.width")))))}(e.getNodes(t.filter),s.zoom);if(t.texts){const t=e.modules.labels.getTextsBoundingBox();t.isValid()&&o.extend(t)}null!=t.width&&isFinite(t.width)&&null!=t.height&&isFinite(t.height)||function adjustViewForGraphSize(e,t,s){const i=t.view.graphToScreenCoordinates(s.bottomLeft()),r=t.view.graphToScreenCoordinates(s.topRight()),o=r.x-i.x,a=r.y-i.y,l=Math.min(e.width/o,e.height/a);e.width=o*l,e.height=a*l}(r,e,o),r.width=Math.max(r.width,2*i),r.height=Math.max(r.height,2*i),r.x=o.cx,r.y=o.cy,r.zoom=Math.min((r.width-2*i)/o.width,(r.height-2*i)/o.height)}return e.modules.geo.isEnabled()?r.backgroundColor=null:void 0!==t.background&&(r.backgroundColor=t.background),r}function exportToImage(e,t,s,i,r=!1){const o=__spreadProps(__spreadValues({},s),{hideImages:r,angle:s.angle||0,currentTime:getCurrentTime(),isBufferDisplayable:e=>t.texts||!isTextBuffer(e)}),a={};if(!1===t.badges){const e={text:null,image:null};a.badges={topLeft:e,topRight:e,bottomRight:e,bottomLeft:e}}const l=e.styles.getClass(Ys);return l&&l.update({nodeAttributes:a}),e.modules.graphics.export(i,o,t.filter||Ju,t)}var getDefaultOptions=e=>({download:!0,filter:"visible",filename:`graph.${e}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,layers:!0,pixelRatio:void 0}),rc={png:getDefaultOptions("png"),jpg:getDefaultOptions("jpg"),tiff:getDefaultOptions("tiff"),gif:getDefaultOptions("gif")};function renderWatermark(e){const{canvas:t,parameters:s}=e;return s.textWatermark.content&&drawWatermarkOnCanvas(t,s.textWatermark,renderText,measureText),s.imageWatermark.url?getImage(s.imageWatermark.url).then((i=>(i&&(s.imageWatermark.content=i,drawWatermarkOnCanvas(t,s.imageWatermark,renderImage,measureImage)),e))):e}function renderLegend(e){const{ogma:t,canvas:s,parameters:i}=e,r=t.modules.legend;let o=null;return void 0===i.legend&&(o=!!r.enabled()&&r.getCurrentOptions()),!0===i.legend&&(o={}),o&&r.exportOnCanvas(s,o,e.parameters.pixelRatio),e}function renderBackground(e){const{canvas:t,parameters:s,view:i}=e;if(!i.renderBackground)return e;i.renderBackground=!1;const r=t.getContext("2d");return r.fillStyle=s.background,r.fillRect(0,0,t.width,t.height),e}function renderGeoBackground(e){const{ogma:t,view:s}=e;return t.modules.geo.isEnabled()?t.modules.geo.exportBackground(s).then((t=>{const i=s.width*s.pixelRatio,r=s.height*s.pixelRatio,o=createCanvas(i,r),a=o.getContext("2d");return a.drawImage(t,(i-t.width)/2,(r-t.height)/2),a.drawImage(e.canvas,0,0),e.canvas=o,e})):e}function renderBelowLayers(e){const{ogma:t,view:s,canvas:i,parameters:r}=e;return r.layers?t.modules.layers.export({view:s,canvas:i,below:!0}).then((()=>e)):e}function renderAboveLayers(e){const{ogma:t,view:s,canvas:i,parameters:r}=e;return r.layers?t.modules.layers.export({view:s,below:!1,canvas:i}).then((()=>e)):e}function renderGraph(e){const{ogma:t,parameters:s,canvas:i,view:r}=e,o=i.getContext("2d");return exportToImage(t,s,r,"canvas",!s.images).then((a=>{try{const t=a.getContext("2d");if(!t)throw new Error("Failed to render graph");return t.getImageData(0,0,1,1),o.drawImage(a,0,0,i.width,i.height),e}catch(a){return $warn(a),exportToImage(t,s,r,"canvas",!0).then((t=>(o.drawImage(t,0,0,i.width,i.height),e)))}}))}function convertToDataUrl({canvas:e,parameters:t,type:s}){const i=e.toDataURL("image/"+s);return t.download&&promptDownload(i,t.filename,"dataURL"),i}function exportImage(e,t,s){const i=getOptions(t,rc[s]);null===i.background&&(i.background=e.modules.graphics.getTransparentBackgroundColor());const r=computeViewForExport(e,i);i.pixelRatio=r.pixelRatio;const o={ogma:e,parameters:i,canvas:createCanvas(r.width*r.pixelRatio,r.height*r.pixelRatio),view:r,type:s};return Promise.resolve().then((()=>o)).then(renderBackground).then(renderGeoBackground).then(renderBelowLayers).then(renderGraph).then(renderAboveLayers).then(renderWatermark).then(renderLegend).then(convertToDataUrl)}function renderText(e,t,s,i){e.textAlign="center",e.textBaseline="middle",e.fillText(t,s,i)}function measureText(e,t,s){return{width:e.measureText(t).width,height:s}}function measureImage(e,t,s,i,r){return{width:void 0===i?t.width:i,height:void 0===r?t.height:r}}function renderImage(e,t,s,i,r,o){e.drawImage(t,s-r/2,i-o/2,r,o)}function drawWatermarkOnCanvas(e,t,s,i){if(!t)return;if("object"!=typeof t)t={content:t};else if(!t.content)return;const{fontFamily:r,fontSize:o,fontStyle:a,fontColor:l,repeat:d,alpha:h,space:u,content:c}=t;let m=t.angle;const p=e.getContext("2d"),y=e.width,x=e.height,b=void 0===t.x?y/2:t.x,v=void 0===t.y?x/2:t.y,E=t.height,k=t.width;m=m/180*Math.PI,setCtxFont(p,r,o,a),p.fillStyle=l,p.globalAlpha=h;const L=i(p,c,o,k,E);if(d){const e=L.width+u,t=L.height+u,i=Math.sqrt(y*y+x*x);p.save(),p.translate(0,0),p.rotate(m);for(let r=0;r<i;r+=e)for(let e=0;e<i;e+=t)s(p,c,r,e,L.width,L.height),0!==e&&s(p,c,r,-e,L.width,L.height);p.restore()}else p.save(),p.translate(b,v),p.rotate(m),s(p,c,0,0,L.width,L.height),p.restore()}var oc={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,layers:!0,clip:!1,margin:10,prefix:"ogma"};function svgExport(e,t){const s=getOptions(t,oc),{background:i,filename:r,download:o,layers:a}=s,l=e.modules.graphics;null===i&&(s.background=l.getTransparentBackgroundColor());const d=computeViewForExport(e,s);return exportToImage(e,s,d,"svg",!s.images).then((e=>(e.removeAttribute("pointer-events"),e.setAttribute("version","1.1"),e.setAttributeNS(je,"xmlns",Be),e.setAttributeNS(je,"xmlns:xlink",Ve),e))).then((t=>s.groupSemantically?function groupSemantically(e,t,s){const i=t.childNodes[2],r=i.childNodes,o={},a=s.prefix;for(let e=0;e<r.length;e++){const t=r[e],s=t.getAttribute(xr);null!=s&&(o[s]=o[s]||[],o[s].push(t))}const l=Object.keys(o),d=e.modules.graph,h=d.getNodeAttribute("id"),u=d.getEdgeAttribute("id"),c=createSvgElement("g",{class:`${a}-edges`}),m=createSvgElement("g",{class:`${a}-nodes`});for(let e=0;e<l.length;e++){const t=l[e],s="n"===t.charAt(0),i=parseInt(t.substring(1)),r=o[t],d=escapeDOMAttribute((s?h:u).get(i).toString()),p=createSvgElement("g");p.setAttribute(`data-${s?"node":"edge"}-id`,d),p.setAttribute("class",`${a}-${s?"node":"edge"}`);for(let e=0;e<r.length;e++){const t=r[e];p.appendChild(t),t.removeAttribute(xr)}(s?m:c).appendChild(p)}return i.appendChild(c),i.appendChild(m),t}(e,t,s):t)).then((e=>function addFontDefinitions(e,t){const s=function getFontsList(e){const t=[].concat(Array.prototype.slice.call(e.getElementsByTagName("text")||[])),s=[],i={};for(let e=0;e<t.length;e++){const r=t[e].parentNode.getAttribute("font-family");if("string"==typeof r){const e=r.split(",");for(let t=0;t<e.length;t++){const r=e[t].replace(/['"]/g,"");""===r||i[r]||(i[r]=!0,s.push(r))}}}return{list:s,map:i}}(e).map;return getDocumentFontRules().then((e=>e.filter((e=>s[e.name])))).then((e=>getEmbeddedFontRules(e,!!t.embedFonts))).then((t=>{if(0!==t.length){const s=createSvgElement("style");for(let e=0;e<t.length;e++)s.appendChild(createTextNode(t[e]));e.childNodes[0].appendChild(s)}return e}))}(e,s))).then((t=>function renderGeoBackground2(e,t,s){return e.modules.geo.isEnabled()?e.modules.geo.exportBackground(__spreadProps(__spreadValues({},t),{pixelRatio:1})).then((e=>{const t=createSvgElement("image",{width:e.width,height:e.height,x:0,y:0,href:e.toDataURL()});return s.insertBefore(t,s.children[0]),s})):Promise.resolve(s)}(e,d,t))).then((t=>renderLayers(e,d,t,a,!0))).then((t=>renderLayers(e,d,t,a,!1))).then((e=>{const t=`<?xml version="1.0" encoding="utf-8"?>${serializeXMLDocument(e)}`;return o&&promptDownload(t,r,"text/xml"),t}))}function renderLayers(e,t,s,i,r=!1){return i?e.modules.layers.export({view:t,svg:s,below:r}).then((()=>s)):Promise.resolve(s)}var ac={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function xlsxExport(e,t={}){"string"==typeof t&&(t={what:t});const{what:s,nodes:i,edges:r,tab:o={nodes:()=>"nodes",edges:()=>"edges"},download:a,filename:l,dataProperties:d,filter:h,nodeData:u,edgeData:c}=getOptions(t,ac);o.nodes||(o.nodes=()=>"nodes"),o.edges||(o.edges=()=>"edges");const m=toCustomJSON(e.modules.graph,e.modules.individualAttributes,{styles:"none",nodes:i,edges:r,filter:h,nodeData:e=>e,edgeData:e=>e}),p=function graphToXlsx(e,{what:t,tabFunctions:s,tabContentFunctions:i},r){const o=smartRequire("XLSX")||smartRequire("xlsx",{throwOnError:!0});if(!o)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');const a=new lc;if(t){if("nodes"!==t&&"edges"!==t)throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${t}`);"nodes"===t&&(e.edges=[]),"edges"===t&&(e.nodes=[])}const l={};for(const t of["nodes","edges"]){const o=tabsFactory(e[t],t,s[t],i[t],r[t]);for(const e of Object.keys(o))l[e]=[...l[e]||[],...o[e]]}for(const e of Object.keys(l))a.SheetNames.push(e),a.Sheets[e]=sheet(o,fromTabsToRows(l[e]));0===a.SheetNames.length&&(a.SheetNames=["nodes","edges"],a.Sheets.nodes={},a.Sheets.edges={});const d=o.write(a,{bookType:"xlsx",bookSST:!1,type:"binary"});return createBlob([s2ab(d)])}(m,{what:s,tabFunctions:o,tabContentFunctions:{nodes:u||(e=>pick(flatten(e||{}),d)),edges:c||(e=>pick(flatten(e||{}),d))}},{nodes:e.modules.graph.getNodes(m.nodes.map((({id:e})=>e))),edges:e.modules.graph.getEdges(m.edges.map((({id:e})=>e)))});return a&&promptDownload(p,l,"blob"),Promise.resolve(p)}function sheet(e,t){const s={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let r=0;r!==t.length;++r){const o=t[r];for(let t=0;t!==o.length;++t){const value=o[t];i.s.r>r&&(i.s.r=r),i.s.c>t&&(i.s.c=t),i.e.r<r&&(i.e.r=r),i.e.c<t&&(i.e.c=t);const a={v:toString2(value)};s[e.utils.encode_cell({c:t,r})]=a}}return i.s.c<1e7&&(s["!ref"]=e.utils.encode_range(i)),s}var lc=class{constructor(){this.SheetNames=[],this.Sheets={}}};function s2ab(e){const t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0;t!==e.length;++t)s[t]=255&e.charCodeAt(t);return t}var dc={};__export(dc,{gexf:()=>gexf2,gexfFromUrl:()=>gexfFromUrl,graphml:()=>graphml2,graphmlFromUrl:()=>graphmlFromUrl,janus:()=>janus2,json:()=>json2,jsonFromUrl:()=>jsonFromUrl,neo4j:()=>neo4j2});var hc=__toESM(u()),gexf2=e=>Promise.resolve(hc.gexf(e)),gexfFromUrl=e=>fetch(e).then((e=>hc.gexf(e))),janus2=e=>Promise.resolve(hc.janus(e)),json2=(e,t)=>Promise.resolve(hc.json(e,t)),jsonFromUrl=(e,t)=>fetch(e).then((e=>hc.json(e,t))),neo4j2=e=>Promise.resolve(hc.neo4j(e)),graphml2=e=>Promise.resolve(hc.graphml(e)),graphmlFromUrl=e=>fetch(e).then((e=>hc.graphml(e))),uc=class extends p{constructor(){super(...arguments),this.wait=e=>new Promise((t=>setTimeout(t,e))),this.initRandomGraph=e=>this._ogma.generate.random(e).then(this._ogma.setGraph).then((()=>this._ogma.view.locateGraph())).then((()=>this._ogma.view.afterNextFrame())),this.initGrid=e=>{const t=Math.ceil(Math.sqrt(e));return this._ogma.generate.grid({rows:t,columns:t}).then((e=>this._ogma.setGraph(e))).then((()=>this._ogma.view.locateGraph()))},this.initLine=e=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:e?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:e="r",start:t=!0}={})=>{let s=t;const callback=()=>{s&&this._ogma.modules.dom.beforeNextFrame().then(callback)};document.addEventListener("keydown",(({key:t})=>{t===e&&(s=!s,callback())})),callback()},this.appendToBody=()=>{const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.bottom="0",e.style.right="0",document.body.appendChild(e),this._ogma.setContainer(e)},this.loadFile=e=>(e.endsWith(".gexf")?gexfFromUrl(e):jsonFromUrl(e)).then((e=>this._ogma.setGraph(e))).then((()=>this._ogma.view.locateGraph())).then((()=>this._ogma.view.afterNextFrame())),this.enableLasso=e=>{this._ogma.events.on("dragStart",(()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(e)}))},this.randomizeGraph=({minX:e=0,minY:t=0,maxX:s=500,maxY:i=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map((()=>({x:e+Math.random()*(s-e),y:t+Math.random()*(i-t)}))))}};var cc=class extends p{constructor(){super(...arguments),this.once=(e,t)=>(this._ogma.modules.events.once(e,t),this),this.removeListener=e=>{this._ogma.modules.events.off(e)},this.onNodesAdded=e=>(this._ogma.events.on("addNodes",e),this._ogma),this.onBeforeNodesRemoved=e=>(this._ogma.events.on("beforeRemoveNodes",e),this._ogma),this.onNodesRemoved=e=>(this._ogma.events.on("removeNodes",e),this._ogma),this.onEdgesAdded=e=>(this._ogma.events.on("addEdges",e),this._ogma),this.onBeforeEdgesRemoved=e=>(this._ogma.events.on("beforeRemoveEdges",e),this._ogma),this.onEdgesRemoved=e=>(this._ogma.events.on("removeEdges",e),this._ogma),this.onGraphCleared=e=>(this._ogma.events.on("clearGraph",e),this._ogma),this.onNodesClassAdded=(e,t)=>(this._ogma.modules.classes.onNodeClassAdded(e,t),this._ogma),this.onNodesClassRemoved=(e,t)=>(this._ogma.modules.classes.onNodeClassRemoved(e,t),this._ogma),this.onEdgesClassAdded=(e,t)=>(this._ogma.modules.classes.onEdgeClassAdded(e,t),this._ogma),this.onEdgesClassRemoved=(e,t)=>(this._ogma.modules.classes.onEdgeClassRemoved(e,t),this._ogma),this.onNodeDragStart=e=>(this._ogma.events.on("nodesDragStart",e),this._ogma),this.onNodeDragProgress=e=>(this._ogma.events.on("nodesDragProgress",e),this._ogma),this.onNodeDragEnd=e=>(this._ogma.events.on("nodesDragEnd",e),this._ogma),this.onDrop=e=>(this._ogma.events.on("drop",e),this._ogma),this.onNodesSelected=e=>this.onNodesClassAdded(Hs,e),this.onNodesUnselected=e=>this.onNodesClassRemoved(Hs,e),this.onEdgesSelected=e=>this.onEdgesClassAdded(Hs,e),this.onEdgesUnselected=e=>this.onEdgesClassRemoved(Hs,e),this.onNodeDataChange=e=>(this._ogma.events.on("updateNodeData",e),this._ogma),this.onEdgeDataChange=e=>(this._ogma.events.on("updateEdgeData",e),this._ogma),this.onAnimate=e=>(this._ogma.events.on("animate",e),this._ogma),this.onMouseMove=e=>(this._ogma.events.on("mousemove",e),this._ogma),this.onMouseButtonDown=e=>(this._ogma.events.on("mousedown",e),this._ogma),this.onMouseButtonUp=e=>(this._ogma.events.on("mouseup",e),this._ogma),this.onClick=e=>(this._ogma.events.on("click",e),this._ogma),this.onDoubleClick=e=>(this._ogma.events.on("doubleclick",e),this._ogma),this.onMouseWheel=e=>(this._ogma.events.on("mousewheel",e),this._ogma),this.onHover=e=>(this._ogma.events.on("mouseover",e),this._ogma),this.onUnhover=e=>(this._ogma.events.on("mouseout",e),this._ogma),this.onDragStart=e=>(this._ogma.events.on("dragStart",e),this._ogma),this.onDragProgress=e=>(this._ogma.events.on("dragProgress",e),this._ogma),this.onDragEnd=e=>(this._ogma.events.on("dragEnd",e),this._ogma),this.onGestureStart=e=>(this._ogma.events.on("gestureStart",e),this._ogma),this.onGestureProgress=e=>(this._ogma.events.on("gestureProgress",e),this._ogma),this.onGestureEnd=e=>(this._ogma.events.on("gestureEnd",e),this._ogma),this.onRendererStateChange=e=>(this._ogma.events.on("rendererStateChange",e),this._ogma),this.onZoomProgress=e=>(this._ogma.events.on("zoom",e),this._ogma),this.onViewChanged=e=>(this._ogma.events.on("viewChanged",e),this._ogma),this.onNodesConnected=e=>(this._ogma.events.on("connectNodes",e),this._ogma),this.onGeoModeEnabled=e=>(this._ogma.events.on("geoEnabled",e),this._ogma),this.onGeoModeDisabled=e=>(this._ogma.events.on("geoDisabled",e),this._ogma),this.onGeoModeLoaded=e=>(this._ogma.events.on("geoLoaded",e),this._ogma),this.onLayoutStart=e=>(this._ogma.events.on("layoutStart",e),this._ogma),this.onLayoutComplete=e=>(this._ogma.events.on("layoutEnd",e),this._ogma),this.onLayoutComputed=e=>(this._ogma.events.on("layoutComputed",e),this._ogma),this.onTooltipShown=e=>(this._ogma.events.on("tooltipShow",e),this._ogma),this.onTooltipHidden=e=>(this._ogma.events.on("tooltipHide",e),this._ogma),this.onTransformationEnabled=e=>(this._ogma.events.on("transformationEnabled",e),this._ogma),this.onTransformationDisabled=e=>(this._ogma.events.on("transformationDisabled",e),this._ogma),this.onTransformationSetIndex=e=>(this._ogma.events.on("transformationSetIndex",e),this._ogma),this.onTransformationDestroyed=e=>(this._ogma.modules.events.on("transformationDestroyed",e),this._ogma),this.onTransformationRefreshed=e=>(this._ogma.events.on("transformationRefresh",e),this._ogma)}on(e,t){return this._ogma.modules.events.on(e,t),this}off(e){return this._ogma.modules.events.off(e),this}onKeyPress(e,t){return this._ogma.modules.keyboard.onKeyPress(e,t),this._ogma}},gc=class extends p{constructor(e){super(e),this.csv=e=>csvExport(this._ogma,e),this.xlsx=e=>(e&&e.dataProperties,xlsxExport(this._ogma,e)),this.gexf=e=>gexfExport(this._ogma,e),this.graphml=(e={})=>graphmlExport(this._ogma,e),this.json=(e={})=>function jsonExport(e,t={}){t.anonymize&&(t={nodeAttributes:"all",edgeAttributes:"all",nodeData:nullFn,edgeData:nullFn,filter:t.filter||"all",download:t.download,pretty:t.pretty,filename:t.filename});const{nodeAttributes:s,edgeAttributes:i,nodeData:r,edgeData:o,filter:a,pretty:l,download:d,filename:h}=getOptions(t,nc),u=toJSON(e.modules.graph,{nodeAttributes:s,edgeAttributes:i,filter:a,nodeData:r,edgeData:o}),c=l?JSON.stringify(u,null," "):JSON.stringify(u);return d&&promptDownload(c,h,"text"),Promise.resolve(u)}(this._ogma,e),this.svg=(e={})=>svgExport(this._ogma,e),this.png=(e={})=>exportImage(this._ogma,e,"png"),this.jpg=(e={})=>exportImage(this._ogma,e,"jpg"),this.tiff=(e={})=>exportImage(this._ogma,e,"tiff"),this.gif=(e={})=>exportImage(this._ogma,e,"gif"),e.styles.createClass({name:Ys,isBuiltin:!0})}},mc=__toESM(c()),_c=class extends p{constructor(){super(...arguments),this.balancedTree=e=>Promise.resolve(mc.balancedTree.generate(mc.balancedTree.configure(e))),this.barabasiAlbert=e=>Promise.resolve(mc.barabasiAlbert.generate(mc.barabasiAlbert.configure(e))),this.erdosRenyi=e=>Promise.resolve(mc.erdosRenyi.generate(mc.erdosRenyi.configure(e))),this.flower=e=>Promise.resolve(mc.flower.generate(mc.flower.configure(e))),this.grid=e=>Promise.resolve(mc.grid.generate(mc.grid.configure(e))),this.path=e=>Promise.resolve(mc.path.generate(mc.path.configure(e))),this.random=e=>Promise.resolve(mc.random.generate(mc.random.configure(e))),this.randomTree=e=>Promise.resolve(mc.randomTree.generate(mc.randomTree.configure(e)))}},pc=class extends p{constructor(){super(...arguments),this.gexf=e=>gexf2(e),this.gexfFromUrl=e=>gexfFromUrl(e),this.janus=e=>janus2(e),this.json=(e,t)=>json2(e,t),this.jsonFromUrl=(e,t)=>jsonFromUrl(e,t),this.neo4j=e=>neo4j2(e),this.graphml=e=>graphml2(e),this.graphmlFromUrl=e=>graphmlFromUrl(e)}},fc=class extends p{constructor(e){super(e),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=(e=>(e.modules.layouts.register(nh),t=>e.modules.layouts.start(nh.name,t)))(e),this.radial=(e=>(e.modules.layouts.register(Bu),t=>{if(void 0===t.centralNode)throw new Error('concentric layout: missing parameter "centralNode"');if(t.maxIterations=t.maxIterations&&isFinite(t.maxIterations)?Math.floor(t.maxIterations):100,t.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(t.iterationsPerRender=t.iterationsPerRender&&isFinite(t.iterationsPerRender)?Math.floor(t.iterationsPerRender):20,t.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(t.epsilon=t.epsilon&&isFinite(t.epsilon)?t.epsilon:.001,t.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return e.modules.layouts.start(Bu.name,t)}))(e),this.force=(e=>(e.modules.layouts.register(Eu),(t={})=>{if(t.incremental)return incrementalLayout(t,e,e.layouts.force);if(void 0!==t.edgeStrength&&(!isFinite(t.edgeStrength)||t.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(void 0!==t.steps&&(!isFinite(t.steps)||t.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(void 0!==t.edgeLength&&(!isFinite(t.edgeLength)||t.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(void 0!==t.gravity&&(!isFinite(t.gravity)||t.gravity<0||t.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(void 0!==t.charge&&!isFinite(t.charge))throw new Error("force layout: 'charge' must be a number");if(void 0!==t.radiusRatio&&(!isFinite(t.radiusRatio)||t.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(void 0!==t.theta&&(!isFinite(t.theta)||t.theta<0||t.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(void 0===t.cx&&void 0===t.cy||"number"==typeof t.cx&&"number"==typeof t.cy))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(void 0!==t.siblingsOffset&&!isFinite(t.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");const s=!!t.gpu&&(t.nodes?isArray(t.nodes)?t.nodes.length:t.nodes.size:e.getNodes().size)>15e3;return t.gpu=!s&&!!t.gpu,t.gpu&&(t.useWebWorker=!1,t.steps=200),e.modules.layouts.start(Eu.name,t)}))(e),this.forceLink=(e=>(e.modules.layouts.register(Tu),(t={})=>t.incremental?incrementalLayout(t,e,e.layouts.forceLink):e.modules.layouts.start(Tu.name,t)))(e),this.hierarchical=(e=>(e.modules.layouts.register(Ou),(t={})=>(t.useWebWorker=!1,e.modules.layouts.start(Ou.name,t))))(e),this.sequential=(e=>(e.modules.layouts.register(ju),(t={})=>{t.useWebWorker=!1;const s=__spreadProps(__spreadValues({},t),{evenDistribution:!0});return e.modules.layouts.start(ju.name,s)}))(e),this.grid=(e=>(e.modules.layouts.register(Cu),(t={})=>e.modules.layouts.start(Cu.name,t)))(e)}},yc=class extends p{constructor(){super(...arguments),this.move=e=>this._ogma.modules.virtualMouse.move(e),this.down=e=>this._ogma.modules.virtualMouse.down(e),this.up=e=>this._ogma.modules.virtualMouse.up(e),this.click=e=>this._ogma.modules.virtualMouse.click(e),this.rightClick=e=>this._ogma.modules.virtualMouse.rightClick(e),this.doubleclick=e=>this._ogma.modules.virtualMouse.doubleclick(e),this.drag=(e,t)=>this._ogma.modules.virtualMouse.drag(e,t),this.wheel=e=>this._ogma.modules.virtualMouse.wheel(e)}},xc=class extends p{constructor(){super(...arguments),this.map=e=>this._ogma.modules.rules.createMapping(e),this.slices=e=>this._ogma.modules.rules.createSlices(e),this.template=e=>this._ogma.modules.rules.createTemplate(e)}},bc=class extends p{constructor(){super(...arguments),this.setNodesVisibility=value=>this._ogma.modules.graphics.setNodesVisibility(value),this.setEdgesVisibility=value=>this._ogma.modules.graphics.setEdgesVisibility(value),this.setNodeTextsVisibility=value=>this._ogma.modules.graphics.setNodeTextsVisibility(value),this.setEdgeTextsVisibility=value=>this._ogma.modules.graphics.setEdgeTextsVisibility(value),this.addRule=(e={})=>this._ogma.modules.styleRules.addRule(e),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(e,t)=>{let s,i;return void 0===t?(s=e,i=void 0):(s=t,i=e),this.addRule({nodeAttributes:s,nodeSelector:i})},this.addEdgeRule=(e,t)=>{let s,i;return void 0===t?(s=e,i=void 0):(s=t,i=e),this.addRule({edgeAttributes:s,edgeSelector:i})},this.getNodeRules=()=>this.getRuleList().filter((e=>void 0===e.getDefinition().edgeAttributes)),this.getEdgeRules=()=>this.getRuleList().filter((e=>void 0===e.getDefinition().nodeAttributes)),this.createClass=e=>this._ogma.modules.classes.createClass(e),this.getClass=e=>this._ogma.modules.classes.getClassByName(e),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(e,t)=>{this._ogma.modules.hover.updateNodeAttributes(e,t)},this.setHoveredEdgeAttributes=(e,t)=>{this._ogma.modules.hover.updateEdgeAttributes(e,t)},this.setSelectedNodeAttributes=(e,t)=>this._ogma.modules.selection.setNodeAttributes(e,!!t),this.setSelectedEdgeAttributes=(e,t)=>this._ogma.modules.selection.setEdgeAttributes(e,!!t),this.setTheme=({nodeAttributes:e,edgeAttributes:t,selectedNodeAttributes:s,selectedEdgeAttributes:i,hoveredNodeAttributes:r,hoveredEdgeAttributes:o})=>{this._ogma.modules.pulses.setTheme(e&&e.pulse||{},t&&t.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(e||{},t||{}),this.setSelectedNodeAttributes(s||{}),this.setSelectedEdgeAttributes(i||{}),this.setHoveredNodeAttributes(r||{}),this.setHoveredEdgeAttributes(o||{})}}},vc=class extends p{constructor(){super(...arguments),this.onNodeHover=(e,t={})=>{this._ogma.modules.tooltip.setHandler("hover.node",e,t)},this.onNodeClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",e,t)},this.onNodeRightClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",e,t)},this.onNodeDoubleClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",e,t)},this.onEdgeHover=(e,t={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",e,t)},this.onEdgeClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",e,t)},this.onEdgeRightClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",e,t)},this.onEdgeDoubleClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",e,t)},this.onBackgroundClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",e,t)},this.onBackgroundRightClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",e,t)},this.onBackgroundDoubleClick=(e,t={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",e,t)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(e,t)=>this._ogma.modules.tooltip.show(e,t)}},Ac=class extends p{constructor(e){super(e),this.lasso=new Wu(e),this.connectNodes=new Gu(e),this.legend=new Hu(e),this.rectangleSelect=new qu(e),this.resize=new Xu(e),this.rewire=new $u(e),this.snapping=new Yu(e),this.tooltip=new vc(e),this.brand=new Uu(e)}};function isValidId(e,t,s){const i=e.getEdge(t.id||"");return!i||i.getTransformation()===s}var defaultItemSelector=e=>!0,defaultGroupId=e=>"";function defaultGeneratorFn(e,t,s){return{}}var Sc=class extends Xd{constructor(e){super(e),this._checkEdgeDataUpdate=!0,this._checkNodeDataUpdate=!0,this._nodeSelector=e.nodeSelector||defaultItemSelector,this._nodeGroupIdFunction=e.nodeGroupIdFunction||defaultGroupId,this._nodeGenerator=e.nodeGenerator||defaultGeneratorFn,this._edgeSelector=e.edgeSelector||defaultItemSelector,this._edgeGroupIdFunction=e.edgeGroupIdFunction||defaultGroupId,this._edgeGenerator=e.edgeGenerator||defaultGeneratorFn,this._edgeSource=e.edgeSource,this._edgeTarget=e.edgeTarget,this._separateEdgesByDirection=e.separateEdgesByDirection,this._groupSelfLoopEdges=!!e.groupSelfLoopEdges,this._groupEdges=e.groupEdges}_computeNodeGroupId(e){if(this._nodeGroupIdFunction)return this._nodeSelector(e)?this._nodeGroupIdFunction(e):void 0}_computeEdgeGroupId(e){if(this._edgeGroupIdFunction)return this._edgeSelector(e)?this._edgeGroupIdFunction(e):void 0}_addMetaNodes(){const e=this._id,t=this._ogma,s=t.getNodes().reduce(((e,t)=>t.getTransformation()===this?e.concat(t.getSubNodes()):e.concat(t.toList())),this._ogma.nodeList()),i=new Map;for(let e=0;e<s.size;++e){const t=s.get(e),r=this._computeNodeGroupId(t);if(void 0!==r){let e=i.get(r);e||(e={id:r,nodes:[]},i.set(r,e)),e.nodes.push(t)}}const r=mapValues(i),o=r.map((({nodes:e})=>t.getNodes(e))),a=[];for(let t=0;t<r.length;++t){const s=r[t].id,i=o[t],l=this._nodeGenerator(i,s,this);void 0===l.id&&(l.id=generateMetaId(s,e)),l.position=computeCentroid(i.getPosition()),a.push(l)}return t.addNodes(a.map((e=>({id:e.id,attributes:e.position}))),{virtual:!0}).then((()=>{const e=t.getNodes(a.map((e=>e.id)));e.replaceOriginalAttributes(a.map((e=>e.attributes)),["x","y","radius"]);const s=e.getData();for(let t=0;t<s.length;t++){const i=s[t],r=a[t];s[t]=merge(merge(i,r.data),this._context.nodeDataUpdates.get(e._indexes[t]))}return this._checkNodeDataUpdate=!1,e.setData(null,s),e.setVisible(!0),this._ogma.modules.grouping.setSubElements(e,o),o.forEach(((t,s)=>{this._ogma.modules.grouping.setMetaElement(t,e.get(s))})),e}))}_addMetaEdges(){const e=this._id,t=this._ogma,s=t.getEdges(),i=new Map,r=this._ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter((e=>"curvature"!==e));for(let e=0;e<s.size;++e){const t=s.get(e),r=this._computeEdgeGroupId(t);if(void 0!==r){const e=this._edgeSource(t),s=this._edgeTarget(t),o=this._groupEdges?getEdgeFullGroupId(r,e.getId(),s.getId(),this._separateEdgesByDirection):String(t.getId());let a=i.get(o);a||(a={id:o,source:e,target:s,edges:[]},i.set(o,a)),a.edges.push(t)}}const o=mapValues(i),a=o.map((({edges:e})=>t.getEdges(e))),l=[];for(let s=0;s<o.length;++s){const i=o[s],d=i.id,h=a[s],u=this._groupEdges?this._edgeGenerator(h,d,this):cloneEdge(h,r);if(null!=u.id&&!isValidId(t,u,this))throw Error(`The id ${u.id} returned by the edgeGenerator function is not a unique id.`);void 0===u.id&&(u.id=generateMetaId(d,e)),u.source=i.source.getId(),u.target=i.target.getId(),l.push(u)}return t.addEdges(function copyIdSourceTarget(e){return e.map((({id:e,source:t,target:s})=>({id:e,source:t,target:s})))}(l),{virtual:!0}).then((()=>{const e=t.getEdges(l.map((e=>e.id)));e.setAttributes(l.map((e=>e.attributes)));const s=e.getData();for(let e=0;e<s.length;e++){const t=l[e],i=s[e];s[e]=merge(i,t.data)}return this._checkEdgeDataUpdate=!1,e.setData(null,s),e.setVisible(!1),this._ogma.modules.grouping.setSubElements(e,a),a.forEach(((t,s)=>{this._ogma.modules.grouping.setMetaElement(t,e.get(s))})),e}))}_removeMetaEdge(e){e.forEach((e=>{const t=e.getSubEdges();if(!t)return;const s=e.getMetaEdge()||null;this._ogma.modules.grouping.setMetaElement(t,s),s&&this._ogma.modules.grouping.setSubElements(s.toList(),[t.concat((s.getSubEdges()||this._ogma.edgeList()).filter((t=>t!==e)))]),t.filter((e=>e.getTarget().isVisible()&&e.getSource().isVisible())).setVisible(!0)}))}_removeMetaNode(e){e.forEach((e=>{const t=e.getSubNodes();t&&(this._ogma.modules.grouping.setMetaElement(t,null),t.setVisible(!0))}))}_checkChanges(e,t){const s=t?this._context.nodeDataUpdates:this._context.edgeDataUpdates;for(let i=0;i<e.length;i++){const r=t?e[i].nodes.filter((e=>e.getTransformation()===this)):e[i].edges.filter((e=>e.getTransformation()===this));if(r.size)for(let t=0;t<r._indexes.length;t++){let o=s.get(r._indexes[t])||{};const a=e[i].property,l=e[i].newValues[t];a?setProperty(o,a,l):o=l,s.set(r._indexes[t],o)}}}_setOptions(e){this._nodeSelector=e.nodeSelector||this._nodeSelector,this._nodeGroupIdFunction=e.nodeGroupIdFunction||this._nodeGroupIdFunction,this._nodeGenerator=e.nodeGenerator||this._nodeGenerator,this._edgeSelector=e.edgeSelector||this._edgeSelector,this._edgeGroupIdFunction=e.edgeGroupIdFunction||this._edgeGroupIdFunction,this._edgeGenerator=e.edgeGenerator||this._edgeGenerator,this._edgeSource=e.edgeSource||this._edgeSource,this._edgeTarget=e.edgeTarget||this._edgeTarget,this._separateEdgesByDirection=void 0!==e.separateEdgesByDirection?!!e.separateEdgesByDirection:this._separateEdgesByDirection,this._groupSelfLoopEdges=void 0!==e.groupSelfLoopEdges?!!e.groupSelfLoopEdges:this._groupSelfLoopEdges,this._groupEdges=void 0!==e.groupEdges?!!e.groupEdges:this._groupEdges}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{nodeDataUpdates:new Map,edgeDataUpdates:new Map})}initialize(e){super.initialize(e),this._ogma.events.on("updateNodeData",(({changes:e})=>{this._checkNodeDataUpdate?this._checkChanges(e,!0):this._checkNodeDataUpdate=!0})),this._ogma.events.on("updateEdgeData",(({changes:e})=>{this._checkEdgeDataUpdate?this._checkChanges(e,!1):this._checkEdgeDataUpdate=!0}))}};function getEdgeFullGroupId(e,t,s,i){let r=t,o=s;return!i&&r.toString()>o.toString()&&(r=s,o=t),`${e}[${r}-${o}]`}function cloneEdge(e,t){const s=e.get(0);return{data:s.getData(),attributes:s.getAttributes(t)}}function generateMetaId(e,t){return`gen_grp_${t}_${e}`}var defaultGroupId2=()=>"",defaultNodeGenerator=()=>({}),Ec=class extends Xd{constructor(e){super(e),this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this._onPreAddGraph=noop,this._onBeforeAdd=e=>{if(this._isCleaningUp||!this.enabled)return;const{isNode:t,objects:s}=e;overwrite(e.objects,t?this._groupNodes(s):this._groupEdges(s)),this._shouldSetVirtual=!0},this._onAfterAdd=e=>{this._shouldSetVirtual&&(this._shouldSetVirtual=!1,this._setVirtual(e.nodes||e.edges,!!e.nodes))},this._onRequestElementsToDelete=e=>{if(e.virtual)return;const t=e.elementsToRemove.isNode,s=t?this._ogma.getNodes:this._ogma.getEdges,i=t?this._context.metaNodesSet:this._context.metaEdgesSet,r=t?this._context.nodeGroups:this._context.edgeGroups,o=t?this._ogma.removeNodes:this._ogma.removeEdges,a=e.elementsToRemove.size,l=s(Array.from(i)),d=e.elementsToRemove.slice();if(e.elementsToRemove=e.elementsToRemove.subtract(l),e.elementsToRemove.size===a)return;const h=d.subtract(e.elementsToRemove);if(h.forEach((e=>{r.delete(e.getId())})),t){const e=h.getAdjacentEdges().filter((e=>e.isVirtual()));this._ogma.removeEdges(e)}o(h,{virtual:!0})},this._nodeToGroupId=e.groupIdFunction||defaultGroupId2,this._groupSelfLoopEdges=!!e.groupSelfLoopEdges,this._nodeGenerator=e.nodeGenerator||defaultNodeGenerator,this._edgeGenerator=e.edgeGenerator||defaultNodeGenerator,this._shouldSetVirtual=!1,this._selector=e.selector,this.shouldDo=void 0===e.enabled||!!e.enabled}initialize(e){super.initialize(e),this._ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on("preAddGraph",this._onPreAddGraph).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}enable(){return this.enabled?Promise.resolve():(this.enabled=!0,this.shouldDo=!0,this.shouldUndo=!1,this._isRunning=!0,this._ogma.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then((e=>Promise.all([e,this._ogma.clearGraph()]))).then((([e])=>e)).then((e=>this._ogma.setGraph(e))).then((()=>(this.resolve(),this._isRunning=!1,Promise.resolve()))))}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,this.shouldUndo=!1,this.cleanup().then((()=>{Promise.resolve()}))):Promise.resolve()}run(){return this.enabled||!this.shouldDo?Promise.resolve(this._context):this._ogma.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then((e=>Promise.all([e,this._ogma.clearGraph()]))).then((([e])=>e)).then((e=>this._ogma.setGraph(e))).then((()=>Promise.resolve(this._context)))}undo(){return Promise.resolve(this._context)}getName(){return"node-clustering"}cleanup(){if(this._isRunning)return Promise.resolve();this._isCleaningUp=!0;const e=this._ogma.getNodes(Array.from(this._context.metaNodesSet)),t=this._ogma.getEdges(Array.from(this._context.metaEdgesSet)),s=this._getSubNodes(),i=this._getSubEdges();return this.resetContext(),this._ogma.removeNodes(e,{virtual:!0}).then((()=>this._ogma.removeEdges(t,{virtual:!0}))).then((()=>this._ogma.addNodes(s))).then((()=>this._ogma.addEdges(i))).then((()=>{this._isCleaningUp=!1,Promise.resolve()}))}resetContext(){this._isRunning||(super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,nodeToGroupId:new Map}))}getSubNodes(e){const t=this._context.nodeGroups.get(e.getId());return t?t.nodes:[]}getSubEdges(e){const t=this._context.edgeGroups.get(e.getId());return t?t.edges:[]}_getSubNodes(){return Array.from(this._context.nodeGroups.values()).reduce(((e,{nodes:t})=>(e.push(...t),e)),[])}_getSubEdges(){return Array.from(this._context.edgeGroups.values()).reduce(((e,{edges:t})=>(e.push(...t),e)),[])}_setVirtual(e,t){if(!e)return;const s=t?this._context.metaNodesSet:this._context.metaEdgesSet,i=e.filter((e=>s.has(e.getId())));this._ogma.modules.graph.storage.fetch(t).getFlexArray("virtual").setMultiple(i._indexes,1),t?this._context.virtualNodes=this._context.virtualNodes.concat(i):this._context.virtualEdges=this._context.virtualEdges.concat(i)}setContext(e){}_computeEdgeGroupId(e,t){return e>t?`${t}:${e}`:`${e}:${t}`}_groupEdges(e){const t=this._id,s=new Map,i=this._context.nodeToGroupId;this._context.edgeGroups.forEach((e=>{e.newEdges=[],s.set(e.id,e)}));const r=[];for(let t=0;t<e.length;++t){const o=e[t];let a=this._context.nodeToGroupId.get(o.source),l=this._context.nodeToGroupId.get(o.target);if(!a&&!l){r.push(o);continue}a=a||o.source,l=l||o.target;const d=this._computeEdgeGroupId(a,l);if(void 0!==d){const e=i.get(o.source)||o.source,t=i.get(o.target)||o.target;let r=s.get(d);r||(r={id:d,source:e,target:t,edges:[],newEdges:[]},s.set(d,r)),r.edges.push(o),r.newEdges.push(o)}}const o=mapValues(s),a=o.map((({edges:e})=>e));for(let e=0;e<o.length;++e){const s=o[e];if(!s.newEdges.length)continue;const i=s.id,l=a[e],d=this._edgeGenerator(l,i,this);void 0===d.id&&(d.id=generateMetaId(i,t)),d.source=s.source,d.target=s.target,s.metaEdge=d,this._context.metaEdgesSet.add(d.id);this._context.edgeGroups.get(d.id)||this._context.edgeGroups.set(d.id,s),(this._groupSelfLoopEdges||d.source!==d.target)&&r.push(d)}return this._ogma.view.afterNextFrame().then((()=>{this._context.edgeGroups.forEach((({newEdges:e,metaEdge:t})=>{if(!(e.length&&t&&t.id&&t.attributes))return;const s=this._ogma.getEdge(t.id);null==s||s.setAttributes(t.attributes)}))})),r}_groupNodes(e){const t=this._id,s=new Map;this._context.nodeGroups.forEach((e=>{e.newNodes=[],s.set(e.id,e)}));const i=[];for(let t=0;t<e.length;t++){const r=e[t];if(this._selector&&!this._selector(r)){i.push(r);continue}r.id=checkId(r.id);const o=this._nodeToGroupId(r);if(void 0!==o){let e=s.get(o);e||(e={id:o,nodes:[],newNodes:[]},s.set(o,e)),e.nodes.push(r),e.newNodes.push(r)}else this._context.nodeToGroupId.set(r.id,r.id)}const r=mapValues(s),o=r.map((({nodes:e})=>e)),a=r.map((({newNodes:e})=>e)),l=[];for(let e=0;e<r.length;++e){if(!r[e].newNodes.length)continue;const s=r[e].id,i=o[e],d=this._nodeGenerator(i,s,this);r[e].metaNode=d,void 0===d.id&&(d.id=generateMetaId(s,t));for(const t of a[e])this._context.nodeToGroupId.set(t.id,d.id);this._context.metaNodesSet.add(d.id);this._context.nodeGroups.get(d.id)||this._context.nodeGroups.set(d.id,r[e]),l.push(d)}return l.push(...i),this._ogma.view.afterNextFrame().then((()=>{this._context.nodeGroups.forEach((({newNodes:e,metaNode:t})=>{if(!(e.length&&t&&t.id&&t.attributes))return;const s=this._ogma.getNode(t.id);null==s||s.setAttributes(t.attributes)}))})),l}_setOptions(e){this._nodeToGroupId=e.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=void 0!==e.groupSelfLoopEdges?!!e.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=e.nodeGenerator||this._nodeGenerator,this._edgeGenerator=e.edgeGenerator||this._edgeGenerator,this._selector=e.selector||this._selector}};function overwrite(e,t){const s=t.length;return e.length=s,e.splice(0,s,...t),e}var wc=class extends Sc{constructor({selector:e=defaultItemSelector,duration:t,enabled:s,groupIdFunction:i=defaultGroupId,generator:r=defaultGeneratorFn,separateEdgesByDirection:o=!1}={}){super({nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:e,edgeGroupIdFunction:i,edgeGenerator:r,edgeSource:e=>e.getSource(),edgeTarget:e=>e.getTarget(),separateEdgesByDirection:o,groupEdges:!0,duration:t,enabled:s})}getName(){return"edge-grouping"}get context(){return this._context}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{metaEdges:this._ogma.edgeList(),subEdges:this._ogma.edgeList(),invalidMetaEdges:this._ogma.edgeList(),invalidSubEdges:this._ogma.edgeList()})}run(){let e,t;const s=this.getAnimationDuration();return this._addMetaEdges().then((i=>{e=i,t=e.getSubEdges().reduce(((e,value)=>e.concat(value)),this._ogma.createEdgeList());const r=this._context.invalidSubEdges.subtract(t),o=t.reduce(((e,t)=>(e[t.getId()]=!0,e)),{});return Promise.all([...e.map(((e,t)=>{const i=e.getParallelEdges({filter:"visible"}),r=i.filter((e=>!o[e.getId()])).reduce(((e,t)=>(e[t.getId()]=!0,e)),{});return r[e.getId()]=!0,i.setAttribute("curvature",i.map((t=>this._ogma.modules.curvatureManager.computeCurvature(o[t.getId()]?e:t,"all",(e=>r[e.getId()])))),s)})),r.setAttribute("curvature",this._getCurvatures(r),s)])})).then((()=>(t.setVisible(!1),e.setVisible(!0),__spreadProps(__spreadValues({},this._context),{metaEdges:e,subEdges:t,virtualEdges:e,invalidMetaEdges:this._context.metaEdges.subtract(e),invalidSubEdges:t}))))}undo(){const{metaEdges:e,subEdges:t}=this._context,s=this.getAnimationDuration(!1);this._removeMetaEdge(e),e.setVisible(!1);return t.filter((e=>e.getSource().isVisible()&&e.getTarget().isVisible())).setVisible(!0),e.setVisible(!1),this._context.invalidSubEdges=this._context.subEdges,t.setAttribute("curvature",this._getCurvatures(t),s)}_getCurvatures(e){return e.map((e=>this._ogma.modules.curvatureManager.computeCurvature(e,"visible",(e=>!0))))}cleanup(){const{virtualEdges:e,invalidMetaEdges:t}=this._context;return this._ogma.removeEdges(e.concat(t),{virtual:!0}).then((()=>(this._context.metaEdges=this._ogma.edgeList(),this._context.virtualEdges=this._ogma.edgeList(),this._context.invalidMetaEdges=this._ogma.edgeList(),this._context.invalidSubEdges=this._ogma.edgeList(),Promise.resolve())))}_setOptions({selector:e,duration:t,enabled:s,groupIdFunction:i,generator:r,separateEdgesByDirection:o}){super._setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:e,edgeGroupIdFunction:i,edgeGenerator:r,edgeSource:e=>e.getSource(),edgeTarget:e=>e.getTarget(),separateEdgesByDirection:o,groupEdges:!0,duration:t,enabled:s})}};function sortKD(e,t,s,i,r,o){if(r-i<=s)return;const a=i+r>>1;select(e,t,a,i,r,o%2),sortKD(e,t,s,i,a-1,o+1),sortKD(e,t,s,a+1,r,o+1)}function select(e,t,s,i,r,o){for(;r>i;){if(r-i>600){const a=r-i+1,l=s-i+1,d=Math.log(a),h=.5*Math.exp(2*d/3),u=.5*Math.sqrt(d*h*(a-h)/a)*(l-a/2<0?-1:1);select(e,t,s,Math.max(i,Math.floor(s-l*h/a+u)),Math.min(r,Math.floor(s+(a-l)*h/a+u)),o)}const a=t[2*s+o];let l=i,d=r;for(swapItem(e,t,i,s),t[2*r+o]>a&&swapItem(e,t,i,r);l<d;){for(swapItem(e,t,l,d),l++,d--;t[2*l+o]<a;)l++;for(;t[2*d+o]>a;)d--}t[2*i+o]===a?swapItem(e,t,i,d):(d++,swapItem(e,t,d,r)),d<=s&&(i=d+1),s<=d&&(r=d-1)}}function swapItem(e,t,s,i){swap2(e,s,i),swap2(t,2*s,2*i),swap2(t,2*s+1,2*i+1)}function swap2(e,t,s){const i=e[t];e[t]=e[s],e[s]=i}function sqDist(e,t,s,i){const r=e-s,o=t-i;return r*r+o*o}var defaultGetX2=e=>e[0],defaultGetY2=e=>e[1],Tc=class{constructor(e,t=defaultGetX2,s=defaultGetY2,i=64,r=Float64Array){this.nodeSize=i,this.points=e;const o=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(e.length),l=this.coords=new r(2*e.length);for(let i=0;i<e.length;i++)a[i]=i,l[2*i]=t(e[i]),l[2*i+1]=s(e[i]);sortKD(a,l,i,0,a.length-1,0)}range(e,t,s,i){return function range2(e,t,s,i,r,o,a){const l=[0,e.length-1,0],d=[];let h,u;for(;l.length;){const c=l.pop(),m=l.pop(),p=l.pop();if(m-p<=a){for(let a=p;a<=m;a++)h=t[2*a],u=t[2*a+1],h>=s&&h<=r&&u>=i&&u<=o&&d.push(e[a]);continue}const y=Math.floor((p+m)/2);h=t[2*y],u=t[2*y+1],h>=s&&h<=r&&u>=i&&u<=o&&d.push(e[y]);const x=(c+1)%2;(0===c?s<=h:i<=u)&&(l.push(p),l.push(y-1),l.push(x)),(0===c?r>=h:o>=u)&&(l.push(y+1),l.push(m),l.push(x))}return d}(this.ids,this.coords,e,t,s,i,this.nodeSize)}within(e,t,s){return function within(e,t,s,i,r,o){const a=[0,e.length-1,0],l=[],d=r*r;for(;a.length;){const h=a.pop(),u=a.pop(),c=a.pop();if(u-c<=o){for(let r=c;r<=u;r++)sqDist(t[2*r],t[2*r+1],s,i)<=d&&l.push(e[r]);continue}const m=Math.floor((c+u)/2),p=t[2*m],y=t[2*m+1];sqDist(p,y,s,i)<=d&&l.push(e[m]);const x=(h+1)%2;(0===h?s-r<=p:i-r<=y)&&(a.push(c),a.push(m-1),a.push(x)),(0===h?s+r>=p:i+r>=y)&&(a.push(m+1),a.push(u),a.push(x))}return l}(this.ids,this.coords,e,t,s,this.nodeSize)}};var Cc=class extends Sc{constructor({duration:e,enabled:t,padding:s=0,selector:i=defaultItemSelector,groupIdFunction:r=defaultGroupId,edgeGroupIdFunction:o=defaultGroupId,nodeGenerator:a=defaultGeneratorFn,edgeGenerator:l=defaultGeneratorFn,separateEdgesByDirection:d=!1,groupSelfLoopEdges:h=!1,groupEdges:u=!0,restorePositions:c=!0,showContents:m=!1,onCreated:p}={}){super({nodeSelector:i,nodeGroupIdFunction:r,edgeGroupIdFunction:o,nodeGenerator:a,edgeSelector:e=>!(!e.getSource().getMetaNode()&&!e.getTarget().getMetaNode()),edgeGenerator:l,edgeSource:e=>selfOrMetaNode(e.getSource()),edgeTarget:e=>selfOrMetaNode(e.getTarget()),separateEdgesByDirection:d,groupEdges:u,groupSelfLoopEdges:h,duration:e,enabled:t}),this._metaNodesIds=new Set,this._padding=s,this._showContents="function"!=typeof m?()=>m:m,this._restorePositions=c,this._onCreated=p||((e,t,s,i)=>{})}getName(){return"node-grouping"}get context(){return this._context}get padding(){return this._padding}set padding(e){this._padding=e,this._refresh()}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{metaNodes:this._ogma.nodeList(),metaEdges:this._ogma.edgeList(),subNodes:this._ogma.nodeList(),collapsedSubNodes:this._ogma.nodeList(),subEdges:this._ogma.edgeList(),subnodesVisibility:[],offsets:[]})}run(){let e,t;const s=this._ogma,i=this.getAnimationDuration();let r=s.createNodeList(),o=s.createNodeList(),a=s.createEdgeList();const l=[],d=this._ogma.modules.grouping,h=[],u=new Set,c=new Set;let m=[];return this._addMetaNodes().then((t=>(e=t,m=e.reduce(((e,t)=>{const s=t.getSubNodes();return e.concat(s?s.isVisible():[])}),[]),e.setVisible(!1),this._addMetaEdges()))).then((h=>(t=h,e.forEach((e=>{const t=e.getSubNodes(),s=e.getPosition(),i=this._showContents(e);if(!t||t.map((e=>!e.isVisible())).every((e=>e)))e.setVisible(!1);else if(t){if(i){u.add(e._index);const s=t.getAdjacentEdges({bothExtremities:!0});t.setVisible(!0),s.forEach((e=>c.add(e._index)))}else{u.delete(e._index),d.removeVisibleGroup(e),l.push(...t.getPosition().map((e=>(e.x=e.x-s.x,e.y=e.y-s.y,e)))),r=r.concat(t);const i=t.toArray();for(;0!==i.length;){const e=i.pop(),t=e.getSubNodes();t&&d.isVisibleGroup(e)&&(t.setVisible(!1),t.getAdjacentEdges({bothExtremities:!0}).setVisible(!1),i.push.apply(i,t.toArray()))}}o=o.concat(t)}})),a=t.getSubEdges().reduce(((e,t)=>{const s=t.filter((e=>{if(c.has(e._index))return!1;const t=e.getSource().getMetaNode(),s=e.getTarget().getMetaNode();return!(t&&s&&d.isVisibleGroup(t)&&d.isVisibleGroup(s)&&t===s)}));return e.concat(s)}),s.createEdgeList()),r.setAttributes(r.getPosition().map(((e,t)=>{const s=l[t];return e.x-=s.x,e.y-=s.y,e})),i)))).then((()=>{r.setVisible(!1),a.setVisible(!1),e.setVisible(!0),this._ogma.modules.events.fire("groupingRun",{metaNodes:e,padding:isNaN(+this._padding)?e.map((e=>(0,this._padding)(e)||0)):this._padding}),t.filter((e=>this._groupSelfLoopEdges||e.getSource()!==e.getTarget())).setVisible(!0)})).then((()=>{const i=new Set;e.forEach((e=>{const t=u.has(e._index),r=e.getSubNodes();if(r){const o=r.getAdjacentEdges({filter:"all",bothExtremities:!0});if(t){const a=r.reduce(((e,t)=>{const s=d.getNodeDepth(t);return i.add(t._index),s<e?s:e}),0);o.forEach((e=>c.add(e._index))),d.addVisibleGroup(e,-1+a),this._metaNodesIds.has(e.getId())||(this._metaNodesIds.add(e.getId()),h.push(function toPromise(value){return value&&"function"===value.then?value:Promise.resolve(value)}(this._onCreated(e,t,r,o)).then(s.view.afterNextFrame)))}}})),t.forEach((e=>{const t=Math.min(d.getNodeDepth(e.getSource()),d.getNodeDepth(e.getTarget()));e.setAttribute("layer",t)})),a=a.filter((e=>!c.has(e._index))),r=r.filter((e=>!i.has(e._index))),s.removeNodes(this.context.metaNodes.subtract(e),{virtual:!0}),s.removeEdges(this.context.metaEdges.subtract(t),{virtual:!0}),this._ogma.modules.graphics.getAttributesManager().update()})).then((()=>Promise.all(h))).then((()=>({metaNodes:e,metaEdges:t,subnodesVisibility:m,collapsedSubNodes:r,virtualNodes:e,virtualEdges:t,subNodes:o,nodeDataUpdates:this._context.nodeDataUpdates,edgeDataUpdates:this._context.edgeDataUpdates,subEdges:a,offsets:l})))}undo(){const{metaNodes:e,metaEdges:t,subnodesVisibility:s,subNodes:i,offsets:r,collapsedSubNodes:o,subEdges:a}=this._context,l=this.getAnimationDuration(),d=this._ogma.modules.grouping,h=this._ogma.getNodes(o.getMetaNode()).getPosition(),u=h.map(((e,t)=>function add4(e,t){return{x:e.x+t.x,y:e.y+t.y}}(e,r[t])));return i.forEach(((e,t)=>e.setVisible(s[t]))),a.setVisible(!0),d.setMetaElement(i,null),d.setMetaElement(a,null),e.setVisible(!1),t.setVisible(!1),o.setAttributes(h).then((()=>this._restorePositions?o.setAttributes(u,l):Promise.resolve(o)))}cleanup(){const e=this._ogma,t=this._context,{metaNodes:s,metaEdges:i}=t;return Promise.all([()=>this._ogma.modules.grouping.resetOffsets(),e.removeEdges(i,{virtual:!0}),e.removeNodes(s,{virtual:!0})]).then((()=>Promise.resolve()))}_setOptions({duration:e,enabled:t,padding:s,selector:i,groupIdFunction:r,nodeGenerator:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupSelfLoopEdges:h,groupEdges:u,restorePositions:c,showContents:m,onCreated:p}={}){super._setOptions({nodeSelector:i,nodeGroupIdFunction:r,nodeGenerator:o,edgeSelector:e=>!(!e.getSource().getMetaNode()&&!e.getTarget().getMetaNode()),edgeGroupIdFunction:a,edgeGenerator:l,edgeSource:e=>selfOrMetaNode(e.getSource()),edgeTarget:e=>selfOrMetaNode(e.getTarget()),separateEdgesByDirection:d,groupEdges:u,groupSelfLoopEdges:h,duration:e,enabled:t}),this._padding=void 0!==s?s:this.padding,this._showContents=void 0!==m?"function"!=typeof m?()=>m:m:this._showContents,this._restorePositions=void 0===c?this._restorePositions:c,this._onCreated=p||this._onCreated}};function selfOrMetaNode(e){return e.getMetaNode()||e}var toMercatorLat=e=>{const t=Math.sin(e*Math.PI/180);return(e=.5-.25*Math.log((1+t)/(1-t))/Math.PI)<0?0:e>1?1:e},kc=class extends Cc{constructor(e){super(__spreadProps(__spreadValues({},e),{selector:t=>{const s=this.getPosition(t);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!e.selector||e.selector(t))},groupIdFunction:t=>{let s=e.groupIdFunction?e.groupIdFunction(t):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(t)}`},edgeGroupIdFunction:t=>{let s=e.edgeGroupIdFunction?e.edgeGroupIdFunction(t):"";return s||(s=""),`${s}-${this.getNodeId(t.getSource())}-${this.getNodeId(t.getTarget())}`},nodeGenerator:(t,s,i)=>{let r=e.nodeGenerator?e.nodeGenerator(t,s,i):{};r||(r={});const o=this.getCoords(t.get(0));return r.data?r.data=merge(r.data,o):r.data=o,r}})),this._zoomLevels=e.zoomLevels?e.zoomLevels:[0,22],this._groupingRadius=void 0===e.radius?60:e.radius,this._generateIdFunction=e.groupIdFunction||(()=>""),this._shouldEnable=e.enabled,this._shouldRefreshClusters=!0}initialize(e){super.initialize(e);const t=this._ogma;this._ogma.modules.events.on("beforeGeoCameraMove",(({zoom:e})=>{this.enabled&&t.geo.enabled()&&this.getClosestZoomLevel(e).zoom!==this._currentClusters.zoom&&(this._shouldRefreshClusters=!1,this._refresh())})),t.events.on("geoDisabled",(()=>{this.isEnabled()&&this.disable(0).then((()=>{this._shouldEnable=!0}))})),t.events.on("geoEnabled",(()=>{this._shouldEnable&&this.enable(0)}))}getPosition(e){return{x:e.getData(this._ogma.modules.geo.latitudePath),y:e.getData(this._ogma.modules.geo.longitudePath)}}getMercatorPosition(e){return{x:(t=e.getData(this._ogma.modules.geo.longitudePath),t/360+.5),y:toMercatorLat(e.getData(this._ogma.modules.geo.latitudePath))};var t}getNodeId(e){var t;return(null==(t=this._currentClusters.idToCluster.get(e._index))?void 0:t.id)||""}enable(e){return this._ogma&&!this._ogma.modules.geo.isEnabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(e)}disable(e){return this._shouldEnable=!1,super.disable(e)}getCoords(e){var t;const s=(null==(t=this._currentClusters.idToCluster.get(e._index))?void 0:t.center)||{x:0,y:0},i={};return this.setToPropertyPath(i,this._ogma.modules.geo.latitudePath,s.x),this.setToPropertyPath(i,this._ogma.modules.geo.longitudePath,s.y),i}setToPropertyPath(e,t,value){if("string"==typeof t)return this.setToPropertyPath(e,t.split("."),value);{let s=e;t.forEach(((e,i)=>{i===t.length-1?s[e]=value:s[e]||(s[e]={}),s=s[e]}))}}nodeToElement(e){return{nodeId:e._index,generatedId:this._generateIdFunction(e),nodes:this._ogma.nodeList(new Uint32Array([e._index])),radius:e.getAttribute("radius"),center:this.getPosition(e),mercatorCenter:this.getMercatorPosition(e),zoom:1/0}}getCluster(e){const t=e.reduce(((t,s)=>({x:t.x+s.center.x/e.length,y:t.y+s.center.y/e.length})),{x:0,y:0}),s=e.reduce(((t,s)=>({x:t.x+s.mercatorCenter.x/e.length,y:t.y+s.mercatorCenter.y/e.length})),{x:0,y:0}),i=e.reduce(((e,s)=>{const i=t.x-s.center.x,r=t.y-s.center.y,o=s.radius+Math.sqrt(i*i+r*r);return Math.max(o,e)}),0);return{nodes:this._ogma.nodeList(new Uint32Array(e.map((({nodeId:e})=>e)))),generatedId:e[0].generatedId,center:t,mercatorCenter:s,radius:i}}onePassCluster(e){const t=e.map((e=>this.nodeToElement(e))),[s,i]=this._zoomLevels,r=[];for(let e=i;Math.abs(e-s)>.01;e-=1*(i-s)/19){const s=[],i=new Tc(t,(({mercatorCenter:e})=>e.x),(({mercatorCenter:e})=>e.y),16,Float32Array);t.forEach((r=>{if(r.zoom<=e)return;const o=this._groupingRadius/(256*Math.pow(2,r.zoom-1));let a=i.within(r.mercatorCenter.x,r.mercatorCenter.y,o).map((e=>t[e])).filter((t=>t.zoom>e&&t&&t.generatedId===r.generatedId));a.length||(a=[r]),a.forEach((t=>t.zoom=e)),s.push(__spreadProps(__spreadValues({},this.getCluster(a)),{zoom:e,id:`${e.toFixed(2)}-${s.length}`}))})),r.push({zoom:e,clusters:s})}return r.map((({zoom:e,clusters:t})=>{const s=new Map;return t.forEach((e=>{e.nodes.forEach((({_index:t})=>s.set(t,e)))})),{zoom:e,idToCluster:s}}))}getClosestZoomLevel(e){return this._clustersByZoom.reduce(((t,s)=>Math.abs(e-s.zoom)<Math.abs(e-t.zoom)?s:t))}run(){var e;this._shouldRefreshClusters&&(this._clustersByZoom=this.onePassCluster(this._ogma.getNodes().filter((e=>this._nodeSelector(e)))));const t=(null==(e=this._ogma.geo.getMap())?void 0:e.getZoom())||0;return this._currentClusters=this.getClosestZoomLevel(t),this.whenApplied().then((()=>{this._ogma.view.afterNextFrame().then((()=>{this._ogma.modules.geo.updateProjection()}))})),this._shouldRefreshClusters=!0,super.run()}_setOptions(e){super._setOptions(__spreadProps(__spreadValues({},e),{selector:t=>{const s=this.getPosition(t);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!e.selector||e.selector(t))},groupIdFunction:t=>{let s=e.groupIdFunction?e.groupIdFunction(t):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(t)}`},nodeGenerator:(t,s,i)=>{let r=e.nodeGenerator?e.nodeGenerator(t,s,i):{};r||(r={});const o=this.getCoords(t.get(0));return r.data?r.data=merge(r.data,o):r.data=o,r},edgeGroupIdFunction:t=>{let s=e.edgeGroupIdFunction?e.edgeGroupIdFunction(t):"";return s||(s=""),`${s}-${this.getNodeId(t.getSource())}-${this.getNodeId(t.getTarget())}`}})),this._groupingRadius=void 0===e.radius?this._groupingRadius:e.radius,this._generateIdFunction=e.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=e.enabled,this._ogma.modules.geo.filter._refresh(),this._refresh()}};function isID(e){return null!=e}function defaultEdgeGenerator(e,t){return{source:e.getId(),target:t.getId()}}var Mc=class extends Xd{constructor(e){super(e);const{selector:t=trueFn,neighborIdFunction:s=nullFn,nodeGenerator:i=(()=>({})),edgeGenerator:r=defaultEdgeGenerator}=e;this._generateIds=e=>t&&t(e)&&s(e)||null,this._nodeGenerator=i,this._edgeGenerator=r||defaultEdgeGenerator}getName(){return"neighbor-generation"}run(){const e=this._id,t=this._ogma,s=this.getAnimationDuration(),i=t.getNodes(),r=new Map;for(let e=0;e<i.size;++e){const t=i.get(e),s=(value=this._generateIds(t),(Array.isArray(value)?value:value?[value]:null)||[]).filter(isID);if(s)for(let e=0;e<s.length;++e){const i=s[e];let o=r.get(i);o||(o=[],r.set(i,o)),o.push(t)}}var value;const o=new Array(r.size),a=[],l=mapKeys(r),d=mapValues(r).map((e=>t.getNodes(e)));for(let t=0;t<o.length;++t){const s=l[t],i=d[t],r=this._nodeGenerator(s,i);r.id=`_gen_${e}_${s}`;const a=computeCentroid(i.getPosition());r.attributes=r.attributes||{},r.attributes.x=a.x,r.attributes.y=a.y,o[t]=r}let h,u;return t.addNodes(o.map((e=>({id:e.id,attributes:e.attributes}))),{virtual:!0}).then((()=>{h=t.getNodes(o.map((e=>e.id))),h.replaceOriginalAttributes(o.map((e=>e.attributes)),["x","y"]),h.setData(null,o.map((e=>e.data)));for(let e=0;e<h.size;++e){const t=h.get(e),s=d[e];for(let e=0;e<s.size;++e){const i=s.get(e),r=this._edgeGenerator(i,t);r.source||r.target||(r.source=i.getId(),r.target=t.getId()),r.id||(r.id=`${r.source}-${r.target}`),a.push(r)}}return t.addEdges(a,{virtual:!0})})).then((()=>(u=t.getEdges(a.map((e=>e.id))),h.setVisible(!0),u.setVisible(!0),h.addClass(Zs),u.addClass(Zs),t.removeNodes(this._context.virtualNodes.subtract(h),{virtual:!0}),t.removeEdges(this._context.virtualEdges.subtract(u),{virtual:!0}),Promise.all([h.removeClass(Zs,s),u.removeClass(Zs,s)])))).then((()=>({virtualNodes:h,virtualEdges:u})))}undo(){const{virtualNodes:e,virtualEdges:t}=this._context;if(!t||!e)return Promise.resolve(this._context);const s=this.getAnimationDuration();return Promise.all([e.addClass(Zs,s),t.addClass(Zs,s)]).then((()=>{e.setVisible(!1),t.setVisible(!1)}))}cleanup(){const{virtualEdges:e,virtualNodes:t}=this._context;if(e&&t){const s=t.filter((e=>!e.isVisible())),i=e.filter((e=>!e.isVisible()));this._ogma.removeNodes(s,{virtual:!0}),this._ogma.removeEdges(i,{virtual:!0})}return Promise.resolve()}_setOptions(e){const{selector:t,neighborIdFunction:s,nodeGenerator:i,edgeGenerator:r}=e;this._generateIds=t?e=>t&&t(e)&&s(e)||null:this._generateIds,this._nodeGenerator=i||this._nodeGenerator,this._edgeGenerator=r||this._edgeGenerator,super._setOptions(e)}};var Lc=class extends Xd{constructor(e){super(e),this._selector=e.selector||falseFn,this._dataFunction=e.dataFunction||noop}run(){const e=this.getAnimationDuration(),t=this._ogma,s=t.getNodes().filter(this._selector?this._selector:e=>!0),i=[],r=new Map;for(let e=0;e<s.size;++e){const t=s.get(e),o=t.getAdjacentEdges(),a=this._dataFunction(t);for(let e=0;e<o.size;++e){const s=o.get(e),l=s.getSource(),d=s.getTarget();if(l!==d&&void 0!==a){const e=l===t?d:l;let s=r.get(e);s||(s=[],r.set(e,s)),s.push(a)}i.push(s)}}const o=t.getEdges(i),a=t.getNodes(mapKeys(r)),l=mapValues(r),d=a.getData(),h=new Array(a.size);for(let e=0;e<h.length;++e){const t=l[e];let s=d[e];for(let e=0;e<t.length;++e)s=merge(s,t[e]);h[e]=s}return Promise.all([s.addClass(Zs,e),o.addClass(Zs,e)]).then((()=>(s.setVisible(!1),o.setVisible(!1),a.setData(h),__spreadProps(__spreadValues({},this._context),{hiddenNodes:s,hiddenEdges:o,nodesWithDataChange:a,oldDataList:d}))))}getName(){return"neighbor-merging"}get context(){return this._context}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{hiddenNodes:this._ogma.nodeList(),hiddenEdges:this._ogma.edgeList(),nodesWithDataChange:this._ogma.nodeList(),oldDataList:[]})}undo(){const{hiddenNodes:e,hiddenEdges:t,nodesWithDataChange:s,oldDataList:i}=this._context;e.setVisible(!0),t.setVisible(!0),e.addClass(Zs),t.addClass(Zs);const r=this.getAnimationDuration();return Promise.all([e.removeClass(Zs,r),t.removeClass(Zs,r)]).then((()=>{s.setData(i)}))}cleanup(){return Promise.resolve()}_setOptions(e){this._selector=e.selector||this._selector,this._dataFunction=e.dataFunction||this._dataFunction,super._setOptions(e)}};function sameLists(e,t){return e.size===t.size&&e.filter((e=>t.includes(e))).size>0}var Ic=class extends Xd{constructor(e){super(e),this._selector=e.selector||(e=>!1),this._edgeGenerator=e.edgeGenerator||(()=>({}))}getName(){return"node-collapsing"}get context(){return this._context}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{hiddenNodes:this._ogma.nodeList(),hiddenEdges:this._ogma.edgeList()})}run(){const e=this._ogma,t=this.getAnimationDuration(),s=e.getNodes().filter(this._selector),i=s.getAdjacentEdges(),r=[],o=s.map((e=>e.getAdjacentNodes().filter((e=>!this._selector(e)))));for(let e=0;e<s.size;e++)for(let t=e;t<s.size;t++){const i=s.get(e),r=s.get(t);if(this._ogma.modules.graph.getEdgesBetweenTwoNodes(i,r).size>0&&(o[e].size||o[t].size)&&!sameLists(o[e],o[t]))throw Error(`addNodeCollapsing: invalid connected nodes [${i.getId()}] and [${r.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}for(let t=0;t<s.size;++t){const i=s.get(t),a=o[t];for(let t=0;t<a.size-1;++t){const s=a.get(t),o=this._ogma.modules.graph.getEdgesBetweenTwoNodes(i,s);if(s!==i)for(let l=t+1;l<a.size;++l){const t=a.get(l),d=this._ogma.modules.graph.getEdgesBetweenTwoNodes(i,t),h=this._edgeGenerator(i,s,t,o,d);if(h){const a=toArray(h);for(let l=0;l<a.length;++l)r.push(formatRawEdge(e,a[l],l,i,s,t,o,d))}}}}return e.addEdges(r,{virtual:!0}).then((()=>this._ogma.getEdges(r.map((e=>e.id))).addClass(Zs))).then((e=>Promise.all([e.removeClass(Zs,t),s.addClass(Zs,t),i.addClass(Zs,t)]))).then((([t])=>(s.setVisible(!1),i.setVisible(!1),t.setVisible(!0),e.removeEdges(this.context.virtualEdges.subtract(t),{virtual:!0}),this._ogma.modules.graphics.getAttributesManager().update(),__spreadProps(__spreadValues({},this._context),{virtualEdges:t,hiddenNodes:s,hiddenEdges:i}))))}undo(){const{hiddenNodes:e,hiddenEdges:t}=this._context,s=this._ogma,i=this.getAnimationDuration(),r=this._context.virtualEdges||s.createEdgeList();return e.setVisible(!0),t.setVisible(!0),Promise.all([e.addClass(Zs),t.addClass(Zs)]).then((()=>Promise.all([r.addClass(Zs,i),e.removeClass(Zs,i),t.removeClass(Zs,i)]))).then((()=>{r.setVisible(!1)}))}cleanup(){const e=this._context.virtualEdges||this._ogma.createEdgeList();return this._ogma.removeEdges(e,{virtual:!0})}_setOptions(e){this._selector=e.selector||this._selector,this._edgeGenerator=e.edgeGenerator||this._edgeGenerator,super._setOptions(e)}};function formatRawEdge(e,t,s,i,r,o,a,l){let d,h;if(void 0!==t.source&&(d=e.getNode(t.source),d!==r&&d!==o))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${t.source}]`,`expected to be [${r.getId()}] or [${o.getId()}]`].join("; "));if(void 0!==t.target&&(h=e.getNode(t.target),h!==r&&h!==o))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${t.target}]`,`expected to be [${r.getId()}] or [${o.getId()}]`].join("; "));if(d&&h&&d===h)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${d.getId()}]`);if(d&&!h)h=d===r?o:r;else if(h&&!d)d=h===r?o:r;else if(!d&&!h){let e=!0;for(let t=0;t<a.size;++t){a.get(t).getSource()===r&&(e=!1)}for(let t=0;t<l.size;++t){l.get(t).getTarget()===o&&(e=!1)}e?(d=o,h=r):(d=r,h=o)}return d&&h?__spreadProps(__spreadValues({},t),{id:`_gen_${i.getId()}_${d.getId()}_${h.getId()}_${s}`,source:d.getId(),target:h.getId()}):{}}var Nc=class extends Xd{constructor(e){super(e),this._nodeSelector=e.nodeSelector||(e=>!0),this._edgeSelector=e.edgeSelector||(e=>!0),this._nodeDataFunction=e.nodeDataFunction||null,this._edgeDataFunction=e.edgeDataFunction||null}getName(){return"virtual-properties"}get context(){return this._context}resetContext(){super.resetContext(),this._context=__spreadProps(__spreadValues({},this._context),{nodes:this._ogma.nodeList(),oldNodesData:[],edges:this._ogma.edgeList(),oldEdgesData:[]})}run(){const e=this._ogma,t=this._context;return this._nodeDataFunction&&(t.nodes=e.getNodes().filter(this._nodeSelector),t.oldNodesData=applyChanges(t.nodes,this._nodeDataFunction)),this._edgeDataFunction&&(t.edges=e.getEdges().filter(this._edgeSelector),t.oldEdgesData=applyChanges(t.edges,this._edgeDataFunction)),Promise.resolve(t)}undo(){const{nodes:e,oldNodesData:t,edges:s,oldEdgesData:i}=this._context;return e&&e.setData(t),s&&s.setData(i),Promise.resolve()}cleanup(){return Promise.resolve()}_setOptions(e){this._nodeSelector=e.nodeSelector||this._nodeSelector,this._edgeSelector=e.edgeSelector||this._edgeSelector,this._nodeDataFunction=e.nodeDataFunction||this._nodeDataFunction,this._edgeDataFunction=e.edgeDataFunction||this._edgeDataFunction,super._setOptions(e)}};function applyChanges(e,t){const s=[];for(let i=0;i<e.size;++i){const r=e.get(i),o=r.getData(),a=t(r),l=merge(o,a);s.push(o),r.setData(l)}return s}var Pc=class extends p{constructor(e){super(e),this.getList=()=>this._ogma.modules.transformations.getList(),this.clear=()=>this._ogma.modules.transformations.clear(),this.getById=e=>this._ogma.modules.transformations.getById(e),this.afterNextUpdate=()=>this._ogma.modules.transformations.whenApplied();const{addNodeGrouping:t,addEdgeGrouping:s,addGeoClustering:i}=(e=>({addNodeGrouping:(t={})=>{const s=new Cc(t);return e.modules.transformations.add(s)},addEdgeGrouping:(t={})=>e.modules.transformations.add(new wc(t)),addGeoClustering:t=>{if(e.modules.transformations.getList().find((e=>"geo-clustering"===e.getName())))throw new Error("Trying to add more than one geo clustering. Please refer to the documentation about this issue.");return e.modules.transformations.add(new kc(t))}}))(e);this.addNodeGrouping=t,this.addEdgeGrouping=s,this.addGeoClustering=i;const{addNodeClustering:r}=(e=>({addNodeClustering:(t={})=>e.modules.transformations.add(new Ec(t))}))(e);this.addNodeClustering=r;const{addNodeFilter:o,addEdgeFilter:a,getNodeFilters:l,getEdgeFilters:d}=(e=>({addNodeFilter:t=>e.modules.filters.addNodeFilter(t),addEdgeFilter:t=>e.modules.filters.addEdgeFilter(t),getNodeFilters:()=>e.modules.transformations.getList().filter((e=>"node-filter"===e.getName())),getEdgeFilters:()=>e.modules.transformations.getList().filter((e=>"edge-filter"===e.getName()))}))(e);this.addNodeFilter=o,this.addEdgeFilter=a,this.getNodeFilters=l,this.getEdgeFilters=d;const{addNeighborGeneration:h,addNeighborMerging:u}=(e=>({addNeighborGeneration:t=>e.modules.transformations.add(new Mc(t)),addNeighborMerging:t=>e.modules.transformations.add(new Lc(t))}))(e);this.addNeighborGeneration=h,this.addNeighborMerging=u;const{addNodeCollapsing:c}=(e=>({addNodeCollapsing:(t={})=>e.modules.transformations.add(new Ic(t))}))(e);this.addNodeCollapsing=c;const{addVirtualProperties:m}=(e=>({addVirtualProperties:t=>e.modules.transformations.add(new Nc(t))}))(e);this.addVirtualProperties=m}},Fc=class{constructor(e,t){this._ogma=e,"webgl"===_a&&Xr.cacheInitData(Xr.createInitData()),this.settings=new ba(e),this.events=new fa(e),this.dom=new Os(e),this.animations=new $a(e),this.camera=new ga(e),this.graph=new bi(e),this.data=new Bs(e),this.graphics=new pa(e),this.layers=new Kd(e),this.individualAttributes=new xa(e),this.algorithms=new Jd(e),this.position=new Wd(e),this.touch=new Pa(e),this.mouse=new Ia(e),this.virtualMouse=new Sl(e),this.spatial=new wa(e),this.captor=new Jl(e),this.interactions=new ql(e),this.classes=new Aa(e),this.cameraInteractions=new ha(e,!!t.debug),this.hover=new Gd(e),this.keyboard=new fd(e),this.selection=new ja(e),this.styleRules=new Cl(e),this.legend=new Od(e),this.sync=new Va(e),this.rules=new qd(e),this.transformations=new Ra(e),this.filters=new Qd(e),this.locate=new Ma(e),this.drag=new sd(e),this.grouping=new Da(e),this.pulses=new Ha(e),this.curvatureManager=new sl(e),this.workers=new ul(e),this.layouts=new pl(e),this.watcher=new Al(e),this.rectangleSelect=new Nl(e),this.labels=new Hl(e,t),this.brand=new Ja(e),this.lasso=new Ll(e),this.rewiring=new nd(e),this.resizing=new ad(e),this.snapping=new wl(e),this.connectNodes=new dd(e),this.tooltip=new md(e),this.geo=new tl(e),Object.keys(this).forEach((e=>{const t=this[e];t instanceof Ds&&(t._setModules(this),t.onMounted())})),e.onReady((()=>{Object.keys(this).forEach((e=>{const s=this[e];s instanceof Ds&&s.onReady(t)}))}))}destroy(){Object.keys(this).forEach((e=>{const t=this[e];t instanceof Ds&&t.destroy(this._ogma)}))}},zc=1,Dc=[class{getNodesByClassName(e,t){return this.modules.classes.getClassByName(e,!0).getNodes()}getEdgesByClassName(e,t){return this.modules.classes.getClassByName(e,!0).getEdges()}},class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},class{setContainer(e){this.modules.dom.setContainer(e)}getContainer(){return this.modules.dom.getContainer()}},class{addNodes(e,t){return addElements(this.modules.graph,!0,e,t)}addEdges(e,t){return addElements(this.modules.graph,!1,e,t)}addNode(e,t){return addElement(this.modules.graph,!0,e,t)}addEdge(e,t){return addElement(this.modules.graph,!1,e,t)}removeNodes(e,t){return function removeNodes(e,t,s){return removeElements(e,!0,t,s)}(this.modules.graph,e,t)}removeEdges(e,t){return function removeEdges(e,t,s){return removeElements(e,!1,t,s)}(this.modules.graph,e,t)}removeNode(e,t){return function removeNode(e,t,s){return removeElements(e,!0,[t],s)}(this.modules.graph,e,t)}removeEdge(e,t){return function removeEdge(e,t,s){return removeElements(e,!1,[t],s)}(this.modules.graph,e,t)}getNodes(e){return this.modules.graph.getNodes(e)}getEdges(e){return this.modules.graph.getEdges(e)}getNode(e){return this.modules.graph.getNode(e)}getEdge(e){return this.modules.graph.getEdge(e)}clearGraph(){this.modules.graph.clear()}setGraph(e,t){return this.modules.graph.clear(),this.addGraph(e,t)}addGraph(e,t){const s=0===this.modules.graph.getNodes().size,i=function addGraph(e,{nodes:t=[],edges:s=[]},i={}){if(e.fireEvent("preAddGraph",{name:"preAddGraph"}),!i.batchSize)return Promise.all([addToGraph(e,!0,t,i),addToGraph(e,!1,s,i)]).then((([t,s])=>(e.fireEvent("postAddGraph",{name:"postAddGraph"}),e.fireEvent("addGraph",{nodes:t,edges:s}),{nodes:t,edges:s})));let r;return addElements(e,!0,t,i).then((t=>(r=t,addElements(e,!1,s,i)))).then((e=>({nodes:r,edges:e}))).then((t=>(e.fireEvent("postAddGraph",{name:"postAddGraph"}),e.fireEvent("addGraph",{name:"addGraph"}),t)))}(this.modules.graph,e,t);return s?this.modules.locate.locateGraph({padding:30,ignoreZoomLimits:!0,duration:0}).then((()=>i)):i}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(e={}){return this.modules.graph.getConnectedComponents(this.getNodes(e.filter),e)}getConnectedComponentByNode(e,t){const s=this.modules.graph.getNode(e);if(void 0===s)throw new Error(`getComponentByNode: cannot find node ${e}`);return this.modules.graph.getConnectedComponentByNode(s,t)[0]}},class{reloadFonts(){this.modules.graphics.reloadFonts()}},class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},class{setOptions(e){return this.modules.settings.update(e)}getOptions(){return this.modules.settings.get()}}],Rc={version:"4.6.5",commit:"6718a692e",buildTime:"Fri Dec 29 2023 19:12:15 GMT+0000 (Coordinated Universal Time)"},Oc=class{constructor(e={}){this.node=e=>new yi(e,this),this.edge=e=>new ai(e,this),this.nodeList=e=>new xi(e||new Uint32Array(0),this),this.edgeList=e=>new li(e||new Uint32Array(0),this),this._onReady=[],this.build=Rc,this._init(e)}_init(e){this._initParameters=e,this._debug=!!e.debug,this._token=zc++,this.modules=new Fc(this,e),this.styles=new bc(this),this.algorithms=new eh(this),this.export=new gc(this),this.keyboard=new sh(this),this.generate=new _c(this),this.layouts=new fc(this),this.parse=new pc(this),this.transformations=new Pc(this),this.tools=new Ac(this),this.view=new Zu(this),this.mouse=new yc(this),this.events=new cc(this),this.schema=new Vu(this),this.rules=new xc(this),this.geo=new th(this),this.layers=new ih(this),this.debug=new uc(this),this._onReady.forEach((e=>e(this))),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"4.6.5",commit:"6718a692e",buildTime:"Fri Dec 29 2023 19:12:15 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(const e of Object.getOwnPropertyNames(Oc.prototype))"function"==typeof Oc.prototype[e]&&(this[e]=this[e].bind(this))}onReady(e){this._onReady.push(e)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){const e=this._initParameters;this._destroy(),this._init(e)}isDebug(){return this._debug}},Ogma=Oc;Ogma.libraries=ve,Ogma.geometry=Ta,Ogma.parse=dc,Ogma.build=Rc,Ogma.algorithms=y,Ogma.utils=de,Ogma.algorithms=y,Ogma.utils=de,Ogma.parse=dc,Ogma.build=Rc,function applyMixins(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((s=>{Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}))}))}(Ogma,Dc);var Bc,jc=Ogma,Vc=__toESM(u()),Uc=jc;return Bc=m,__copyProps(t({},"__esModule",{value:!0}),Bc)})();return void 0!==Ogma?Ogma:void 0}));